<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Guava 解析 | 守株阁</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言 Guava 本身适配不同的环境，Jdk 1.8 以上使用 jre flavor，Jdk 1.7 和 android 使用 android flavor。 类库的作者，不要使用 @Beta 成员，以后它们不会是 source-compatible。但我们可以使用其他成员，它们会是 binary-compatible，Guava 现在不会再因为非安全原因删除成员了，即使是 @Deprecated">
<meta property="og:type" content="article">
<meta property="og:title" content="Guava 解析">
<meta property="og:url" content="https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="守株阁">
<meta property="og:description" content="前言 Guava 本身适配不同的环境，Jdk 1.8 以上使用 jre flavor，Jdk 1.7 和 android 使用 android flavor。 类库的作者，不要使用 @Beta 成员，以后它们不会是 source-compatible。但我们可以使用其他成员，它们会是 binary-compatible，Guava 现在不会再因为非安全原因删除成员了，即使是 @Deprecated">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/Guava.jpg">
<meta property="article:published_time" content="2026-02-07T08:59:49.000Z">
<meta property="article:modified_time" content="2026-02-07T09:15:07.611Z">
<meta property="article:author" content="magicliang">
<meta property="article:tag" content="Guava">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/Guava.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Guava 解析",
  "url": "https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/",
  "image": "https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/Guava.jpg",
  "datePublished": "2026-02-07T08:59:49.000Z",
  "dateModified": "2026-02-07T09:15:07.611Z",
  "author": [
    {
      "@type": "Person",
      "name": "magicliang",
      "url": "https://magicliang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: 守株阁","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Guava 解析',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="守株阁" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/Guava.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">守株阁</span></a><a class="nav-page-title" href="/"><span class="site-name">Guava 解析</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Guava 解析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-02-07T08:59:49.000Z" title="Created 2026-02-07 16:59:49">2026-02-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-07T09:15:07.611Z" title="Updated 2026-02-07 17:15:07">2026-02-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">14k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>66mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1>前言</h1>
<p>Guava 本身适配不同的环境，Jdk 1.8 以上使用 jre flavor，Jdk 1.7 和 android 使用 android flavor。</p>
<p>类库的作者，不要使用 @Beta 成员，以后它们不会是 source-compatible。但我们可以使用其他成员，它们会是 binary-compatible，Guava 现在不会再因为非安全原因删除成员了，即使是 @Deprecated 的。</p>
<p>可用的功能见这个 <a target="_blank" rel="noopener" href="https://github.com/google/guava/wiki">User Guide</a>。</p>
<h1>common</h1>
<h2 id="collect">Collect</h2>
<h2 id="不可变集合">不可变集合</h2>
<p>Guava 提供了强类型的不可变集合，这些集合一旦创建就不能被修改，非常适合用于构建线程安全的应用和防御性编程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableList;<br><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableSet;<br><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableMap;<br><br><span class="hljs-comment">// 创建不可变 List</span><br>ImmutableList&lt;String&gt; immutableList = ImmutableList.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>);<br><span class="hljs-comment">// immutableList.add(&quot;D&quot;); // 抛出 UnsupportedOperationException</span><br><br><span class="hljs-comment">// 创建不可变 Set</span><br>ImmutableSet&lt;String&gt; immutableSet = ImmutableSet.of(<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-string">&quot;Z&quot;</span>);<br><br><span class="hljs-comment">// 创建不可变 Map</span><br>ImmutableMap&lt;String, Integer&gt; immutableMap = ImmutableMap.of(<br>    <span class="hljs-string">&quot;one&quot;</span>, <span class="hljs-number">1</span>,<br>    <span class="hljs-string">&quot;two&quot;</span>, <span class="hljs-number">2</span>,<br>    <span class="hljs-string">&quot;three&quot;</span>, <span class="hljs-number">3</span><br>);<br><br><span class="hljs-comment">// 使用 Builder 模式</span><br>ImmutableList&lt;String&gt; list = ImmutableList.&lt;String&gt;builder()<br>    .add(<span class="hljs-string">&quot;A&quot;</span>)<br>    .addAll(Arrays.asList(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>))<br>    .build();<br><br><span class="hljs-comment">// 复制现有集合</span><br>ImmutableList&lt;String&gt; copy = ImmutableList.copyOf(existingList);<br></code></pre></td></tr></table></figure>
<p>不可变集合的优势：</p>
<ul>
<li><strong>线程安全</strong>：多个线程可以安全地访问</li>
<li><strong>防御性编程</strong>：防止外部代码修改内部数据</li>
<li><strong>内存效率</strong>：可以使用更高效的数据结构表示</li>
</ul>
<p>Collections（集合扩展）</p>
<p>Guava 的集合扩展是其最核心、最受欢迎的功能模块之一。它提供了不可变集合、新集合类型、集合工具类等丰富的功能，极大地简化了 Java 集合操作。</p>
<p>不可变集合</p>
<h2 id="multiset">Multiset</h2>
<p><code>Multiset</code> 类似于 Java 的 Set，但它可以跟踪每个元素出现的次数。这使得它在需要计数的场景下非常实用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.HashMultiset;<br><span class="hljs-keyword">import</span> com.google.common.collect.Multiset;<br><span class="hljs-keyword">import</span> com.google.common.collect.TreeMultiset;<br><br><span class="hljs-comment">// HashMultiset - 无序，基于哈希</span><br>Multiset&lt;String&gt; wordCount = HashMultiset.create();<br>wordCount.add(<span class="hljs-string">&quot;apple&quot;</span>);<br>wordCount.add(<span class="hljs-string">&quot;banana&quot;</span>);<br>wordCount.add(<span class="hljs-string">&quot;apple&quot;</span>);<br>wordCount.add(<span class="hljs-string">&quot;orange&quot;</span>);<br>wordCount.add(<span class="hljs-string">&quot;banana&quot;</span>);<br>wordCount.add(<span class="hljs-string">&quot;apple&quot;</span>);<br><br>System.out.println(<span class="hljs-string">&quot;元素计数:&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;apple: &quot;</span> + wordCount.count(<span class="hljs-string">&quot;apple&quot;</span>));   <span class="hljs-comment">// 3</span><br>System.out.println(<span class="hljs-string">&quot;banana: &quot;</span> + wordCount.count(<span class="hljs-string">&quot;banana&quot;</span>)); <span class="hljs-comment">// 2</span><br>System.out.println(<span class="hljs-string">&quot;orange: &quot;</span> + wordCount.count(<span class="hljs-string">&quot;orange&quot;</span>)); <span class="hljs-comment">// 1</span><br><br>System.out.println(<span class="hljs-string">&quot;\n所有元素: &quot;</span> + wordCount); <span class="hljs-comment">// [apple x 3, banana x 2, orange]</span><br>System.out.println(<span class="hljs-string">&quot;不同元素数量: &quot;</span> + wordCount.elementSet().size()); <span class="hljs-comment">// 3</span><br>System.out.println(<span class="hljs-string">&quot;总元素数量: &quot;</span> + wordCount.size()); <span class="hljs-comment">// 6</span><br><br><span class="hljs-comment">// TreeMultiset - 有序，基于树</span><br>Multiset&lt;Integer&gt; sortedNumbers = TreeMultiset.create();<br>sortedNumbers.add(<span class="hljs-number">5</span>);<br>sortedNumbers.add(<span class="hljs-number">2</span>);<br>sortedNumbers.add(<span class="hljs-number">8</span>);<br>sortedNumbers.add(<span class="hljs-number">2</span>);<br>sortedNumbers.add(<span class="hljs-number">5</span>);<br><br>System.out.println(<span class="hljs-string">&quot;\n有序 Multiset: &quot;</span> + sortedNumbers); <span class="hljs-comment">// [2 x 2, 5 x 2, 8]</span><br></code></pre></td></tr></table></figure>
<h2 id="multimap">Multimap</h2>
<p>这个数据结构首先是一个接口，有以下子接口： ListMultimap、SetMultimap。不同的子接口的 Get 方法返回不同的数据结构。</p>
<p>有两种方法可以理解这个数据结构：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>a → 1, 2<br>   <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>b → 3<br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>第一种形式同 Stream 的 groupingBy 的操作结果类似：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;MapKey, List&lt;Object&gt;&gt; map = actionAggregates.stream()<br>                .collect(Collectors.groupingBy(objs -&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapKey</span>(obj.val1, obj.val2);<br>&#125;));<br></code></pre></td></tr></table></figure>
<p>第一种形式必须使用 asMap 创造一种视图，size 为 2。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>a → 1<br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>a → 2<br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>b → 3<br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>第二种形式本身属于天然形式，size 为 3（非 list 形式的，意味着 total entry count）。</p>
<p>所有的方法，都是视图方法：</p>
<ul>
<li>asMap(), mentioned above</li>
<li>keys(), keySet(), values(), entries(), which are similar to the corresponding view collections of Map</li>
<li>and, notably, even the collection returned by get(key) is an active view of the values corresponding to key 这一点很容易被忽略</li>
</ul>
<p>Multimaps 是 Map&lt;K, Collection<V>&gt; 更优秀的替代品。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.ArrayListMultimap;<br><span class="hljs-keyword">import</span> com.google.common.collect.HashMultimap;<br><span class="hljs-keyword">import</span> com.google.common.collect.Multimap;<br><br><span class="hljs-comment">// ArrayListMultimap - 值按添加顺序存储，允许重复</span><br>Multimap&lt;String, String&gt; studentCourses = ArrayListMultimap.create();<br>studentCourses.put(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;数学&quot;</span>);<br>studentCourses.put(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;英语&quot;</span>);<br>studentCourses.put(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;物理&quot;</span>);<br>studentCourses.put(<span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;数学&quot;</span>);<br>studentCourses.put(<span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;化学&quot;</span>);<br><br>System.out.println(<span class="hljs-string">&quot;张三的课程: &quot;</span> + studentCourses.get(<span class="hljs-string">&quot;张三&quot;</span>));<br><span class="hljs-comment">// [数学, 英语, 物理]</span><br><br>System.out.println(<span class="hljs-string">&quot;所有学生: &quot;</span> + studentCourses.keySet());<br><span class="hljs-comment">// [张三, 李四]</span><br><br>System.out.println(<span class="hljs-string">&quot;数学课的所有学生: &quot;</span> + studentCourses.keys()); <span class="hljs-comment">// 统计出现次数</span><br><span class="hljs-comment">// [张三, 李四 (count=2)]</span><br><br><span class="hljs-comment">// HashMultimap - 值无序，不允许重复</span><br>Multimap&lt;String, Integer&gt; departmentEmployees = HashMultimap.create();<br>departmentEmployees.put(<span class="hljs-string">&quot;研发部&quot;</span>, <span class="hljs-number">1001</span>);<br>departmentEmployees.put(<span class="hljs-string">&quot;研发部&quot;</span>, <span class="hljs-number">1002</span>);<br>departmentEmployees.put(<span class="hljs-string">&quot;研发部&quot;</span>, <span class="hljs-number">1003</span>);<br>departmentEmployees.put(<span class="hljs-string">&quot;市场部&quot;</span>, <span class="hljs-number">2001</span>);<br>departmentEmployees.put(<span class="hljs-string">&quot;市场部&quot;</span>, <span class="hljs-number">2002</span>);<br><br>System.out.println(<span class="hljs-string">&quot;\n研发部员工数量: &quot;</span> + departmentEmployees.get(<span class="hljs-string">&quot;研发部&quot;</span>).size());<br>System.out.println(<span class="hljs-string">&quot;部门-员工映射: &quot;</span> + departmentEmployees.asMap());<br></code></pre></td></tr></table></figure>
<h2 id="bimap-双向映射">BiMap（双向映射）</h2>
<p><code>BiMap</code> 是一种特殊的 Map，它保证值也是唯一的，并且可以通过值来查找键。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.BiMap;<br><span class="hljs-keyword">import</span> com.google.common.collect.HashBiMap;<br><br>BiMap&lt;String, String&gt; countryCode = HashBiMap.create();<br>countryCode.put(<span class="hljs-string">&quot;中国&quot;</span>, <span class="hljs-string">&quot;CN&quot;</span>);<br>countryCode.put(<span class="hljs-string">&quot;美国&quot;</span>, <span class="hljs-string">&quot;US&quot;</span>);<br>countryCode.put(<span class="hljs-string">&quot;日本&quot;</span>, <span class="hljs-string">&quot;JP&quot;</span>);<br><br>System.out.println(<span class="hljs-string">&quot;国家的代码: &quot;</span> + countryCode.get(<span class="hljs-string">&quot;中国&quot;</span>)); <span class="hljs-comment">// CN</span><br><br><span class="hljs-comment">// 反向查找：通过值找键</span><br>BiMap&lt;String, String&gt; reverseCountryCode = countryCode.inverse();<br>System.out.println(<span class="hljs-string">&quot;代码对应的国家: &quot;</span> + reverseCountryCode.get(<span class="hljs-string">&quot;US&quot;</span>)); <span class="hljs-comment">// 美国</span><br><br><span class="hljs-comment">// 尝试插入重复的值会抛出 IllegalArgumentException</span><br><span class="hljs-keyword">try</span> &#123;<br>    countryCode.put(<span class="hljs-string">&quot;英国&quot;</span>, <span class="hljs-string">&quot;CN&quot;</span>); <span class="hljs-comment">// CN 已经存在</span><br>&#125; <span class="hljs-keyword">catch</span> (IllegalArgumentException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;\n值必须唯一: &quot;</span> + e.getMessage());<br>&#125;<br><br><span class="hljs-comment">// 使用 forcePut 强制替换（会移除原来的键值对）</span><br>countryCode.forcePut(<span class="hljs-string">&quot;英国&quot;</span>, <span class="hljs-string">&quot;CN&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;\n强制替换后:&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;中国的代码: &quot;</span> + countryCode.get(<span class="hljs-string">&quot;中国&quot;</span>)); <span class="hljs-comment">// null</span><br>System.out.println(<span class="hljs-string">&quot;英国的代码: &quot;</span> + countryCode.get(<span class="hljs-string">&quot;英国&quot;</span>)); <span class="hljs-comment">// CN</span><br></code></pre></td></tr></table></figure>
<h2 id="table-表格">Table（表格）</h2>
<p><code>Table</code> 是一种双键映射结构，类似于电子表格，使用行键和列键来定位值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.HashBasedTable;<br><span class="hljs-keyword">import</span> com.google.common.collect.Table;<br><br><span class="hljs-comment">// 创建一个成绩表：学生(行) × 科目(列) → 分数</span><br>Table&lt;String, String, Integer&gt; scoreTable = HashBasedTable.create();<br>scoreTable.put(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;数学&quot;</span>, <span class="hljs-number">90</span>);<br>scoreTable.put(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;英语&quot;</span>, <span class="hljs-number">85</span>);<br>scoreTable.put(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;物理&quot;</span>, <span class="hljs-number">88</span>);<br>scoreTable.put(<span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;数学&quot;</span>, <span class="hljs-number">95</span>);<br>scoreTable.put(<span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;英语&quot;</span>, <span class="hljs-number">92</span>);<br>scoreTable.put(<span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;物理&quot;</span>, <span class="hljs-number">89</span>);<br><br>System.out.println(<span class="hljs-string">&quot;张三的数学成绩: &quot;</span> + scoreTable.get(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;数学&quot;</span>)); <span class="hljs-comment">// 90</span><br><br>System.out.println(<span class="hljs-string">&quot;\n张三的所有成绩: &quot;</span> + scoreTable.row(<span class="hljs-string">&quot;张三&quot;</span>));<br><span class="hljs-comment">// &#123;数学=90, 英语=85, 物理=88&#125;</span><br><br>System.out.println(<span class="hljs-string">&quot;\n数学课的所有成绩: &quot;</span> + scoreTable.column(<span class="hljs-string">&quot;数学&quot;</span>));<br><span class="hljs-comment">// &#123;张三=90, 李四=95&#125;</span><br><br>System.out.println(<span class="hljs-string">&quot;\n所有行键(学生): &quot;</span> + scoreTable.rowKeySet());<br>System.out.println(<span class="hljs-string">&quot;所有列键(科目): &quot;</span> + scoreTable.columnKeySet());<br>System.out.println(<span class="hljs-string">&quot;所有单元格: &quot;</span> + scoreTable.cellSet());<br></code></pre></td></tr></table></figure>
<h2 id="rangeset-区间集合">RangeSet（区间集合）</h2>
<p><code>RangeSet</code> 用于管理一组不重叠的区间，非常适合处理时间范围、数值区间等问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.Range;<br><span class="hljs-keyword">import</span> com.google.common.collect.RangeSet;<br><span class="hljs-keyword">import</span> com.google.common.collect.TreeRangeSet;<br><br>RangeSet&lt;Integer&gt; numberRanges = TreeRangeSet.create();<br>numberRanges.add(Range.closed(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>));    <span class="hljs-comment">// [1, 10]</span><br>numberRanges.add(Range.open(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>));     <span class="hljs-comment">// (20, 30)</span><br>numberRanges.add(Range.closedOpen(<span class="hljs-number">40</span>, <span class="hljs-number">50</span>)); <span class="hljs-comment">// [40, 50)</span><br><br>System.out.println(<span class="hljs-string">&quot;区间集合: &quot;</span> + numberRanges);<br><span class="hljs-comment">// [[1..10], (20..30), [40..50)]</span><br><br>System.out.println(<span class="hljs-string">&quot;包含 5: &quot;</span> + numberRanges.contains(<span class="hljs-number">5</span>));   <span class="hljs-comment">// true</span><br>System.out.println(<span class="hljs-string">&quot;包含 15: &quot;</span> + numberRanges.contains(<span class="hljs-number">15</span>)); <span class="hljs-comment">// false</span><br>System.out.println(<span class="hljs-string">&quot;包含 25: &quot;</span> + numberRanges.contains(<span class="hljs-number">25</span>)); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 移除一个区间</span><br>numberRanges.remove(Range.closed(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>));<br>System.out.println(<span class="hljs-string">&quot;\n移除 [5, 8] 后: &quot;</span> + numberRanges);<br><span class="hljs-comment">// [[1..4], (8..10], (20..30), [40..50)]</span><br><br><span class="hljs-comment">// 合并相邻区间</span><br>numberRanges.add(Range.closed(<span class="hljs-number">30</span>, <span class="hljs-number">40</span>));<br>System.out.println(<span class="hljs-string">&quot;\n添加 [30, 40] 后: &quot;</span> + numberRanges);<br><span class="hljs-comment">// [[1..4], (8..10], (20..30], (30..40], [40..50)]</span><br></code></pre></td></tr></table></figure>
<h2 id="rangemap-区间映射">RangeMap（区间映射）</h2>
<p><code>RangeMap</code> 将区间映射到值，每个区间对应一个特定的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.RangeMap;<br><span class="hljs-keyword">import</span> com.google.common.collect.TreeRangeMap;<br><br>RangeMap&lt;Integer, String&gt; gradeMap = TreeRangeMap.create();<br>gradeMap.put(Range.closedOpen(<span class="hljs-number">0</span>, <span class="hljs-number">60</span>), <span class="hljs-string">&quot;不及格&quot;</span>);<br>gradeMap.put(Range.closedOpen(<span class="hljs-number">60</span>, <span class="hljs-number">70</span>), <span class="hljs-string">&quot;及格&quot;</span>);<br>gradeMap.put(Range.closedOpen(<span class="hljs-number">70</span>, <span class="hljs-number">80</span>), <span class="hljs-string">&quot;中等&quot;</span>);<br>gradeMap.put(Range.closedOpen(<span class="hljs-number">80</span>, <span class="hljs-number">90</span>), <span class="hljs-string">&quot;良好&quot;</span>);<br>gradeMap.put(Range.closed(<span class="hljs-number">90</span>, <span class="hljs-number">100</span>), <span class="hljs-string">&quot;优秀&quot;</span>);<br><br>System.out.println(<span class="hljs-string">&quot;85 分的等级: &quot;</span> + gradeMap.get(<span class="hljs-number">85</span>)); <span class="hljs-comment">// 良好</span><br>System.out.println(<span class="hljs-string">&quot;75 分的等级: &quot;</span> + gradeMap.get(<span class="hljs-number">75</span>)); <span class="hljs-comment">// 中等</span><br>System.out.println(<span class="hljs-string">&quot;55 分的等级: &quot;</span> + gradeMap.get(<span class="hljs-number">55</span>)); <span class="hljs-comment">// 不及格</span><br><br>System.out.println(<span class="hljs-string">&quot;\n所有区间映射:&quot;</span>);<br>gradeMap.asMapOfRanges().forEach((range, grade) -&gt; &#123;<br>    System.out.println(range + <span class="hljs-string">&quot; → &quot;</span> + grade);<br>&#125;);<br></code></pre></td></tr></table></figure>
<h2 id="集合工具类">集合工具类</h2>
<h2 id="lists-sets-maps-工厂方法">Lists、Sets、Maps 工厂方法</h2>
<p>Guava 提供了便捷的集合创建工厂方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.Lists;<br><span class="hljs-keyword">import</span> com.google.common.collect.Sets;<br><span class="hljs-keyword">import</span> com.google.common.collect.Maps;<br><br><span class="hljs-comment">// Lists 工具类</span><br>List&lt;String&gt; list1 = Lists.newArrayList();<br>List&lt;String&gt; list2 = Lists.newArrayList(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>);<br>List&lt;String&gt; list3 = Lists.newArrayListWithCapacity(<span class="hljs-number">100</span>); <span class="hljs-comment">// 指定初始容量</span><br>List&lt;String&gt; list4 = Lists.newLinkedList();<br><br><span class="hljs-comment">// 创建固定大小的列表（类似 Array.asList，但返回的是 ArrayList）</span><br>List&lt;String&gt; fixedList = Lists.newArrayListWithExpectedSize(<span class="hljs-number">3</span>);<br>fixedList.addAll(Arrays.asList(<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-string">&quot;Z&quot;</span>));<br><br><span class="hljs-comment">// 分割列表</span><br>List&lt;Integer&gt; numbers = Lists.newArrayList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);<br>List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(numbers, <span class="hljs-number">3</span>);<br>System.out.println(<span class="hljs-string">&quot;分割后的列表: &quot;</span> + partitions);<br><span class="hljs-comment">// [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]</span><br><br><span class="hljs-comment">// Sets 工具类</span><br>Set&lt;String&gt; set1 = Sets.newHashSet();<br>Set&lt;String&gt; set2 = Sets.newHashSet(<span class="hljs-string">&quot;Java&quot;</span>, <span class="hljs-string">&quot;Python&quot;</span>);<br>Set&lt;String&gt; set3 = Sets.newLinkedHashSet();<br>Set&lt;String&gt; set4 = Sets.newConcurrentHashSet();<br><br><span class="hljs-comment">// 集合运算</span><br>Set&lt;Integer&gt; setA = Sets.newHashSet(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);<br>Set&lt;Integer&gt; setB = Sets.newHashSet(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);<br><br>Set&lt;Integer&gt; union = Sets.union(setA, setB);       <span class="hljs-comment">// 并集: &#123;1, 2, 3, 4, 5, 6&#125;</span><br>Set&lt;Integer&gt; intersection = Sets.intersection(setA, setB); <span class="hljs-comment">// 交集: &#123;3, 4&#125;</span><br>Set&lt;Integer&gt; difference = Sets.difference(setA, setB);     <span class="hljs-comment">// 差集: &#123;1, 2&#125;</span><br><br>System.out.println(<span class="hljs-string">&quot;并集: &quot;</span> + union);<br>System.out.println(<span class="hljs-string">&quot;交集: &quot;</span> + intersection);<br>System.out.println(<span class="hljs-string">&quot;差集: &quot;</span> + difference);<br><br><span class="hljs-comment">// 笛卡尔积</span><br>Set&lt;List&lt;String&gt;&gt; cartesianProduct = Sets.cartesianProduct(<br>    Sets.newHashSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>),<br>    Sets.newHashSet(<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>)<br>);<br>System.out.println(<span class="hljs-string">&quot;笛卡尔积: &quot;</span> + cartesianProduct);<br><span class="hljs-comment">// [[A, 1], [A, 2], [A, 3], [B, 1], [B, 2], [B, 3]]</span><br><br><span class="hljs-comment">// Maps 工具类</span><br>Map&lt;String, Integer&gt; map1 = Maps.newHashMap();<br>Map&lt;String, Integer&gt; map2 = Maps.newLinkedHashMap();<br>Map&lt;String, Integer&gt; map3 = Maps.newConcurrentMap();<br><br><span class="hljs-comment">// 创建指定大小的 Map</span><br>Map&lt;String, String&gt; mapWithExpectedSize = Maps.newHashMapWithExpectedSize(<span class="hljs-number">16</span>);<br><br><span class="hljs-comment">// 创建 EnumMap</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Weekday</span> &#123; MONDAY, TUESDAY, WEDNESDAY &#125;<br>Map&lt;Weekday, String&gt; enumMap = Maps.newEnumMap(Weekday.class);<br></code></pre></td></tr></table></figure>
<h2 id="iterables-和-iterators">Iterables 和 Iterators</h2>
<p><code>Iterables</code> 提供了丰富的可迭代对象操作方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.Iterables;<br><br>List&lt;Integer&gt; numbers = Lists.newArrayList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);<br><br><span class="hljs-comment">// 过滤</span><br>Iterable&lt;Integer&gt; evenNumbers = Iterables.filter(numbers, <br>    n -&gt; n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>);<br>System.out.println(<span class="hljs-string">&quot;偶数: &quot;</span> + evenNumbers); <span class="hljs-comment">// [2, 4, 6, 8, 10]</span><br><br><span class="hljs-comment">// 转换</span><br>Iterable&lt;String&gt; numberStrings = Iterables.transform(numbers, <br>    n -&gt; <span class="hljs-string">&quot;Number: &quot;</span> + n);<br>System.out.println(<span class="hljs-string">&quot;转换后: &quot;</span> + Iterables.limit(numberStrings, <span class="hljs-number">3</span>));<br><span class="hljs-comment">// [Number: 1, Number: 2, Number: 3]</span><br><br><span class="hljs-comment">// 限制数量</span><br>Iterable&lt;Integer&gt; firstFive = Iterables.limit(numbers, <span class="hljs-number">5</span>);<br>System.out.println(<span class="hljs-string">&quot;前 5 个: &quot;</span> + firstFive); <span class="hljs-comment">// [1, 2, 3, 4, 5]</span><br><br><span class="hljs-comment">// 跳过元素</span><br>Iterable&lt;Integer&gt; skipFive = Iterables.skip(numbers, <span class="hljs-number">5</span>);<br>System.out.println(<span class="hljs-string">&quot;跳过前 5 个: &quot;</span> + skipFive); <span class="hljs-comment">// [6, 7, 8, 9, 10]</span><br><br><span class="hljs-comment">// 检查所有元素是否满足条件</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">allGreaterThanZero</span> <span class="hljs-operator">=</span> Iterables.all(numbers, n -&gt; n &gt; <span class="hljs-number">0</span>);<br>System.out.println(<span class="hljs-string">&quot;都大于 0: &quot;</span> + allGreaterThanZero); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 检查是否有元素满足条件</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">hasFive</span> <span class="hljs-operator">=</span> Iterables.any(numbers, n -&gt; n == <span class="hljs-number">5</span>);<br>System.out.println(<span class="hljs-string">&quot;包含 5: &quot;</span> + hasFive); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 获取第一个和最后一个元素</span><br>System.out.println(<span class="hljs-string">&quot;第一个: &quot;</span> + Iterables.getFirst(numbers, -<span class="hljs-number">1</span>)); <span class="hljs-comment">// 1</span><br>System.out.println(<span class="hljs-string">&quot;最后一个: &quot;</span> + Iterables.getLast(numbers)); <span class="hljs-comment">// 10</span><br><br><span class="hljs-comment">// 频次统计</span><br>System.out.println(<span class="hljs-string">&quot;5 出现的次数: &quot;</span> + Iterables.frequency(numbers, <span class="hljs-number">5</span>)); <span class="hljs-comment">// 1</span><br><br><span class="hljs-comment">// 连接多个 Iterable</span><br>List&lt;Integer&gt; moreNumbers = Lists.newArrayList(<span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>);<br>Iterable&lt;Integer&gt; allNumbers = Iterables.concat(numbers, moreNumbers);<br>System.out.println(<span class="hljs-string">&quot;连接后: &quot;</span> + allNumbers); <span class="hljs-comment">// [1, 2, ..., 13]</span><br></code></pre></td></tr></table></figure>
<h2 id="collections2-filter-和-transform">Collections2.filter() 和 transform()</h2>
<p><code>Collections2</code> 提供了针对 <code>Collection</code> 的静态方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.Collections2;<br><br>List&lt;String&gt; words = Lists.newArrayList(<br>    <span class="hljs-string">&quot;Apple&quot;</span>, <span class="hljs-string">&quot;banana&quot;</span>, <span class="hljs-string">&quot;Cherry&quot;</span>, <span class="hljs-string">&quot;date&quot;</span>, <span class="hljs-string">&quot;Elderberry&quot;</span><br>);<br><br><span class="hljs-comment">// 过滤：只保留首字母大写的单词</span><br>Collection&lt;String&gt; capitalWords = Collections2.filter(words, <br>    word -&gt; Character.isUpperCase(word.charAt(<span class="hljs-number">0</span>)));<br>System.out.println(<span class="hljs-string">&quot;首字母大写的单词: &quot;</span> + capitalWords);<br><span class="hljs-comment">// [Apple, Cherry, Elderberry]</span><br><br><span class="hljs-comment">// 转换：转换为小写</span><br>Collection&lt;String&gt; lowerCaseWords = Collections2.transform(words, <br>    String::toLowerCase);<br>System.out.println(<span class="hljs-string">&quot;转换为小写: &quot;</span> + lowerCaseWords);<br><span class="hljs-comment">// [apple, banana, cherry, date, elderberry]</span><br><br><span class="hljs-comment">// 转换：获取单词长度</span><br>Collection&lt;Integer&gt; wordLengths = Collections2.transform(words, <br>    String::length);<br>System.out.println(<span class="hljs-string">&quot;单词长度: &quot;</span> + wordLengths);<br><span class="hljs-comment">// [5, 6, 6, 4, 10]</span><br><br><span class="hljs-comment">// 组合使用</span><br>Collection&lt;String&gt; shortCapitalWords = Collections2.filter(<br>    Collections2.transform(words, String::toUpperCase),<br>    word -&gt; word.length() &lt;= <span class="hljs-number">5</span><br>);<br>System.out.println(<span class="hljs-string">&quot;短单词(大写): &quot;</span> + shortCapitalWords);<br></code></pre></td></tr></table></figure>
<h2 id="与-java-8-stream-api-的对比和互补">与 Java 8 Stream API 的对比和互补</h2>
<p>Guava 集合工具和 Java 8 Stream API 在功能上有重叠，但各有优势。</p>
<h3 id="主要区别">主要区别</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>Guava Collections</th>
<th>Java 8 Stream</th>
</tr>
</thead>
<tbody>
<tr>
<td>懒加载</td>
<td>否（立即执行）</td>
<td>是（惰性求值）</td>
</tr>
<tr>
<td>并行处理</td>
<td>有限</td>
<td>原生支持</td>
</tr>
<tr>
<td>不可变性</td>
<td>强类型支持</td>
<td>通过 Collectors</td>
</tr>
<tr>
<td>新集合类型</td>
<td>丰富（Multiset、Multimap 等）</td>
<td>无</td>
</tr>
<tr>
<td>API 设计</td>
<td>方法链式</td>
<td>流式操作</td>
</tr>
</tbody>
</table>
<h3 id="互补使用场景">互补使用场景</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.stream.Collectors;<br><br><span class="hljs-comment">// Guava 的独特优势：新集合类型</span><br>Multiset&lt;String&gt; wordCount = HashMultiset.create();<br>List&lt;String&gt; text = Arrays.asList(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>);<br>wordCount.addAll(text);<br>System.out.println(<span class="hljs-string">&quot;Guava Multiset: &quot;</span> + wordCount);<br><br><span class="hljs-comment">// Stream API 的优势：复杂的数据处理</span><br>List&lt;String&gt; filteredAndTransformed = text.stream()<br>    .filter(s -&gt; !s.equals(<span class="hljs-string">&quot;a&quot;</span>))<br>    .map(String::toUpperCase)<br>    .distinct()<br>    .sorted()<br>    .collect(Collectors.toList());<br>System.out.println(<span class="hljs-string">&quot;Stream 处理结果: &quot;</span> + filteredAndTransformed);<br><br><span class="hljs-comment">// 结合使用：使用 Stream 填充 Guava 集合</span><br>Multimap&lt;Integer, String&gt; lengthToWords = text.stream()<br>    .collect(Collectors.groupingBy(<br>        String::length,<br>        ArrayListMultimap::create,<br>        Collectors.toList()<br>    ));<br>System.out.println(<span class="hljs-string">&quot;按长度分组: &quot;</span> + lengthToWords);<br><br><span class="hljs-comment">// 使用 Guava 的不可变集合作为 Stream 的结果</span><br>ImmutableList&lt;String&gt; immutableResult = text.stream()<br>    .filter(s -&gt; s.length() &gt; <span class="hljs-number">0</span>)<br>    .collect(Collectors.collectingAndThen(<br>        Collectors.toList(),<br>        ImmutableList::copyOf<br>    ));<br>System.out.println(<span class="hljs-string">&quot;不可变结果: &quot;</span> + immutableResult);<br></code></pre></td></tr></table></figure>
<h3 id="选择建议">选择建议</h3>
<ul>
<li>
<p><strong>使用 Guava</strong>：</p>
<ul>
<li>需要使用 Multiset、Multimap、BiMap、Table 等特殊集合类型</li>
<li>需要强类型的不可变集合</li>
<li>处理区间（RangeSet、RangeMap）</li>
<li>项目尚未升级到 Java 8</li>
</ul>
</li>
<li>
<p><strong>使用 Stream API</strong>：</p>
<ul>
<li>需要复杂的数据转换和过滤</li>
<li>需要并行处理</li>
<li>需要惰性求值优化性能</li>
</ul>
</li>
<li>
<p><strong>结合使用</strong>：</p>
<ul>
<li>使用 Stream 进行数据处理</li>
<li>使用 Guava 集合类型存储结果</li>
<li>使用 Guava 的不可变集合确保线程安全</li>
</ul>
</li>
</ul>
<h2 id="实际使用建议">实际使用建议</h2>
<h3 id="1-优先使用不可变集合">1. 优先使用不可变集合</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 好的做法：返回不可变集合</span><br><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getConfiguredOptions</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> ImmutableList.copyOf(options);<br>&#125;<br><br><span class="hljs-comment">// 避免：返回可变集合，可能导致外部修改</span><br><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getOptions</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(options); <span class="hljs-comment">// 虽然是副本，但仍然可变</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="2-合理选择集合类型">2. 合理选择集合类型</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 需要计数时使用 Multiset</span><br>Multiset&lt;String&gt; errorLog = HashMultiset.create();<br>errorLog.add(<span class="hljs-string">&quot;NullPointerException&quot;</span>);<br>errorLog.add(<span class="hljs-string">&quot;NullPointerException&quot;</span>);<br>errorLog.add(<span class="hljs-string">&quot;IOException&quot;</span>);<br><br><span class="hljs-comment">// 需要一对多映射时使用 Multimap</span><br>Multimap&lt;String, String&gt; userRoles = ArrayListMultimap.create();<br>userRoles.put(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>);<br>userRoles.put(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;write&quot;</span>);<br>userRoles.put(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span>);<br><br><span class="hljs-comment">// 需要双向查找时使用 BiMap</span><br>BiMap&lt;String, Integer&gt; idMapping = HashBiMap.create();<br></code></pre></td></tr></table></figure>
<h3 id="3-使用工厂方法简化代码">3. 使用工厂方法简化代码</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 简洁</span><br>List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>);<br><br><span class="hljs-comment">// 冗长</span><br>List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>list.add(<span class="hljs-string">&quot;A&quot;</span>);<br>list.add(<span class="hljs-string">&quot;B&quot;</span>);<br>list.add(<span class="hljs-string">&quot;C&quot;</span>);<br></code></pre></td></tr></table></figure>
<h3 id="4-注意空值处理">4. 注意空值处理</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Guava 不允许 null 值</span><br>ImmutableList&lt;String&gt; list = ImmutableList.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-literal">null</span>); <span class="hljs-comment">// 抛出 NullPointerException</span><br><br><span class="hljs-comment">// 如果需要支持 null，使用 Java 标准集合或显式处理</span><br>List&lt;String&gt; list = Lists.newArrayList();<br>list.add(<span class="hljs-string">&quot;A&quot;</span>);<br>list.add(<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure>
<h3 id="5-性能考虑">5. 性能考虑</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 对于大量数据，使用不可变集合可能更高效</span><br>ImmutableList&lt;String&gt; hugeList = ImmutableList.copyOf(largeDataSource);<br><br><span class="hljs-comment">// 使用 Builder 模式避免中间集合的创建</span><br>ImmutableList&lt;String&gt; list = ImmutableList.&lt;String&gt;builder()<br>    .addAll(source1)<br>    .addAll(source2)<br>    .addAll(source3)<br>    .build();<br></code></pre></td></tr></table></figure>
<h3 id="6-防御性编程">6. 防御性编程</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processList</span><span class="hljs-params">(List&lt;String&gt; input)</span> &#123;<br>    <span class="hljs-comment">// 防止输入被修改</span><br>    List&lt;String&gt; safeCopy = ImmutableList.copyOf(input);<br>    <br>    <span class="hljs-comment">// 或者使用不可变参数</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processList</span><span class="hljs-params">(ImmutableList&lt;String&gt; input)</span> &#123;<br>        <span class="hljs-comment">// 直接使用，无需复制</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h1>Guava Cache（缓存）</h1>
<p>Guava Cache 是一个高性能、线程安全的本地缓存库，基于 ConcurrentHashMap 增强设计，提供了丰富的缓存配置和统计功能。</p>
<h3 id="核心设计理念">核心设计理念</h3>
<p>Guava Cache 的核心设计包括：</p>
<ul>
<li><strong>线程安全</strong>：基于 ConcurrentHashMap 实现，支持高并发访问</li>
<li><strong>自动驱逐</strong>：支持基于大小、时间、引用的自动驱逐策略</li>
<li><strong>缓存加载</strong>：支持自动加载和手动加载两种模式</li>
<li><strong>统计监控</strong>：Cache（缓存）</li>
</ul>
<p>Guava Cache 是一个高性能的本地缓存库，基于 ConcurrentHashMap 进行增强，提供了自动加载、过期策略、驱逐监听等功能。</p>
<p>核心特性</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>API</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CacheBuilder</code></td>
<td>缓存构建器，链式配置缓存参数</td>
</tr>
<tr>
<td><code>LoadingCache</code></td>
<td>自动加载缓存接口</td>
</tr>
<tr>
<td><code>CacheLoader</code></td>
<td>缓存加载器，定义加载逻辑</td>
</tr>
<tr>
<td><code>Cache&lt;K,V&gt;</code></td>
<td>手动缓存接口</td>
</tr>
<tr>
<td><code>CacheStats</code></td>
<td>缓存统计信息</td>
</tr>
<tr>
<td><code>RemovalListener</code></td>
<td>驱逐事件监听器</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.cache.Cache;<br><span class="hljs-keyword">import</span> com.google.common.cache.CacheBuilder;<br><span class="hljs-keyword">import</span> com.google.common.cache.CacheLoader;<br><span class="hljs-keyword">import</span> com.google.common.cache.LoadingCache;<br><span class="hljs-keyword">import</span> com.google.common.cache.RemovalListener;<br><span class="hljs-keyword">import</span> com.google.common.cache.RemovalNotification;<br><span class="hljs-keyword">import</span> com.google.common.cache.Weigher;<br><span class="hljs-keyword">import</span> com.google.common.base.Optional;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-comment">// 1. LoadingCache - 自动加载缓存</span><br>LoadingCache&lt;String, String&gt; loadingCache = CacheBuilder.newBuilder()<br>    .maximumSize(<span class="hljs-number">1000</span>)  <span class="hljs-comment">// 最大缓存条目数</span><br>    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// 写入后 10 分钟过期</span><br>    .expireAfterAccess(<span class="hljs-number">5</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// 访问后 5 分钟过期</span><br>    .refreshAfterWrite(<span class="hljs-number">1</span>, TimeUnit.MINUTES)  <span class="hljs-comment">// 写入后 1 分钟自动刷新</span><br>    .recordStats()  <span class="hljs-comment">// 开启统计</span><br>    .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, String&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(String key)</span> &#123;<br>            <span class="hljs-comment">// 模拟从数据库加载</span><br>            System.out.println(<span class="hljs-string">&quot;从数据库加载: &quot;</span> + key);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Value-&quot;</span> + key;<br>        &#125;<br>    &#125;);<br><br><span class="hljs-comment">// 使用 LoadingCache</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">value1</span> <span class="hljs-operator">=</span> loadingCache.get(<span class="hljs-string">&quot;key1&quot;</span>);  <span class="hljs-comment">// 第一次会触发 load</span><br>    System.out.println(<span class="hljs-string">&quot;value1: &quot;</span> + value1);<br>    <br>    <span class="hljs-type">String</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> loadingCache.get(<span class="hljs-string">&quot;key1&quot;</span>);  <span class="hljs-comment">// 第二次从缓存获取</span><br>    System.out.println(<span class="hljs-string">&quot;value2: &quot;</span> + value2);<br>    <br>    <span class="hljs-comment">// 批量加载</span><br>    loadingCache.getAll(Lists.newArrayList(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;key3&quot;</span>));<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    e.printStackTrace();<br>&#125;<br><br><span class="hljs-comment">// 2. 手动缓存 Cache&lt;K,V&gt;</span><br>Cache&lt;String, Optional&lt;String&gt;&gt; manualCache = CacheBuilder.newBuilder()<br>    .maximumSize(<span class="hljs-number">500</span>)<br>    .expireAfterWrite(<span class="hljs-number">30</span>, TimeUnit.MINUTES)<br>    .weakKeys()  <span class="hljs-comment">// 使用弱引用键</span><br>    .softValues()  <span class="hljs-comment">// 使用软引用值</span><br>    .removalListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RemovalListener</span>&lt;String, Optional&lt;String&gt;&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onRemoval</span><span class="hljs-params">(RemovalNotification&lt;String, Optional&lt;String&gt;&gt; notification)</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;驱逐通知: &quot;</span> + notification.getKey() + <br>                <span class="hljs-string">&quot;, 原因: &quot;</span> + notification.getCause());<br>        &#125;<br>    &#125;)<br>    .build();<br><br><span class="hljs-comment">// 使用手动缓存</span><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// Guava Cache 不支持 null value，使用 Optional 包装</span><br>    manualCache.put(<span class="hljs-string">&quot;key1&quot;</span>, Optional.of(<span class="hljs-string">&quot;value1&quot;</span>));<br>    manualCache.put(<span class="hljs-string">&quot;key2&quot;</span>, Optional.&lt;String&gt;absent());  <span class="hljs-comment">// 表示 null</span><br>    <br>    Optional&lt;String&gt; value = manualCache.get(<span class="hljs-string">&quot;key1&quot;</span>, () -&gt; &#123;<br>        <span class="hljs-comment">// 如果缓存不存在，执行此 Callable 获取值</span><br>        <span class="hljs-keyword">return</span> Optional.of(<span class="hljs-string">&quot;default-value&quot;</span>);<br>    &#125;);<br>    <br>    System.out.println(<span class="hljs-string">&quot;手动缓存值: &quot;</span> + value.or(<span class="hljs-string">&quot;null&quot;</span>));<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>    e.printStackTrace();<br>&#125;<br><br><span class="hljs-comment">// 3. 基于权重的缓存驱逐</span><br>Cache&lt;String, String&gt; weightedCache = CacheBuilder.newBuilder()<br>    .maximumWeight(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)  <span class="hljs-comment">// 最大 10MB</span><br>    .weigher(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Weigher</span>&lt;String, String&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">weigh</span><span class="hljs-params">(String key, String value)</span> &#123;<br>            <span class="hljs-keyword">return</span> key.getBytes().length + value.getBytes().length;<br>        &#125;<br>    &#125;)<br>    .build();<br><br><span class="hljs-comment">// 4. 缓存统计</span><br><span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> loadingCache.stats();<br>System.out.println(<span class="hljs-string">&quot;缓存统计:&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;  请求次数: &quot;</span> + stats.requestCount());<br>System.out.println(<span class="hljs-string">&quot;  命中次数: &quot;</span> + stats.hitCount());<br>System.out.println(<span class="hljs-string">&quot;  未命中次数: &quot;</span> + stats.missCount());<br>System.out.println(<span class="hljs-string">&quot;  命中率: &quot;</span> + stats.hitRate());<br>System.out.println(<span class="hljs-string">&quot;  平均加载时间(ms): &quot;</span> + stats.averageLoadPenalty() / <span class="hljs-number">1_000_000</span>);<br><br><span class="hljs-comment">// 5. 手动刷新和失效</span><br>loadingCache.refresh(<span class="hljs-string">&quot;key1&quot;</span>);  <span class="hljs-comment">// 异步刷新</span><br>loadingCache.invalidate(<span class="hljs-string">&quot;key2&quot;</span>);  <span class="hljs-comment">// 失效单个</span><br>loadingCache.invalidateAll();  <span class="hljs-comment">// 失效所有</span><br></code></pre></td></tr></table></figure>
<h2 id="与-caffeine-的对比">与 Caffeine 的对比</h2>
<table>
<thead>
<tr>
<th>特性</th>
<th>Guava Cache</th>
<th>Caffeine</th>
</tr>
</thead>
<tbody>
<tr>
<td>性能</td>
<td>高</td>
<td>更高（基于 W-TinyLFU 算法）</td>
</tr>
<tr>
<td>异步加载</td>
<td>支持</td>
<td>支持，更完善</td>
</tr>
<tr>
<td>淘汰算法</td>
<td>LRU</td>
<td>W-TinyLFU</td>
</tr>
<tr>
<td>维护状态</td>
<td>基本维护</td>
<td>活跃维护</td>
</tr>
</tbody>
</table>
<p><strong>迁移建议</strong>：新项目建议使用 Caffeine，它是 Guava Cache 的改进版本，提供了更好的性能和更丰富的功能。</p>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>合理设置过期时间</strong>：根据业务特点选择 <code>expireAfterWrite</code> 或 <code>expireAfterAccess</code></li>
<li><strong>开启统计</strong>：生产环境建议开启统计，便于监控缓存效果</li>
<li><strong>处理 null 值</strong>：使用 <code>Optional</code> 包装 null 值，避免 NPE</li>
<li><strong>监控缓存</strong>：定期查看 <code>CacheStats</code>，优化缓存策略</li>
</ol>
<hr>
<h1>Strings（字符串处理）</h1>
<p>Guava 提供了强大的字符串处理工具类，简化了常见的字符串操作。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>工具类</th>
<th>主要功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Strings</code></td>
<td>基本字符串操作（空值处理、填充、重复等）</td>
</tr>
<tr>
<td><code>Joiner</code></td>
<td>字符串连接</td>
</tr>
<tr>
<td><code>Splitter</code></td>
<td>字符串拆分</td>
</tr>
<tr>
<td><code>CharMatcher</code></td>
<td>字符匹配和处理</td>
</tr>
<tr>
<td><code>CaseFormat</code></td>
<td>命名风格转换</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.base.Strings;<br><span class="hljs-keyword">import</span> com.google.common.base.Joiner;<br><span class="hljs-keyword">import</span> com.google.common.base.Splitter;<br><span class="hljs-keyword">import</span> com.google.common.base.CharMatcher;<br><span class="hljs-keyword">import</span> com.google.common.base.CaseFormat;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-comment">// 1. Strings 工具类</span><br>System.out.println(<span class="hljs-string">&quot;=== Strings 工具类 ===&quot;</span>);<br><br><span class="hljs-comment">// 空值处理</span><br><span class="hljs-type">String</span> <span class="hljs-variable">nullStr</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">emptyStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">normalStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br><br>System.out.println(<span class="hljs-string">&quot;nullToEmpty: [&quot;</span> + Strings.nullToEmpty(nullStr) + <span class="hljs-string">&quot;]&quot;</span>);  <span class="hljs-comment">// []</span><br>System.out.println(<span class="hljs-string">&quot;nullToEmpty: [&quot;</span> + Strings.nullToEmpty(normalStr) + <span class="hljs-string">&quot;]&quot;</span>);  <span class="hljs-comment">// [hello]</span><br>System.out.println(<span class="hljs-string">&quot;emptyToNull: &quot;</span> + Strings.emptyToNull(emptyStr));  <span class="hljs-comment">// null</span><br>System.out.println(<span class="hljs-string">&quot;emptyToNull: &quot;</span> + Strings.emptyToNull(normalStr));  <span class="hljs-comment">// hello</span><br>System.out.println(<span class="hljs-string">&quot;isNullOrEmpty(null): &quot;</span> + Strings.isNullOrEmpty(nullStr));  <span class="hljs-comment">// true</span><br>System.out.println(<span class="hljs-string">&quot;isNullOrEmpty(\&quot;\&quot;): &quot;</span> + Strings.isNullOrEmpty(emptyStr));  <span class="hljs-comment">// true</span><br>System.out.println(<span class="hljs-string">&quot;isNullOrEmpty(\&quot;hello\&quot;): &quot;</span> + Strings.isNullOrEmpty(normalStr));  <span class="hljs-comment">// false</span><br><br><span class="hljs-comment">// 前缀和后缀</span><br>System.out.println(<span class="hljs-string">&quot;commonPrefix(\&quot;abcdef\&quot;, \&quot;abxy\&quot;): &quot;</span> + <br>    Strings.commonPrefix(<span class="hljs-string">&quot;abcdef&quot;</span>, <span class="hljs-string">&quot;abxy&quot;</span>));  <span class="hljs-comment">// ab</span><br>System.out.println(<span class="hljs-string">&quot;commonSuffix(\&quot;abcdef\&quot;, \&quot;xydef\&quot;): &quot;</span> + <br>    Strings.commonSuffix(<span class="hljs-string">&quot;abcdef&quot;</span>, <span class="hljs-string">&quot;xydef&quot;</span>));  <span class="hljs-comment">// def</span><br><br><span class="hljs-comment">// 填充和重复</span><br>System.out.println(<span class="hljs-string">&quot;padStart(\&quot;7\&quot;, 3, &#x27;0&#x27;): &quot;</span> + Strings.padStart(<span class="hljs-string">&quot;7&quot;</span>, <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;0&#x27;</span>));  <span class="hljs-comment">// 007</span><br>System.out.println(<span class="hljs-string">&quot;padEnd(\&quot;hello\&quot;, 10, &#x27;!&#x27;): &quot;</span> + Strings.padEnd(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;!&#x27;</span>));  <span class="hljs-comment">// hello!!!!!</span><br>System.out.println(<span class="hljs-string">&quot;repeat(\&quot;abc\&quot;, 3): &quot;</span> + Strings.repeat(<span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-number">3</span>));  <span class="hljs-comment">// abcabcabc</span><br><br><span class="hljs-comment">// 2. Joiner - 连接字符串</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Joiner ===&quot;</span>);<br><br>List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;王五&quot;</span>);<br><br><span class="hljs-comment">// 跳过 null</span><br><span class="hljs-type">String</span> <span class="hljs-variable">joined1</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">&quot;, &quot;</span>).skipNulls().join(names);<br>System.out.println(<span class="hljs-string">&quot;跳过 null: &quot;</span> + joined1);  <span class="hljs-comment">// 张三, 李四, 王五</span><br><br><span class="hljs-comment">// null 替换为指定值</span><br><span class="hljs-type">String</span> <span class="hljs-variable">joined2</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">&quot;, &quot;</span>).useForNull(<span class="hljs-string">&quot;未知&quot;</span>).join(names);<br>System.out.println(<span class="hljs-string">&quot;null 替换: &quot;</span> + joined2);  <span class="hljs-comment">// 张三, 李四, 未知, 王五</span><br><br><span class="hljs-comment">// 连接 Map</span><br>Map&lt;String, Integer&gt; scores = ImmutableMap.of(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-number">90</span>, <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-number">85</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">joinedMap</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">&quot;; &quot;</span>).withKeyValueSeparator(<span class="hljs-string">&quot;=&quot;</span>).join(scores);<br>System.out.println(<span class="hljs-string">&quot;Map 连接: &quot;</span> + joinedMap);  <span class="hljs-comment">// 张三=90; 李四=85</span><br><br><span class="hljs-comment">// 3. Splitter - 拆分字符串</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Splitter ===&quot;</span>);<br><br><span class="hljs-type">String</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;a, b,  c  ,d,,e&quot;</span>;<br><br><span class="hljs-comment">// 简单拆分</span><br>List&lt;String&gt; parts1 = Splitter.on(<span class="hljs-string">&quot;,&quot;</span>).splitToList(input);<br>System.out.println(<span class="hljs-string">&quot;简单拆分: &quot;</span> + parts1);  <span class="hljs-comment">// [a,  b,  c  , d, , e]</span><br><br><span class="hljs-comment">// 去除空字符串</span><br>List&lt;String&gt; parts2 = Splitter.on(<span class="hljs-string">&quot;,&quot;</span>).omitEmptyStrings().splitToList(input);<br>System.out.println(<span class="hljs-string">&quot;去除空字符串: &quot;</span> + parts2);  <span class="hljs-comment">// [a,  b,  c  , d, e]</span><br><br><span class="hljs-comment">// 去除空白</span><br>List&lt;String&gt; parts3 = Splitter.on(<span class="hljs-string">&quot;,&quot;</span>).trimResults().omitEmptyStrings().splitToList(input);<br>System.out.println(<span class="hljs-string">&quot;去除空白: &quot;</span> + parts3);  <span class="hljs-comment">// [a, b, c, d, e]</span><br><br><span class="hljs-comment">// 限制拆分数量</span><br>List&lt;String&gt; parts4 = Splitter.on(<span class="hljs-string">&quot;,&quot;</span>).limit(<span class="hljs-number">3</span>).splitToList(input);<br>System.out.println(<span class="hljs-string">&quot;限制数量: &quot;</span> + parts4);  <span class="hljs-comment">// [a,  b,  c  ,d,,e]</span><br><br><span class="hljs-comment">// 拆分键值对</span><br><span class="hljs-type">String</span> <span class="hljs-variable">kvString</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;name=张三;age=25;city=北京&quot;</span>;<br>Map&lt;String, String&gt; kvMap = Splitter.on(<span class="hljs-string">&quot;;&quot;</span>)<br>    .trimResults()<br>    .withKeyValueSeparator(<span class="hljs-string">&quot;=&quot;</span>)<br>    .split(kvString);<br>System.out.println(<span class="hljs-string">&quot;键值对: &quot;</span> + kvMap);  <span class="hljs-comment">// &#123;name=张三, age=25, city=北京&#125;</span><br><br><span class="hljs-comment">// 4. CharMatcher - 字符匹配器</span><br>System.out.println(<span class="hljs-string">&quot;\n=== CharMatcher ===&quot;</span>);<br><br><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello 123 World! @#$&quot;</span>;<br><br><span class="hljs-comment">// 预定义匹配器</span><br><span class="hljs-type">String</span> <span class="hljs-variable">digits</span> <span class="hljs-operator">=</span> CharMatcher.digit().retainFrom(text);  <span class="hljs-comment">// 保留数字</span><br>System.out.println(<span class="hljs-string">&quot;保留数字: &quot;</span> + digits);  <span class="hljs-comment">// 123</span><br><br><span class="hljs-type">String</span> <span class="hljs-variable">letters</span> <span class="hljs-operator">=</span> CharMatcher.javaLetter().retainFrom(text);  <span class="hljs-comment">// 保留字母</span><br>System.out.println(<span class="hljs-string">&quot;保留字母: &quot;</span> + letters);  <span class="hljs-comment">// HelloWorld</span><br><br><span class="hljs-type">String</span> <span class="hljs-variable">noDigits</span> <span class="hljs-operator">=</span> CharMatcher.digit().removeFrom(text);  <span class="hljs-comment">// 移除数字</span><br>System.out.println(<span class="hljs-string">&quot;移除数字: &quot;</span> + noDigits);  <span class="hljs-comment">// Hello  World! @#$</span><br><br><span class="hljs-comment">// 自定义匹配器</span><br><span class="hljs-type">String</span> <span class="hljs-variable">noWhitespace</span> <span class="hljs-operator">=</span> CharMatcher.whitespace().removeFrom(text);  <span class="hljs-comment">// 移除空白</span><br>System.out.println(<span class="hljs-string">&quot;移除空白: &quot;</span> + noWhitespace);  <span class="hljs-comment">// Hello123World!@#$</span><br><br><span class="hljs-type">String</span> <span class="hljs-variable">onlyAlnum</span> <span class="hljs-operator">=</span> CharMatcher.javaLetterOrDigit().retainFrom(text);  <span class="hljs-comment">// 只保留字母和数字</span><br>System.out.println(<span class="hljs-string">&quot;只保留字母数字: &quot;</span> + onlyAlnum);  <span class="hljs-comment">// Hello123World</span><br><br><span class="hljs-comment">// 复杂匹配</span><br><span class="hljs-type">String</span> <span class="hljs-variable">cleaned</span> <span class="hljs-operator">=</span> CharMatcher.anyOf(<span class="hljs-string">&quot;@#$&quot;</span>).removeFrom(text);  <span class="hljs-comment">// 移除特殊字符</span><br>System.out.println(<span class="hljs-string">&quot;移除特殊字符: &quot;</span> + cleaned);  <span class="hljs-comment">// Hello 123 World!</span><br><br><span class="hljs-comment">// 压缩连续字符</span><br><span class="hljs-type">String</span> <span class="hljs-variable">compressed</span> <span class="hljs-operator">=</span> CharMatcher.whitespace().collapseFrom(text, <span class="hljs-string">&#x27; &#x27;</span>);<br>System.out.println(<span class="hljs-string">&quot;压缩空白: &quot;</span> + compressed);  <span class="hljs-comment">// Hello 123 World! @#$</span><br><br><span class="hljs-comment">// 5. CaseFormat - 命名风格转换</span><br>System.out.println(<span class="hljs-string">&quot;\n=== CaseFormat ===&quot;</span>);<br><br><span class="hljs-type">String</span> <span class="hljs-variable">lowerCamel</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;userName&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">upperCamel</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;UserName&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">lowerUnderscore</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user_name&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">upperUnderscore</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;USER_NAME&quot;</span>;<br><span class="hljs-type">String</span> <span class="hljs-variable">lowerHyphen</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user-name&quot;</span>;<br><br><span class="hljs-comment">// 转换示例</span><br>System.out.println(<span class="hljs-string">&quot;LOWER_CAMEL to UPPER_UNDERSCORE: &quot;</span> + <br>    CaseFormat.LOWER_CAMEL.to(CaseFormat.UPPER_UNDERSCORE, lowerCamel));  <span class="hljs-comment">// USER_NAME</span><br>System.out.println(<span class="hljs-string">&quot;LOWER_UNDERSCORE to LOWER_CAMEL: &quot;</span> + <br>    CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_CAMEL, lowerUnderscore));  <span class="hljs-comment">// userName</span><br>System.out.println(<span class="hljs-string">&quot;LOWER_HYPHEN to LOWER_CAMEL: &quot;</span> + <br>    CaseFormat.LOWER_HYPHEN.to(CaseFormat.LOWER_CAMEL, lowerHyphen));  <span class="hljs-comment">// userName</span><br>System.out.println(<span class="hljs-string">&quot;UPPER_CAMEL to LOWER_CAMEL: &quot;</span> + <br>    CaseFormat.UPPER_CAMEL.to(CaseFormat.LOWER_CAMEL, upperCamel));  <span class="hljs-comment">// userName</span><br></code></pre></td></tr></table></figure>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>Joiner 和 Splitter 是不可变的</strong>：配置后可以重复使用，建议定义为常量</li>
<li><strong>优先使用 CharMatcher</strong>：比正则表达式更简洁高效</li>
<li><strong>处理 null 值</strong>：使用 <code>Strings.nullToEmpty()</code> 避免 NPE</li>
<li><strong>批量操作</strong>：Joiner 和 Splitter 支持 List、Iterable 等集合类型</li>
</ol>
<hr>
<h1>Preconditions（前置条件检查）</h1>
<p>Guava 的 Preconditions 提供了简洁的前置条件检查工具，用于方法的输入验证和状态检查。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
<th>抛出异常</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>checkArgument</code></td>
<td>检查参数是否满足条件</td>
<td><code>IllegalArgumentException</code></td>
</tr>
<tr>
<td><code>checkNotNull</code></td>
<td>检查引用是否为 null</td>
<td><code>NullPointerException</code></td>
</tr>
<tr>
<td><code>checkState</code></td>
<td>检查对象状态是否有效</td>
<td><code>IllegalStateException</code></td>
</tr>
<tr>
<td><code>checkElementIndex</code></td>
<td>检查索引是否在集合范围内</td>
<td><code>IndexOutOfBoundsException</code></td>
</tr>
<tr>
<td><code>checkPositionIndex</code></td>
<td>检查位置索引是否有效</td>
<td><code>IndexOutOfBoundsException</code></td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.base.Preconditions;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// 1. checkArgument - 检查参数</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>    Preconditions.checkArgument(age &gt;= <span class="hljs-number">0</span> &amp;&amp; age &lt;= <span class="hljs-number">150</span>, <br>        <span class="hljs-string">&quot;年龄必须在 0-150 之间，当前值: %s&quot;</span>, age);<br>    <span class="hljs-built_in">this</span>.age = age;<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">try</span> &#123;<br>    setAge(-<span class="hljs-number">5</span>);  <span class="hljs-comment">// 抛出 IllegalArgumentException</span><br>&#125; <span class="hljs-keyword">catch</span> (IllegalArgumentException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;参数错误: &quot;</span> + e.getMessage());<br>&#125;<br><br><span class="hljs-comment">// 2. checkNotNull - 检查非空</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processUser</span><span class="hljs-params">(String userName)</span> &#123;<br>    Preconditions.checkNotNull(userName, <span class="hljs-string">&quot;用户名不能为 null&quot;</span>);<br>    System.out.println(<span class="hljs-string">&quot;处理用户: &quot;</span> + userName);<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br><span class="hljs-keyword">try</span> &#123;<br>    processUser(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// 抛出 NullPointerException</span><br>&#125; <span class="hljs-keyword">catch</span> (NullPointerException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;空值错误: &quot;</span> + e.getMessage());<br>&#125;<br><br><span class="hljs-comment">// 3. checkState - 检查状态</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Connection</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> &#123;<br>        Preconditions.checkState(!connected, <span class="hljs-string">&quot;连接已经建立&quot;</span>);<br>        <span class="hljs-built_in">this</span>.connected = <span class="hljs-literal">true</span>;<br>        System.out.println(<span class="hljs-string">&quot;连接成功&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disconnect</span><span class="hljs-params">()</span> &#123;<br>        Preconditions.checkState(connected, <span class="hljs-string">&quot;连接未建立&quot;</span>);<br>        <span class="hljs-built_in">this</span>.connected = <span class="hljs-literal">false</span>;<br>        System.out.println(<span class="hljs-string">&quot;断开连接&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 4. checkElementIndex - 检查元素索引</span><br><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getElement</span><span class="hljs-params">(List&lt;T&gt; list, <span class="hljs-type">int</span> index)</span> &#123;<br>    Preconditions.checkElementIndex(index, list.size(), <br>        <span class="hljs-string">&quot;索引超出范围&quot;</span>);<br>    <span class="hljs-keyword">return</span> list.get(index);<br>&#125;<br><br><span class="hljs-comment">// 使用</span><br>List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>    getElement(list, <span class="hljs-number">3</span>);  <span class="hljs-comment">// 抛出 IndexOutOfBoundsException</span><br>&#125; <span class="hljs-keyword">catch</span> (IndexOutOfBoundsException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;索引错误: &quot;</span> + e.getMessage());<br>&#125;<br><br><span class="hljs-comment">// 5. checkPositionIndex - 检查位置索引（允许等于 size）</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertAt</span><span class="hljs-params">(List&lt;String&gt; list, <span class="hljs-type">int</span> index, String value)</span> &#123;<br>    Preconditions.checkPositionIndex(index, list.size(), <br>        <span class="hljs-string">&quot;插入位置无效&quot;</span>);<br>    list.add(index, value);<br>&#125;<br><br><span class="hljs-comment">// 组合使用</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserValidator</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateUser</span><span class="hljs-params">(String name, Integer age, String email)</span> &#123;<br>        <span class="hljs-comment">// 多个前置条件检查</span><br>        Preconditions.checkNotNull(name, <span class="hljs-string">&quot;姓名不能为 null&quot;</span>);<br>        Preconditions.checkArgument(!name.trim().isEmpty(), <br>            <span class="hljs-string">&quot;姓名不能为空&quot;</span>);<br>        Preconditions.checkNotNull(age, <span class="hljs-string">&quot;年龄不能为 null&quot;</span>);<br>        Preconditions.checkArgument(age &gt;= <span class="hljs-number">0</span> &amp;&amp; age &lt;= <span class="hljs-number">150</span>, <br>            <span class="hljs-string">&quot;年龄必须在 0-150 之间&quot;</span>);<br>        Preconditions.checkNotNull(email, <span class="hljs-string">&quot;邮箱不能为 null&quot;</span>);<br>        Preconditions.checkArgument(email.contains(<span class="hljs-string">&quot;@&quot;</span>), <br>            <span class="hljs-string">&quot;邮箱格式不正确&quot;</span>);<br>        <br>        System.out.println(<span class="hljs-string">&quot;用户验证通过: &quot;</span> + name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="与其他方法的对比">与其他方法的对比</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>Guava Preconditions</th>
<th>Java assert</th>
<th>Objects.requireNonNull</th>
</tr>
</thead>
<tbody>
<tr>
<td>异常类型</td>
<td>明确的异常类型</td>
<td>AssertionError</td>
<td>NullPointerException</td>
</tr>
<tr>
<td>编译检查</td>
<td>始终检查</td>
<td>需要开启 -ea</td>
<td>始终检查</td>
</tr>
<tr>
<td>错误信息</td>
<td>支持格式化</td>
<td>不支持</td>
<td>固定格式</td>
</tr>
<tr>
<td>性能</td>
<td>最小化开销</td>
<td>零开销（关闭时）</td>
<td>简单检查</td>
</tr>
</tbody>
</table>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>方法入口验证</strong>：在公共方法开始处使用 <code>checkArgument</code> 验证参数</li>
<li><strong>状态检查</strong>：在依赖对象状态的方法中使用 <code>checkState</code></li>
<li><strong>非空检查</strong>：使用 <code>checkNotNull</code> 替代手动 null 检查</li>
<li><strong>清晰的错误信息</strong>：提供有意义的错误消息，便于调试</li>
<li><strong>不要过度使用</strong>：只在真正需要验证的地方使用，避免影响性能</li>
</ol>
<hr>
<h1>Optional（可选值）</h1>
<p>Guava Optional 是一个用于表示可能为 null 的值的容器类，帮助开发者避免 NPE。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>of(T)</code></td>
<td>创建包含非 null 值的 Optional</td>
</tr>
<tr>
<td><code>absent()</code></td>
<td>创建空的 Optional</td>
</tr>
<tr>
<td><code>fromNullable(T)</code></td>
<td>创建可能为 null 的 Optional</td>
</tr>
<tr>
<td><code>isPresent()</code></td>
<td>检查是否包含值</td>
</tr>
<tr>
<td><code>get()</code></td>
<td>获取值（如果不存在抛出异常）</td>
</tr>
<tr>
<td><code>or(T)</code></td>
<td>获取值，不存在则返回默认值</td>
</tr>
<tr>
<td><code>orNull()</code></td>
<td>获取值，不存在则返回 null</td>
</tr>
<tr>
<td><code>transform(Function)</code></td>
<td>转换值</td>
</tr>
</tbody>
</table>
<h3 id="guava-optional-vs-java-8-optional">Guava Optional vs Java 8 Optional</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>Guava Optional</th>
<th>Java 8 Optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>包路径</td>
<td><code>com.google.common.base</code></td>
<td><code>java.util</code></td>
</tr>
<tr>
<td><code>or()</code> 方法</td>
<td>支持</td>
<td>不支持（用 <code>orElse()</code>）</td>
</tr>
<tr>
<td><code>orNull()</code></td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td><code>transform()</code></td>
<td>支持</td>
<td>用 <code>map()</code></td>
</tr>
<tr>
<td>序列化</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>推荐使用</td>
<td>Java 7 项目</td>
<td>Java 8+ 项目</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.base.Optional;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// 1. 创建 Optional</span><br>Optional&lt;String&gt; present = Optional.of(<span class="hljs-string">&quot;Hello&quot;</span>);<br>Optional&lt;String&gt; absent = Optional.absent();<br>Optional&lt;String&gt; nullable = Optional.fromNullable(<span class="hljs-literal">null</span>);<br>Optional&lt;String&gt; fromValue = Optional.fromNullable(<span class="hljs-string">&quot;World&quot;</span>);<br><br>System.out.println(<span class="hljs-string">&quot;present.isPresent(): &quot;</span> + present.isPresent());  <span class="hljs-comment">// true</span><br>System.out.println(<span class="hljs-string">&quot;absent.isPresent(): &quot;</span> + absent.isPresent());  <span class="hljs-comment">// false</span><br>System.out.println(<span class="hljs-string">&quot;nullable.isPresent(): &quot;</span> + nullable.isPresent());  <span class="hljs-comment">// false</span><br><br><span class="hljs-comment">// 2. 获取值</span><br>System.out.println(<span class="hljs-string">&quot;present.get(): &quot;</span> + present.get());  <span class="hljs-comment">// Hello</span><br>System.out.println(<span class="hljs-string">&quot;present.or(\&quot;Default\&quot;): &quot;</span> + present.or(<span class="hljs-string">&quot;Default&quot;</span>));  <span class="hljs-comment">// Hello</span><br>System.out.println(<span class="hljs-string">&quot;absent.or(\&quot;Default\&quot;): &quot;</span> + absent.or(<span class="hljs-string">&quot;Default&quot;</span>));  <span class="hljs-comment">// Default</span><br>System.out.println(<span class="hljs-string">&quot;absent.orNull(): &quot;</span> + absent.orNull());  <span class="hljs-comment">// null</span><br><br><span class="hljs-comment">// 3. 转换值</span><br>Optional&lt;Integer&gt; length = present.transform(String::length);<br>System.out.println(<span class="hljs-string">&quot;长度: &quot;</span> + length.or(<span class="hljs-number">0</span>));  <span class="hljs-comment">// 5</span><br><br><span class="hljs-comment">// 4. 实际应用场景</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">private</span> Map&lt;String, User&gt; userDatabase = Maps.newHashMap();<br>    <br>    <span class="hljs-keyword">public</span> Optional&lt;User&gt; <span class="hljs-title function_">findUserById</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-keyword">return</span> Optional.fromNullable(userDatabase.get(userId));<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserName</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-keyword">return</span> findUserById(userId)<br>            .transform(User::getName)<br>            .or(<span class="hljs-string">&quot;未知用户&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">getUserRoles</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-keyword">return</span> findUserById(userId)<br>            .transform(User::getRoles)<br>            .or(Lists.newArrayList());<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 使用示例</span><br><span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br><span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> userService.getUserName(<span class="hljs-string">&quot;123&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;用户名: &quot;</span> + userName);<br><br><span class="hljs-comment">// 5. 链式操作</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigService</span> &#123;<br>    <span class="hljs-keyword">public</span> Optional&lt;String&gt; <span class="hljs-title function_">getConfig</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-comment">// 模拟配置读取</span><br>        <span class="hljs-keyword">return</span> Optional.fromNullable(System.getProperty(key));<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getTimeout</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> getConfig(key)<br>            .transform(Integer::parseInt)<br>            .or(<span class="hljs-number">30</span>);  <span class="hljs-comment">// 默认 30 秒</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 6. 避免嵌套 null 检查</span><br><span class="hljs-comment">// 传统方式</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCityOld</span><span class="hljs-params">(User user)</span> &#123;<br>    <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">Address</span> <span class="hljs-variable">address</span> <span class="hljs-operator">=</span> user.getAddress();<br>        <span class="hljs-keyword">if</span> (address != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> address.getCity();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未知&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// 使用 Optional</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">getCityNew</span><span class="hljs-params">(Optional&lt;User&gt; user)</span> &#123;<br>    <span class="hljs-keyword">return</span> user.transform(User::getAddress)<br>        .transform(Address::getCity)<br>        .or(<span class="hljs-string">&quot;未知&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="迁移建议">迁移建议</h3>
<ol>
<li><strong>Java 8+ 项目</strong>：优先使用 <code>java.util.Optional</code></li>
<li><strong>需要序列化</strong>：使用 Guava Optional</li>
<li><strong>需要 <code>orNull()</code> 方法</strong>：使用 Guava Optional</li>
<li><strong>迁移路径</strong>：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Guava Optional</span><br>Optional&lt;String&gt; guavaOpt = Optional.fromNullable(value);<br><br><span class="hljs-comment">// 迁移到 Java 8 Optional</span><br>java.util.Optional&lt;String&gt; javaOpt = java.util.Optional.ofNullable(value);<br><br><span class="hljs-comment">// 主要差异</span><br><span class="hljs-comment">// guavaOpt.or(default)  -&gt; javaOpt.orElse(default)</span><br><span class="hljs-comment">// guavaOpt.orNull()     -&gt; javaOpt.orElse(null)</span><br><span class="hljs-comment">// guavaOpt.transform()  -&gt; javaOpt.map()</span><br></code></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>不要将 Optional 作为字段类型</strong>：主要用于方法返回值</li>
<li><strong>不要将 Optional 作为方法参数</strong>：直接传递 null 或使用重载</li>
<li><strong>不要直接调用 <code>get()</code></strong>：先检查 <code>isPresent()</code> 或使用 <code>or()</code></li>
<li><strong>用于返回值</strong>：明确表示可能返回 null 的方法</li>
</ol>
<hr>
<h1>Ordering（排序器）</h1>
<p>Guava Ordering 是一个强大的排序工具类，提供了丰富的链式排序 API。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>natural()</code></td>
<td>自然排序</td>
</tr>
<tr>
<td><code>usingToString()</code></td>
<td>按 toString() 排序</td>
</tr>
<tr>
<td><code>from(Comparator)</code></td>
<td>从 Comparator 创建 Ordering</td>
</tr>
<tr>
<td><code>reverse()</code></td>
<td>反转排序</td>
</tr>
<tr>
<td><code>nullsFirst()</code></td>
<td>null 排在前面</td>
</tr>
<tr>
<td><code>nullsLast()</code></td>
<td>null 排在后面</td>
</tr>
<tr>
<td><code>compound(Comparator)</code></td>
<td>组合排序</td>
</tr>
<tr>
<td><code>onResultOf(Function)</code></td>
<td>基于函数值排序</td>
</tr>
<tr>
<td><code>greatestOf(Iterable, n)</code></td>
<td>获取最大的 n 个元素</td>
</tr>
<tr>
<td><code>leastOf(Iterable, n)</code></td>
<td>获取最小的 n 个元素</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.collect.Ordering;<br><span class="hljs-keyword">import</span> com.google.common.base.Function;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Comparator;<br><br><span class="hljs-comment">// 1. 基本排序</span><br>List&lt;String&gt; names = Lists.newArrayList(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-string">&quot;王五&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;赵六&quot;</span>);<br><br><span class="hljs-comment">// 自然排序</span><br>Ordering&lt;String&gt; natural = Ordering.natural();<br>List&lt;String&gt; sorted = natural.sortedCopy(names);<br>System.out.println(<span class="hljs-string">&quot;自然排序: &quot;</span> + sorted);  <span class="hljs-comment">// [null, 张三, 李四, 王五, 赵六]</span><br><br><span class="hljs-comment">// null 排在最后</span><br>List&lt;String&gt; nullsLast = Ordering.natural().nullsLast().sortedCopy(names);<br>System.out.println(<span class="hljs-string">&quot;null 最后: &quot;</span> + nullsLast);  <span class="hljs-comment">// [张三, 李四, 王五, 赵六, null]</span><br><br><span class="hljs-comment">// 反转排序</span><br>List&lt;String&gt; reversed = Ordering.natural().reverse().sortedCopy(names);<br>System.out.println(<span class="hljs-string">&quot;反转排序: &quot;</span> + reversed);  <span class="hljs-comment">// [赵六, 王五, 李四, 张三, null]</span><br><br><span class="hljs-comment">// 2. 使用对象排序</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> score;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, <span class="hljs-type">int</span> score)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.score = score;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> name; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> age; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getScore</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> score; &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">&quot;%s(%d岁,%d分)&quot;</span>, name, age, score);<br>    &#125;<br>&#125;<br><br>List&lt;Person&gt; people = Lists.newArrayList(<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-number">90</span>),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;李四&quot;</span>, <span class="hljs-number">30</span>, <span class="hljs-number">85</span>),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;王五&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-number">95</span>),<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;赵六&quot;</span>, <span class="hljs-number">28</span>, <span class="hljs-number">90</span>)<br>);<br><br><span class="hljs-comment">// 3. 基于函数排序</span><br>Ordering&lt;Person&gt; byAge = Ordering.natural().onResultOf(Person::getAge);<br>List&lt;Person&gt; sortedByAge = byAge.sortedCopy(people);<br>System.out.println(<span class="hljs-string">&quot;按年龄排序: &quot;</span> + sortedByAge);<br><br><span class="hljs-comment">// 4. 组合排序：先按年龄，年龄相同按分数</span><br>Ordering&lt;Person&gt; byAgeThenScore = Ordering.natural()<br>    .onResultOf(Person::getAge)<br>    .compound(Ordering.natural().onResultOf(Person::getScore));<br>List&lt;Person&gt; sortedByAgeThenScore = byAgeThenScore.sortedCopy(people);<br>System.out.println(<span class="hljs-string">&quot;按年龄和分数排序: &quot;</span> + sortedByAgeThenScore);<br><br><span class="hljs-comment">// 5. 获取前 N 个元素</span><br>List&lt;Person&gt; top2 = Ordering.natural()<br>    .onResultOf(Person::getScore)<br>    .greatestOf(people, <span class="hljs-number">2</span>);<br>System.out.println(<span class="hljs-string">&quot;分数最高的 2 人: &quot;</span> + top2);<br><br>List&lt;Person&gt; bottom2 = Ordering.natural()<br>    .onResultOf(Person::getScore)<br>    .leastOf(people, <span class="hljs-number">2</span>);<br>System.out.println(<span class="hljs-string">&quot;分数最低的 2 人: &quot;</span> + bottom2);<br><br><span class="hljs-comment">// 6. 自定义 Comparator</span><br>Ordering&lt;Person&gt; byNameLength = Ordering.from(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>&lt;Person&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(Person p1, Person p2)</span> &#123;<br>        <span class="hljs-keyword">return</span> Integer.compare(p1.getName().length(), p2.getName().length());<br>    &#125;<br>&#125;);<br>List&lt;Person&gt; sortedByNameLength = byNameLength.sortedCopy(people);<br>System.out.println(<span class="hljs-string">&quot;按姓名长度排序: &quot;</span> + sortedByNameLength);<br><br><span class="hljs-comment">// 7. 链式排序</span><br>Ordering&lt;Person&gt; complexOrdering = Ordering.natural()<br>    .nullsFirst()<br>    .onResultOf(Person::getScore)<br>    .reverse()<br>    .compound(Ordering.natural().onResultOf(Person::getAge));<br>List&lt;Person&gt; complexSorted = complexOrdering.sortedCopy(people);<br>System.out.println(<span class="hljs-string">&quot;复杂排序: &quot;</span> + complexSorted);<br><br><span class="hljs-comment">// 8. 检查排序</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">isSorted</span> <span class="hljs-operator">=</span> Ordering.natural().isOrdered(Lists.newArrayList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>));<br>System.out.println(<span class="hljs-string">&quot;是否已排序: &quot;</span> + isSorted);  <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 9. 二分查找</span><br>List&lt;Integer&gt; numbers = Lists.newArrayList(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> Ordering.natural().binarySearch(numbers, <span class="hljs-number">5</span>);<br>System.out.println(<span class="hljs-string">&quot;5 的索引: &quot;</span> + index);  <span class="hljs-comment">// 2</span><br></code></pre></td></tr></table></figure>
<h3 id="与-java-8-comparator-的对比">与 Java 8 Comparator 的对比</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>Guava Ordering</th>
<th>Java 8 Comparator</th>
</tr>
</thead>
<tbody>
<tr>
<td>链式 API</td>
<td>丰富</td>
<td>支持（<code>thenComparing</code>）</td>
</tr>
<tr>
<td>null 处理</td>
<td><code>nullsFirst()</code>/<code>nullsLast()</code></td>
<td><code>Comparator.nullsFirst()</code></td>
</tr>
<tr>
<td>获取前 N 个</td>
<td><code>greatestOf()</code>/<code>leastOf()</code></td>
<td><code>Stream.sorted().limit()</code></td>
</tr>
<tr>
<td>检查排序</td>
<td><code>isOrdered()</code></td>
<td>无直接方法</td>
</tr>
<tr>
<td>二分查找</td>
<td><code>binarySearch()</code></td>
<td><code>Collections.binarySearch()</code></td>
</tr>
</tbody>
</table>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>Java 8+ 项目</strong>：优先使用 Stream API 和 Comparator</li>
<li><strong>复杂排序</strong>：使用 <code>compound()</code> 组合多个排序条件</li>
<li><strong>null 处理</strong>：使用 <code>nullsFirst()</code> 或 <code>nullsLast()</code> 避免 NPE</li>
<li><strong>性能优化</strong>：使用 <code>greatestOf()</code>/<code>leastOf()</code> 比先排序再取更高效</li>
</ol>
<hr>
<h1>EventBus（事件总线）</h1>
<p>Guava EventBus 是一个发布-订阅模式的事件总线，实现了组件间的松耦合通信。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>EventBus</code></td>
<td>同步事件总线</td>
</tr>
<tr>
<td><code>AsyncEventBus</code></td>
<td>异步事件总线</td>
</tr>
<tr>
<td><code>@Subscribe</code></td>
<td>订阅者方法注解</td>
</tr>
<tr>
<td><code>DeadEvent</code></td>
<td>无订阅者的事件包装类</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.eventbus.EventBus;<br><span class="hljs-keyword">import</span> com.google.common.eventbus.AsyncEventBus;<br><span class="hljs-keyword">import</span> com.google.common.eventbus.Subscribe;<br><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;<br><span class="hljs-keyword">import</span> java.util.concurrent.Executors;<br><br><span class="hljs-comment">// 1. 定义事件</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserEvent</span> &#123;<br>    <span class="hljs-keyword">private</span> String eventType;<br>    <span class="hljs-keyword">private</span> String userName;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserEvent</span><span class="hljs-params">(String eventType, String userName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.eventType = eventType;<br>        <span class="hljs-built_in">this</span>.userName = userName;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getEventType</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> eventType; &#125;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserName</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> userName; &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">&quot;UserEvent&#123;type=%s, user=%s&#125;&quot;</span>, eventType, userName);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 2. 定义订阅者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserListener</span> &#123;<br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserLogin</span><span class="hljs-params">(UserEvent event)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;LOGIN&quot;</span>.equals(event.getEventType())) &#123;<br>            System.out.println(<span class="hljs-string">&quot;用户登录: &quot;</span> + event.getUserName());<br>            <span class="hljs-comment">// 记录日志、更新状态等</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onUserLogout</span><span class="hljs-params">(UserEvent event)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;LOGOUT&quot;</span>.equals(event.getEventType())) &#123;<br>            System.out.println(<span class="hljs-string">&quot;用户登出: &quot;</span> + event.getUserName());<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAllEvents</span><span class="hljs-params">(UserEvent event)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;收到事件: &quot;</span> + event);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 3. 使用 EventBus</span><br><span class="hljs-type">EventBus</span> <span class="hljs-variable">eventBus</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventBus</span>();<br><br><span class="hljs-comment">// 注册订阅者</span><br><span class="hljs-type">UserListener</span> <span class="hljs-variable">listener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserListener</span>();<br>eventBus.register(listener);<br><br><span class="hljs-comment">// 发布事件</span><br>eventBus.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserEvent</span>(<span class="hljs-string">&quot;LOGIN&quot;</span>, <span class="hljs-string">&quot;张三&quot;</span>));<br>eventBus.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserEvent</span>(<span class="hljs-string">&quot;LOGIN&quot;</span>, <span class="hljs-string">&quot;李四&quot;</span>));<br>eventBus.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserEvent</span>(<span class="hljs-string">&quot;LOGOUT&quot;</span>, <span class="hljs-string">&quot;张三&quot;</span>));<br><br><span class="hljs-comment">// 4. 处理 DeadEvent（无订阅者的事件）</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadEventListener</span> &#123;<br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleDeadEvent</span><span class="hljs-params">(DeadEvent event)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;无订阅者的事件: &quot;</span> + event.getEvent());<br>    &#125;<br>&#125;<br><br>eventBus.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DeadEventListener</span>());<br>eventBus.post(<span class="hljs-string">&quot;这是一个没有订阅者的事件&quot;</span>);  <span class="hljs-comment">// 会被 DeadEventListener 接收</span><br><br><span class="hljs-comment">// 5. 异步事件总线</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);<br><span class="hljs-type">AsyncEventBus</span> <span class="hljs-variable">asyncEventBus</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncEventBus</span>(executor);<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncListener</span> &#123;<br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleAsyncEvent</span><span class="hljs-params">(String event)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;异步处理: &quot;</span> + event + <span class="hljs-string">&quot; - 线程: &quot;</span> + <br>            Thread.currentThread().getName());<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// 模拟耗时操作</span><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            Thread.currentThread().interrupt();<br>        &#125;<br>    &#125;<br>&#125;<br><br>asyncEventBus.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncListener</span>());<br>asyncEventBus.post(<span class="hljs-string">&quot;事件1&quot;</span>);<br>asyncEventBus.post(<span class="hljs-string">&quot;事件2&quot;</span>);<br>asyncEventBus.post(<span class="hljs-string">&quot;事件3&quot;</span>);<br><br><span class="hljs-comment">// 6. 多个订阅者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListenerA</span> &#123;<br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(String event)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ListenerA 收到: &quot;</span> + event);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListenerB</span> &#123;<br>    <span class="hljs-meta">@Subscribe</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(String event)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;ListenerB 收到: &quot;</span> + event);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">EventBus</span> <span class="hljs-variable">multiBus</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventBus</span>();<br>multiBus.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListenerA</span>());<br>multiBus.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ListenerB</span>());<br>multiBus.post(<span class="hljs-string">&quot;广播消息&quot;</span>);<br><br><span class="hljs-comment">// 7. 取消注册</span><br>eventBus.unregister(listener);<br></code></pre></td></tr></table></figure>
<h3 id="与-spring-event-的对比">与 Spring Event 的对比</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>Guava EventBus</th>
<th>Spring Event</th>
</tr>
</thead>
<tbody>
<tr>
<td>依赖</td>
<td>无依赖</td>
<td>需要 Spring 框架</td>
</tr>
<tr>
<td>同步/异步</td>
<td>两者都支持</td>
<td>两者都支持</td>
</tr>
<tr>
<td>事务</td>
<td>不支持</td>
<td>支持（<code>@TransactionalEventListener</code>）</td>
</tr>
<tr>
<td>条件订阅</td>
<td>不支持</td>
<td>支持（SpEL 表达式）</td>
</tr>
<tr>
<td>泛型支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>使用场景</td>
<td>轻量级、无 Spring 环境</td>
<td>Spring 项目</td>
</tr>
</tbody>
</table>
<h3 id="适用场景">适用场景</h3>
<p><strong>适合使用 EventBus</strong>：</p>
<ul>
<li>组件间需要解耦通信</li>
<li>不需要事务支持</li>
<li>轻量级项目，不依赖 Spring</li>
<li>简单的发布-订阅模式</li>
</ul>
<p><strong>不适合使用 EventBus</strong>：</p>
<ul>
<li>需要事务支持的事件</li>
<li>需要条件过滤的事件</li>
<li>需要有序处理的事件</li>
<li>复杂的企业级应用（建议使用 Spring Event 或消息队列）</li>
</ul>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>事件对象不可变</strong>：确保事件对象在发布后不被修改</li>
<li><strong>避免阻塞</strong>：同步事件总线中，订阅者方法不应长时间阻塞</li>
<li><strong>异常处理</strong>：订阅者方法中的异常不会影响其他订阅者</li>
<li><strong>内存泄漏</strong>：及时 unregister 不再需要的订阅者</li>
</ol>
<hr>
<h1>Hashing（哈希）</h1>
<p>Guava 提供了强大的哈希工具，包括常见的哈希算法、布隆过滤器和一致性哈希。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HashFunction</code></td>
<td>哈希函数接口</td>
</tr>
<tr>
<td><code>HashCode</code></td>
<td>哈希码值</td>
</tr>
<tr>
<td><code>Hasher</code></td>
<td>哈希计算器</td>
</tr>
<tr>
<td><code>BloomFilter</code></td>
<td>布隆过滤器</td>
</tr>
<tr>
<td><code>Hashing</code></td>
<td>哈希工具类</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.hash.HashFunction;<br><span class="hljs-keyword">import</span> com.google.common.hash.HashCode;<br><span class="hljs-keyword">import</span> com.google.common.hash.Hasher;<br><span class="hljs-keyword">import</span> com.google.common.hash.Hashing;<br><span class="hljs-keyword">import</span> com.google.common.hash.BloomFilter;<br><span class="hljs-keyword">import</span> com.google.common.hash.Funnels;<br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// 1. 基本哈希计算</span><br><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello, Guava!&quot;</span>;<br><br><span class="hljs-comment">// MD5</span><br><span class="hljs-type">HashFunction</span> <span class="hljs-variable">md5</span> <span class="hljs-operator">=</span> Hashing.md5();<br><span class="hljs-type">HashCode</span> <span class="hljs-variable">md5Hash</span> <span class="hljs-operator">=</span> md5.hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;MD5: &quot;</span> + md5Hash.toString());<br><br><span class="hljs-comment">// SHA-256</span><br><span class="hljs-type">HashCode</span> <span class="hljs-variable">sha256Hash</span> <span class="hljs-operator">=</span> Hashing.sha256().hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;SHA-256: &quot;</span> + sha256Hash.toString());<br><br><span class="hljs-comment">// MurmurHash3（高性能）</span><br><span class="hljs-type">HashCode</span> <span class="hljs-variable">murmurHash</span> <span class="hljs-operator">=</span> Hashing.murmur3_128().hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;Murmur3: &quot;</span> + murmurHash.toString());<br><br><span class="hljs-comment">// 2. 分步哈希（适用于大文件）</span><br><span class="hljs-type">Hasher</span> <span class="hljs-variable">hasher</span> <span class="hljs-operator">=</span> Hashing.sha256().newHasher();<br>hasher.putString(<span class="hljs-string">&quot;Part 1: &quot;</span>, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>hasher.putString(<span class="hljs-string">&quot;Hello&quot;</span>, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>hasher.putString(<span class="hljs-string">&quot;Part 2: &quot;</span>, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>hasher.putString(<span class="hljs-string">&quot;World&quot;</span>, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br><span class="hljs-type">HashCode</span> <span class="hljs-variable">combinedHash</span> <span class="hljs-operator">=</span> hasher.hash();<br>System.out.println(<span class="hljs-string">&quot;组合哈希: &quot;</span> + combinedHash.toString());<br><br><span class="hljs-comment">// 3. 哈希对象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> name; &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> age; &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Hashing.combineOrdered(<br>            Hashing.consistentHash(Hashing.sha256().hashString(name, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)), <span class="hljs-number">100</span>),<br>            Hashing.consistentHash(HashCode.fromInt(age), <span class="hljs-number">100</span>)<br>        );<br>    &#125;<br>&#125;<br><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;张三&quot;</span>, <span class="hljs-number">25</span>);<br><span class="hljs-type">HashCode</span> <span class="hljs-variable">userHash</span> <span class="hljs-operator">=</span> Hashing.sha256().newHasher()<br>    .putString(user.getName(), Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>))<br>    .putInt(user.getAge())<br>    .hash();<br>System.out.println(<span class="hljs-string">&quot;用户哈希: &quot;</span> + userHash.toString());<br><br><span class="hljs-comment">// 4. 布隆过滤器（Bloom Filter）</span><br><span class="hljs-comment">// 布隆过滤器用于判断一个元素是否在一个集合中，有误判但不会漏判</span><br>BloomFilter&lt;String&gt; bloomFilter = BloomFilter.create(<br>    Funnels.stringFunnel(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)),<br>    <span class="hljs-number">1000</span>,  <span class="hljs-comment">// 预期插入数量</span><br>    <span class="hljs-number">0.01</span>   <span class="hljs-comment">// 误判率 1%</span><br>);<br><br><span class="hljs-comment">// 添加元素</span><br>bloomFilter.put(<span class="hljs-string">&quot;apple&quot;</span>);<br>bloomFilter.put(<span class="hljs-string">&quot;banana&quot;</span>);<br>bloomFilter.put(<span class="hljs-string">&quot;orange&quot;</span>);<br><br><span class="hljs-comment">// 检查元素</span><br>System.out.println(<span class="hljs-string">&quot;包含 apple: &quot;</span> + bloomFilter.mightContain(<span class="hljs-string">&quot;apple&quot;</span>));    <span class="hljs-comment">// true</span><br>System.out.println(<span class="hljs-string">&quot;包含 banana: &quot;</span> + bloomFilter.mightContain(<span class="hljs-string">&quot;banana&quot;</span>));  <span class="hljs-comment">// true</span><br>System.out.println(<span class="hljs-string">&quot;包含 grape: &quot;</span> + bloomFilter.mightContain(<span class="hljs-string">&quot;grape&quot;</span>));    <span class="hljs-comment">// false（可能误判为 true）</span><br><br><span class="hljs-comment">// 5. 一致性哈希（Consistent Hashing）</span><br><span class="hljs-comment">// 用于分布式系统中的数据分片</span><br>List&lt;String&gt; servers = Lists.newArrayList(<span class="hljs-string">&quot;server1&quot;</span>, <span class="hljs-string">&quot;server2&quot;</span>, <span class="hljs-string">&quot;server3&quot;</span>, <span class="hljs-string">&quot;server4&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;user_12345&quot;</span>;<br><br><span class="hljs-comment">// 计算键应该分配到哪个服务器</span><br><span class="hljs-type">int</span> <span class="hljs-variable">serverIndex</span> <span class="hljs-operator">=</span> Hashing.consistentHash(<br>    Hashing.md5().hashString(key, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)),<br>    servers.size()<br>);<br>System.out.println(<span class="hljs-string">&quot;键 &quot;</span> + key + <span class="hljs-string">&quot; 分配到: &quot;</span> + servers.get(serverIndex));<br><br><span class="hljs-comment">// 当服务器数量变化时，大部分键的分配不变</span><br>List&lt;String&gt; newServers = Lists.newArrayList(<span class="hljs-string">&quot;server1&quot;</span>, <span class="hljs-string">&quot;server2&quot;</span>, <span class="hljs-string">&quot;server5&quot;</span>, <span class="hljs-string">&quot;server6&quot;</span>);<br><span class="hljs-type">int</span> <span class="hljs-variable">newServerIndex</span> <span class="hljs-operator">=</span> Hashing.consistentHash(<br>    Hashing.md5().hashString(key, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)),<br>    newServers.size()<br>);<br>System.out.println(<span class="hljs-string">&quot;服务器变化后分配到: &quot;</span> + newServers.get(newServerIndex));<br><br><span class="hljs-comment">// 6. goodFastHash - 快速哈希（性能优先）</span><br><span class="hljs-type">HashCode</span> <span class="hljs-variable">fastHash</span> <span class="hljs-operator">=</span> Hashing.goodFastHash(<span class="hljs-number">128</span>).hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;快速哈希: &quot;</span> + fastHash.toString());<br><br><span class="hljs-comment">// 7. SipHash24 - 安全哈希</span><br><span class="hljs-type">HashCode</span> <span class="hljs-variable">sipHash</span> <span class="hljs-operator">=</span> Hashing.sipHash24().hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;SipHash24: &quot;</span> + sipHash.toString());<br><br><span class="hljs-comment">// 8. adler32 和 crc32 - 校验和</span><br><span class="hljs-type">HashCode</span> <span class="hljs-variable">adler32</span> <span class="hljs-operator">=</span> Hashing.adler32().hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br><span class="hljs-type">HashCode</span> <span class="hljs-variable">crc32</span> <span class="hljs-operator">=</span> Hashing.crc32().hashString(text, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;Adler32: &quot;</span> + adler32.toString());<br>System.out.println(<span class="hljs-string">&quot;CRC32: &quot;</span> + crc32.toString());<br></code></pre></td></tr></table></figure>
<h3 id="哈希算法选择">哈希算法选择</h3>
<table>
<thead>
<tr>
<th>算法</th>
<th>特点</th>
<th>使用场景</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>md5</code></td>
<td>快速但已不安全</td>
<td>非安全场景的哈希</td>
</tr>
<tr>
<td><code>sha256</code></td>
<td>安全</td>
<td>安全哈希需求</td>
</tr>
<tr>
<td><code>murmur3_128</code></td>
<td>极高性能</td>
<td>缓存、数据分片</td>
</tr>
<tr>
<td><code>sipHash24</code></td>
<td>安全且快速</td>
<td>防止哈希碰撞攻击</td>
</tr>
<tr>
<td><code>goodFastHash</code></td>
<td>自适应快速</td>
<td>通用快速哈希</td>
</tr>
</tbody>
</table>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>安全哈希</strong>：使用 <code>sha256</code> 或 <code>sipHash24</code></li>
<li><strong>高性能哈希</strong>：使用 <code>murmur3_128</code> 或 <code>goodFastHash</code></li>
<li><strong>布隆过滤器</strong>：用于去重、黑名单检查等场景</li>
<li><strong>一致性哈希</strong>：用于分布式缓存、负载均衡</li>
</ol>
<hr>
<h1>Concurrency（并发工具）</h1>
<p>Guava 提供了增强的并发工具，包括可监听的 Future、限流器等。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>类/接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ListenableFuture</code></td>
<td>可监听的 Future</td>
</tr>
<tr>
<td><code>SettableFuture</code></td>
<td>可手动设置的 Future</td>
</tr>
<tr>
<td><code>Futures</code></td>
<td>Future 工具类</td>
</tr>
<tr>
<td><code>MoreExecutors</code></td>
<td>Executor 工具类</td>
</tr>
<tr>
<td><code>RateLimiter</code></td>
<td>令牌桶限流器</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.util.concurrent.*;<br><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-comment">// 1. ListenableFuture - 可监听的 Future</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">4</span>);<br><span class="hljs-type">ListeningExecutorService</span> <span class="hljs-variable">listeningExecutor</span> <span class="hljs-operator">=</span> MoreExecutors.listeningDecorator(executor);<br><br><span class="hljs-comment">// 创建异步任务</span><br>ListenableFuture&lt;String&gt; future = listeningExecutor.submit(() -&gt; &#123;<br>    Thread.sleep(<span class="hljs-number">1000</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;任务完成&quot;</span>;<br>&#125;);<br><br><span class="hljs-comment">// 添加回调</span><br>Futures.addCallback(future, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureCallback</span>&lt;String&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(String result)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;成功: &quot;</span> + result);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;失败: &quot;</span> + t.getMessage());<br>    &#125;<br>&#125;, executor);<br><br><span class="hljs-comment">// 2. Future 转换</span><br>ListenableFuture&lt;Integer&gt; lengthFuture = Futures.transform(future, <br>    String::length, executor);<br><br>Futures.addCallback(lengthFuture, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureCallback</span>&lt;Integer&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(Integer result)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;长度: &quot;</span> + result);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;转换失败: &quot;</span> + t.getMessage());<br>    &#125;<br>&#125;, executor);<br><br><span class="hljs-comment">// 3. 组合多个 Future</span><br>ListenableFuture&lt;String&gt; future1 = listeningExecutor.submit(() -&gt; &#123;<br>    Thread.sleep(<span class="hljs-number">500</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello&quot;</span>;<br>&#125;);<br><br>ListenableFuture&lt;String&gt; future2 = listeningExecutor.submit(() -&gt; &#123;<br>    Thread.sleep(<span class="hljs-number">800</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;World&quot;</span>;<br>&#125;);<br><br><span class="hljs-comment">// 等待所有 Future 完成</span><br>ListenableFuture&lt;List&lt;String&gt;&gt; allFutures = Futures.allAsList(future1, future2);<br>Futures.addCallback(allFutures, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureCallback</span>&lt;List&lt;String&gt;&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(List&lt;String&gt; results)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;所有结果: &quot;</span> + results);  <span class="hljs-comment">// [Hello, World]</span><br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;组合失败: &quot;</span> + t.getMessage());<br>    &#125;<br>&#125;, executor);<br><br><span class="hljs-comment">// 成功的 Future（忽略失败的）</span><br>ListenableFuture&lt;List&lt;String&gt;&gt; successfulFutures = <br>    Futures.successfulAsList(future1, future2);<br><br><span class="hljs-comment">// 4. SettableFuture - 手动控制 Future</span><br>SettableFuture&lt;String&gt; settableFuture = SettableFuture.create();<br><br><span class="hljs-comment">// 在另一个线程中设置值</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        settableFuture.set(<span class="hljs-string">&quot;手动设置&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        settableFuture.setException(e);<br>    &#125;<br>&#125;).start();<br><br>Futures.addCallback(settableFuture, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureCallback</span>&lt;String&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(String result)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;SettableFuture 结果: &quot;</span> + result);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;SettableFuture 失败: &quot;</span> + t.getMessage());<br>    &#125;<br>&#125;, executor);<br><br><span class="hljs-comment">// 5. RateLimiter - 令牌桶限流器</span><br><span class="hljs-comment">// 创建限流器：每秒允许 10 个请求</span><br><span class="hljs-type">RateLimiter</span> <span class="hljs-variable">rateLimiter</span> <span class="hljs-operator">=</span> RateLimiter.create(<span class="hljs-number">10.0</span>);<br><br>System.out.println(<span class="hljs-string">&quot;=== RateLimiter 测试 ===&quot;</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) &#123;<br>    <span class="hljs-comment">// 尝试获取令牌（如果可用则立即返回，否则等待）</span><br>    <span class="hljs-type">double</span> <span class="hljs-variable">waitTime</span> <span class="hljs-operator">=</span> rateLimiter.acquire();<br>    System.out.printf(<span class="hljs-string">&quot;请求 %d: 等待 %.3f 秒%n&quot;</span>, i + <span class="hljs-number">1</span>, waitTime);<br>&#125;<br><br><span class="hljs-comment">// 6. tryAcquire - 非阻塞获取</span><br>System.out.println(<span class="hljs-string">&quot;\n=== tryAcquire 测试 ===&quot;</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> rateLimiter.tryAcquire();  <span class="hljs-comment">// 立即尝试获取</span><br>    System.out.printf(<span class="hljs-string">&quot;请求 %d: %s%n&quot;</span>, i + <span class="hljs-number">1</span>, acquired ? <span class="hljs-string">&quot;成功&quot;</span> : <span class="hljs-string">&quot;被限流&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 7. 预热限流器（避免冷启动问题）</span><br><span class="hljs-type">RateLimiter</span> <span class="hljs-variable">warmupRateLimiter</span> <span class="hljs-operator">=</span> RateLimiter.create(<span class="hljs-number">2.0</span>, <span class="hljs-number">5</span>, TimeUnit.SECONDS);<br>System.out.println(<span class="hljs-string">&quot;\n=== 预热限流器 ===&quot;</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>    warmupRateLimiter.acquire();<br>    System.out.println(<span class="hljs-string">&quot;请求 &quot;</span> + (i + <span class="hljs-number">1</span>));<br>&#125;<br><br><span class="hljs-comment">// 8. 直接执行器（用于回调）</span><br><span class="hljs-type">Executor</span> <span class="hljs-variable">directExecutor</span> <span class="hljs-operator">=</span> MoreExecutors.directExecutor();<br>ListenableFuture&lt;String&gt; directFuture = Futures.submit(() -&gt; <span class="hljs-string">&quot;直接执行&quot;</span>, directExecutor);<br><br><span class="hljs-comment">// 9. 获取已完成的 Future</span><br>ListenableFuture&lt;String&gt; immediateFuture = Futures.immediateFuture(<span class="hljs-string">&quot;立即完成&quot;</span>);<br>ListenableFuture&lt;String&gt; failedFuture = Futures.immediateFailedFuture(<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;立即失败&quot;</span>));<br><br><span class="hljs-comment">// 10. 超时处理</span><br>ListenableFuture&lt;String&gt; timeoutFuture = listeningExecutor.submit(() -&gt; &#123;<br>    Thread.sleep(<span class="hljs-number">2000</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;超时测试&quot;</span>;<br>&#125;);<br><br>ListenableFuture&lt;String&gt; withTimeout = Futures.withTimeout(<br>    timeoutFuture, <br>    <span class="hljs-number">1</span>, TimeUnit.SECONDS, <br>    executor<br>);<br><br>Futures.addCallback(withTimeout, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureCallback</span>&lt;String&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(String result)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;超时测试成功: &quot;</span> + result);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;超时测试失败: &quot;</span> + t.getMessage());<br>    &#125;<br>&#125;, executor);<br><br><span class="hljs-comment">// 等待所有任务完成</span><br>Thread.sleep(<span class="hljs-number">3000</span>);<br>listeningExecutor.shutdown();<br>executor.shutdown();<br></code></pre></td></tr></table></figure>
<h3 id="与-java-8-completablefuture-的对比">与 Java 8 CompletableFuture 的对比</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>Guava ListenableFuture</th>
<th>Java 8 CompletableFuture</th>
</tr>
</thead>
<tbody>
<tr>
<td>回调机制</td>
<td><code>addCallback()</code></td>
<td><code>thenApply()</code>, <code>thenAccept()</code></td>
</tr>
<tr>
<td>组合操作</td>
<td><code>allAsList()</code></td>
<td><code>allOf()</code>, <code>anyOf()</code></td>
</tr>
<tr>
<td>异常处理</td>
<td><code>onFailure()</code></td>
<td><code>exceptionally()</code>, <code>handle()</code></td>
</tr>
<tr>
<td>限流器</td>
<td><code>RateLimiter</code></td>
<td>无内置支持</td>
</tr>
<tr>
<td>推荐使用</td>
<td>Java 7 项目</td>
<td>Java 8+ 项目</td>
</tr>
</tbody>
</table>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>Java 8+ 项目</strong>：优先使用 <code>CompletableFuture</code></li>
<li><strong>限流场景</strong>：使用 <code>RateLimiter</code> 实现令牌桶算法</li>
<li><strong>回调链</strong>：使用 <code>Futures.transform()</code> 组合多个异步操作</li>
<li><strong>资源管理</strong>：记得关闭 ExecutorService</li>
</ol>
<hr>
<h1>IO（输入输出）</h1>
<p>Guava IO 提供了简化的 IO 操作工具类，使文件和流处理更加便捷。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>工具类</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ByteStreams</code></td>
<td>字节流工具</td>
</tr>
<tr>
<td><code>CharStreams</code></td>
<td>字符流工具</td>
</tr>
<tr>
<td><code>Files</code></td>
<td>文件操作工具</td>
</tr>
<tr>
<td><code>ByteSource</code>/<code>CharSource</code></td>
<td>字节/字符源</td>
</tr>
<tr>
<td><code>ByteSink</code>/<code>CharSink</code></td>
<td>字节/字符目标</td>
</tr>
<tr>
<td><code>Resources</code></td>
<td>资源读取工具</td>
</tr>
<tr>
<td><code>BaseEncoding</code></td>
<td>Base 编解码</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.io.*;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.nio.charset.Charset;<br><span class="hljs-keyword">import</span> java.nio.file.Paths;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">// 1. ByteStreams - 字节流操作</span><br>System.out.println(<span class="hljs-string">&quot;=== ByteStreams ===&quot;</span>);<br><br><span class="hljs-comment">// 读取流到字节数组</span><br><span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(<span class="hljs-string">&quot;Hello, Guava!&quot;</span>.getBytes());<br><span class="hljs-type">byte</span>[] bytes = ByteStreams.toByteArray(inputStream);<br>System.out.println(<span class="hljs-string">&quot;读取字节: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes));<br><br><span class="hljs-comment">// 复制流</span><br><span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br><span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(<span class="hljs-string">&quot;复制测试&quot;</span>.getBytes());<br>ByteStreams.copy(source, outputStream);<br>System.out.println(<span class="hljs-string">&quot;复制结果: &quot;</span> + outputStream.toString());<br><br><span class="hljs-comment">// 跳过字节</span><br><span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">skipStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(<span class="hljs-string">&quot;1234567890&quot;</span>.getBytes());<br>ByteStreams.skipFully(skipStream, <span class="hljs-number">5</span>);<br>System.out.println(<span class="hljs-string">&quot;跳过 5 字节后: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(ByteStreams.toByteArray(skipStream)));<br><br><span class="hljs-comment">// 2. CharStreams - 字符流操作</span><br>System.out.println(<span class="hljs-string">&quot;\n=== CharStreams ===&quot;</span>);<br><br><span class="hljs-type">StringReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(<span class="hljs-string">&quot;第一行\n第二行\n第三行&quot;</span>);<br>List&lt;String&gt; lines = CharStreams.readLines(reader);<br>System.out.println(<span class="hljs-string">&quot;读取行: &quot;</span> + lines);<br><br><span class="hljs-comment">// 读取全部内容</span><br><span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> CharStreams.toString(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(<span class="hljs-string">&quot;全部内容&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;全部内容: &quot;</span> + content);<br><br><span class="hljs-comment">// 复制字符流</span><br><span class="hljs-type">StringWriter</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>();<br>CharStreams.copy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringReader</span>(<span class="hljs-string">&quot;复制字符&quot;</span>), writer);<br>System.out.println(<span class="hljs-string">&quot;复制字符: &quot;</span> + writer.toString());<br><br><span class="hljs-comment">// 3. Files - 文件操作</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Files ===&quot;</span>);<br><br><span class="hljs-comment">// 写入文件</span><br>java.io.<span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;test.txt&quot;</span>);<br>Files.write(<span class="hljs-string">&quot;Hello, Guava IO!&quot;</span>.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)), file);<br>System.out.println(<span class="hljs-string">&quot;写入文件: &quot;</span> + file.getAbsolutePath());<br><br><span class="hljs-comment">// 读取文件</span><br><span class="hljs-type">String</span> <span class="hljs-variable">fileContent</span> <span class="hljs-operator">=</span> Files.toString(file, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;文件内容: &quot;</span> + fileContent);<br><br><span class="hljs-comment">// 读取文件行</span><br>List&lt;String&gt; fileLines = Files.readLines(file, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>System.out.println(<span class="hljs-string">&quot;文件行: &quot;</span> + fileLines);<br><br><span class="hljs-comment">// 复制文件</span><br>java.io.<span class="hljs-type">File</span> <span class="hljs-variable">destFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;test_copy.txt&quot;</span>);<br>Files.copy(file, destFile);<br>System.out.println(<span class="hljs-string">&quot;复制文件到: &quot;</span> + destFile.getAbsolutePath());<br><br><span class="hljs-comment">// 移动文件</span><br>java.io.<span class="hljs-type">File</span> <span class="hljs-variable">movedFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;test_moved.txt&quot;</span>);<br>Files.move(destFile, movedFile);<br>System.out.println(<span class="hljs-string">&quot;移动文件到: &quot;</span> + movedFile.getAbsolutePath());<br><br><span class="hljs-comment">// 追加内容</span><br>Files.append(<span class="hljs-string">&quot;\n追加的内容&quot;</span>, file, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br><br><span class="hljs-comment">// 4. ByteSource - 字节源</span><br>System.out.println(<span class="hljs-string">&quot;\n=== ByteSource ===&quot;</span>);<br><br><span class="hljs-type">ByteSource</span> <span class="hljs-variable">byteSource</span> <span class="hljs-operator">=</span> ByteSource.wrap(<span class="hljs-string">&quot;ByteSource 测试&quot;</span>.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br><span class="hljs-type">byte</span>[] sourceBytes = byteSource.read();<br>System.out.println(<span class="hljs-string">&quot;ByteSource 读取: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(sourceBytes));<br><br><span class="hljs-comment">// 文件作为 ByteSource</span><br><span class="hljs-type">ByteSource</span> <span class="hljs-variable">fileSource</span> <span class="hljs-operator">=</span> Files.asByteSource(file);<br><span class="hljs-type">long</span> <span class="hljs-variable">fileSize</span> <span class="hljs-operator">=</span> fileSource.size();<br>System.out.println(<span class="hljs-string">&quot;文件大小: &quot;</span> + fileSize + <span class="hljs-string">&quot; 字节&quot;</span>);<br><br><span class="hljs-comment">// 5. CharSource - 字符源</span><br><span class="hljs-type">CharSource</span> <span class="hljs-variable">charSource</span> <span class="hljs-operator">=</span> CharSource.wrap(<span class="hljs-string">&quot;CharSource 测试&quot;</span>);<br><span class="hljs-type">String</span> <span class="hljs-variable">charSourceContent</span> <span class="hljs-operator">=</span> charSource.read();<br>System.out.println(<span class="hljs-string">&quot;CharSource 读取: &quot;</span> + charSourceContent);<br><br><span class="hljs-comment">// 文件作为 CharSource</span><br><span class="hljs-type">CharSource</span> <span class="hljs-variable">fileCharSource</span> <span class="hljs-operator">=</span> Files.asCharSource(file, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br><span class="hljs-type">String</span> <span class="hljs-variable">fileCharContent</span> <span class="hljs-operator">=</span> fileCharSource.readFirstLine();<br>System.out.println(<span class="hljs-string">&quot;文件首行: &quot;</span> + fileCharContent);<br><br><span class="hljs-comment">// 6. ByteSink - 字节目标</span><br>System.out.println(<span class="hljs-string">&quot;\n=== ByteSink ===&quot;</span>);<br><br>java.io.<span class="hljs-type">File</span> <span class="hljs-variable">sinkFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;sink_test.txt&quot;</span>);<br><span class="hljs-type">ByteSink</span> <span class="hljs-variable">byteSink</span> <span class="hljs-operator">=</span> Files.asByteSink(sinkFile);<br>byteSink.write(<span class="hljs-string">&quot;ByteSink 测试&quot;</span>.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br>System.out.println(<span class="hljs-string">&quot;写入 ByteSink: &quot;</span> + sinkFile.getAbsolutePath());<br><br><span class="hljs-comment">// 7. CharSink - 字符目标</span><br>java.io.<span class="hljs-type">File</span> <span class="hljs-variable">charSinkFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;charsink_test.txt&quot;</span>);<br><span class="hljs-type">CharSink</span> <span class="hljs-variable">charSink</span> <span class="hljs-operator">=</span> Files.asCharSink(charSinkFile, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>charSink.write(<span class="hljs-string">&quot;CharSink 测试&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;写入 CharSink: &quot;</span> + charSinkFile.getAbsolutePath());<br><br><span class="hljs-comment">// 8. Resources - 读取 classpath 资源</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Resources ===&quot;</span>);<br><br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">URL</span> <span class="hljs-variable">resourceUrl</span> <span class="hljs-operator">=</span> Resources.getResource(<span class="hljs-string">&quot;application.properties&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">resourceContent</span> <span class="hljs-operator">=</span> Resources.toString(resourceUrl, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>));<br>    System.out.println(<span class="hljs-string">&quot;资源内容长度: &quot;</span> + resourceContent.length());<br>    <br>    <span class="hljs-comment">// 读取为字节数组</span><br>    <span class="hljs-type">byte</span>[] resourceBytes = Resources.toByteArray(resourceUrl);<br>    System.out.println(<span class="hljs-string">&quot;资源字节数: &quot;</span> + resourceBytes.length);<br>    <br>    <span class="hljs-comment">// 复制到文件</span><br>    Resources.copy(resourceUrl, <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;resource_copy.txt&quot;</span>));<br>&#125; <span class="hljs-keyword">catch</span> (IllegalArgumentException e) &#123;<br>    System.out.println(<span class="hljs-string">&quot;资源未找到: &quot;</span> + e.getMessage());<br>&#125;<br><br><span class="hljs-comment">// 9. BaseEncoding - Base 编解码</span><br>System.out.println(<span class="hljs-string">&quot;\n=== BaseEncoding ===&quot;</span>);<br><br><span class="hljs-type">String</span> <span class="hljs-variable">original</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello, Guava!&quot;</span>;<br><br><span class="hljs-comment">// Base64</span><br><span class="hljs-type">String</span> <span class="hljs-variable">base64Encoded</span> <span class="hljs-operator">=</span> BaseEncoding.base64().encode(original.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br>System.out.println(<span class="hljs-string">&quot;Base64 编码: &quot;</span> + base64Encoded);<br><span class="hljs-type">byte</span>[] base64Decoded = BaseEncoding.base64().decode(base64Encoded);<br>System.out.println(<span class="hljs-string">&quot;Base64 解码: &quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(base64Decoded, Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br><br><span class="hljs-comment">// Base32</span><br><span class="hljs-type">String</span> <span class="hljs-variable">base32Encoded</span> <span class="hljs-operator">=</span> BaseEncoding.base32().encode(original.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br>System.out.println(<span class="hljs-string">&quot;Base32 编码: &quot;</span> + base32Encoded);<br><br><span class="hljs-comment">// Base16（十六进制）</span><br><span class="hljs-type">String</span> <span class="hljs-variable">base16Encoded</span> <span class="hljs-operator">=</span> BaseEncoding.base16().encode(original.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br>System.out.println(<span class="hljs-string">&quot;Base16 编码: &quot;</span> + base16Encoded);<br><br><span class="hljs-comment">// 自定义分隔符</span><br><span class="hljs-type">String</span> <span class="hljs-variable">base64WithSeparator</span> <span class="hljs-operator">=</span> BaseEncoding.base64()<br>    .withSeparator(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-number">76</span>)  <span class="hljs-comment">// 每 76 个字符换行</span><br>    .encode(original.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br>System.out.println(<span class="hljs-string">&quot;带分隔符的 Base64:\n&quot;</span> + base64WithSeparator);<br><br><span class="hljs-comment">// 10. 组合使用</span><br>System.out.println(<span class="hljs-string">&quot;\n=== 组合使用 ===&quot;</span>);<br><br><span class="hljs-comment">// 从 ByteSource 复制到 ByteSink</span><br><span class="hljs-type">ByteSource</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> ByteSource.wrap(<span class="hljs-string">&quot;源数据&quot;</span>.getBytes(Charset.forName(<span class="hljs-string">&quot;UTF-8&quot;</span>)));<br><span class="hljs-type">ByteSink</span> <span class="hljs-variable">sink</span> <span class="hljs-operator">=</span> Files.asByteSink(<span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;combination_test.txt&quot;</span>));<br>source.copyTo(sink);<br>System.out.println(<span class="hljs-string">&quot;组合操作完成&quot;</span>);<br><br><span class="hljs-comment">// 清理测试文件</span><br>file.delete();<br>movedFile.delete();<br>sinkFile.delete();<br>charSinkFile.delete();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;resource_copy.txt&quot;</span>).delete();<br><span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.io.File(<span class="hljs-string">&quot;combination_test.txt&quot;</span>).delete();<br></code></pre></td></tr></table></figure>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>简化 IO 操作</strong>：使用 <code>Files</code> 工具类替代复杂的 IO 代码</li>
<li><strong>资源管理</strong>：使用 <code>ByteSource</code> 和 <code>CharSource</code> 封装数据源</li>
<li><strong>编码处理</strong>：始终指定 Charset，避免平台依赖</li>
<li><strong>异常处理</strong>：IO 操作需要处理 IOException</li>
</ol>
<hr>
<h1>Primitives（原始类型工具）</h1>
<p>Guava 为 Java 原始类型提供了专门的工具类，避免自动装箱的性能开销。</p>
<h2 id="核心-api">核心 API</h2>
<table>
<thead>
<tr>
<th>工具类</th>
<th>对应类型</th>
<th>主要方法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Ints</code></td>
<td>int</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Longs</code></td>
<td>long</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Doubles</code></td>
<td>double</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Floats</code></td>
<td>float</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Shorts</code></td>
<td>short</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Bytes</code></td>
<td>byte</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Chars</code></td>
<td>char</td>
<td>asList, toArray, contains, max, min, join</td>
</tr>
<tr>
<td><code>Booleans</code></td>
<td>boolean</td>
<td>asList, toArray, contains, countTrue</td>
</tr>
</tbody>
</table>
<h2 id="代码示例">代码示例</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.google.common.primitives.*;<br><br><span class="hljs-comment">// 1. Ints - int 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;=== Ints ===&quot;</span>);<br><br><span class="hljs-comment">// 数组转 List</span><br><span class="hljs-type">int</span>[] intArray = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>List&lt;Integer&gt; intList = Ints.asList(intArray);<br>System.out.println(<span class="hljs-string">&quot;数组转 List: &quot;</span> + intList);<br><br><span class="hljs-comment">// List 转数组</span><br>List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>);<br><span class="hljs-type">int</span>[] array = Ints.toArray(list);<br>System.out.println(<span class="hljs-string">&quot;List 转数组: &quot;</span> + Arrays.toString(array));<br><br><span class="hljs-comment">// 检查包含</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">contains</span> <span class="hljs-operator">=</span> Ints.contains(intArray, <span class="hljs-number">3</span>);<br>System.out.println(<span class="hljs-string">&quot;包含 3: &quot;</span> + contains);<br><br><span class="hljs-comment">// 查找索引</span><br><span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> Ints.indexOf(intArray, <span class="hljs-number">4</span>);<br>System.out.println(<span class="hljs-string">&quot;4 的索引: &quot;</span> + index);<br><br><span class="hljs-comment">// 最大最小值</span><br><span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> Ints.max(intArray);<br><span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> Ints.min(intArray);<br>System.out.println(<span class="hljs-string">&quot;最大值: &quot;</span> + max + <span class="hljs-string">&quot;, 最小值: &quot;</span> + min);<br><br><span class="hljs-comment">// 连接数组</span><br><span class="hljs-type">int</span>[] array1 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><span class="hljs-type">int</span>[] array2 = &#123;<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>&#125;;<br><span class="hljs-type">int</span>[] concatenated = Ints.concat(array1, array2);<br>System.out.println(<span class="hljs-string">&quot;连接数组: &quot;</span> + Arrays.toString(concatenated));<br><br><span class="hljs-comment">// 字符串连接</span><br><span class="hljs-type">String</span> <span class="hljs-variable">joined</span> <span class="hljs-operator">=</span> Ints.join(<span class="hljs-string">&quot;,&quot;</span>, intArray);<br>System.out.println(<span class="hljs-string">&quot;连接字符串: &quot;</span> + joined);<br><br><span class="hljs-comment">// 比较数组</span><br><span class="hljs-type">int</span>[] array3 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">isEqual</span> <span class="hljs-operator">=</span> Ints.compare(intArray, array3) == <span class="hljs-number">0</span>;<br>System.out.println(<span class="hljs-string">&quot;数组相等: &quot;</span> + isEqual);<br><br><span class="hljs-comment">// 2. Longs - long 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Longs ===&quot;</span>);<br><br><span class="hljs-type">long</span>[] longArray = &#123;<span class="hljs-number">100L</span>, <span class="hljs-number">200L</span>, <span class="hljs-number">300L</span>, <span class="hljs-number">400L</span>, <span class="hljs-number">500L</span>&#125;;<br>List&lt;Long&gt; longList = Longs.asList(longArray);<br>System.out.println(<span class="hljs-string">&quot;Long List: &quot;</span> + longList);<br><br><span class="hljs-type">long</span> <span class="hljs-variable">longMax</span> <span class="hljs-operator">=</span> Longs.max(longArray);<br><span class="hljs-type">long</span> <span class="hljs-variable">longMin</span> <span class="hljs-operator">=</span> Longs.min(longArray);<br>System.out.println(<span class="hljs-string">&quot;Long 最大值: &quot;</span> + longMax + <span class="hljs-string">&quot;, 最小值: &quot;</span> + longMin);<br><br><span class="hljs-comment">// 3. Doubles - double 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Doubles ===&quot;</span>);<br><br><span class="hljs-type">double</span>[] doubleArray = &#123;<span class="hljs-number">1.1</span>, <span class="hljs-number">2.2</span>, <span class="hljs-number">3.3</span>, <span class="hljs-number">4.4</span>, <span class="hljs-number">5.5</span>&#125;;<br>List&lt;Double&gt; doubleList = Doubles.asList(doubleArray);<br>System.out.println(<span class="hljs-string">&quot;Double List: &quot;</span> + doubleList);<br><br><span class="hljs-type">double</span> <span class="hljs-variable">doubleMax</span> <span class="hljs-operator">=</span> Doubles.max(doubleArray);<br><span class="hljs-type">double</span> <span class="hljs-variable">doubleMin</span> <span class="hljs-operator">=</span> Doubles.min(doubleArray);<br>System.out.println(<span class="hljs-string">&quot;Double 最大值: &quot;</span> + doubleMax + <span class="hljs-string">&quot;, 最小值: &quot;</span> + doubleMin);<br><br><span class="hljs-comment">// 4. Chars - char 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Chars ===&quot;</span>);<br><br><span class="hljs-type">char</span>[] charArray = &#123;<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>&#125;;<br>List&lt;Character&gt; charList = Chars.asList(charArray);<br>System.out.println(<span class="hljs-string">&quot;Char List: &quot;</span> + charList);<br><br><span class="hljs-type">char</span> <span class="hljs-variable">charMax</span> <span class="hljs-operator">=</span> Chars.max(charArray);<br><span class="hljs-type">char</span> <span class="hljs-variable">charMin</span> <span class="hljs-operator">=</span> Chars.min(charArray);<br>System.out.println(<span class="hljs-string">&quot;Char 最大值: &quot;</span> + charMax + <span class="hljs-string">&quot;, 最小值: &quot;</span> + charMin);<br><br><span class="hljs-comment">// 检查包含</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">containsChar</span> <span class="hljs-operator">=</span> Chars.contains(charArray, <span class="hljs-string">&#x27;C&#x27;</span>);<br>System.out.println(<span class="hljs-string">&quot;包含 &#x27;C&#x27;: &quot;</span> + containsChar);<br><br><span class="hljs-comment">// 5. Booleans - boolean 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Booleans ===&quot;</span>);<br><br><span class="hljs-type">boolean</span>[] boolArray = &#123;<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>&#125;;<br>List&lt;Boolean&gt; boolList = Booleans.asList(boolArray);<br>System.out.println(<span class="hljs-string">&quot;Boolean List: &quot;</span> + boolList);<br><br><span class="hljs-comment">// 统计 true 的数量</span><br><span class="hljs-type">int</span> <span class="hljs-variable">trueCount</span> <span class="hljs-operator">=</span> Booleans.countTrue(boolArray);<br><span class="hljs-type">int</span> <span class="hljs-variable">falseCount</span> <span class="hljs-operator">=</span> Booleans.countFalse(boolArray);<br>System.out.println(<span class="hljs-string">&quot;True 数量: &quot;</span> + trueCount + <span class="hljs-string">&quot;, False 数量: &quot;</span> + falseCount);<br><br><span class="hljs-comment">// 6. Bytes - byte 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Bytes ===&quot;</span>);<br><br><span class="hljs-type">byte</span>[] byteArray = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>List&lt;Byte&gt; byteList = Bytes.asList(byteArray);<br>System.out.println(<span class="hljs-string">&quot;Byte List: &quot;</span> + byteList);<br><br><span class="hljs-type">byte</span> <span class="hljs-variable">byteMax</span> <span class="hljs-operator">=</span> Bytes.max(byteArray);<br><span class="hljs-type">byte</span> <span class="hljs-variable">byteMin</span> <span class="hljs-operator">=</span> Bytes.min(byteArray);<br>System.out.println(<span class="hljs-string">&quot;Byte 最大值: &quot;</span> + byteMax + <span class="hljs-string">&quot;, 最小值: &quot;</span> + byteMin);<br><br><span class="hljs-comment">// 7. Shorts - short 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Shorts ===&quot;</span>);<br><br><span class="hljs-type">short</span>[] shortArray = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>&#125;;<br>List&lt;Short&gt; shortList = Shorts.asList(shortArray);<br>System.out.println(<span class="hljs-string">&quot;Short List: &quot;</span> + shortList);<br><br><span class="hljs-type">short</span> <span class="hljs-variable">shortMax</span> <span class="hljs-operator">=</span> Shorts.max(shortArray);<br><span class="hljs-type">short</span> <span class="hljs-variable">shortMin</span> <span class="hljs-operator">=</span> Shorts.min(shortArray);<br>System.out.println(<span class="hljs-string">&quot;Short 最大值: &quot;</span> + shortMax + <span class="hljs-string">&quot;, 最小值: &quot;</span> + shortMin);<br><br><span class="hljs-comment">// 8. Floats - float 类型工具</span><br>System.out.println(<span class="hljs-string">&quot;\n=== Floats ===&quot;</span>);<br><br><span class="hljs-type">float</span>[] floatArray = &#123;<span class="hljs-number">1.1f</span>, <span class="hljs-number">2.2f</span>, <span class="hljs-number">3.3f</span>, <span class="hljs-number">4.4f</span>, <span class="hljs-number">5.5f</span>&#125;;<br>List&lt;Float&gt; floatList = Floats.asList(floatArray);<br>System.out.println(<span class="hljs-string">&quot;Float List: &quot;</span> + floatList);<br><br><span class="hljs-type">float</span> <span class="hljs-variable">floatMax</span> <span class="hljs-operator">=</span> Floats.max(floatArray);<br><span class="hljs-type">float</span> <span class="hljs-variable">floatMin</span> <span class="hljs-operator">=</span> Floats.min(floatArray);<br>System.out.println(<span class="hljs-string">&quot;Float 最大值: &quot;</span> + floatMax + <span class="hljs-string">&quot;, 最小值: &quot;</span> + floatMin);<br><br><span class="hljs-comment">// 9. 性能对比</span><br>System.out.println(<span class="hljs-string">&quot;\n=== 性能对比 ===&quot;</span>);<br><br><span class="hljs-comment">// 使用原始类型数组</span><br><span class="hljs-type">int</span>[] primitiveArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1000000</span>];<br><span class="hljs-type">long</span> <span class="hljs-variable">start1</span> <span class="hljs-operator">=</span> System.nanoTime();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; primitiveArray.length; i++) &#123;<br>    primitiveArray[i] = i;<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-variable">sum1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : primitiveArray) &#123;<br>    sum1 += value;<br>&#125;<br><span class="hljs-type">long</span> <span class="hljs-variable">end1</span> <span class="hljs-operator">=</span> System.nanoTime();<br>System.out.println(<span class="hljs-string">&quot;原始类型数组耗时: &quot;</span> + (end1 - start1) / <span class="hljs-number">1_000_000</span> + <span class="hljs-string">&quot; ms&quot;</span>);<br><br><span class="hljs-comment">// 使用包装类型 List</span><br>List&lt;Integer&gt; wrapperList = Lists.newArrayListWithCapacity(<span class="hljs-number">1000000</span>);<br><span class="hljs-type">long</span> <span class="hljs-variable">start2</span> <span class="hljs-operator">=</span> System.nanoTime();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) &#123;<br>    wrapperList.add(i);<br>&#125;<br><span class="hljs-type">int</span> <span class="hljs-variable">sum2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (Integer value : wrapperList) &#123;<br>    sum2 += value;<br>&#125;<br><span class="hljs-type">long</span> <span class="hljs-variable">end2</span> <span class="hljs-operator">=</span> System.nanoTime();<br>System.out.println(<span class="hljs-string">&quot;包装类型 List 耗时: &quot;</span> + (end2 - start2) / <span class="hljs-number">1_000_000</span> + <span class="hljs-string">&quot; ms&quot;</span>);<br><br><span class="hljs-comment">// 10. 实际应用场景</span><br>System.out.println(<span class="hljs-string">&quot;\n=== 实际应用 ===&quot;</span>);<br><br><span class="hljs-comment">// 计算统计值</span><br><span class="hljs-type">int</span>[] scores = &#123;<span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>, <span class="hljs-number">90</span>, <span class="hljs-number">88</span>, <span class="hljs-number">95</span>, <span class="hljs-number">82</span>, <span class="hljs-number">87</span>&#125;;<br><span class="hljs-type">int</span> <span class="hljs-variable">maxScore</span> <span class="hljs-operator">=</span> Ints.max(scores);<br><span class="hljs-type">int</span> <span class="hljs-variable">minScore</span> <span class="hljs-operator">=</span> Ints.min(scores);<br>System.out.println(<span class="hljs-string">&quot;最高分: &quot;</span> + maxScore + <span class="hljs-string">&quot;, 最低分: &quot;</span> + minScore);<br><br><span class="hljs-comment">// 检查值是否在范围内</span><br><span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br><span class="hljs-type">int</span>[] range = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>, <span class="hljs-number">60</span>&#125;;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">inRange</span> <span class="hljs-operator">=</span> Ints.contains(range, value);<br>System.out.println(<span class="hljs-string">&quot;值 &quot;</span> + value + <span class="hljs-string">&quot; 在范围内: &quot;</span> + inRange);<br><br><span class="hljs-comment">// 数组排序和二分查找</span><br><span class="hljs-type">int</span>[] sortedArray = &#123;<span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">12</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">38</span>, <span class="hljs-number">56</span>, <span class="hljs-number">72</span>, <span class="hljs-number">91</span>&#125;;<br><span class="hljs-type">int</span> <span class="hljs-variable">searchValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">23</span>;<br><span class="hljs-type">int</span> <span class="hljs-variable">foundIndex</span> <span class="hljs-operator">=</span> Ints.indexOf(sortedArray, searchValue);<br>System.out.println(<span class="hljs-string">&quot;值 &quot;</span> + searchValue + <span class="hljs-string">&quot; 的索引: &quot;</span> + foundIndex);<br></code></pre></td></tr></table></figure>
<h2 id="与自动装箱的性能对比">与自动装箱的性能对比</h2>
<table>
<thead>
<tr>
<th>操作</th>
<th>原始类型数组</th>
<th>包装类型 List</th>
<th>性能差异</th>
</tr>
</thead>
<tbody>
<tr>
<td>存储</td>
<td>直接存储</td>
<td>对象包装</td>
<td>数倍差异</td>
</tr>
<tr>
<td>计算</td>
<td>直接计算</td>
<td>拆箱计算</td>
<td>数倍差异</td>
</tr>
<tr>
<td>内存</td>
<td>连续内存</td>
<td>对象引用</td>
<td>数倍差异</td>
</tr>
<tr>
<td>缓存</td>
<td>缓存友好</td>
<td>缓存不友好</td>
<td>显著差异</td>
</tr>
</tbody>
</table>
<h2 id="使用建议">使用建议</h2>
<ol>
<li><strong>优先使用原始类型</strong>：在性能敏感的场景使用原始类型数组</li>
<li><strong>避免频繁装箱</strong>：使用 <code>Ints</code> 等工具类减少装箱拆箱</li>
<li><strong>大数据量</strong>：对于大数据量，原始类型数组性能优势明显</li>
<li><strong>API 简化</strong>：使用工具类方法简化常见操作</li>
</ol>
<hr>
<h2 id="总结">总结</h2>
<p>Guava 是一个功能强大的 Java 工具库，为开发者提供了丰富的实用工具：</p>
<h3 id="collections-集合扩展">Collections（集合扩展）</h3>
<ol>
<li><strong>不可变集合</strong>提供了线程安全和防御性编程的最佳实践</li>
<li><strong>新集合类型</strong>（Multiset、Multimap、BiMap、Table、RangeSet、RangeMap 等）解决了特定的业务需求</li>
<li><strong>工具类</strong>（Lists、Sets、Maps、Iterables）简化了常见操作</li>
<li>与 <strong>Java 8 Stream API</strong> 互补使用，可以发挥更大的威力</li>
</ol>
<h3 id="cache-缓存">Cache（缓存）</h3>
<ol start="5">
<li><strong>高性能本地缓存</strong>，基于 ConcurrentHashMap 增强</li>
<li>支持自动加载、手动加载、过期策略、驱逐监听</li>
<li>提供 <code>RateLimiter</code> 令牌桶限流器</li>
<li>新项目建议迁移到 Caffeine</li>
</ol>
<h3 id="strings-字符串处理">Strings（字符串处理）</h3>
<ol start="9">
<li><strong>Strings</strong> 工具类简化空值处理和字符串操作</li>
<li><strong>Joiner</strong> 和 <strong>Splitter</strong> 提供灵活的字符串连接和拆分</li>
<li><strong>CharMatcher</strong> 强大的字符匹配和处理</li>
<li><strong>CaseFormat</strong> 支持多种命名风格转换</li>
</ol>
<h3 id="preconditions-前置条件检查">Preconditions（前置条件检查）</h3>
<ol start="13">
<li>提供简洁的前置条件验证方法</li>
<li>比 Java assert 更可靠，比手动检查更简洁</li>
<li>是防御性编程的重要工具</li>
</ol>
<h3 id="optional-可选值">Optional（可选值）</h3>
<ol start="16">
<li>明确表示可能为 null 的值，避免 NPE</li>
<li>提供 <code>transform()</code> 等链式操作</li>
<li>Java 8+ 项目建议使用 <code>java.util.Optional</code></li>
</ol>
<h3 id="ordering-排序器">Ordering（排序器）</h3>
<ol start="19">
<li>提供丰富的链式排序 API</li>
<li>支持复合排序、null 处理、基于函数排序</li>
<li>Java 8+ 项目建议使用 Stream API 和 Comparator</li>
</ol>
<h3 id="eventbus-事件总线">EventBus（事件总线）</h3>
<ol start="22">
<li>实现发布-订阅模式，组件间松耦合通信</li>
<li>支持同步和异步事件处理</li>
<li>适合轻量级项目，复杂场景建议使用 Spring Event</li>
</ol>
<h3 id="hashing-哈希">Hashing（哈希）</h3>
<ol start="25">
<li>提供多种哈希算法（MD5、SHA256、Murmur3 等）</li>
<li><strong>BloomFilter</strong> 布隆过滤器用于高效去重</li>
<li><strong>consistentHash</strong> 一致性哈希用于分布式系统</li>
</ol>
<h3 id="concurrency-并发工具">Concurrency（并发工具）</h3>
<ol start="28">
<li><strong>ListenableFuture</strong> 增强异步编程能力</li>
<li><strong>Futures</strong> 工具类简化 Future 组合操作</li>
<li><strong>RateLimiter</strong> 令牌桶限流器</li>
<li>Java 8+ 项目建议使用 CompletableFuture</li>
</ol>
<h3 id="io-输入输出">IO（输入输出）</h3>
<ol start="32">
<li><strong>ByteStreams</strong> 和 <strong>CharStreams</strong> 简化流操作</li>
<li><strong>Files</strong> 工具类提供便捷的文件操作</li>
<li><strong>ByteSource/CharSource</strong> 和 <strong>ByteSink/CharSink</strong> 封装数据源和目标</li>
<li><strong>BaseEncoding</strong> 支持多种 Base 编解码</li>
</ol>
<h3 id="primitives-原始类型工具">Primitives（原始类型工具）</h3>
<ol start="36">
<li>为所有原始类型提供专门的工具类</li>
<li>避免自动装箱的性能开销</li>
<li>性能敏感场景的首选</li>
</ol>
<h2 id="使用建议">使用建议</h2>
<p>在实际项目中，合理使用 Guava 可以显著提高代码质量和开发效率：</p>
<ul>
<li>
<p><strong>Java 7 项目</strong>：全面使用 Guava 的各种功能</p>
</li>
<li>
<p><strong>Java 8+ 项目</strong>：</p>
<ul>
<li>集合操作：优先使用 Stream API，特殊集合类型使用 Guava</li>
<li>Optional：使用 <code>java.util.Optional</code></li>
<li>异步编程：使用 <code>CompletableFuture</code></li>
<li>排序：使用 Comparator</li>
<li>缓存：使用 Caffeine</li>
<li>其他工具类：继续使用 Guava</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong>：使用 Primitives 工具类避免装箱拆箱</p>
</li>
<li>
<p><strong>防御性编程</strong>：使用 Preconditions 和 Optional</p>
</li>
<li>
<p><strong>简化代码</strong>：使用 Strings、Joiner、Splitter 等工具类</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://magicliang.github.io">magicliang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/">https://magicliang.github.io/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Guava/">Guava</a></div><div class="post-share"><div class="social-share" data-image="/2026/02/07/Guava-%E8%A7%A3%E6%9E%90/Guava.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2017/10/23/%E6%98%82%E8%B4%B5%E7%9A%84%E5%BC%82%E5%B8%B8/" title="昂贵的异常"><img class="cover" src="/img/wall-paper-75.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-23</div><div class="info-item-2">昂贵的异常</div></div><div class="info-2"><div class="info-item-1">抛出问题 Joshua Bloch 在《Effective Java》的 Item 57 里明确地提到过，不要试图用 Exception 的跳转来代替正常的程序控制流。他列举了很多原因，但特别提到了抛出异常会使得整个程序运行变慢。抛出异常远比普通的 return、break 等操作对控制流、数据流的性能影响要大，它就只适合拿来作异常分支的控制语句，而不能拿来编写正常的逻辑。  Throwing exception is expensive.  这句话在 Java 的程序员世界里面已经成为老生常谈，却很少有人谈及到底抛出异常比正常的程序跳转返回慢在哪里，有多慢。&quot;不要滥用异常&quot;好像一个猴子定律，人们知道不能这么做，却不明白为什么不能这么做。 此前读了一位同事写的好文《Java虚拟机是如何处理异常的》，深入地分析了 JVM 对异常跳转的处理过程：JVM 会通过异常表的机制，优化异常抛出和正常返回之间的性能差异。仅从程序计数器的移动上来讲，抛出一个异常对栈帧的弹栈并不比直接返回更昂贵。写在前头的结论是：&quot;try-catch 语句块几乎不会影响程序运行性能！...</div></div></div></a><a class="pagination-related" href="/2017/11/30/Java%E4%B8%AD%E7%9A%84%E5%B9%BD%E7%81%B5%E7%B1%BB%E5%9E%8B/" title="Java中的幽灵类型"><img class="cover" src="/img/wall-paper-48.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-11-30</div><div class="info-item-2">Java中的幽灵类型</div></div><div class="info-2"><div class="info-item-1">什么是幽灵类型 先上结论：幽灵类型（Phantom Type）顾名思义，就是幽灵般的类型，这种类型往往在运行时可以消失，因为在运行时没有任何作用，它们最大的特点就是没有任何实例（Java 的 Void 就是一个不可实例化类型的例子，常被用作幽灵类型的类型参数，如 Future&lt;Void&gt;）。幽灵类型是一种可以把有些运行时才能检测到的错误，在编译时检测出来的技巧。按照有些老外的观点，就是&quot;Making Wrong Code Look Wrong&quot;。在面向对象的编程语言之中，幽灵类型的实现，往往与状态模式较为接近，但比状态模式提供了更强的纠错功能。在 Java 5 以后的版本里，程序员可以使用泛型。通过泛型的类型参数，Java 中也拥有了幽灵类型的能力。 上面的阐述是不是很难看懂？直接进入具体的例子。假设有一个飞机控制程序，操作飞机起飞或者落地。这个程序有一个非常强的业务约束，就是必须保证飞机一开始必须出现在地上，只有在地上的飞机可以起飞，只有起飞的飞机可以落地，那么应该怎样设计程序（主要是类型关系），来保证这个约束必然成立呢？ 定义状态接口 先来定义...</div></div></div></a><a class="pagination-related" href="/2018/05/29/JPA-%E7%9A%84-id-%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/" title="JPA 的 id 生成策略"><img class="cover" src="/img/wall-paper-75.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-05-29</div><div class="info-item-2">JPA 的 id 生成策略</div></div><div class="info-2"><div class="info-item-1">JPA 有一个@GeneratedValue注解，有一个strategy attribute，如 @GeneratedValue(strategy = GenerationType.IDENTITY)。 常见的可选策略主要有IDENTITY和SEQUENCE。 GenerationType.IDENTITY 要求底层有一个 integer 或者 bigint 类型的自增列（ auto-incremented column)。自增列的赋值必须在插入操作之后发生，因为这个原因，Hibernate 无法进行各种优化（特别是 JDBC 的 batch 处理，一次 flush 操作会产生很多条insert 语句，分别执行）。如果事务回滚，自增列的值就会被丢弃。数据库在这个自增操作上有个高度优化的轻量级锁机制，性能非常棒。 MySQL 支持这种 id 生成策略， 使用 MySQL 应该尽量使用这个策略，即使它无法优化。 JPA 用它生成 id，会一条一条地插入新的 entity。 GenerationType.SEQUENCE 数据库有一个所谓的 sequence 对象，可以通过 selec...</div></div></div></a><a class="pagination-related" href="/2018/06/19/%E5%A6%82%E4%BD%95%E5%81%9A%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8B%E7%9A%84%E7%AD%94%E6%A1%88/" title="如何做性能测试的问题下的答案"><img class="cover" src="/img/wall-paper-66.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-19</div><div class="info-item-2">如何做性能测试的问题下的答案</div></div><div class="info-2"><div class="info-item-1">试着回答一下这个问题。 首先要划分系统类型：有状态还是无状态，业务系统还是存储系统。根据不同的业务场景，设立性能测试的目标：是要测 QPS，还是 TPS 还是 TPS，还是任何其他【性能】-从广义来讲，一个存储系统到底能够以多高的平均时延来管理大多的存储空间，可能也是性能的一种。 有了性能测试的目标，接下来就是拆解用例。如果把性能测试归为测试的话，测试就需要测试用例，测试用例只是用例的形式化表达。把用户的使用场景勾勒出来，把每一步拆解成的流程图或者时序图–我们已经得到了一个纸上的集成测试计划，只是没有跟性能挂上钩。 接下来就进入真正写测试用例的环节了。 我们的测试报告如果要涵盖足够立体的信息，则既要了解每一个环节/接口/API 的性能指标，又要了解整体的性能指标。 这个时候测试工具的覆盖面就很重要了。如果我们选择偏黑盒的测试工具，apache ab /JMeter，则我们的测试用例就要围绕着对外交互的 API写，也只能测到外围接口的性能。这样的测试用例写起来最简单，无需侵入任何内部代码中。 如果我们使用了 JMH 一类的工具，则可以自由编写对任何方法的测试用例。但需要对系统有非常...</div></div></div></a><a class="pagination-related" href="/2018/09/07/%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4/" title="日期与时间"><img class="cover" src="/img/wall-paper-82.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-09-07</div><div class="info-item-2">日期与时间</div></div><div class="info-2"><div class="info-item-1">JSR 310 Java Date与Time API 新旧 API 的更迭 旧的 Java API 主要包括java.util.Date和java.util.Calendar 两个包的内容。这两个包的时间类型是可变的。如 Date 的实例可以通过 setYear 来产生变化。 JSR 310 中包括的日期类型主要有：  计算机时间：Instant，对应 java.util.Date，它代表了一个确定的时间点，即相对于标准Java纪元（1970年1月1日）的偏移量；但与java.util.Date类不同的是其精确到了纳秒级别。 人类时间：对应于人类自身的观念，比如LocalDate和LocalTime。他们代表了一般的时区概念，要么是日期（不包含时间），要么是时间（不包含日期），类似于java.sql的表示方式。此外，还有一个MonthDay，它可以存储某人的生日（不包含年份）。每个类都在内部存储正确的数据而不是像java.util.Date那样利用午夜12点来区分日期，利用1970-01-01来表示时间。这些类型的实例是 immutable 的，而且只能通过工厂方法创建。  时区...</div></div></div></a><a class="pagination-related" href="/2018/10/13/%E5%8D%A1%E8%A1%A8%E5%92%8C-RSet/" title="卡表和 RSet"><img class="cover" src="/img/wall-paper-101.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-13</div><div class="info-item-2">卡表和 RSet</div></div><div class="info-2"><div class="info-item-1">卡表和 RSet 问题定义：为什么需要跨区域引用记录 JVM 垃圾收集器的核心工作之一是确定 live set——哪些对象仍然存活、不可回收。确定 live set 的标准做法是从 GC Roots（栈帧中的局部变量、静态字段等）出发，沿引用链遍历所有可达对象。 问题在于：当堆被划分为多个区域（代、Region）并且只回收其中一部分时，如何高效地找到从&quot;不回收区域&quot;指向&quot;回收区域&quot;的引用？ 以 Young GC 为例：只回收新生代，但老年代中可能持有指向新生代对象的引用。如果不处理这些跨代引用，就会错误地回收仍被老年代引用的新生代对象。最朴素的做法是扫描整个老年代来找出这些引用——但老年代通常远大于新生代，这样做的代价过高，违背了分代收集&quot;只回收一部分堆&quot;的初衷。 卡表（Card Table）和 RSet（Remembered Set）正是为解决这个问题而设计的辅助数据结构。二者的关系并非互相替代，而是层次不同、协作互补：卡表是底层的脏标记机制，RSet 是建立在卡表之上的更高层索引结构。 核心概念速览 在深入细节之前，...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">common</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#collect"><span class="toc-number">2.1.</span> <span class="toc-text">Collect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E5%8F%98%E9%9B%86%E5%90%88"><span class="toc-number">2.2.</span> <span class="toc-text">不可变集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multiset"><span class="toc-number">2.3.</span> <span class="toc-text">Multiset</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multimap"><span class="toc-number">2.4.</span> <span class="toc-text">Multimap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bimap-%E5%8F%8C%E5%90%91%E6%98%A0%E5%B0%84"><span class="toc-number">2.5.</span> <span class="toc-text">BiMap（双向映射）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#table-%E8%A1%A8%E6%A0%BC"><span class="toc-number">2.6.</span> <span class="toc-text">Table（表格）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rangeset-%E5%8C%BA%E9%97%B4%E9%9B%86%E5%90%88"><span class="toc-number">2.7.</span> <span class="toc-text">RangeSet（区间集合）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rangemap-%E5%8C%BA%E9%97%B4%E6%98%A0%E5%B0%84"><span class="toc-number">2.8.</span> <span class="toc-text">RangeMap（区间映射）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">2.9.</span> <span class="toc-text">集合工具类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lists-sets-maps-%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="toc-number">2.10.</span> <span class="toc-text">Lists、Sets、Maps 工厂方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iterables-%E5%92%8C-iterators"><span class="toc-number">2.11.</span> <span class="toc-text">Iterables 和 Iterators</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#collections2-filter-%E5%92%8C-transform"><span class="toc-number">2.12.</span> <span class="toc-text">Collections2.filter() 和 transform()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E-java-8-stream-api-%E7%9A%84%E5%AF%B9%E6%AF%94%E5%92%8C%E4%BA%92%E8%A1%A5"><span class="toc-number">2.13.</span> <span class="toc-text">与 Java 8 Stream API 的对比和互补</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8C%BA%E5%88%AB"><span class="toc-number">2.13.1.</span> <span class="toc-text">主要区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%92%E8%A1%A5%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.13.2.</span> <span class="toc-text">互补使用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.13.3.</span> <span class="toc-text">选择建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.14.</span> <span class="toc-text">实际使用建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%8F%AF%E5%8F%98%E9%9B%86%E5%90%88"><span class="toc-number">2.14.1.</span> <span class="toc-text">1. 优先使用不可变集合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%90%88%E7%90%86%E9%80%89%E6%8B%A9%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.14.2.</span> <span class="toc-text">2. 合理选择集合类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E7%AE%80%E5%8C%96%E4%BB%A3%E7%A0%81"><span class="toc-number">2.14.3.</span> <span class="toc-text">3. 使用工厂方法简化代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B3%A8%E6%84%8F%E7%A9%BA%E5%80%BC%E5%A4%84%E7%90%86"><span class="toc-number">2.14.4.</span> <span class="toc-text">4. 注意空值处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%80%A7%E8%83%BD%E8%80%83%E8%99%91"><span class="toc-number">2.14.5.</span> <span class="toc-text">5. 性能考虑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E9%98%B2%E5%BE%A1%E6%80%A7%E7%BC%96%E7%A8%8B"><span class="toc-number">2.14.6.</span> <span class="toc-text">6. 防御性编程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Guava Cache（缓存）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">核心设计理念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">3.2.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.3.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E-caffeine-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">3.4.</span> <span class="toc-text">与 Caffeine 的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">3.5.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">Strings（字符串处理）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">4.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">4.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">Preconditions（前置条件检查）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">5.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.2.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">5.3.</span> <span class="toc-text">与其他方法的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">5.4.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">Optional（可选值）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">6.1.</span> <span class="toc-text">核心 API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#guava-optional-vs-java-8-optional"><span class="toc-number">6.1.1.</span> <span class="toc-text">Guava Optional vs Java 8 Optional</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.2.</span> <span class="toc-text">代码示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%E5%BB%BA%E8%AE%AE"><span class="toc-number">6.2.1.</span> <span class="toc-text">迁移建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">6.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">Ordering（排序器）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">7.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">7.2.</span> <span class="toc-text">代码示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-java-8-comparator-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">7.2.1.</span> <span class="toc-text">与 Java 8 Comparator 的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">7.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">EventBus（事件总线）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">8.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">8.2.</span> <span class="toc-text">代码示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-spring-event-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">8.2.1.</span> <span class="toc-text">与 Spring Event 的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">8.2.2.</span> <span class="toc-text">适用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">8.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">Hashing（哈希）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">9.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">9.2.</span> <span class="toc-text">代码示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E9%80%89%E6%8B%A9"><span class="toc-number">9.2.1.</span> <span class="toc-text">哈希算法选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">9.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">Concurrency（并发工具）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">10.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">10.2.</span> <span class="toc-text">代码示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-java-8-completablefuture-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">10.2.1.</span> <span class="toc-text">与 Java 8 CompletableFuture 的对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">10.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">IO（输入输出）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">11.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">11.2.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">11.3.</span> <span class="toc-text">使用建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">12.</span> <span class="toc-text">Primitives（原始类型工具）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83-api"><span class="toc-number">12.1.</span> <span class="toc-text">核心 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span class="toc-number">12.2.</span> <span class="toc-text">代码示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E8%87%AA%E5%8A%A8%E8%A3%85%E7%AE%B1%E7%9A%84%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-number">12.3.</span> <span class="toc-text">与自动装箱的性能对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">12.4.</span> <span class="toc-text">使用建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">12.5.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#collections-%E9%9B%86%E5%90%88%E6%89%A9%E5%B1%95"><span class="toc-number">12.5.1.</span> <span class="toc-text">Collections（集合扩展）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cache-%E7%BC%93%E5%AD%98"><span class="toc-number">12.5.2.</span> <span class="toc-text">Cache（缓存）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strings-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86"><span class="toc-number">12.5.3.</span> <span class="toc-text">Strings（字符串处理）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preconditions-%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%E6%A3%80%E6%9F%A5"><span class="toc-number">12.5.4.</span> <span class="toc-text">Preconditions（前置条件检查）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#optional-%E5%8F%AF%E9%80%89%E5%80%BC"><span class="toc-number">12.5.5.</span> <span class="toc-text">Optional（可选值）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ordering-%E6%8E%92%E5%BA%8F%E5%99%A8"><span class="toc-number">12.5.6.</span> <span class="toc-text">Ordering（排序器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eventbus-%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF"><span class="toc-number">12.5.7.</span> <span class="toc-text">EventBus（事件总线）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashing-%E5%93%88%E5%B8%8C"><span class="toc-number">12.5.8.</span> <span class="toc-text">Hashing（哈希）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#concurrency-%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="toc-number">12.5.9.</span> <span class="toc-text">Concurrency（并发工具）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#io-%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="toc-number">12.5.10.</span> <span class="toc-text">IO（输入输出）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#primitives-%E5%8E%9F%E5%A7%8B%E7%B1%BB%E5%9E%8B%E5%B7%A5%E5%85%B7"><span class="toc-number">12.5.11.</span> <span class="toc-text">Primitives（原始类型工具）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="toc-number">12.6.</span> <span class="toc-text">使用建议</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">簡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>