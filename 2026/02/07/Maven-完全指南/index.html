<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Maven 完全指南 | 守株阁</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文整合了 Maven 构建生命周期、插件配置、依赖管理、全局配置 settings.xml、FatJar 打包、测试与覆盖率等全部知识点，是一份系统性的 Maven 参考指南。  maven-生命周期.xmind 构建生命周期 构建生命周期的基础知识 Maven 基于一个&quot;构建生命周期&quot;的中心概念，也就意味着构建和发布一个特定的工件（也就是工程）的过程已经被清晰地定义了。 有">
<meta property="og:type" content="article">
<meta property="og:title" content="Maven 完全指南">
<meta property="og:url" content="https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="守株阁">
<meta property="og:description" content="本文整合了 Maven 构建生命周期、插件配置、依赖管理、全局配置 settings.xml、FatJar 打包、测试与覆盖率等全部知识点，是一份系统性的 Maven 参考指南。  maven-生命周期.xmind 构建生命周期 构建生命周期的基础知识 Maven 基于一个&quot;构建生命周期&quot;的中心概念，也就意味着构建和发布一个特定的工件（也就是工程）的过程已经被清晰地定义了。 有">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/maven-on-macos.gif">
<meta property="article:published_time" content="2026-02-07T12:17:00.000Z">
<meta property="article:modified_time" content="2026-02-07T12:46:50.484Z">
<meta property="article:author" content="magicliang">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Maven">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/maven-on-macos.gif"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Maven 完全指南",
  "url": "https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/",
  "image": "https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/maven-on-macos.gif",
  "datePublished": "2026-02-07T12:17:00.000Z",
  "dateModified": "2026-02-07T12:46:50.484Z",
  "author": [
    {
      "@type": "Person",
      "name": "magicliang",
      "url": "https://magicliang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: 守株阁","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Maven 完全指南',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="守株阁" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/maven-on-macos.gif);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">守株阁</span></a><a class="nav-page-title" href="/"><span class="site-name">Maven 完全指南</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">Maven 完全指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-02-07T12:17:00.000Z" title="Created 2026-02-07 20:17:00">2026-02-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-07T12:46:50.484Z" title="Updated 2026-02-07 20:46:50">2026-02-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">18.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>79mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>本文整合了 Maven 构建生命周期、插件配置、依赖管理、全局配置 settings.xml、FatJar 打包、测试与覆盖率等全部知识点，是一份系统性的 Maven 参考指南。</p>
<p><img src="maven-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.png" alt="maven-生命周期.png"><br>
<a href="maven-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.xmind">maven-生命周期.xmind</a></p>
<h1>构建生命周期</h1>
<h2 id="构建生命周期的基础知识">构建生命周期的基础知识</h2>
<p>Maven 基于一个&quot;构建生命周期&quot;的中心概念，也就意味着构建和发布一个特定的工件（也就是工程）的过程已经被清晰地定义了。</p>
<p>有三种内置的生命周期：default，clean 和 site。default 生命周期处理项目部署，clean 生命周期处理项目清理，site 生命周期处理项目的站点（site）文档的创建。</p>
<pre><code class="hljs mermaid">graph TD
    subgraph Clean生命周期
        A1[pre-clean] --&gt; A2[clean]
        A2 --&gt; A3[post-clean]
    end
    
    subgraph Default生命周期
        B1[validate] --&gt; B2[initialize]
        B2 --&gt; B3[generate-sources]
        B3 --&gt; B4[process-sources]
        B4 --&gt; B5[generate-resources]
        B5 --&gt; B6[process-resources]
        B6 --&gt; B7[compile]
        B7 --&gt; B8[process-classes]
        B8 --&gt; B9[generate-test-sources]
        B9 --&gt; B10[process-test-sources]
        B10 --&gt; B11[generate-test-resources]
        B11 --&gt; B12[process-test-resources]
        B12 --&gt; B13[test-compile]
        B13 --&gt; B14[process-test-classes]
        B14 --&gt; B15[test]
        B15 --&gt; B16[prepare-package]
        B16 --&gt; B17[package]
        B17 --&gt; B18[pre-integration-test]
        B18 --&gt; B19[integration-test]
        B19 --&gt; B20[post-integration-test]
        B20 --&gt; B21[verify]
        B21 --&gt; B22[install]
        B22 --&gt; B23[deploy]
    end
    
    subgraph Site生命周期
        C1[pre-site] --&gt; C2[site]
        C2 --&gt; C3[post-site]
        C3 --&gt; C4[site-deploy]
    end</code></pre>
<p>实际上这些 lifecycle 只是在（比如 idea 里）对 phase 归类的时候特别有用，我们平时使用 mvn 命令的时候是无法指定这几个生命周期的。</p>
<h3 id="一个构建生命周期是由多个阶段组成的">一个构建生命周期是由多个阶段组成的</h3>
<p>上面每个生命周期是由不同的 phase 列表组成的。一个 phase 表示生命周期中的一个执行阶段或步骤。</p>
<p>default 里 phases 的顺序是 <code>validate</code> -&gt; <code>compile</code> -&gt; <code>test</code> -&gt; <code>package</code> -&gt; <code>verify</code> -&gt; <code>install</code> -&gt; <code>deploy</code>。</p>
<h3 id="使用命令行">使用命令行</h3>
<p>如果我们使用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn install<br></code></pre></td></tr></table></figure>
<p>实际上到 install 为止所有的 phases 都会执行，所以我们通常只要指定执行某一个生命周期的最后一个 phase 就行了。</p>
<p>如果我们使用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean deploy<br></code></pre></td></tr></table></figure>
<p>maven 会先进行清理，然后再进行部署。如果这是一个多 module 的项目（即有多个子项目），则会遍历每个项目以执行 clean 和 deploy。</p>
<p>如果我们使用命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean install -Dmaven.test.skip=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>
<p>则执行清理、安装且跳过测试 phase。</p>
<h3 id="每一个构建-phase-是由构建-goal-组成的">每一个构建 phase 是由构建 goal 组成的</h3>
<p>phase 下面还可以再细分，细分的单元就是 plugin goal。</p>
<p>plugin goal 其实是一个执行的任务（比 phase 更细粒度）一个 goal 可以和一个或者多个 phase 绑定，甚至在生命周期之外通过直接 invocation 运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean dependency:copy-dependencies package<br></code></pre></td></tr></table></figure>
<p>mvn 是一级命令。</p>
<p>clean 和 package 是二级命令，也就是 phase。</p>
<p>dependency 是三级命令，也就是 plugin。</p>
<p>copy-dependencies差不多可以说是参数，也就是 plugin goal。</p>
<p><strong>上面的命令就是执行 clean 及其前面所有的 phases 的所有 goal，单独执行 dependency 插件的 copy-dependencies goal，然后再执行 package 的所有 goal。</strong></p>
<p>一个 goal 被绑定到(bound 是 bind 的过去分词形式)多个 phase，这个 goal 会被执行多遍。</p>
<h2 id="设置你的项目来使用构建生命周期">设置你的项目来使用构建生命周期</h2>
<p>如何把任务分配到构建 phases 里？</p>
<h3 id="packaging">packaging</h3>
<p>第一个方法是使用 packaging，它对应的 POM 元素是<code>&lt;packaging&gt;</code>。它的有效值分别是：jar、war、ear 和 pom（pom 也是一个 packaging 值，证明这个项目是 purely meta data）。默认值就是 jar。</p>
<p>packaging 有不同的值，插件的 goal 对各个 phases 的绑定就不同。</p>
<p>jar 的插件绑定如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">phases</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">process-resources</span>&gt;</span><br>    org.apache.maven.plugins:maven-resources-plugin:2.6:resources<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">process-resources</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">compile</span>&gt;</span><br>    org.apache.maven.plugins:maven-compiler-plugin:3.1:compile<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">compile</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">process-test-resources</span>&gt;</span><br>    org.apache.maven.plugins:maven-resources-plugin:2.6:testResources<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">process-test-resources</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">test-compile</span>&gt;</span><br>    org.apache.maven.plugins:maven-compiler-plugin:3.1:testCompile<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">test-compile</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">test</span>&gt;</span><br>    org.apache.maven.plugins:maven-surefire-plugin:2.12.4:test<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">test</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">package</span>&gt;</span><br>    org.apache.maven.plugins:maven-jar-plugin:2.4:jar<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">package</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">install</span>&gt;</span><br>    org.apache.maven.plugins:maven-install-plugin:2.4:install<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">install</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">deploy</span>&gt;</span><br>    org.apache.maven.plugins:maven-deploy-plugin:2.7:deploy<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">deploy</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">phases</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>其他 phases 见这个<a target="_blank" rel="noopener" href="https://maven.apache.org/ref/3.5.4/maven-core/default-bindings.html">《Plugin Bindings for default Lifecycle Reference》</a>。</p>
<h3 id="如何控制构建的语言版本">如何控制构建的语言版本</h3>
<p>在 Maven 中控制 Java 编译版本有多种方式，推荐使用以下方式之一：</p>
<p><strong>方式一：使用 properties（推荐）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><strong>方式二：在 compiler plugin 中配置</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><strong>方式三：使用 release（Java 9+）</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">release</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">release</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><strong>注意</strong>：<code>release</code> 参数会同时设置 <code>source</code> 和 <code>target</code>，并且会启用跨编译检查，确保代码兼容目标版本。不能同时使用 <code>release</code> 和 <code>source/target</code> 参数。</p>
<h3 id="plugins">plugins</h3>
<p>插件是向 maven 提供 goal 的 artifact，即插件虽然自己包含很多 mojo，但它是以 artifact 的形式向外发布自己的能力（capability）的。例如，<code>compile</code>插件提供两个 goal：<code>compile</code>和<code>testCompile</code>（注意看，没有中间的连字符，所以不是 phase）。</p>
<p>在添加插件的时候要注意，不是只是加入一个 plugin 就万事大吉了，我们需要指定我们想要在构建的时候运行的 goal。</p>
<p>因为 packaging 本身也含有对插件和 goal 的绑定，所以我们要当心混合使用的时候的顺序问题。我们可以使用<code>&lt;execution/&gt;</code>来进行顺序的控制，如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.modello<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>modello-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- execution 可以包着 configuration --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">models</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">model</span>&gt;</span>src/main/mdo/maven.mdo<span class="hljs-tag">&lt;/<span class="hljs-name">model</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">models</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>java<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>execution 里还可以指定 phases：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mycompany.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>display-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 默认的 plugin 都是有默认的 phase 属性的，但可以靠配置覆盖这些属性 --&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>process-test-resources<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>time<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="maven-wrapper">Maven Wrapper</h2>
<p>Maven Wrapper 是 Maven 的一个重要特性，它允许项目在没有预装 Maven 的环境中构建。Wrapper 会下载并使用指定版本的 Maven。</p>
<h3 id="使用-maven-wrapper">使用 Maven Wrapper</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装 Maven Wrapper（在项目根目录执行）</span><br>mvn wrapper:wrapper<br><br><span class="hljs-comment"># 使用 Wrapper 构建项目（替代 mvn 命令）</span><br>./mvnw clean install<br><span class="hljs-comment"># Windows 系统</span><br>mvnw.cmd clean install<br></code></pre></td></tr></table></figure>
<h3 id="maven-wrapper-的优势">Maven Wrapper 的优势</h3>
<ol>
<li><strong>版本一致性</strong>：确保所有开发者和 CI 环境使用相同版本的 Maven</li>
<li><strong>零安装</strong>：新成员只需检出代码即可构建，无需手动安装 Maven</li>
<li><strong>可移植性</strong>：项目自带构建环境，不依赖系统 Maven</li>
</ol>
<h3 id="配置-maven-版本">配置 Maven 版本</h3>
<p>在 <code>.mvn/wrapper/maven-wrapper.properties</code> 文件中配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">distributionUrl</span>=<span class="hljs-string">https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.8.6/apache-maven-3.8.6-bin.zip</span><br></code></pre></td></tr></table></figure>
<h2 id="多模块项目中的生命周期执行">多模块项目中的生命周期执行</h2>
<p>在多模块项目中，Maven 会按照模块间的依赖关系顺序执行生命周期。</p>
<h3 id="执行顺序">执行顺序</h3>
<ol>
<li>Maven 首先解析模块间的依赖关系，构建反应堆（Reactor）</li>
<li>按照依赖顺序执行：被依赖的模块先执行</li>
<li>如果模块 A 依赖模块 B，则先构建 B，再构建 A</li>
</ol>
<pre><code class="hljs mermaid">graph LR
    subgraph 多模块项目
        Parent[父POM] --&gt; Child1[common模块]
        Parent --&gt; Child2[service模块]
        Parent --&gt; Child3[web模块]
        
        Child3 --&gt;|依赖| Child2
        Child2 --&gt;|依赖| Child1
    end
    
    subgraph 构建顺序
        Step1[1. common] --&gt; Step2[2. service]
        Step2 --&gt; Step3[3. web]
    end
    
    style Child1 fill:#90EE90
    style Child2 fill:#87CEEB
    style Child3 fill:#DDA0DD</code></pre>
<h3 id="示例">示例</h3>
<p>假设有三个模块：<code>common</code>、<code>service</code>、<code>web</code>，依赖关系为 <code>web -&gt; service -&gt; common</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean install<br></code></pre></td></tr></table></figure>
<p>执行顺序为：<code>common</code> -&gt; <code>service</code> -&gt; <code>web</code></p>
<h3 id="控制构建范围">控制构建范围</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 只构建特定模块</span><br>mvn clean install -pl service<br><br><span class="hljs-comment"># 构建特定模块及其依赖</span><br>mvn clean install -pl service -am<br><br><span class="hljs-comment"># 构建特定模块及依赖它的模块</span><br>mvn clean install -pl service -amd<br><br><span class="hljs-comment"># 从特定模块开始构建</span><br>mvn clean install -rf service<br></code></pre></td></tr></table></figure>
<h2 id="profile-与生命周期的关系">Profile 与生命周期的关系</h2>
<p>Profile 允许根据不同的环境或条件使用不同的构建配置。</p>
<h3 id="定义-profile">定义 Profile</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>dev<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="激活-profile">激活 Profile</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 命令行激活</span><br>mvn clean install -Pdev<br><br><span class="hljs-comment"># 通过 settings.xml 激活</span><br>&lt;activeProfiles&gt;<br>    &lt;activeProfile&gt;dev&lt;/activeProfile&gt;<br>&lt;/activeProfiles&gt;<br></code></pre></td></tr></table></figure>
<h3 id="profile-中的插件配置">Profile 中的插件配置</h3>
<p>Profile 可以覆盖或扩展插件配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>prod<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">release</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">release</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">debug</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">debug</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">optimize</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optimize</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="跳过测试的多种方式">跳过测试的多种方式</h2>
<h3 id="方式一：使用-maven-test-skip">方式一：使用 maven.test.skip</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean install -Dmaven.test.skip=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure>
<p>这种方式会完全跳过测试编译和执行，测试代码不会被编译。</p>
<h3 id="方式二：使用-skiptests">方式二：使用 skipTests</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean install -DskipTests<br></code></pre></td></tr></table></figure>
<p>这种方式会编译测试代码，但不执行测试。推荐使用这种方式，因为它可以提前发现测试代码的编译错误。</p>
<h3 id="方式三：使用-surefire-插件配置">方式三：使用 surefire 插件配置</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0-M7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">skipTests</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">skipTests</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="maven-3-x-与-maven-4-x-的差异">Maven 3.x 与 Maven 4.x 的差异</h2>
<p>截至 2024 年，Maven 4.x 仍在开发中，主要的改进方向包括：</p>
<h3 id="性能优化">性能优化</h3>
<ul>
<li>更快的构建速度</li>
<li>改进的并行构建能力</li>
<li>更好的增量构建支持</li>
</ul>
<h3 id="依赖管理">依赖管理</h3>
<ul>
<li>更灵活的依赖范围</li>
<li>改进的依赖解析算法</li>
</ul>
<h3 id="用户界面">用户界面</h3>
<ul>
<li>更好的错误提示</li>
<li>改进的日志输出</li>
</ul>
<h3 id="兼容性">兼容性</h3>
<ul>
<li>Maven 4.x 将向后兼容 Maven 3.x 的 POM 文件</li>
<li>但某些废弃的特性将被移除</li>
</ul>
<p><strong>注意</strong>：目前生产环境仍推荐使用 Maven 3.8.x 或 3.9.x 稳定版本。</p>
<h2 id="生命周期参考">生命周期参考</h2>
<h3 id="clean-生命周期的-phases">clean 生命周期的 phases</h3>
<table>
<thead>
<tr>
<th style="text-align:center">phase</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">pre-clean</td>
<td style="text-align:center">在实际的项目清理以前，需要被执行的处理过程（processes）</td>
</tr>
<tr>
<td style="text-align:center">clean</td>
<td style="text-align:center"><strong>移走前一个 build 生成的所有文件</strong></td>
</tr>
<tr>
<td style="text-align:center">post-clean</td>
<td style="text-align:center">执行所有需要用来终结项目清理的过程</td>
</tr>
</tbody>
</table>
<h3 id="default-的-phases">default 的 phases</h3>
<table>
<thead>
<tr>
<th style="text-align:center">phase</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">validate</td>
<td style="text-align:center">验证项目是正确的，且所有必须信息是可用的（实际上就是整个 pom 文件是 valid 的）</td>
</tr>
<tr>
<td style="text-align:center">initialize</td>
<td style="text-align:center">初始化构建状态，即设置 properties 或创建目录。也就是 properties 要在这个阶段被 inject</td>
</tr>
<tr>
<td style="text-align:center">generate-sources</td>
<td style="text-align:center">为任何编译中的inclusion（包含）生成源代码。</td>
</tr>
<tr>
<td style="text-align:center">process-sources</td>
<td style="text-align:center">处理源代码，比如过滤某些值</td>
</tr>
<tr>
<td style="text-align:center">generate-resources</td>
<td style="text-align:center">为打包的时候需要的inclusion（包含）生成资源。也就是中间资源（resources/assets）生成。</td>
</tr>
<tr>
<td style="text-align:center">process-resources</td>
<td style="text-align:center">拷贝和处理资源到目标文件夹里，为打包做准备。也就是静态资源准备完毕</td>
</tr>
<tr>
<td style="text-align:center">compile</td>
<td style="text-align:center">编译项目的源代码</td>
</tr>
<tr>
<td style="text-align:center">process-classes</td>
<td style="text-align:center">后处理编译生成的文件，比如对 Java 类进行字节码增强。比如使用 AOP 框架进行字节码织入</td>
</tr>
<tr>
<td style="text-align:center">generate-test-sources</td>
<td style="text-align:center">为编译中的inclusion（包含）生成测试用源代码</td>
</tr>
<tr>
<td style="text-align:center">process-test-sources</td>
<td style="text-align:center">处理测试源代码，比如过滤某些值</td>
</tr>
<tr>
<td style="text-align:center">generate-test-resources</td>
<td style="text-align:center">为测试创建资源。</td>
</tr>
<tr>
<td style="text-align:center">process-test-resources</td>
<td style="text-align:center">复制和处理资源到测试目标目录</td>
</tr>
<tr>
<td style="text-align:center">test-compile</td>
<td style="text-align:center">编译测试源代码到测试目标目录</td>
</tr>
<tr>
<td style="text-align:center">process-test-classes</td>
<td style="text-align:center">对测试编译的结果进行后处理，比如进行字节码增强，需要 Maven 2.0.5 和以上版本。</td>
</tr>
<tr>
<td style="text-align:center">test</td>
<td style="text-align:center">用测试框架中合适的单元运行测试，这些测试不能要求类被打包和部署</td>
</tr>
<tr>
<td style="text-align:center">prepare-package</td>
<td style="text-align:center">进行任何实际打包前必须的准备操作</td>
</tr>
<tr>
<td style="text-align:center">package</td>
<td style="text-align:center">把编译过的代码装进一个可发布格式，比如 JAR</td>
</tr>
<tr>
<td style="text-align:center">pre-integration-test</td>
<td style="text-align:center">进行集成测试前需要的活动，比如设置一个合适的环境</td>
</tr>
<tr>
<td style="text-align:center">integration-test</td>
<td style="text-align:center">处理和部署一个包到集成测试环境，运行集成测试</td>
</tr>
<tr>
<td style="text-align:center">post-integration-test</td>
<td style="text-align:center">执行集成测试后需要执行的活动，比如清理环境</td>
</tr>
<tr>
<td style="text-align:center">verify</td>
<td style="text-align:center">跑一些校验，来验证包是有效的，而且满足质量标准的</td>
</tr>
<tr>
<td style="text-align:center">install</td>
<td style="text-align:center">把当前的包安装到本地仓库，这样可以作为其他项目的本地依赖</td>
</tr>
<tr>
<td style="text-align:center">deploy</td>
<td style="text-align:center">在集成或者发布环境中执行，把包拷贝到一个远程的仓库，给其他开发者和项目共享</td>
</tr>
</tbody>
</table>
<h3 id="site-的-phases">site 的 phases</h3>
<table>
<thead>
<tr>
<th style="text-align:center">phase</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">pre-site</td>
<td style="text-align:center">执行需要在站点生成（generation）之前执行的流程</td>
</tr>
<tr>
<td style="text-align:center">site</td>
<td style="text-align:center">生成项目的站点文档</td>
</tr>
<tr>
<td style="text-align:center">post-site</td>
<td style="text-align:center">执行需要被用来终结站点生成的操作，来为站点部署做准备</td>
</tr>
<tr>
<td style="text-align:center">site-deploy</td>
<td style="text-align:center">部署站点文档到特定的 web server 里（而不是仓库里）</td>
</tr>
</tbody>
</table>
<h1>插件配置</h1>
<p>本章主要参考了<a target="_blank" rel="noopener" href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html">《Guide to Configuring Plug-ins》</a>。</p>
<p>maven 实际上有两种插件：</p>
<ul>
<li>构建插件，需要在<code>&lt;build/&gt;</code>元素里配置。如<code>&lt;build&gt;&lt;pluginManagement/&gt;&lt;/build&gt;</code>，当然也有<code>&lt;build&gt;&lt;plugins/&gt;&lt;/build&gt;</code>。</li>
<li>报告插件，会在&quot;site generation&quot;里被执行，应该在<code>&lt;reporting/&gt;</code>里配置。如<code>&lt;reporting&gt;&lt;plugins/&gt;&lt;/reporting&gt;</code>。</li>
</ul>
<p>要引用插件至少要有三个元素：<code>groupId</code>，<code>artifactId</code>， <code>version</code>。</p>
<h2 id="mojo-是什么">mojo 是什么</h2>
<p>根据<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8420561/what-is-mojo-in-maven">《What is MOJO in Maven?》</a>，mojo 是 Maven plain Old Java Object 的意思。实际上是可执行的 goal。</p>
<h2 id="通用配置">通用配置</h2>
<p>一个插件通常包含一个以上的mojo，当一个 mojo 被映射到 goal 的时候，则包含多个 mojo（即一个插件可能有多个 goal）。maven 通过 <configuration> 元素来配置 maven 插件，<configuration> 的子元素，就会映射到 mojo 的字段，或者 setter 里。</p>
<p>假设有一个mojo：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@goal</span> query</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyQueryMojo</span><br>    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMojo</span><br>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span> expression=&quot;$&#123;query.url&#125;&quot;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String url;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span> default-value=&quot;60&quot;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> timeout;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String[] options;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span><br>        <span class="hljs-keyword">throws</span> MojoExecutionException<br>    &#123;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>生成的 xml 就如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-myquery-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.foobar.com/query<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">timeout</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">options</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>one<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>two<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>three<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">options</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>可以看到<code>&lt;configuration/&gt;</code>确实是 schemaless 的。</p>
<p>而且这些 field 上的注释可以注明缺省值，以及与命令行参数一起使用时的表达式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 调用 myquery 插件 query goal，-D 引出命令行参数，在底层可以通过 System.getProperties() 取值，相当于系统变量（而不是环境变量）的一部分</span><br>mvn myquery:query -Dquery.url=http://maven.apache.org<br></code></pre></td></tr></table></figure>
<h3 id="查看帮助">查看帮助</h3>
<p>通常插件都带有一个<code>help</code>的 goal，通常可以用以下的方法查看（自行替换插件名称）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn javadoc:<span class="hljs-built_in">help</span> -Ddetail -Dgoal=javadoc<br></code></pre></td></tr></table></figure>
<h3 id="配置参数">配置参数</h3>
<h4 id="普通类型">普通类型</h4>
<p>基本类型的映射，就使用字面量配置<code>&lt;configuration/&gt;</code>元素：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">myString</span>&gt;</span>a string<span class="hljs-tag">&lt;/<span class="hljs-name">myString</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">myBoolean</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">myBoolean</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">myInteger</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">myInteger</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">myDouble</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">myDouble</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">myFile</span>&gt;</span>c:\temp<span class="hljs-tag">&lt;/<span class="hljs-name">myFile</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">myURL</span>&gt;</span>http://maven.apache.org<span class="hljs-tag">&lt;/<span class="hljs-name">myURL</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="复杂类型">复杂类型</h4>
<p>如果有复杂（complex not compoud）类型映射的需要：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">person</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">firstName</span>&gt;</span>Jason<span class="hljs-tag">&lt;/<span class="hljs-name">firstName</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">lastName</span>&gt;</span>van Zyl<span class="hljs-tag">&lt;/<span class="hljs-name">lastName</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>maven 会以大写首字母的方式，在 mojo 本身存在的包里寻找 person 类，否则，就要指定包名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">person</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">&quot;com.mycompany.mojo.query.SuperPerson&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">firstName</span>&gt;</span>Jason<span class="hljs-tag">&lt;/<span class="hljs-name">firstName</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">lastName</span>&gt;</span>van Zyl<span class="hljs-tag">&lt;/<span class="hljs-name">lastName</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="列表类型">列表类型</h4>
<p>同数组不同，列表类型在 maven 的xml 语法里不是强类型的（换言之，数组是）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAnimalMojo</span><br>    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMojo</span><br>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> List animals;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span><br>        <span class="hljs-keyword">throws</span> MojoExecutionException<br>    &#123;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-myanimal-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">animals</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">animal</span>&gt;</span>cat<span class="hljs-tag">&lt;/<span class="hljs-name">animal</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">animal</span>&gt;</span>dog<span class="hljs-tag">&lt;/<span class="hljs-name">animal</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">animal</span>&gt;</span>aardvark<span class="hljs-tag">&lt;/<span class="hljs-name">animal</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">animals</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>其映射规则是：</p>
<blockquote>
<ul>
<li>If the XML element contains an implementation hint  attribute, that is used</li>
<li>If the XML tag contains a ., try that as a fully qualified class name</li>
<li>Try the XML tag (with capitalized first letter) as a class in the same package as the mojo/object being configured</li>
<li>If the element has no children, assume its type is String. Otherwise, the configuration will fail.</li>
</ul>
</blockquote>
<h4 id="map-类型">map 类型</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * My Map.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@parameter</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> Map myMap;<br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml">...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">myMap</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">key1</span>&gt;</span>value1<span class="hljs-tag">&lt;/<span class="hljs-name">key1</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">key2</span>&gt;</span>value2<span class="hljs-tag">&lt;/<span class="hljs-name">key2</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">myMap</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>...<br></code></pre></td></tr></table></figure>
<h4 id="properties-类型">Properties 类型</h4>
<p>和 map 表达嵌套的方式恰好又不一样了，更加工整：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * My Properties.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@parameter</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> Properties myProperties;<br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">myProperties</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>propertyName1<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>propertyValue1<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>propertyName2<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>propertyValue2<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">myProperties</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="配置构建插件">配置构建插件</h2>
<h3 id="使用-executions-标签">使用<code>&lt;executions&gt;</code>标签</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-myquery-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>          <span class="hljs-comment">&lt;!-- execution 实际上是插件的执行配置 --&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 执行的 id --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>execution1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--这个执行所属的阶段--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>              <span class="hljs-comment">&lt;!--配置内部的属性--&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.foo.com/query<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">timeout</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">options</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>one<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>two<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>three<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>              <span class="hljs-tag">&lt;/<span class="hljs-name">options</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--这一个 execution 需要执行的 goal 是什么 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>query<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>execution2<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.bar.com/query<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">timeout</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">options</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>four<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>five<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>six<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>              <span class="hljs-tag">&lt;/<span class="hljs-name">options</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>query<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>注意，在一个 POM 的一个插件里，execution id 必须是唯一的。</p>
<p>一个 plugin 在多个 phase 多次被执行的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        ...<br>        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>execution1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            ...<br>          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>execution2<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>install<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.bar.com/query<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">timeout</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">options</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>four<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>five<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>six<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>              <span class="hljs-tag">&lt;/<span class="hljs-name">options</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>query<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>下面这个 mojo，用注释标明了这个 plugin/goal 的默认 phase：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@goal</span> query</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@phase</span> package</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBindedQueryMojo</span><br>    <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMojo</span><br>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span> expression=&quot;$&#123;query.url&#125;&quot;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String url;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span> default-value=&quot;60&quot;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> timeout;<br> <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@parameter</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String[] options;<br> <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span><br>        <span class="hljs-keyword">throws</span> MojoExecutionException<br>    &#123;<br>        ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>我们可以使用 xml 配置来覆盖初始配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-myquery-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>execution1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>install<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://www.bar.com/query<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">timeout</span>&gt;</span>15<span class="hljs-tag">&lt;/<span class="hljs-name">timeout</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">options</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>four<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>five<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>six<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br>              <span class="hljs-tag">&lt;/<span class="hljs-name">options</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>query<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>曾经，maven 插件的<configuration>如果处于<execution>内部，则无法被命令行 invocation 调用，因为它必须到指定生命周期 phase 才可以被使用。但自 Maven 3.3.1 以后，我们可以直接这样做：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># execution id 终于派上用场了</span><br>mvn myqyeryplugin:queryMojo@execution1<br></code></pre></td></tr></table></figure>
<h3 id="使用-dependencies-标签">使用<code>&lt;dependencies&gt;</code>标签</h3>
<p>插件自己也有自己的默认 dependency，我们可以在插件内部自己使用<code>&lt;dependencies&gt;</code>来更换它的依赖。如  Maven Antrun Plugin version 1.2 使用的 Ant version 1.6.5，我们可以这样更新依赖（兼容性自己保证）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        ...<br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.ant<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ant<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.ant<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ant-launcher<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="在构建插件里使用-inherited-标签">在构建插件里使用<code>&lt;inherited&gt;</code>标签</h3>
<p>默认的插件配置是会被传播（propagated）到子 pom 里的，所以可以显式地设置<code>&lt;inherited&gt;</code>为 false 来打破这种属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 不使用这个 tag 的时候，这个值默认就是 false --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">inherited</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">inherited</span>&gt;</span><br>        ...<br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="配置-reporting-插件">配置 reporting 插件</h2>
<h3 id="使用-reporting-tag-vs-build-tag">使用 <code>&lt;reporting&gt;</code> Tag VS <code>&lt;build&gt;</code> Tag</h3>
<p><code>&lt;build&gt;</code> 标签里也可以配置 reporting 插件，但大部分情况下<code>&lt;reporting&gt;</code>里的配置都优先被使用。具体细则见 <a target="_blank" rel="noopener" href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html#Using_the_reporting_Tag_VS_build_Tag">maven 原文档</a>。</p>
<h3 id="使用-reportsets-标签">使用<code>&lt;reportSets&gt;</code>标签</h3>
<p>如果我们想要选择性地生成报告，我们可以使用<code>&lt;reportSets&gt;</code>标签，只有被它包括的报告，才被选中生成：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">reporting</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-project-info-reports-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">reportSets</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">reportSet</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">reports</span>&gt;</span><br>              <span class="hljs-tag">&lt;<span class="hljs-name">report</span>&gt;</span>project-team<span class="hljs-tag">&lt;/<span class="hljs-name">report</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">reports</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">reportSet</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">reportSets</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">reporting</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>推而广之，一份报告都不生成的时候，我们可以这样做：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">reportSets</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">reportSet</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">reports</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">reportSet</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">reportSets</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="在报告插件中使用-inherited-标签">在报告插件中使用<code>&lt;inherited&gt;</code>标签</h3>
<p>同构建插件差不多</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">reporting</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-project-info-reports-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">inherited</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">inherited</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">reporting</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h1>依赖管理</h1>
<h2 id="maven-的配置和依赖是单根继承的">Maven 的配置和依赖是单根继承的</h2>
<p>Maven 的模块继承是无法进行多继承的，只能使用单根继承。</p>
<h2 id="dependencies-与-dependencymanagement-的区别">dependencies 与 dependencyManagement 的区别</h2>
<p>dependencies 即使在子项目中不写该依赖项，那么子项目仍然会从父项目中继承该依赖项（全部继承）</p>
<p>dependencyManagement 里只是声明依赖和它们的版本，并不实现引入，因此子项目需要显示的声明需要用的依赖。如果不在子项目中声明依赖，是不会从父项目中继承下来的；只有在子项目中写了该依赖项，并且没有指定具体版本，才会从父项目中继承该项，并且 version 和 scope 都读取自父 pom; 另外如果子项目中指定了版本号，那么会使用子项目中指定的jar版本。</p>
<h2 id="有效-pom">有效 pom</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn <span class="hljs-built_in">help</span>:effective-pom &gt; effective-pom.xml<br><span class="hljs-comment"># 获取某个指定 artifact 的依赖树</span><br> mvn dependency:tree -Dverbose -Dincludes=com.fasterxml.jackson.core:jackson-core<br></code></pre></td></tr></table></figure>
<h2 id="下载依赖中的源码和文档">下载依赖中的源码和文档</h2>
<p>在 maven 里，resolve 有特别的含义：仲裁。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 只下载源码</span><br>mvn dependency:sources<br><br><span class="hljs-comment"># 静默下载源码</span><br>mvn dependency:sources -Dsilent=<span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 只下载文档</span><br>mvn dependency:resolve -Dclassifier=javadoc<br><span class="hljs-comment"># 一起下载</span><br>mvn dependency:sources dependency:resolve -Dclassifier=javadoc<br><br><span class="hljs-comment"># 主动获取源码，这样做可以帮助其他构件工具使用 mavenLocal() 仓库</span><br>mvn dependency:get -Dartifact=GROUP_ID:ARTIFACT_ID:VERSION:jar:sources<br>mvn dependency:get -Dartifact=org.springframework:spring-core:5.1.2.RELEASE:jar:sources<br></code></pre></td></tr></table></figure>
<p>在 .m2 中这样配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- ... other settings omitted ... --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>downloadSources<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">downloadSources</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">downloadSources</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">downloadJavadocs</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">downloadJavadocs</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">activeProfiles</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>downloadSources<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">activeProfiles</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>在项目中这样主动配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>sources<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>resolve<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>javadoc<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>附赠一个批量构建脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">traverseAllProjects</span></span> () &#123;<br>    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> *; <span class="hljs-keyword">do</span><br>        <span class="hljs-keyword">if</span> [ -d <span class="hljs-string">&quot;<span class="hljs-variable">$f</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;coming into a folder <span class="hljs-variable">$f</span>&quot;</span><br>            <span class="hljs-built_in">cd</span> <span class="hljs-variable">$f</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;current path:&quot;</span><br>            git pull<br>            <span class="hljs-built_in">pwd</span><br>            POM_FILE=pom.xml<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$POM_FILE</span>&quot;</span>; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$POM_FILE</span> exists.&quot;</span><br>                <span class="hljs-comment"># clean build</span><br>                <span class="hljs-keyword">time</span> mvn clean install -Dmaven.test.skip=<span class="hljs-literal">true</span><br>                <span class="hljs-comment"># resolve dependencies&#x27; javadocs and sources</span><br>                <span class="hljs-keyword">time</span> mvn dependency:sources dependency:resolve -Dclassifier=javadoc\n<br>                <span class="hljs-comment"># complete build</span><br>                <span class="hljs-keyword">time</span> mvn clean install -Dmaven.test.skip=<span class="hljs-literal">true</span><br>            <span class="hljs-keyword">fi</span><br>            GRADLE_FILE=build.gradle<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$GRADLE_FILE</span>&quot;</span>; <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$GRADLE_FILE</span> exists.&quot;</span><br>                <span class="hljs-comment"># clean build</span><br>                <span class="hljs-keyword">time</span> ./gradlew clean build -x <span class="hljs-built_in">test</span><br>                <span class="hljs-comment"># 目前还没有简单的在命令行里下载源代码的方法</span><br>            <span class="hljs-keyword">fi</span><br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;coming out a folder <span class="hljs-variable">$f</span>&quot;</span><br>            <span class="hljs-built_in">cd</span> ..<br>            <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;current path:&quot;</span><br>            <span class="hljs-built_in">pwd</span><br>        <span class="hljs-keyword">fi</span><br>    <span class="hljs-keyword">done</span><br>&#125;<br><br><span class="hljs-keyword">time</span> traverseAllProjects<br></code></pre></td></tr></table></figure>
<p>在 idea中这样配置<code> Preference &gt; Build, Execution, Deployment &gt; Build Tools &gt; Maven &gt; importing</code>。</p>
<h2 id="bom-bill-of-material">BOM（Bill of Material）</h2>
<h3 id="bom定义">BOM定义</h3>
<p>BOM（Bill of Material），物料清单。将某一个领域相应的jar统一称之为XXX-BOM予以管理（例如inf-bom、spring-framework-bom），并不是Maven的规定，只是一种约定俗成（convention over configuration）。<a target="_blank" rel="noopener" href="https://mrhaki.blogspot.com/2019/04/gradle-goodness-use-bill-of-materials.html">Gradle 也采用了这样的思路</a>。</p>
<h3 id="为什么要使用bom">为什么要使用bom</h3>
<p>（1）避免开发同学需要关心各个API的版本关系：BOM这种方式在 dependencyManagement 指定了各个依赖的版本，并不会使得这些依赖并被真正引入（仅做版本管理使用）。在dependency中还要按需引入、但省去了需要制定version的麻烦。</p>
<p>（2）便于历史版本API的收归。</p>
<p>（3）可以说逐渐使用 bom 来统一管理某个团队（领域）的 API 版本已成为一种趋势。</p>
<h2 id="scope-的含义">scope 的含义</h2>
<p>scope元素的作用：控制 dependency 元素的使用范围。通俗的讲，就是控制 Jar 包在哪些范围被加载和使用。</p>
<h3 id="compile-默认">compile（默认）</h3>
<p>含义：compile 是默认值，如果没有指定 scope 值，该元素的默认值为 compile。被依赖项目需要参与到当前项目的编译，测试，打包，运行等阶段。打包的时候通常会包含被依赖项目。</p>
<h3 id="provided">provided</h3>
<p>含义：被依赖项目理论上可以参与编译、测试、运行等阶段，相当于compile，但是再打包阶段做了exclude的动作。<br>
适用场景：例如， 如果我们在开发一个web 应用，在编译时我们需要依赖 servlet-api.jar，但是在运行时我们不需要该 jar 包，因为这个 jar 包已由应用服务器提供，此时我们需要使用 provided 进行范围修饰。</p>
<h3 id="runtime">runtime</h3>
<p>含义：表示被依赖项目无需参与项目的编译，但是会参与到项目的测试和运行。与compile相比，被依赖项目无需参与项目的编译。<br>
适用场景：例如，在编译的时候我们不需要 JDBC API 的 jar 包，而在运行的时候我们才需要 JDBC 驱动包。</p>
<h3 id="test">test</h3>
<p>含义： 表示被依赖项目仅仅参与测试相关的工作，包括测试代码的编译，执行。<br>
适用场景：例如，Junit 测试。</p>
<h3 id="system">system</h3>
<p>含义：system 元素与 provided 元素类似，但是被依赖项不会从 maven 仓库中查找，而是从本地系统中获取，systemPath 元素用于制定本地系统中 jar 文件的路径。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.open<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>open-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>system<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">systemPath</span>&gt;</span>$&#123;basedir&#125;/WebContent/WEB-INF/lib/open-core.jar<span class="hljs-tag">&lt;/<span class="hljs-name">systemPath</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="import">import</h3>
<p>它只使用在<dependencyManagement>中，表示从其它的pom中导入dependency的配置，例如 (B项目导入A项目中的包配置)：</p>
<p>想必大家在做SpringBoot应用的时候，都会有如下代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>继承一个父模块，然后再引入相应的依赖。<br>
假如说，我不想继承，或者我想继承多个，怎么做？</p>
<p>我们知道Maven的继承和Java的继承一样，是无法实现多重继承的，如果10个、20个甚至更多模块继承自同一个模块，那么按照我们之前的做法，这个父模块的dependencyManagement会包含大量的依赖。如果你想把这些依赖分类以更清晰的管理，那就不可能了，import scope依赖能解决这个问题。你可以把 dependencyManagement 放到单独的专门用来管理依赖的pom中，然后在需要使用依赖的模块中通过import scope依赖，就可以引入 dependencyManagement。例如可以写这样一个用于依赖管理的pom：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.test.sample<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>base-parent1<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactid</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.8.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactid</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>然后我就可以通过非继承的方式来引入这段依赖管理配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.test.sample<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactid</span>&gt;</span>base-parent1<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br> <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactid</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactid</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><strong>注意：import scope只能用在 dependencyManagement 里面。这么多的 scope 里面，import 也因此是最危险的，因为 import 会把依赖直接展开，而不是用间接传递的方式在新应用中体现，会覆盖 parent 和 dependency（因为寻根路径最短，链接器会最先被链接上），而且<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39276024/import-dependency-management-with-exclusion">无法被 exclude 排除</a>。</strong></p>
<p>这样，父模块的pom就会非常干净，由专门的packaging为pom来管理依赖，也契合的面向对象设计中的单一职责原则。此外，我们还能够创建多个这样的依赖管理pom，以更细化的方式管理依赖。这种做法与面向对象设计中使用组合而非继承也有点相似的味道。</p>
<p>那么，如何用这个方法来解决SpringBoot的那个继承问题呢？</p>
<p>配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br> <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>这样配置的话，自己的项目里面就不需要继承SpringBoot的module了，而可以继承自己项目的module了。</p>
<h2 id="scope的依赖传递">scope的依赖传递</h2>
<p>A–&gt;B–&gt;C。当前项目为A，A依赖于B，B依赖于C。知道B在A项目中的scope，那么怎么知道C在A中的scope呢？答案是：<br>
当C是test或者provided时，C直接被丢弃，A不依赖C；<br>
否则A依赖C，C的scope继承于B的scope。</p>
<pre><code class="hljs mermaid">graph LR
    A[项目A] --&gt;|依赖 scope: compile| B[项目B]
    B --&gt;|依赖 scope: compile| C[项目C]
    
    A --&gt;|依赖 scope: test| T[项目T]
    T --&gt;|依赖 scope: compile| U[项目U]
    
    style C fill:#90EE90
    style U fill:#FFB6C1
    
    classDef green fill:#90EE90,stroke:#333,stroke-width:2px
    classDef red fill:#FFB6C1,stroke:#333,stroke-width:2px
    class C green
    class U red</code></pre>
<p><strong>依赖传递规则</strong>：</p>
<table>
<thead>
<tr>
<th>B的scope</th>
<th>C的scope</th>
<th>C在A中的结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>compile</td>
<td>compile</td>
<td>compile</td>
</tr>
<tr>
<td>compile</td>
<td>test</td>
<td>✗ 被丢弃</td>
</tr>
<tr>
<td>compile</td>
<td>provided</td>
<td>✗ 被丢弃</td>
</tr>
<tr>
<td>test</td>
<td>compile</td>
<td>✗ 被丢弃</td>
</tr>
<tr>
<td>provided</td>
<td>compile</td>
<td>provided</td>
</tr>
<tr>
<td>runtime</td>
<td>compile</td>
<td>runtime</td>
</tr>
</tbody>
</table>
<p>依赖矩阵表格见：<a target="_blank" rel="noopener" href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">《Introduction to the Dependency Mechanism》</a></p>
<h2 id="scope-与-optional-的区别">scope 与 optional 的区别</h2>
<p>maven的 scope 决定依赖的包是否加入本工程的classpath下。- 某些 scope 连本项目的 classpath 都会被影响。使用本项目的项目无论如何都不能绕过 scope 的影响，scope 才是最彻底的对传播的隔离（比如 provided）。</p>
<p>optional仅限制依赖包的传递性，不影响依赖包的classpath。- 不影响本项目生成的 jar，影响使用本项目的项目。</p>
<p>scope 与 optional 都可以用重新声明依赖的方式来引入缺失依赖。</p>
<p>比如一个工程中</p>
<p>A-&gt;B, B-&gt;C(scope:compile, optional:true)，B的编译/运行/测试classpath都有C，A中的编译/运行/测试classpath都不存在C(尽管C的scope声明为compile)，A调用B哪些依赖C的方法就会出错。</p>
<p>A-&gt;B, B-&gt;C(scope:provided), B的编译/测试classpath有C，A中的编译/运行/测试classpath都不存在C，但是A使用B(需要依赖C)的接口时就会出现找不到C的错误，此时，要么是手动加入C的依赖，即A-&gt;C，否则需要容器提供C的依赖包到运行时classpath。</p>
<p>对于纯粹作为 lib 来用的 jar，rovided over optional。因为出了 test 这个 phase，连 jar 都不能独立 run 起来。optional 本身是一个可以自己在各种 phase run，但被依赖的时候则会去除打包配置，依然会影响 classpath。</p>
<p>optional 是大项目无法被切割成小的子模块的无奈选择，如果项目要使用被依赖模块的可选功能，必须显式地再声明一遍可选依赖，否则会产生调用出错。optional 阻断了传递依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- declare the dependency to be set as optional --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>sample.ProjectA<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>Project-A<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span> <span class="hljs-comment">&lt;!-- value will be true or false only --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p><code>Project-A -&gt; Project-B Project-X -&gt; Project-A</code></p>
<p>A 的类路径里有 B，而 X 的类路径里无 B。</p>
<h2 id="依赖排除与-debug-技巧">依赖排除与 debug 技巧</h2>
<ul>
<li>在子工程里显式地指定某个依赖版本看是否能够消除错误。</li>
<li>使用 ide 的依赖分析工具，如 mvn dependency 插件（这个分析工具只是运行时分析，有误导性）或者 idea 的 dependency analyzer。</li>
<li>显式地消除依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context-support<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="maven-enforcer-plugin-解决包冲突">maven-enforcer-plugin 解决包冲突</h2>
<h3 id="执行时机">执行时机</h3>
<p>生命周期validate环节。</p>
<h3 id="dependencyconvergence执行逻辑">dependencyConvergence执行逻辑</h3>
<p>通过访问maven dependency tree生成的依赖树，存入map中，key是groupid和artifactId组合，value是依赖对象list，通过判断每个list里的版本号是否相同来判断所有依赖是否为同一个版本。</p>
<h3 id="配置实例">配置实例</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-enforcer-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0-M3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>enforce<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>enforce<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">rules</span>&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">bannedDependencies</span>&gt;</span><br>                                    <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>com.alibaba:fastjson:(,1.2.60)<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>org.hibernate:hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                  <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>                                <span class="hljs-tag">&lt;/<span class="hljs-name">bannedDependencies</span>&gt;</span><br>                            <span class="hljs-tag">&lt;/<span class="hljs-name">rules</span>&gt;</span><br>                            <span class="hljs-tag">&lt;<span class="hljs-name">fail</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">fail</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="快速检验">快速检验</h3>
<p>在自己分支开发完成后，执行<code>mvn validate</code>命令即可查看冲突信息</p>
<h3 id="移除冲突jar">移除冲突jar</h3>
<p>登陆线上机器确认冲突jar的版本，移除不是对应版本的jar，方法：<code>Dependency Analyzer</code> 中搜索冲突jar名，右键选择移除即可自动生成exclude内容。</p>
<h2 id="versions-maven-plugin-版本管理">versions-maven-plugin 版本管理</h2>
<p>参考：<a target="_blank" rel="noopener" href="https://www.baeldung.com/maven-dependency-latest-version">《Use the Latest Version of a Dependency in Maven》</a></p>
<blockquote>
<p>Maven2 also provided two special metaversion values to achieve the<br>
result: LATEST and RELEASE.</p>
</blockquote>
<p>但这两个值已经过期了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>versions-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>org.apache.commons:commons-collections4<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 校验当前的项目有哪些依赖有 newer version</span><br>mvn versions:display-dependency-updates<br><br><span class="hljs-comment"># 会改变 pom 的版本，产生一个备份：pom.xml.versionsBackup，会把 1.1.1-SNAPSHOT，转成 1.1.1</span><br>mvn versions:use-releases<br><br><span class="hljs-comment"># 使用下一个版本的 release</span><br>mvn versions:use-next-releases<br><span class="hljs-comment"># 使用最新的 release</span><br>mvn versions:use-latest-releases<br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>versions-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rulesUri</span>&gt;</span>http://www.mycompany.com/maven-version-rules.xml<span class="hljs-tag">&lt;/<span class="hljs-name">rulesUri</span>&gt;</span><br>       <span class="hljs-comment">&lt;!-- &lt;rulesUri&gt;file:///home/andrea/maven-version-rules.xml&lt;/rulesUri&gt; --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ruleset</span> <span class="hljs-attr">comparisonMethod</span>=<span class="hljs-string">&quot;maven&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://mojo.codehaus.org/versions-maven-plugin/rule/2.0.0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://mojo.codehaus.org/versions-maven-plugin/rule/2.0.0 </span></span><br><span class="hljs-string"><span class="hljs-tag">  http://mojo.codehaus.org/versions-maven-plugin/xsd/rule-2.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ignoreVersions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">ignoreVersion</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;regex&quot;</span>&gt;</span>.*-beta<span class="hljs-tag">&lt;/<span class="hljs-name">ignoreVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ignoreVersions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ruleset</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">ruleset</span> <span class="hljs-attr">comparisonMethod</span>=<span class="hljs-string">&quot;maven&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://mojo.codehaus.org/versions-maven-plugin/rule/2.0.0&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://mojo.codehaus.org/versions-maven-plugin/rule/2.0.0 </span></span><br><span class="hljs-string"><span class="hljs-tag">    http://mojo.codehaus.org/versions-maven-plugin/xsd/rule-2.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">rules</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">rule</span> <span class="hljs-attr">groupId</span>=<span class="hljs-string">&quot;com.mycompany.maven&quot;</span> <span class="hljs-attr">comparisonMethod</span>=<span class="hljs-string">&quot;maven&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ignoreVersions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">ignoreVersion</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;regex&quot;</span>&gt;</span>.*-RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">ignoreVersion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">ignoreVersion</span>&gt;</span>2.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">ignoreVersion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ignoreVersions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">rule</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">rules</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ruleset</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h1>全局配置 settings.xml</h1>
<h2 id="文件结构与顶层元素">文件结构与顶层元素</h2>
<p>settings.xml 对于 maven 来说相当于全局性的配置，用于所有的项目。在 Maven2 中存在两个 settings.xml，一个位于 maven2 的安装目录 conf 下面，作为全局性配置。对于团队设置，保持一致的定义是关键，所以 maven2/conf 下面的 settings.xml 就作为团队共同的配置文件。而对于每个成员，如果有特殊的需求，则可以在 ~/.m2/settings.xml 中进行设置。</p>
<p>settings.xml 基本结构如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0</span></span><br><span class="hljs-string"><span class="hljs-tag">                          https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">interactiveMode</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">usePluginRegistry</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">offline</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">pluginGroups</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">servers</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">proxies</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">activeProfiles</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="localrepository">LocalRepository</h2>
<p>作用：该值表示构建系统本地仓库的路径。其默认值：<code>~/.m2/repository</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">localRepository</span>&gt;</span>$&#123;user.home&#125;/.m2/repository<span class="hljs-tag">&lt;/<span class="hljs-name">localRepository</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="interactivemode">InteractiveMode</h2>
<p>作用：表示maven是否需要和用户交互以获得输入。如果maven需要和用户交互以获得输入，则设置成true，反之则应为false。默认为true。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">interactiveMode</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">interactiveMode</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="offline">Offline</h2>
<p>作用：表示maven是否需要在离线模式下运行。如果构建系统需要在离线模式下运行，则为true，默认为false。当由于网络设置原因或者安全因素，构建服务器不能连接远程仓库的时候，该配置就十分有用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">offline</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">offline</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="plugingroups">PluginGroups</h2>
<p>作用：当插件的组织id（groupId）没有显式提供时，供搜寻插件组织Id（groupId）的列表。该元素包含一个pluginGroup元素列表，每个子元素包含了一个组织Id（groupId）。当我们使用某个插件，并且没有在命令行为其提供组织Id（groupId）的时候，Maven就会使用该列表。默认情况下该列表包含了 <code>org.apache.maven.plugins</code> 和 <code>org.codehaus.mojo</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">pluginGroups</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--plugin的组织Id（groupId） --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">pluginGroup</span>&gt;</span>org.codehaus.mojo<span class="hljs-tag">&lt;/<span class="hljs-name">pluginGroup</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">pluginGroups</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="servers">Servers</h2>
<p>作用：一般，仓库的下载和部署是在pom.xml文件中的repositories和distributionManagement元素中定义的。然而，一般类似用户名、密码（有些仓库访问是需要安全认证的）等信息不应该在pom.xml文件中配置，这些信息可以配置在 settings.xml 中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servers</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--这是server的id（注意不是用户登陆的id），该id与distributionManagement中repository元素的id相匹配。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>server001<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--鉴权用户名。鉴权用户名和鉴权密码表示服务器认证所需要的登录名和密码。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>my_login<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--鉴权密码 。鉴权用户名和鉴权密码表示服务器认证所需要的登录名和密码。密码加密功能已被添加到2.1.0 +。详情请访问密码加密页面 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>my_password<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--鉴权时使用的私钥位置。和前两个元素类似，私钥位置和私钥密码指定了一个私钥的路径（默认是$&#123;user.home&#125;/.ssh/id_dsa）以及如果需要的话，一个密语。将来passphrase和password元素可能会被提取到外部，但目前它们必须在settings.xml文件以纯文本的形式声明。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">privateKey</span>&gt;</span>$&#123;usr.home&#125;/.ssh/id_dsa<span class="hljs-tag">&lt;/<span class="hljs-name">privateKey</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--鉴权时使用的私钥密码。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">passphrase</span>&gt;</span>some_passphrase<span class="hljs-tag">&lt;/<span class="hljs-name">passphrase</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--文件被创建时的权限。如果在部署的时候会创建一个仓库文件或者目录，这时候就可以使用权限（permission）。这两个元素合法的值是一个三位数字，其对应了unix文件系统的权限，如664，或者775。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filePermissions</span>&gt;</span>664<span class="hljs-tag">&lt;/<span class="hljs-name">filePermissions</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--目录被创建时的权限。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">directoryPermissions</span>&gt;</span>775<span class="hljs-tag">&lt;/<span class="hljs-name">directoryPermissions</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--传输层额外的配置项 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servers</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="mirrors">Mirrors</h2>
<p>作用：为仓库列表配置的下载镜像列表。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 该镜像的唯一标识符。id用来区分不同的mirror元素。 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>planetmirror.com<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 镜像名称 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>PlanetMirror Australia<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 该镜像的URL。构建系统会优先考虑使用该URL，而非使用默认的服务器URL。 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://downloads.planetmirror.com/pub/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 被镜像的服务器的id。例如，如果我们要设置了一个Maven中央仓库（http://repo.maven.apache.org/maven2/）的镜像，就需要将该元素设置成central。这必须和中央仓库的id central完全一致。 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 是否阻塞 http 访问强制 https --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">blocked</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">blocked</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>两个例子。现在的主流仓库都是https了，如果使用http可能遇到 301 报错。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus-aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Nexus aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://maven.aliyun.com/nexus/content/groups/public<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>repo1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>maven repo1<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo1.maven.org/maven2/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="proxies">Proxies</h2>
<p>作用：用来配置不同的代理。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0</span></span><br><span class="hljs-string"><span class="hljs-tag">                      https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">proxies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--代理元素包含配置代理时需要的信息 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">proxy</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--代理的唯一定义符，用来区分不同的代理元素。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>myproxy<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--该代理是否是激活的那个。true则激活代理。当我们声明了一组代理，而某个时候只需要激活一个代理的时候，该元素就可以派上用处。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">active</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">active</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--代理的协议。 协议://主机名:端口，分隔成离散的元素以方便配置。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">protocol</span>&gt;</span>http<span class="hljs-tag">&lt;/<span class="hljs-name">protocol</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--代理的主机名。协议://主机名:端口，分隔成离散的元素以方便配置。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>proxy.somewhere.com<span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--代理的端口。协议://主机名:端口，分隔成离散的元素以方便配置。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">port</span>&gt;</span>8080<span class="hljs-tag">&lt;/<span class="hljs-name">port</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--代理的用户名，用户名和密码表示代理服务器认证的登录名和密码。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>proxyuser<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--代理的密码，用户名和密码表示代理服务器认证的登录名和密码。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>somepassword<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--不该被代理的主机名列表。该列表的分隔符由代理服务器指定；例子中使用了竖线分隔符，使用逗号分隔也很常见。 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">nonProxyHosts</span>&gt;</span>*.google.com|ibiblio.org|192.168.58.*|10.*|mirrors.xxx.com<span class="hljs-tag">&lt;/<span class="hljs-name">nonProxyHosts</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 只有高版本的maven可以理解这个配置 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">sslHostConfig</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--指定是否信任所有证书--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">all</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">all</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--指定使用的SSL协议版本--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sslProtocol</span>&gt;</span>all<span class="hljs-tag">&lt;/<span class="hljs-name">sslProtocol</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--指定是否启用SSL--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sslEnabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">sslEnabled</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--指定支持的SSL协议版本列表--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">sslProtocols</span>&gt;</span>TLSv1.2<span class="hljs-tag">&lt;/<span class="hljs-name">sslProtocols</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--指定是否忽略证书验证--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ignoreCertificates</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">ignoreCertificates</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 指定是否信任自签名证书--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">trustSelfSigned</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">trustSelfSigned</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 指定是否允许所有证书  --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">allowAllCerts</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">allowAllCerts</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">sslHostConfig</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">proxy</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">proxies</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="profiles-settings-xml-版">Profiles（settings.xml 版）</h2>
<p>作用：根据环境参数来调整构建配置的列表。<br>
settings.xml中的profile元素是pom.xml中profile元素的裁剪版本。<br>
它包含了id、activation、repositories、pluginRepositories和 properties元素。这里的profile元素只包含这五个子元素是因为这里只关心构建系统这个整体（这正是settings.xml文件的角色定位），而非单独的项目对象模型设置。如果一个settings.xml中的profile被激活，它的值会覆盖任何其它定义在pom.xml中带有相同id的profile。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0</span></span><br><span class="hljs-string"><span class="hljs-tag">                      https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">profiles</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">profile</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- profile的唯一标识 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>      <span class="hljs-comment">&lt;!-- 自动触发profile的条件逻辑 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">activation</span> /&gt;</span><br>      <span class="hljs-comment">&lt;!-- 扩展属性列表 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">properties</span> /&gt;</span><br>      <span class="hljs-comment">&lt;!-- 远程仓库列表 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span> /&gt;</span><br>      <span class="hljs-comment">&lt;!-- 插件仓库列表 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">pluginRepositories</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">profile</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">profiles</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="快照与发布">快照与发布</h3>
<p>我们考虑这种问题要分清楚：</p>
<ol>
<li>我们是使用者还是开发者？这决定了我们使用 repository/pluginRepository，还是 distributionManagement。</li>
<li>我们如果是使用者，我们要分清我们是使用第一方还是第三方，然后我们要分清我们要使用快照还是发布。</li>
<li>当我们选择快照和发布的时候，我们还要分清 updatePolicy。</li>
</ol>
<p>对于 Maven 来说，snapshot 和 release 仓库的设置有以下区别:</p>
<ul>
<li><strong>仓库的用途不同</strong>:
<ul>
<li>snapshot 仓库用于存储开发过程中的不稳定版本，这些版本的构件可能会频繁更新。</li>
<li>release 仓库用于存储稳定的发布版本，这些版本的构件不会再进行修改。</li>
</ul>
</li>
<li><strong>版本号的约定不同</strong>:
<ul>
<li>snapshot 版本的版本号以 “-SNAPSHOT” 结尾，如 “1.0-SNAPSHOT”。</li>
<li>release 版本的版本号不包含 “-SNAPSHOT” 后缀，如 “1.0”。</li>
</ul>
</li>
<li><strong>更新策略不同</strong>:
<ul>
<li>对于 snapshot 版本，Maven 每次构建时都会自动检查远程仓库是否有更新，并下载最新的构件。</li>
<li>对于 release 版本，Maven 默认不会检查更新，而是直接使用本地仓库中的构件。</li>
</ul>
</li>
<li><strong>部署策略不同</strong>:
<ul>
<li>snapshot 版本通常会频繁部署到 snapshot 仓库中，以供其他开发者使用。</li>
<li>release 版本通常只会在稳定后部署一次到 release 仓库中，不再进行修改。</li>
</ul>
</li>
</ul>
<p>这种 snapshot 和 release 的区分确实是一种约定高于配置的设计。Maven 通过版本号的约定来区分构件的稳定性，并根据约定自动选择适当的仓库和更新策略。这种约定简化了配置，提高了构建的可重复性和可靠性。</p>
<p>其他构建工具也有类似的约定:</p>
<ul>
<li>Gradle 使用 “-SNAPSHOT” 后缀来标识 snapshot 版本，并支持配置不同的 snapshot 和 release 仓库。</li>
<li>Ivy 使用 “latest.integration” 和 “latest.release” 来区分 snapshot 和 release 版本，并支持配置不同的仓库。</li>
<li>sbt (Scala 构建工具)使用 “-SNAPSHOT” 后缀来标识 snapshot 版本，并支持配置不同的 snapshot 和 release 仓库。</li>
</ul>
<p>一个完整的远程仓库，需要配置至少如下四类 repo 来管理 jar：</p>
<ul>
<li>release</li>
<li>snapshot</li>
<li>thirdParty-release</li>
<li>thirdParty-snapshot</li>
</ul>
<p>其中</p>
<ul>
<li>标准的用法里，首先从仓库名称标识出仓库的性质，然后使用属性进一步区分快照和发布：
<ul>
<li>对于 release 仓库：releases enabled 为 true，snapshots enabled 为 false；</li>
<li>对于 snapshot 仓库：releases enabled 为 false，snapshots enabled 为 true。</li>
<li>对于 maven central 或者它的镜像，选项都是 true。</li>
</ul>
</li>
<li>后两者其实并不是特别的类型，而是在 id 的名字上有所区别。如设计<code> &lt;id&gt;thirdparty&lt;/id&gt;</code>或者<code>&lt;id&gt;thirdparty-snapshots&lt;/id&gt;</code>的<code>&lt;repository&gt;</code>。这也就意味着还可以有二方的仓库和四方的仓库，<strong>只要你能够从 id 里区分开这些仓库</strong>。</li>
</ul>
<p>这四种仓库在 Maven 中有不同的用途和约定:</p>
<ul>
<li><strong>release 仓库</strong>: 用于存储和管理项目自己的稳定发布版本的构件。这些构件的版本号不包含 “-SNAPSHOT” 后缀，表示它们是经过测试和验证的稳定版本。</li>
<li><strong>snapshot 仓库</strong>: 用于存储和管理项目自己的开发版本的构件。这些构件的版本号以 “-SNAPSHOT” 结尾，表示它们是不稳定的开发版本。</li>
<li><strong>thirdParty-release 仓库</strong>: 用于存储和管理第三方的稳定发布版本的构件。将第三方的 release 构件单独存储，可以与项目自己的 release 构件分开管理。</li>
<li><strong>thirdParty-snapshot 仓库</strong>: 用于存储和管理第三方的开发版本的构件。将第三方的 snapshot 构件单独存储，可以与项目自己的 snapshot 构件分开管理。</li>
</ul>
<p>两个具体的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>some-company-releases<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Repository for releases artifacts<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://pixel.some-company.com/repository/group-releases<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span>&gt;</span>always<span class="hljs-tag">&lt;/<span class="hljs-name">updatePolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>some-company-snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Repository for snapshots artifacts<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://pixel.some-company.com/repository/group-snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span>&gt;</span>always<span class="hljs-tag">&lt;/<span class="hljs-name">updatePolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br> <br><span class="hljs-tag">&lt;<span class="hljs-name">pluginRepositories</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">pluginRepository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>some-company-releases-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Repository for plugin releases artifacts<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://pixel.some-company.com/repository/group-releases<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span>&gt;</span>always<span class="hljs-tag">&lt;/<span class="hljs-name">updatePolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">checksumPolicy</span>&gt;</span>ignore<span class="hljs-tag">&lt;/<span class="hljs-name">checksumPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepository</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">pluginRepository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>some-company-snapshots-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Repository for plugin snapshots artifacts<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://pixel.some-company.com/repository/group-snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span>&gt;</span>always<span class="hljs-tag">&lt;/<span class="hljs-name">updatePolicy</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">checksumPolicy</span>&gt;</span>ignore<span class="hljs-tag">&lt;/<span class="hljs-name">checksumPolicy</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepositories</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="activation">Activation</h3>
<p>作用：自动触发profile的条件逻辑。<br>
如pom.xml中的profile一样，profile的作用在于它能够在某些特定的环境中自动使用某些特定的值；这些环境通过activation元素指定。<br>
activation元素并不是激活profile的唯一方式。settings.xml文件中的activeProfile元素可以包含profile的id。profile也可以通过在命令行，使用-P标记和逗号分隔的列表来显式的激活（如，-P test）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">activation</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--profile默认是否激活的标识 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">activeByDefault</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">activeByDefault</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--当匹配的jdk被检测到，profile被激活。例如，1.4激活JDK1.4，1.4.0_2，而!1.4激活所有版本不是以1.4开头的JDK。 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">jdk</span>&gt;</span>1.5<span class="hljs-tag">&lt;/<span class="hljs-name">jdk</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--当匹配的操作系统属性被检测到，profile被激活。os元素可以定义一些操作系统相关的属性。 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">os</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--激活profile的操作系统的名字 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Windows XP<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--激活profile的操作系统所属家族(如 &#x27;windows&#x27;) --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">family</span>&gt;</span>Windows<span class="hljs-tag">&lt;/<span class="hljs-name">family</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--激活profile的操作系统体系结构 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">arch</span>&gt;</span>x86<span class="hljs-tag">&lt;/<span class="hljs-name">arch</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--激活profile的操作系统版本 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.2600<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">os</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--如果Maven检测到某一个属性（其值可以在POM中通过$&#123;name&#125;引用），其拥有对应的name = 值，Profile就会被激活。如果值字段是空的，那么存在属性名称字段就会激活profile，否则按区分大小写方式匹配属性值字段 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--激活profile的属性的名称 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>mavenVersion<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--激活profile的属性的值 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>2.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--提供一个文件名，通过检测该文件的存在或不存在来激活profile。missing检查文件是否存在，如果不存在则激活profile。另一方面，exists则会检查文件是否存在，如果存在则激活profile。 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--如果指定的文件存在，则激活profile。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exists</span>&gt;</span>$&#123;basedir&#125;/file2.properties<span class="hljs-tag">&lt;/<span class="hljs-name">exists</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--如果指定的文件不存在，则激活profile。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">missing</span>&gt;</span>$&#123;basedir&#125;/file1.properties<span class="hljs-tag">&lt;/<span class="hljs-name">missing</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">activation</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>注：在maven工程的pom.xml所在目录下执行<code>mvn help:active-profiles</code>命令可以查看中央仓储的profile是否在工程中生效。</p>
<h3 id="properties">Properties</h3>
<p>作用：对应profile的扩展属性列表。<br>
maven属性和ant中的属性一样，可以用来存放一些值。这些值可以在pom.xml中的任何地方使用标记${X}来使用，这里X是指属性的名称。属性有五种不同的形式，并且都能在settings.xml文件中访问。</p>
<ol>
<li><strong>env.X</strong>: 在一个变量前加上&quot;env.&quot;的前缀，会返回一个shell环境变量。例如，&quot;env.PATH&quot;指代了$path环境变量（在Windows上是%PATH%）。</li>
<li><strong>project.x</strong>：指代了POM中对应的元素值。例如: <code>&lt;project&gt;&lt;version&gt;1.0&lt;/version&gt;&lt;/project&gt;</code>通过<code>${project.version}</code>获得version的值。</li>
<li><strong>settings.x</strong>: 指代了settings.xml中对应元素的值。例如：<code>&lt;settings&gt;&lt;offline&gt;false&lt;/offline&gt;&lt;/settings&gt;</code>通过 <code>${settings.offline}</code>获得offline的值。</li>
<li><strong>Java System Properties</strong>: 所有可通过<code>java.lang.System.getProperties()</code>访问的属性都能在POM中使用该形式访问，例如 <code>${java.home}</code>。</li>
<li><strong>x</strong>: 在<code>&lt;properties/&gt;</code>元素中，或者外部文件中设置，以<code>${someVar}</code>的形式使用。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">user.install</span>&gt;</span>$&#123;user.home&#125;/our-project<span class="hljs-tag">&lt;/<span class="hljs-name">user.install</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>注：如果该profile被激活，则可以在pom.xml中使用<code>${user.install}</code>。</p>
<h3 id="repositories">Repositories</h3>
<p>作用：远程仓库列表，它是maven用来填充构建系统本地仓库所使用的一组远程仓库。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--包含需要连接到远程仓库的信息 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--远程仓库唯一标识 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>codehausSnapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--远程仓库名称 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Codehaus Snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--如何处理远程仓库里发布版本的下载 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br>      <span class="hljs-comment">&lt;!--true或者false表示该仓库是否为下载某种类型构件（发布版，快照版）开启。 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>      <span class="hljs-comment">&lt;!--该元素指定更新发生的频率。Maven会比较本地POM和远程POM的时间戳。这里的选项是：always（一直），daily（默认，每日），interval：X（这里X是以分钟为单位的时间间隔），或者never（从不）。 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span>&gt;</span>always<span class="hljs-tag">&lt;/<span class="hljs-name">updatePolicy</span>&gt;</span><br>      <span class="hljs-comment">&lt;!--当Maven验证构件校验文件失败时该怎么做-ignore（忽略），fail（失败），或者warn（警告）。 --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">checksumPolicy</span>&gt;</span>warn<span class="hljs-tag">&lt;/<span class="hljs-name">checksumPolicy</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--如何处理远程仓库里快照版本的下载。有了releases和snapshots这两组配置，POM就可以在每个单独的仓库中，为每种类型的构件采取不同的策略。例如，可能有人会决定只为开发目的开启对快照版本下载的支持。参见repositories/repository/releases元素 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">checksumPolicy</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--远程仓库URL，按protocol://hostname/path形式 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://snapshots.maven.codehaus.org/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--用于定位和排序构件的仓库布局类型-可以是default（默认）或者legacy（遗留）。Maven 2为其仓库提供了一个默认的布局；然而，Maven 1.x有一种不同的布局。我们可以使用该元素指定布局是default（默认）还是legacy（遗留）。 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span>default<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="pluginrepositories">PluginRepositories</h3>
<p>作用：发现插件的远程仓库列表。<br>
和repository类似，只是repository是管理jar包依赖的仓库，pluginRepositories则是管理插件的仓库。<br>
maven插件是一种特殊类型的构件。由于这个原因，插件仓库独立于其它仓库。pluginRepositories元素的结构和repositories元素的结构类似。每个pluginRepository元素指定一个Maven可以用来寻找新插件的远程地址。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">pluginRepositories</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- 包含需要连接到远程插件仓库的信息.参见profiles/profile/repositories/repository元素的说明 --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">pluginRepository</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">checksumPolicy</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">updatePolicy</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">checksumPolicy</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> /&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">pluginRepositories</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="activeprofiles">ActiveProfiles</h2>
<p>作用：手动激活profiles的列表，按照profile被应用的顺序定义activeProfile。<br>
该元素包含了一组activeProfile元素，每个activeProfile都含有一个profile id。任何在activeProfile中定义的profile id，不论环境设置如何，其对应的 profile都会被激活。如果没有匹配的profile，则什么都不会发生。<br>
例如，env-test是一个activeProfile，则在pom.xml（或者profile.xml）中对应id的profile会被激活。如果运行过程中找不到这样一个profile，Maven则会像往常一样运行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">settings</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">  <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/SETTINGS/1.0.0</span></span><br><span class="hljs-string"><span class="hljs-tag">                      https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span><br>  ...<br>  <span class="hljs-tag">&lt;<span class="hljs-name">activeProfiles</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 要激活的profile id --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">activeProfile</span>&gt;</span>env-test<span class="hljs-tag">&lt;/<span class="hljs-name">activeProfile</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">activeProfiles</span>&gt;</span><br>  ...<br><span class="hljs-tag">&lt;/<span class="hljs-name">settings</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h1>打包与 FatJar</h1>
<h2 id="什么是-fatjar">什么是 FatJar</h2>
<p>FatJar 又叫 uber-jar。uber 不是打车的 uber，而是德语里面的 uber，意思是英语里面的 over-勉强可以翻译为超越。</p>
<p>FatJar 是一个 all-in-one 的 jar，它可以让部署和运行更加便利，它让最终部署和运行的环境不依赖于任何 maven 或者 lib 的 classpath。</p>
<h2 id="fatjar-的三种具体类型">FatJar 的三种具体类型</h2>
<pre><code class="hljs mermaid">graph TB
    subgraph 普通JAR
        A1[META-INF]
        A2[com/example/*.class]
        A3[依赖外部classpath]
    end
    
    subgraph Unshaded FatJar
        B1[META-INF]
        B2[com/example/*.class]
        B3[org/apache/commons/*.class]
        B4[所有依赖解压平铺]
    end
    
    subgraph Shaded FatJar
        C1[META-INF]
        C2[com/example/*.class]
        C3[com/acme/shaded/apachecommons/*.class]
        C4[依赖类被重命名]
    end
    
    subgraph Spring Boot FatJar
        D1[META-INF]
        D2[BOOT-INF/classes/*.class]
        D3[BOOT-INF/lib/*.jar]
        D4[org/springframework/loader/*.class]
    end</code></pre>
<h3 id="非遮蔽的-unshaded-maven-assembly-plugin">非遮蔽的（Unshaded）—— maven-assembly-plugin</h3>
<p>依赖于<a target="_blank" rel="noopener" href="http://maven.apache.org/plugins/maven-assembly-plugin/">maven-assembly-plugin</a>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>assemble-all<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>single<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>descriptorRef 有：</p>
<ul>
<li>bin 只打包编译结果，并包含 README, LICENSE 和 NOTICE 文件，输出文件格式为 tar.gz, tar.bz2 和 zip。</li>
<li>jar-with-dependencies 打包编译结果，并带上所有的依赖，如果依赖的是 jar 包，jar 包会被解压开，平铺到最终的 uber-jar 里去。输出格式为 jar。</li>
<li>src 打包源码文件。输出格式为 tar.gz, tar.bz2 和 zip。</li>
<li>project 打包整个项目，除了部署输出目录 target 以外的所有文件和目录都会被打包。输出格式为 tar.gz, tar.bz2 和 zip。</li>
</ul>
<p>所有的 jar 都被 unpack，然后 repack。和 java 的缺省类加载器一起工作。</p>
<p>maven-assembly-plugin 也可以用于创建自定义分发包，将项目打包成 zip、tar.gz 等格式，包含配置文件、脚本等：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>single<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.Main<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="遮蔽的-shaded-maven-shade-plugin">遮蔽的（Shaded）—— maven-shade-plugin</h3>
<p>依赖于<a target="_blank" rel="noopener" href="http://maven.apache.org/plugins/maven-shade-plugin/">maven-shade-plugin</a>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-shade-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>shade<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relocations</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">relocation</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">shadedPattern</span>&gt;</span>com.acme.shaded.apachecommons<span class="hljs-tag">&lt;/<span class="hljs-name">shadedPattern</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">relocation</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">relocations</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">transformers</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">transformer</span> <span class="hljs-attr">implementation</span>=<span class="hljs-string">&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.Main<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">transformer</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">transformers</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>所有的 jar 都被 unpack，然后 repack，而且被<strong>刻意 rename（所以叫 shade）</strong>，以避免 dependency version clashes。这种 rename 会产生字节码级的变动，使得类的 package 变化。</p>
<p>和 java 的缺省类加载器一起工作。</p>
<p>shaded jar 依然有可能导致版本冲突，所以需要依赖 <a target="_blank" rel="noopener" href="http://maven.apache.org/plugins/maven-shade-plugin/examples/class-relocation.html">class-relocation</a> 解决类重定位的问题，依赖 <a target="_blank" rel="noopener" href="http://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html">Resource Transformers</a> 解决资源重定位的问题。</p>
<p>shaded jar  是为了解决这样的问题：</p>
<p>A 依赖 b/c，b/c依赖于 d 的两个版本。如果不产生 shaded，则 b 和 c 必有一段分支路径运行时失败。如果让 b 使用 shaded 过的 d，产生一个 shaded-b，则这个 shaded-b 本身包含引用了改名的 d，c 依赖于正常的 d，两段执行路径都可要正常运行完。</p>
<h3 id="jar-of-jars">JAR of JARs</h3>
<p>只是把 jar 打包在一起，jar 里有 jar。</p>
<p>我们常见的 maven package 无插件操作打出来的 jar 就是这种 jar。</p>
<p>默认的 fatjar 里不一定包含所有的依赖，所以需要使用插件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.jolira<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>onejar-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>one-jar<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>          <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="jar-的分类">Jar 的分类</h2>
<ul>
<li><strong>Skinny</strong> – Contains ONLY the bits you literally type into your code editor, and NOTHING else.</li>
<li><strong>Thin</strong> – Contains all of the above PLUS the app’s direct dependencies of your app (db drivers, utility libraries, etc).</li>
<li><strong>Hollow</strong> – The inverse of Thin – Contains only the bits needed to run your app but does NOT contain the app itself. Basically a pre-packaged “app server” to which you can later deploy your app, in the same style as traditional Java EE app servers, but with important differences.</li>
<li><strong>Fat/Uber</strong> – Contains the bit you literally write yourself PLUS the direct dependencies of your app PLUS the bits needed to run your app “on its own”.</li>
</ul>
<h2 id="spring-boot-与-fatjar">Spring Boot 与 FatJar</h2>
<p>实际上 Java 的原生类加载器处理普通的 Jar 里面的嵌套 class 是友好的，但处理嵌套的 jar 是不友好的。</p>
<p>Spring Boot 的 jar 就是 fatjar，这种 fatjar 携带所有依赖，而且有专有的类加载器来处理嵌套 jar 的依赖问题。这种 fatjar 是最简单的，运行起来最友好的。</p>
<p>分析依赖本来要逐层解压这种 jar-of-jars，但很多解析工具只解析一层的话，反而会被其他问题触发。例如，有时候为了解决依赖版本冲突而指定 jar 的版本，而直接在一个多模块的 parent pom 里面短路地指定了一个依赖版本，反而会触发解析工具的检测规则。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.1.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>repackage<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 使用本插件打包非 Spring-Boot 专有程序 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span>&gt;</span>ZIP<span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">requiresUnpack</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jruby<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jruby-complete<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">requiresUnpack</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>这样会打印出两个 jar，一个 jar 是普通 jar，另一个 jar 是 jar.original。第二个 jar 是原始 jar，而第一个 jar 则是大而全的真正的 fat-jar。</p>
<h1>测试与覆盖率</h1>
<h2 id="apache-maven-surefire">Apache Maven Surefire</h2>
<p>Apache Maven Surefire 本身是一个测试框架。Maven Surefire Plugin 和 Maven Failsafe Plugin 都是这个项目的模块。</p>
<h3 id="surefire-插件">Surefire 插件</h3>
<p>Surefire 是在 maven 的构建生命周期里面，test phase 执行单元测试的插件。<br>
Surefire 的意思是&quot;完全，一定成功的&quot;。任何单元测试失败，都会导致构建失败。<br>
Surefire 跑测试失败，会在现场留下名如hs_err*的文件。</p>
<h4 id="用法">用法</h4>
<p>这个插件只有一个 goal，就是 test。</p>
<p>因此，使用它都不需要配置什么 configuration 和 phase。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.22.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>它默认就会在 test phase 被执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn <span class="hljs-built_in">test</span><br></code></pre></td></tr></table></figure>
<p>不管底层的 test provider 是 JUnit 还是 TestNG，甚至只是一个 pojo，它都可以运行测试。</p>
<p>对于pojo，插件可以自动运行类里面的 public testxxx 方法，也可以使用 JDK 1.4 时代以后使用的断言。</p>
<p>对于 JUnit 之类的 test provider，可以使用以下配置进行并行测试：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.22.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">parallel</span>&gt;</span>methods<span class="hljs-tag">&lt;/<span class="hljs-name">parallel</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">threadCount</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">threadCount</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h4 id="类路径太长问题">类路径太长问题</h4>
<p>整体而言，就是有些 OS 的命令行不允许太长的类路径。</p>
<p>解决这个问题的思路是，不在命令行内传递类路径，而使用进程内部的参数传递机制。由此诞生的解决方案有：</p>
<ol>
<li>
<p><strong>单独的类加载器</strong>。这样可以通过执行一个伪的 booter 程序来绕开类路径的直接限制，在程序内部再 load 我们的目标程序。这个方法也有缺点。首先，<code>java.class.path</code> 这个系统变量不会包括启动 jar。如果应用程序需要关心这个点，可能会导致问题。其次，程序内部可能会调用<code>Classloader.getSystemClassLoader()</code>而不是使用缺省的类加载器（也就是我们这个 isolated 类加载器）来加载特定的类。</p>
</li>
<li>
<p><strong>使用一个 Manifest-Only 的 Jar</strong>。这个 Jar 几乎为空，只有一个MANIFEST.MF 文件。JVM 会把这个清单文件里的类路径 honor 起来当做 directive。比如我们可以用一个单独的 Class-Path 的 attribute 来填写我们的很长的类路径。</p>
</li>
</ol>
<h3 id="failsafe-插件">Failsafe 插件</h3>
<p>Failsafe 是在 maven 的构建生命周期里面，test phase 执行集成测试的插件。<br>
Failsafe 看起来是 Surefire 的同义词，但事实上它使用更安全的方式运作。集成测试的失败，和构建过程解耦了，构建不会因此失败。</p>
<p>与 surefire-plugin 的区别在于：</p>
<ul>
<li><strong>surefire-plugin</strong>：运行单元测试（<code>*Test.java</code>）</li>
<li><strong>failsafe-plugin</strong>：运行集成测试（<code>*IT.java</code>）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-failsafe-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0-M7<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>integration-test<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>verify<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="jacoco">JaCoCo</h2>
<p>JaCoCo 本质上是是一个 java agent，基于 Java 的 Instrumentation API。可以对类文件进行 on-the-fly 的 instrumentation。它是在 class loading 的阶段通过 in memory 字节码增强的形式，进行类型补强。</p>
<p>JaCoCo 本身支持三种数据采集模式：</p>
<ul>
<li>写入文件系统</li>
<li>作为一个 server 让其他客户端采集</li>
<li>作为一个 client 去连接某个 TCP 端点获取数据</li>
</ul>
<p>JMX 的接口本身是没有鉴权和授权机制的，所以使用的时候要分清什么是 trusted server。</p>
<h3 id="jacoco-java-agent">JaCoCo java agent</h3>
<p>JaCoCo 以一个 jar 的形式发布。<a target="_blank" rel="noopener" href="https://www.eclemma.org/jacoco/trunk/index.html">下载地址</a>，注意它的发布包有 osgi bundle的版本。当做 javaagent 使用，我们应该使用jacocoagent.jar，如果使用它的命令行接口，我们应该使用 jacococli.jar。它遵循通常的 Java agent 的启动命令语法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">-javaagent:[yourpath/]jacocoagent.jar=[option1]=[value1],[option2]=[value2]<br></code></pre></td></tr></table></figure>
<p>javaagent 可用的 options 见这个<a target="_blank" rel="noopener" href="https://www.eclemma.org/jacoco/trunk/doc/agent.html">表格</a>。</p>
<h3 id="jacoco-maven-plugin">JaCoCo Maven plugin</h3>
<p>要使用 jacoco 的插件，第一步是获取 maven 的的引用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.8.3-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>这个插件自带的 goal 分别是：</p>
<ul>
<li>help</li>
<li>prepare-agent(最重要的 goal，大部分情况下只使用这个 goal)</li>
<li>prepare-agent-integration</li>
<li>merge</li>
<li>report-aggregate</li>
<li>check</li>
<li>dump</li>
<li>instrument</li>
<li>restore-instrumented-classes</li>
</ul>
<p>使用这个插件最起码要配的属性：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- pom 全局的 properties --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- test相关，解决sonar上独立集成测试工程得不到测试覆盖率的问题 --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">sonar.core.codeCoveragePlugin</span>&gt;</span>jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">sonar.core.codeCoveragePlugin</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">sonar.dynamicAnalysis</span>&gt;</span>reuseReports<span class="hljs-tag">&lt;/<span class="hljs-name">sonar.dynamicAnalysis</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">sonar.jacoco.itReportPath</span>&gt;</span>target/jacoco-it.exec<span class="hljs-tag">&lt;/<span class="hljs-name">sonar.jacoco.itReportPath</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">sonar.jacoco.reportPath</span>&gt;</span>target/jacoco-ut.exec<span class="hljs-tag">&lt;/<span class="hljs-name">sonar.jacoco.reportPath</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- jacoco 是一定要全局配置一个输出 report 的路径的，这里的 jacoco-ut.exec 不是一个可执行文件，而是一个 report 的destFile --&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">jacoco.path</span>&gt;</span>$&#123;project.build.directory&#125;/jacoco-ut.exec<span class="hljs-tag">&lt;/<span class="hljs-name">jacoco.path</span>&gt;</span><br>		<span class="hljs-tag">&lt;<span class="hljs-name">jacoco.skip</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">jacoco.skip</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>然后在使用插件的时候，我们引用了这个 path</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.6.0.201210061924<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 这个到底有什么用，存疑。仅仅是越过 jacoco 当前的执行吗？ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">skip</span>&gt;</span>$&#123;jacoco.skip&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">skip</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 复用刚才的数据落点资料 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">destFile</span>&gt;</span>$&#123;jacoco.path&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">destFile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dataFile</span>&gt;</span>$&#123;jacoco.path&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">dataFile</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">sessionId</span>&gt;</span>jacoco_coverage<span class="hljs-tag">&lt;/<span class="hljs-name">sessionId</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>pre-test<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-comment">&lt;!--在 compile 完成后，处理类的 phase--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>process-classes<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- 准备 agent --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>prepare-agent<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- 配置好的 agent，要准备放到这个 maven property 里面，这样就可以被其他插件（特别是测试用的 surefire 插件）复用 --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">propertyName</span>&gt;</span>coverageAgent<span class="hljs-tag">&lt;/<span class="hljs-name">propertyName</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>上面这个 goal 的主要用处就是准备一个 maven property，用来给其他插件作为 VM argument。在这个例子里，argLine 是一个专门为 surefire 准备的 maven property。</p>
<h3 id="surefire-与-jacoco-集成">Surefire 与 JaCoCo 集成</h3>
<p>surefire 插件本身就可以把 JaCoCo 生成的 maven property 内插进自己的命令行参数里面：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.12.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">argLine</span>&gt;</span>-Xmx1024m -XX:PermSize=256m -XX:MaxPermSize=256m<br>            $&#123;coverageAgent&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">argLine</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">testFailureIgnore</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">testFailureIgnore</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*Test*.java<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>更详细的配置（包含如何写 report）见 <a target="_blank" rel="noopener" href="https://www.petrikainulainen.net/programming/maven/creating-code-coverage-reports-for-unit-and-integration-tests-with-the-jacoco-maven-plugin/">Creating Code Coverage Reports for Unit and Integration Tests</a>。</p>
<h1>参考资料</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://maven.apache.org/ref/3.5.4/maven-core/default-bindings.html">Plugin Bindings for default Lifecycle Reference</a></li>
<li><a target="_blank" rel="noopener" href="https://maven.apache.org/guides/mini/guide-configuring-plugins.html">Guide to Configuring Plug-ins</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8420561/what-is-mojo-in-maven">What is MOJO in Maven?</a></li>
<li><a target="_blank" rel="noopener" href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">Introduction to the Dependency Mechanism</a></li>
<li><a target="_blank" rel="noopener" href="http://maven.apache.org/guides/introduction/introduction-to-optional-and-excludes-dependencies.html">Optional Dependencies and Dependency Exclusions</a></li>
<li><a target="_blank" rel="noopener" href="https://www.baeldung.com/maven-dependency-latest-version">Use the Latest Version of a Dependency in Maven</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/110d897a5442">Maven 全局配置文件settings.xml详解</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/100439269148">重新看待Jar包冲突问题及解决方案</a></li>
<li><a target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/630208?utm_content=m_1000014409">Java 打包 FatJar 方法小结</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/11947037/what-is-an-uber-jar">What is an uber jar?</a></li>
<li><a target="_blank" rel="noopener" href="https://luyiisme.github.io/2017/01/16/fatjar/">可执行的uberJar (fatJar)</a></li>
<li><a target="_blank" rel="noopener" href="https://mrhaki.blogspot.com/2019/04/gradle-goodness-use-bill-of-materials.html">Gradle BOM</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7145f01ac3ad">Maven依赖中scope的含义</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/xhyzjiji/article/details/72731276">maven scope-provided 与 optional 区别</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/28986005/what-is-the-difference-between-the-maven-surefire-and-maven-failsafe-plugins">What is the difference between the Maven Surefire and Maven Failsafe plugins?</a></li>
<li><a target="_blank" rel="noopener" href="https://www.eclemma.org/jacoco/trunk/doc/agent.html">JaCoCo Agent Options</a></li>
<li><a target="_blank" rel="noopener" href="https://www.eclemma.org/jacoco/trunk/doc/maven.html">JaCoCo Maven Plugin</a></li>
<li><a target="_blank" rel="noopener" href="https://www.petrikainulainen.net/programming/maven/creating-code-coverage-reports-for-unit-and-integration-tests-with-the-jacoco-maven-plugin/">Creating Code Coverage Reports</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://magicliang.github.io">magicliang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/">https://magicliang.github.io/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Maven/">Maven</a></div><div class="post-share"><div class="social-share" data-image="/2026/02/07/Maven-%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/maven-on-macos.gif" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2017/10/23/%E6%98%82%E8%B4%B5%E7%9A%84%E5%BC%82%E5%B8%B8/" title="昂贵的异常"><img class="cover" src="/img/wall-paper-55.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-23</div><div class="info-item-2">昂贵的异常</div></div><div class="info-2"><div class="info-item-1">抛出问题 Joshua Bloch 在《Effective Java》的 Item 57 里明确地提到过，不要试图用 Exception 的跳转来代替正常的程序控制流。他列举了很多原因，但特别提到了抛出异常会使得整个程序运行变慢。抛出异常远比普通的 return、break 等操作对控制流、数据流的性能影响要大，它就只适合拿来作异常分支的控制语句，而不能拿来编写正常的逻辑。  Throwing exception is expensive.  这句话在 Java 的程序员世界里面已经成为老生常谈，却很少有人谈及到底抛出异常比正常的程序跳转返回慢在哪里，有多慢。&quot;不要滥用异常&quot;好像一个猴子定律，人们知道不能这么做，却不明白为什么不能这么做。 此前读了一位同事写的好文《Java虚拟机是如何处理异常的》，深入地分析了 JVM 对异常跳转的处理过程：JVM 会通过异常表的机制，优化异常抛出和正常返回之间的性能差异。仅从程序计数器的移动上来讲，抛出一个异常对栈帧的弹栈并不比直接返回更昂贵。写在前头的结论是：&quot;try-catch 语句块几乎不会影响程序运行性能！...</div></div></div></a><a class="pagination-related" href="/2017/11/30/Java%E4%B8%AD%E7%9A%84%E5%B9%BD%E7%81%B5%E7%B1%BB%E5%9E%8B/" title="Java中的幽灵类型"><img class="cover" src="/img/wall-paper-27.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-11-30</div><div class="info-item-2">Java中的幽灵类型</div></div><div class="info-2"><div class="info-item-1">什么是幽灵类型 先上结论：幽灵类型（Phantom Type）顾名思义，就是幽灵般的类型，这种类型往往在运行时可以消失，因为在运行时没有任何作用，它们最大的特点就是没有任何实例（Java 的 Void 就是一个不可实例化类型的例子，常被用作幽灵类型的类型参数，如 Future&lt;Void&gt;）。幽灵类型是一种可以把有些运行时才能检测到的错误，在编译时检测出来的技巧。按照有些老外的观点，就是&quot;Making Wrong Code Look Wrong&quot;。在面向对象的编程语言之中，幽灵类型的实现，往往与状态模式较为接近，但比状态模式提供了更强的纠错功能。在 Java 5 以后的版本里，程序员可以使用泛型。通过泛型的类型参数，Java 中也拥有了幽灵类型的能力。 上面的阐述是不是很难看懂？直接进入具体的例子。假设有一个飞机控制程序，操作飞机起飞或者落地。这个程序有一个非常强的业务约束，就是必须保证飞机一开始必须出现在地上，只有在地上的飞机可以起飞，只有起飞的飞机可以落地，那么应该怎样设计程序（主要是类型关系），来保证这个约束必然成立呢？ 定义状态接口 先来定义...</div></div></div></a><a class="pagination-related" href="/2018/05/29/JPA-%E7%9A%84-id-%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/" title="JPA 的 id 生成策略"><img class="cover" src="/img/wall-paper-175.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-05-29</div><div class="info-item-2">JPA 的 id 生成策略</div></div><div class="info-2"><div class="info-item-1">JPA 有一个@GeneratedValue注解，有一个strategy attribute，如 @GeneratedValue(strategy = GenerationType.IDENTITY)。 常见的可选策略主要有IDENTITY和SEQUENCE。 GenerationType.IDENTITY 要求底层有一个 integer 或者 bigint 类型的自增列（ auto-incremented column)。自增列的赋值必须在插入操作之后发生，因为这个原因，Hibernate 无法进行各种优化（特别是 JDBC 的 batch 处理，一次 flush 操作会产生很多条insert 语句，分别执行）。如果事务回滚，自增列的值就会被丢弃。数据库在这个自增操作上有个高度优化的轻量级锁机制，性能非常棒。 MySQL 支持这种 id 生成策略， 使用 MySQL 应该尽量使用这个策略，即使它无法优化。 JPA 用它生成 id，会一条一条地插入新的 entity。 GenerationType.SEQUENCE 数据库有一个所谓的 sequence 对象，可以通过 selec...</div></div></div></a><a class="pagination-related" href="/2018/06/19/%E5%A6%82%E4%BD%95%E5%81%9A%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8B%E7%9A%84%E7%AD%94%E6%A1%88/" title="如何做性能测试的问题下的答案"><img class="cover" src="/img/wall-paper-26.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-19</div><div class="info-item-2">如何做性能测试的问题下的答案</div></div><div class="info-2"><div class="info-item-1">试着回答一下这个问题。 首先要划分系统类型：有状态还是无状态，业务系统还是存储系统。根据不同的业务场景，设立性能测试的目标：是要测 QPS，还是 TPS 还是 TPS，还是任何其他【性能】-从广义来讲，一个存储系统到底能够以多高的平均时延来管理大多的存储空间，可能也是性能的一种。 有了性能测试的目标，接下来就是拆解用例。如果把性能测试归为测试的话，测试就需要测试用例，测试用例只是用例的形式化表达。把用户的使用场景勾勒出来，把每一步拆解成的流程图或者时序图–我们已经得到了一个纸上的集成测试计划，只是没有跟性能挂上钩。 接下来就进入真正写测试用例的环节了。 我们的测试报告如果要涵盖足够立体的信息，则既要了解每一个环节/接口/API 的性能指标，又要了解整体的性能指标。 这个时候测试工具的覆盖面就很重要了。如果我们选择偏黑盒的测试工具，apache ab /JMeter，则我们的测试用例就要围绕着对外交互的 API写，也只能测到外围接口的性能。这样的测试用例写起来最简单，无需侵入任何内部代码中。 如果我们使用了 JMH 一类的工具，则可以自由编写对任何方法的测试用例。但需要对系统有非常...</div></div></div></a><a class="pagination-related" href="/2018/09/07/%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4/" title="日期与时间"><img class="cover" src="/img/wall-paper-58.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-09-07</div><div class="info-item-2">日期与时间</div></div><div class="info-2"><div class="info-item-1">JSR 310 Java Date与Time API 新旧 API 的更迭 旧的 Java API 主要包括java.util.Date和java.util.Calendar 两个包的内容。这两个包的时间类型是可变的。如 Date 的实例可以通过 setYear 来产生变化。 JSR 310 中包括的日期类型主要有：  计算机时间：Instant，对应 java.util.Date，它代表了一个确定的时间点，即相对于标准Java纪元（1970年1月1日）的偏移量；但与java.util.Date类不同的是其精确到了纳秒级别。 人类时间：对应于人类自身的观念，比如LocalDate和LocalTime。他们代表了一般的时区概念，要么是日期（不包含时间），要么是时间（不包含日期），类似于java.sql的表示方式。此外，还有一个MonthDay，它可以存储某人的生日（不包含年份）。每个类都在内部存储正确的数据而不是像java.util.Date那样利用午夜12点来区分日期，利用1970-01-01来表示时间。这些类型的实例是 immutable 的，而且只能通过工厂方法创建。  时区...</div></div></div></a><a class="pagination-related" href="/2018/10/22/JDWP-%E4%B8%8E%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95/" title="JDWP 与远程调试"><img class="cover" src="/img/wall-paper-179.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-22</div><div class="info-item-2">JDWP 与远程调试</div></div><div class="info-2"><div class="info-item-1">JDWP（Java Debug Wire Protocol），它提供了调试器和目标 JVM （target vm）之间的调试协议。 在 target vm 启动时，增加这个 JAVA_OPTS： 1JAVA_OPTS=&quot;-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=26310&quot; 在服务器端，增加 remote debuging 的时候使用如下配置： 12345678# Java 9 以上-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000# Java 5-8-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8000# Java 1.4.x -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,addre...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">构建生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">构建生命周期的基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%9E%84%E5%BB%BA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%98%AF%E7%94%B1%E5%A4%9A%E4%B8%AA%E9%98%B6%E6%AE%B5%E7%BB%84%E6%88%90%E7%9A%84"><span class="toc-number">1.1.1.</span> <span class="toc-text">一个构建生命周期是由多个阶段组成的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-number">1.1.2.</span> <span class="toc-text">使用命令行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%8F%E4%B8%80%E4%B8%AA%E6%9E%84%E5%BB%BA-phase-%E6%98%AF%E7%94%B1%E6%9E%84%E5%BB%BA-goal-%E7%BB%84%E6%88%90%E7%9A%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">每一个构建 phase 是由构建 goal 组成的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9D%A5%E4%BD%BF%E7%94%A8%E6%9E%84%E5%BB%BA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.2.</span> <span class="toc-text">设置你的项目来使用构建生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#packaging"><span class="toc-number">1.2.1.</span> <span class="toc-text">packaging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6%E6%9E%84%E5%BB%BA%E7%9A%84%E8%AF%AD%E8%A8%80%E7%89%88%E6%9C%AC"><span class="toc-number">1.2.2.</span> <span class="toc-text">如何控制构建的语言版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plugins"><span class="toc-number">1.2.3.</span> <span class="toc-text">plugins</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maven-wrapper"><span class="toc-number">1.3.</span> <span class="toc-text">Maven Wrapper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-maven-wrapper"><span class="toc-number">1.3.1.</span> <span class="toc-text">使用 Maven Wrapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maven-wrapper-%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.3.2.</span> <span class="toc-text">Maven Wrapper 的优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-maven-%E7%89%88%E6%9C%AC"><span class="toc-number">1.3.3.</span> <span class="toc-text">配置 Maven 版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%89%A7%E8%A1%8C"><span class="toc-number">1.4.</span> <span class="toc-text">多模块项目中的生命周期执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%9E%84%E5%BB%BA%E8%8C%83%E5%9B%B4"><span class="toc-number">1.4.3.</span> <span class="toc-text">控制构建范围</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#profile-%E4%B8%8E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.5.</span> <span class="toc-text">Profile 与生命周期的关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-profile"><span class="toc-number">1.5.1.</span> <span class="toc-text">定义 Profile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BF%80%E6%B4%BB-profile"><span class="toc-number">1.5.2.</span> <span class="toc-text">激活 Profile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#profile-%E4%B8%AD%E7%9A%84%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.3.</span> <span class="toc-text">Profile 中的插件配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%B3%E8%BF%87%E6%B5%8B%E8%AF%95%E7%9A%84%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">跳过测试的多种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8-maven-test-skip"><span class="toc-number">1.6.1.</span> <span class="toc-text">方式一：使用 maven.test.skip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8-skiptests"><span class="toc-number">1.6.2.</span> <span class="toc-text">方式二：使用 skipTests</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9A%E4%BD%BF%E7%94%A8-surefire-%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.3.</span> <span class="toc-text">方式三：使用 surefire 插件配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maven-3-x-%E4%B8%8E-maven-4-x-%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="toc-number">1.7.</span> <span class="toc-text">Maven 3.x 与 Maven 4.x 的差异</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.7.1.</span> <span class="toc-text">性能优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-number">1.7.2.</span> <span class="toc-text">依赖管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span class="toc-number">1.7.3.</span> <span class="toc-text">用户界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">1.7.4.</span> <span class="toc-text">兼容性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%8F%82%E8%80%83"><span class="toc-number">1.8.</span> <span class="toc-text">生命周期参考</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#clean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%9A%84-phases"><span class="toc-number">1.8.1.</span> <span class="toc-text">clean 生命周期的 phases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#default-%E7%9A%84-phases"><span class="toc-number">1.8.2.</span> <span class="toc-text">default 的 phases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#site-%E7%9A%84-phases"><span class="toc-number">1.8.3.</span> <span class="toc-text">site 的 phases</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">插件配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mojo-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.</span> <span class="toc-text">mojo 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.</span> <span class="toc-text">通用配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%B8%AE%E5%8A%A9"><span class="toc-number">2.2.1.</span> <span class="toc-text">查看帮助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">2.2.2.</span> <span class="toc-text">配置参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.2.1.</span> <span class="toc-text">普通类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">复杂类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">列表类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#map-%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">map 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#properties-%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">Properties 类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9E%84%E5%BB%BA%E6%8F%92%E4%BB%B6"><span class="toc-number">2.3.</span> <span class="toc-text">配置构建插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-executions-%E6%A0%87%E7%AD%BE"><span class="toc-number">2.3.1.</span> <span class="toc-text">使用&lt;executions&gt;标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-dependencies-%E6%A0%87%E7%AD%BE"><span class="toc-number">2.3.2.</span> <span class="toc-text">使用&lt;dependencies&gt;标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%9E%84%E5%BB%BA%E6%8F%92%E4%BB%B6%E9%87%8C%E4%BD%BF%E7%94%A8-inherited-%E6%A0%87%E7%AD%BE"><span class="toc-number">2.3.3.</span> <span class="toc-text">在构建插件里使用&lt;inherited&gt;标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-reporting-%E6%8F%92%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">配置 reporting 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-reporting-tag-vs-build-tag"><span class="toc-number">2.4.1.</span> <span class="toc-text">使用 &lt;reporting&gt; Tag VS &lt;build&gt; Tag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-reportsets-%E6%A0%87%E7%AD%BE"><span class="toc-number">2.4.2.</span> <span class="toc-text">使用&lt;reportSets&gt;标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%8A%A5%E5%91%8A%E6%8F%92%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8-inherited-%E6%A0%87%E7%AD%BE"><span class="toc-number">2.4.3.</span> <span class="toc-text">在报告插件中使用&lt;inherited&gt;标签</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">依赖管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#maven-%E7%9A%84%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BE%9D%E8%B5%96%E6%98%AF%E5%8D%95%E6%A0%B9%E7%BB%A7%E6%89%BF%E7%9A%84"><span class="toc-number">3.1.</span> <span class="toc-text">Maven 的配置和依赖是单根继承的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dependencies-%E4%B8%8E-dependencymanagement-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.2.</span> <span class="toc-text">dependencies 与 dependencyManagement 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E6%95%88-pom"><span class="toc-number">3.3.</span> <span class="toc-text">有效 pom</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96%E4%B8%AD%E7%9A%84%E6%BA%90%E7%A0%81%E5%92%8C%E6%96%87%E6%A1%A3"><span class="toc-number">3.4.</span> <span class="toc-text">下载依赖中的源码和文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bom-bill-of-material"><span class="toc-number">3.5.</span> <span class="toc-text">BOM（Bill of Material）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bom%E5%AE%9A%E4%B9%89"><span class="toc-number">3.5.1.</span> <span class="toc-text">BOM定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8bom"><span class="toc-number">3.5.2.</span> <span class="toc-text">为什么要使用bom</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scope-%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-number">3.6.</span> <span class="toc-text">scope 的含义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#compile-%E9%BB%98%E8%AE%A4"><span class="toc-number">3.6.1.</span> <span class="toc-text">compile（默认）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#provided"><span class="toc-number">3.6.2.</span> <span class="toc-text">provided</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#runtime"><span class="toc-number">3.6.3.</span> <span class="toc-text">runtime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#test"><span class="toc-number">3.6.4.</span> <span class="toc-text">test</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#system"><span class="toc-number">3.6.5.</span> <span class="toc-text">system</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#import"><span class="toc-number">3.6.6.</span> <span class="toc-text">import</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scope%E7%9A%84%E4%BE%9D%E8%B5%96%E4%BC%A0%E9%80%92"><span class="toc-number">3.7.</span> <span class="toc-text">scope的依赖传递</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scope-%E4%B8%8E-optional-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.8.</span> <span class="toc-text">scope 与 optional 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%8E%92%E9%99%A4%E4%B8%8E-debug-%E6%8A%80%E5%B7%A7"><span class="toc-number">3.9.</span> <span class="toc-text">依赖排除与 debug 技巧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#maven-enforcer-plugin-%E8%A7%A3%E5%86%B3%E5%8C%85%E5%86%B2%E7%AA%81"><span class="toc-number">3.10.</span> <span class="toc-text">maven-enforcer-plugin 解决包冲突</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA"><span class="toc-number">3.10.1.</span> <span class="toc-text">执行时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dependencyconvergence%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91"><span class="toc-number">3.10.2.</span> <span class="toc-text">dependencyConvergence执行逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="toc-number">3.10.3.</span> <span class="toc-text">配置实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%A3%80%E9%AA%8C"><span class="toc-number">3.10.4.</span> <span class="toc-text">快速检验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4%E5%86%B2%E7%AA%81jar"><span class="toc-number">3.10.5.</span> <span class="toc-text">移除冲突jar</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#versions-maven-plugin-%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="toc-number">3.11.</span> <span class="toc-text">versions-maven-plugin 版本管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">全局配置 settings.xml</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E4%B8%8E%E9%A1%B6%E5%B1%82%E5%85%83%E7%B4%A0"><span class="toc-number">4.1.</span> <span class="toc-text">文件结构与顶层元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#localrepository"><span class="toc-number">4.2.</span> <span class="toc-text">LocalRepository</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#interactivemode"><span class="toc-number">4.3.</span> <span class="toc-text">InteractiveMode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#offline"><span class="toc-number">4.4.</span> <span class="toc-text">Offline</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#plugingroups"><span class="toc-number">4.5.</span> <span class="toc-text">PluginGroups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#servers"><span class="toc-number">4.6.</span> <span class="toc-text">Servers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mirrors"><span class="toc-number">4.7.</span> <span class="toc-text">Mirrors</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#proxies"><span class="toc-number">4.8.</span> <span class="toc-text">Proxies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#profiles-settings-xml-%E7%89%88"><span class="toc-number">4.9.</span> <span class="toc-text">Profiles（settings.xml 版）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%E4%B8%8E%E5%8F%91%E5%B8%83"><span class="toc-number">4.9.1.</span> <span class="toc-text">快照与发布</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#activation"><span class="toc-number">4.9.2.</span> <span class="toc-text">Activation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#properties"><span class="toc-number">4.9.3.</span> <span class="toc-text">Properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#repositories"><span class="toc-number">4.9.4.</span> <span class="toc-text">Repositories</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pluginrepositories"><span class="toc-number">4.9.5.</span> <span class="toc-text">PluginRepositories</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#activeprofiles"><span class="toc-number">4.10.</span> <span class="toc-text">ActiveProfiles</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">打包与 FatJar</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-fatjar"><span class="toc-number">5.1.</span> <span class="toc-text">什么是 FatJar</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fatjar-%E7%9A%84%E4%B8%89%E7%A7%8D%E5%85%B7%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.2.</span> <span class="toc-text">FatJar 的三种具体类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E9%81%AE%E8%94%BD%E7%9A%84-unshaded-maven-assembly-plugin"><span class="toc-number">5.2.1.</span> <span class="toc-text">非遮蔽的（Unshaded）—— maven-assembly-plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%AE%E8%94%BD%E7%9A%84-shaded-maven-shade-plugin"><span class="toc-number">5.2.2.</span> <span class="toc-text">遮蔽的（Shaded）—— maven-shade-plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jar-of-jars"><span class="toc-number">5.2.3.</span> <span class="toc-text">JAR of JARs</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jar-%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">5.3.</span> <span class="toc-text">Jar 的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-boot-%E4%B8%8E-fatjar"><span class="toc-number">5.4.</span> <span class="toc-text">Spring Boot 与 FatJar</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">测试与覆盖率</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#apache-maven-surefire"><span class="toc-number">6.1.</span> <span class="toc-text">Apache Maven Surefire</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#surefire-%E6%8F%92%E4%BB%B6"><span class="toc-number">6.1.1.</span> <span class="toc-text">Surefire 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">6.1.1.1.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E8%B7%AF%E5%BE%84%E5%A4%AA%E9%95%BF%E9%97%AE%E9%A2%98"><span class="toc-number">6.1.1.2.</span> <span class="toc-text">类路径太长问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#failsafe-%E6%8F%92%E4%BB%B6"><span class="toc-number">6.1.2.</span> <span class="toc-text">Failsafe 插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jacoco"><span class="toc-number">6.2.</span> <span class="toc-text">JaCoCo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jacoco-java-agent"><span class="toc-number">6.2.1.</span> <span class="toc-text">JaCoCo java agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jacoco-maven-plugin"><span class="toc-number">6.2.2.</span> <span class="toc-text">JaCoCo Maven plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#surefire-%E4%B8%8E-jacoco-%E9%9B%86%E6%88%90"><span class="toc-number">6.2.3.</span> <span class="toc-text">Surefire 与 JaCoCo 集成</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">簡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>