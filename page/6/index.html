<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>守株阁 - 一切都是守株待兔，如切如磋，如琢如磨。I am just joking.</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="关于技术以及人生">
<meta property="og:type" content="website">
<meta property="og:title" content="守株阁">
<meta property="og:url" content="https://magicliang.github.io/page/6/index.html">
<meta property="og:site_name" content="守株阁">
<meta property="og:description" content="关于技术以及人生">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/img/rei.jpeg">
<meta property="article:author" content="magicliang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/img/rei.jpeg"><script type="application/ld+json"></script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/page/6/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: 守株阁","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '守株阁',
  isHighlightShrink: false,
  isToc: false,
  pageType: 'home'
}</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="守株阁" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url(/img/eva-wallpaper.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">守株阁</span></a></span><div id="menus"></div></nav><div id="site-info"><h1 id="site-title">守株阁</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/magicliang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:magicliang@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts nc" id="recent-posts"><div class="recent-post-items"><div class="recent-post-item"><div class="post_cover left"><a href="/2022/05/12/Dapper-%E8%AE%BA%E6%96%87/" title="Dapper 论文"><img class="post-bg" src="/2022/05/12/Dapper-%E8%AE%BA%E6%96%87/img1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dapper 论文"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/05/12/Dapper-%E8%AE%BA%E6%96%87/" title="Dapper 论文">Dapper 论文</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-05-12T08:28:59.000Z" title="Created 2022-05-12 16:28:59">2022-05-12</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:08.262Z" title="Updated 2026-01-24 15:32:08">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%BF%BD%E8%B8%AA/">分布式追踪</a></span></div><div class="content"> 参考译文 dapper分布式跟踪系统原文  概述 当代的互联网的服务，通常都是用复杂的、大规模分布式集群来实现的。互联网应用构建在不同的软件模块集上，这些软件模块，有可能是由不同的团队开发、可能使用不同的编程语言来实现、有可能部署在了几千台服务器，横跨多个不同的数据中心。因此，就需要一些可以帮助理解系统行为、用于分析性能问题的工具。 Dapper–Google生产环境下的分布式跟踪系统，应运而生。那么我们就来介绍一个大规模集群的跟踪系统，它是如何满足一个低开销、应用透明的、大范围部署这三个需求的。当然Dapper设计之初，参考了一些其他分布式系统的理念，尤其是Magpie和X-Trace，但是我们之所以能成功应用在生产环境上，还需要一些画龙点睛之笔，例如采样率的使用以及把代码植入限制在一小部分公共库的改造上。 介绍 我们开发Dapper是为了收集更多的复杂分布式系统的行为信息，然后呈现给Google的开发者们。这样的分布式系统有一个特殊的好处，因为那些大规模的低端服务器，作为互联网服务的载体，是一个特殊的经济划算的平台。想要在这个上下文中理解分布式系统的行为，就需要监控那些横跨...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/05/10/%E9%87%8D%E5%86%99-ELK-%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF/" title="重写 ELK 相关信息"><img class="post-bg" src="/2022/05/10/%E9%87%8D%E5%86%99-ELK-%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF/elasticsearch.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="重写 ELK 相关信息"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/05/10/%E9%87%8D%E5%86%99-ELK-%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF/" title="重写 ELK 相关信息">重写 ELK 相关信息</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-05-10T10:04:53.000Z" title="Created 2022-05-10 18:04:53">2022-05-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:08.245Z" title="Updated 2026-01-24 15:32:08">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Elasticsearch/">Elasticsearch</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Logstash/">Logstash</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Kibana/">Kibana</a></span></div><div class="content">ELK in docker 官方文档见：《Running the Elastic Stack (“ELK”) on Docker》 Start Elasticsearch and Kibana in Docker 任意在容器中启动的单节点 Elasticsearch 集群都会 security will be automatically enabled and configured for you。这包括：  证书和key会在配置目录下自动生成。Certificates and keys are generated for the transport and HTTP layers.``When you install Elasticsearch, the following certificates and keys are generated in the Elasticsearch configuration directory, which are used to connect a Kibana instance to your secured Elasticsearc...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/05/10/%E4%B8%80%E4%B8%AA%E9%9A%90%E8%97%8F%E4%BA%8617%E5%B9%B4%E7%9A%84-JDK-Bug/" title="一个隐藏了17年的 JDK Bug"><img class="post-bg" src="/2022/05/10/%E4%B8%80%E4%B8%AA%E9%9A%90%E8%97%8F%E4%BA%8617%E5%B9%B4%E7%9A%84-JDK-Bug/%E4%BE%9D%E6%97%A7%E6%97%A0%E9%99%90%E9%98%BB%E5%A1%9E.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一个隐藏了17年的 JDK Bug"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/05/10/%E4%B8%80%E4%B8%AA%E9%9A%90%E8%97%8F%E4%BA%8617%E5%B9%B4%E7%9A%84-JDK-Bug/" title="一个隐藏了17年的 JDK Bug">一个隐藏了17年的 JDK Bug</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-05-10T09:41:59.000Z" title="Created 2022-05-10 17:41:59">2022-05-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:08.235Z" title="Updated 2026-01-24 15:32:08">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Java/">Java</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%8D%89%E8%99%AB/">捉虫</a></span></div><div class="content">摘要 本文介绍了发现JDK-8286463 : DiscardPolicy may block invokeAll forever的全过程。 问题起因 因为工作需要，笔者最近考虑利用 Java 标准文档里的标准 API做一个批量执行任务的框架：  这个 API 的语义是：  批量执行任务。 在任务执行完成（不管任务是被正常终止还是异常终止）后，批量返回一个持有任务状态的 Future 列表。  我们团队内部的代码里已经有了一个自定义线程池的工厂方法，大义是： 1234567891011121314151617181920212223242526272829303132333435363738394041/** * 一个有缺陷的线程池构造器 * * @param corePoolSize      the number of threads to keep in the pool, even *                          if they are idle, unless &#123;@code allowCoreThreadTimeOut&#125; is ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/05/09/Lombok-%E6%8B%BE%E9%81%97/" title="Lombok 拾遗"><img class="post-bg" src="/2022/05/09/Lombok-%E6%8B%BE%E9%81%97/lombok.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lombok 拾遗"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/05/09/Lombok-%E6%8B%BE%E9%81%97/" title="Lombok 拾遗">Lombok 拾遗</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-05-09T02:56:36.000Z" title="Created 2022-05-09 10:56:36">2022-05-09</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:08.233Z" title="Updated 2026-01-24 15:32:08">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Java/">Java</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Lombok/">Lombok</a></span></div><div class="content">sneakyThrow 12345678public static RuntimeException sneakyThrow(Throwable t) &#123;        if (t == null) throw new NullPointerException(&quot;t&quot;);        return Lombok.&lt;RuntimeException&gt;sneakyThrow0(t);    &#125;    private static &lt;T extends Throwable&gt; T sneakyThrow0(Throwable t) throws T &#123;        throw (T)t;    &#125;</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/04/25/%E5%9F%BA%E4%BA%8E-Play-%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/" title="基于 Play 框架进行开发"><img class="post-bg" src="/2022/04/25/%E5%9F%BA%E4%BA%8E-Play-%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/%E5%8A%A0%E8%BD%BD%E8%B0%83%E8%AF%95%E5%99%A8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 Play 框架进行开发"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/04/25/%E5%9F%BA%E4%BA%8E-Play-%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E5%BC%80%E5%8F%91/" title="基于 Play 框架进行开发">基于 Play 框架进行开发</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-04-25T10:52:40.000Z" title="Created 2022-04-25 18:52:40">2022-04-25</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:08.231Z" title="Updated 2026-01-24 15:32:08">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Java/">Java</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Play/">Play</a></span></div><div class="content">构建和编译的方法 sbt clean &quot;project leads-web&quot; &quot;universal:packageZipTarball&quot; 常用命令 1234567891011121314151617# 在 sbt 里# 刷新命令reload;update;clean;compile# 切换到项目 aproject a# 在 sbt 的项目 a 里run &quot;-Dotel.resource.attributes=serviceName=iouy&quot;# 如果使用了 coursier 来管理依赖的话，查看依赖coursierDependencyTree# 在普通的 shell 里# 开启远程调试sbt -jvm-debug 9999 run# 传递 jvm 参数sbt -J-javaagent:skywalking-agent.jar -jvm-debug 9999 run   ORM ebean 1234567891011121314151617181920212223242526lazy val `model-base` = ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/03/29/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E6%B1%87%E6%80%BB/" title="领域驱动设计汇总"><img class="post-bg" src="/2022/03/29/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E6%B1%87%E6%80%BB/%E5%A4%A7%E5%B9%82%E5%B9%82.gif" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="领域驱动设计汇总"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/29/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E6%B1%87%E6%80%BB/" title="领域驱动设计汇总">领域驱动设计汇总</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-29T07:49:06.000Z" title="Created 2022-03-29 15:49:06">2022-03-29</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:07.840Z" title="Updated 2026-01-24 15:32:07">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/DDD/">DDD</a></span></div><div class="content">总结 DDD 主要是面向对象范式的高级应用。 分治、分层、抽象、演化是架构设计的4大原则。  分治是为了让复杂度变小，而且围绕单一的中心概念具有内聚，又通过边界区别彼此。在DDD中，在解决规模性问题，防止模型出现分裂-矛盾和重复的时候，使用战略设计：上下文（支持边界，天然为微服务服务，这里的上下文边界也是组织架构的边界，也强调团队管理）、精炼（围绕核心域的种种动作）、大型结构（分层在这里被强调）。战术设计则是围绕各种职责类型，强调程序的构造块。 分层 主要依赖于大型结构和模型驱动设计提到的 flexible layered architecture。 抽象意味着永远留有余地，核心越薄越好，这也是精炼要求的。 演化在这里则体现为，允许系统设计不断通过重构来精化模型。  在 DDD 的原书里面，为了防止模型出问题，才逐渐引入战略设计。 但别的 DDD 书籍里面，作者们都主张直接从战略设计入手。 DDD 官网   真实的架构是由项目需求驱动出来的。  左半段最外层叫 interface 层；右半段最外层叫 infra 层。左半段的 bus 是 command query bus，右半段...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/03/18/%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81/" title="如何写业务代码"><img class="post-bg" src="/2022/03/18/%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E9%A2%86%E5%9F%9F%E7%B3%BB%E7%BB%9F.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何写业务代码"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/18/%E5%A6%82%E4%BD%95%E5%86%99%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81/" title="如何写业务代码">如何写业务代码</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-18T05:56:48.000Z" title="Created 2022-03-18 13:56:48">2022-03-18</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:07.836Z" title="Updated 2026-01-24 15:32:07">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">系统架构</a></span></div><div class="content">业务研发面对的问题  稳定的业务模式 不稳定的需求 业务对交付的渴望  假设  命名规范（《clean code》） 面向对象设计（SOLID原则、贫血/充血模型、设计模式）  系统要拆分  流程控制系统与领域系统.drawio  每一个用例（解决的一个问题）都由访问逻辑和执行逻辑组成。访问逻辑负责用例执行的顺序与分支，并调用执行逻辑完成完整业务逻辑。 访问逻辑由单独的交易系统负责。执行逻辑由个子系统负责。  工程要拆分 三层架构 + 洋葱架构 代码要拆分  业务代码：描述核心业务逻辑的代码，核心是保持业务的流程及业务状态的一致性 领域对象与领域服务，不得对外部有任何依赖（工具类除外） 最核心的几个抽象： 校验：参数有效性校验、参数的业务属性校验。在进入正常业务逻辑代码前，完成所有的校验工作。 异常：业务异常：所有不符合业务逻辑而产生的异常。 系统异常：因为程序本身or依赖产生的异常。 所有的异常第一位runningtime异常。 数据:  业务数据：保存领域对象状态的数据。 非业务数据：过程数据。业务的核心流程中，只对业务数据的持久化负责。 参数：任何时候，任何方法的参数都需要...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/03/16/Idea-%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/" title="Idea 的小技巧"><img class="post-bg" src="/2022/03/16/Idea-%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/idea%E5%A2%9E%E9%87%8F%E7%BC%96%E8%AF%91%E7%9A%84%E9%85%8D%E7%BD%AE.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Idea 的小技巧"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/16/Idea-%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/" title="Idea 的小技巧">Idea 的小技巧</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-16T03:29:32.000Z" title="Created 2022-03-16 11:29:32">2022-03-16</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:07.782Z" title="Updated 2026-01-24 15:32:07">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Java/">Java</a><span class="article-meta-link">•</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Idea/">Idea</a></span></div><div class="content">调试的时候的断点 Suspend Policies  Specifies whether to pause the program execution when the breakpoint is hit. Non-suspending breakpoints are useful when you need to log some expression without pausing the program (for example, when you need to know how many times a method was called) or if you need to create a master breakpoint that will enable dependent breakpoints when hit. The following policies are available for the breakpoints that suspend program execution: All: all threads are suspended when...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/03/11/%E9%9D%A2%E5%90%91%E5%A5%BD%E7%9A%84%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A8%8B/" title="面向好的架构编程"><img class="post-bg" src="/2022/03/11/%E9%9D%A2%E5%90%91%E5%A5%BD%E7%9A%84%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A8%8B/%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D%E6%B2%A5%E9%9D%92%E6%B1%A0.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面向好的架构编程"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/11/%E9%9D%A2%E5%90%91%E5%A5%BD%E7%9A%84%E6%9E%B6%E6%9E%84%E7%BC%96%E7%A8%8B/" title="面向好的架构编程">面向好的架构编程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-11T13:42:55.000Z" title="Created 2022-03-11 21:42:55">2022-03-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:07.779Z" title="Updated 2026-01-24 15:32:07">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">系统架构</a></span></div><div class="content">前言 本文是《架构随笔》系列的第五篇，也是它的收官之作。 架构的定义 架构是一个界定不清的东西，我们很难讲清楚哪些东西是架构，哪些东西不是架构。但软件行业里其实人人都在搞架构，软件设计就是架构本身。 架构这个词出现得很早，有些人认为是 NASA（也可能是NATO） 发明的。最早的架构定义就是描述软件的结构而已，但现在已经没有多少人谈论他们定义的“软件架构”了。工程师很难以克制描述复杂结构的原始冲动，但描述复杂结构的普世标准并不存在。大家常见的各种定义，翻来覆去地重新讲着“软件架构是软件结构的顶层设计或者抽象设计”之类的话。即使是这种软件架构的定义，也并不为所有人都接受。汗牛充栋的架构书籍里有各种各样的观点，有的进一步把软件架构视作一堆组件和交互的设计，有的则把软件架构视作架构师主观意图的体现。把自己当作架构师的人们，着迷于把软件里的“不变与抽象的部分”和“易变与具体的部分”分离出来，把前者当作架构。架构师们是如此地热衷于做这样一件事，以至于有些人认为架构设计好了就解决了基本问题，设计不好通常是因为架构不好。于是很多人开始刻舟求剑：从某某颗粒度开始的设计应该叫概要设计，从某某颗粒度...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/03/09/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="性能优化"><img class="post-bg" src="/2022/03/09/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%AF%8F%E4%B8%AA%E4%BA%BA%E9%83%BD%E5%BA%94%E8%AF%A5%E6%8C%87%E7%9A%84%E7%9A%84%E6%80%A7%E8%83%BD%E6%95%B0%E5%AD%97.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="性能优化"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/09/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" title="性能优化">性能优化</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-09T07:41:25.000Z" title="Created 2022-03-09 15:41:25">2022-03-09</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:07.775Z" title="Updated 2026-01-24 15:32:07">2026-01-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%80%A7%E8%83%BD/">性能</a></span></div><div class="content">每个人都应该知道的操作时间 出处：《每个程序员都应该知道的延迟数字》  </div></div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/5/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/#content-inner">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/#content-inner">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/#content-inner">35</a><a class="extend next" rel="next" href="/page/7/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/rei.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">magicliang</div><div class="author-info-description">关于技术以及人生</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">342</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">203</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/magicliang"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/magicliang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:magicliang@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">人生只是，守株待兔</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/07/Java-%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91/" title="Java 结构化并发"><img src="/img/wall-paper-8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java 结构化并发"/></a><div class="content"><a class="title" href="/2026/02/07/Java-%E7%BB%93%E6%9E%84%E5%8C%96%E5%B9%B6%E5%8F%91/" title="Java 结构化并发">Java 结构化并发</a><time datetime="2026-02-07T03:49:00.000Z" title="Created 2026-02-07 11:49:00">2026-02-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/02/06/%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B6%85%E6%97%B6%E6%9C%BA%E5%88%B6%E5%85%A8%E8%A7%A3%E6%9E%90/" title="跨语言超时机制全解析"><img src="/2026/02/06/%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B6%85%E6%97%B6%E6%9C%BA%E5%88%B6%E5%85%A8%E8%A7%A3%E6%9E%90/go-channel%E8%B6%85%E6%97%B6.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跨语言超时机制全解析"/></a><div class="content"><a class="title" href="/2026/02/06/%E8%B7%A8%E8%AF%AD%E8%A8%80%E8%B6%85%E6%97%B6%E6%9C%BA%E5%88%B6%E5%85%A8%E8%A7%A3%E6%9E%90/" title="跨语言超时机制全解析">跨语言超时机制全解析</a><time datetime="2026-02-06T10:30:00.000Z" title="Created 2026-02-06 18:30:00">2026-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/24/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AC%94%E8%AE%B0/" title="Java 线程池笔记"><img src="/2026/01/24/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AC%94%E8%AE%B0/ThreadPoolExecutorUML%E7%B1%BB%E5%9B%BE.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java 线程池笔记"/></a><div class="content"><a class="title" href="/2026/01/24/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%AC%94%E8%AE%B0/" title="Java 线程池笔记">Java 线程池笔记</a><time datetime="2026-01-24T13:50:09.000Z" title="Created 2026-01-24 21:50:09">2026-01-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/19/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E4%B8%8E%E9%94%81%E4%BC%98%E5%8C%96/" title="线程安全与锁优化"><img src="/2026/01/19/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E4%B8%8E%E9%94%81%E4%BC%98%E5%8C%96/synchronized%E5%8E%9F%E7%90%86.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="线程安全与锁优化"/></a><div class="content"><a class="title" href="/2026/01/19/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E4%B8%8E%E9%94%81%E4%BC%98%E5%8C%96/" title="线程安全与锁优化">线程安全与锁优化</a><time datetime="2026-01-19T11:18:44.000Z" title="Created 2026-01-19 19:18:44">2026-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/18/%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97/" title="无锁队列"><img src="/2026/01/18/%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97/%E8%AE%A1%E7%AE%97%E6%9C%BACPU%E4%B8%8E%E7%BC%93%E5%AD%98%E7%A4%BA%E6%84%8F%E5%9B%BE.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无锁队列"/></a><div class="content"><a class="title" href="/2026/01/18/%E6%97%A0%E9%94%81%E9%98%9F%E5%88%97/" title="无锁队列">无锁队列</a><time datetime="2026-01-18T14:50:42.000Z" title="Created 2026-01-18 22:50:42">2026-01-18</time></div></div></div></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/Test/" style="font-size: 1.1em; color: #999">Test</a> <a href="/tags/JVM/" style="font-size: 1.45em; color: #99a7ba">JVM</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.1em; color: #999">面试</a> <a href="/tags/DDD/" style="font-size: 1.15em; color: #999b9e">DDD</a> <a href="/tags/Elasticsearch/" style="font-size: 1.1em; color: #999">Elasticsearch</a> <a href="/tags/http/" style="font-size: 1.1em; color: #999">http</a> <a href="/tags/Mac/" style="font-size: 1.1em; color: #999">Mac</a> <a href="/tags/hive/" style="font-size: 1.1em; color: #999">hive</a> <a href="/tags/KOA/" style="font-size: 1.1em; color: #999">KOA</a> <a href="/tags/Idea/" style="font-size: 1.1em; color: #999">Idea</a> <a href="/tags/%E8%AF%8D%E6%B1%87/" style="font-size: 1.1em; color: #999">词汇</a> <a href="/tags/JDK/" style="font-size: 1.1em; color: #999">JDK</a> <a href="/tags/JavaScript/" style="font-size: 1.35em; color: #99a3b1">JavaScript</a> <a href="/tags/RESTful/" style="font-size: 1.1em; color: #999">RESTful</a> <a href="/tags/%E9%BB%91%E5%AE%A2%E6%96%87%E5%8C%96/" style="font-size: 1.1em; color: #999">黑客文化</a> <a href="/tags/%E9%87%91%E8%9E%8D/" style="font-size: 1.25em; color: #999fa7">金融</a> <a href="/tags/%E6%80%A7%E8%83%BD/" style="font-size: 1.15em; color: #999b9e">性能</a> <a href="/tags/Scala/" style="font-size: 1.2em; color: #999da3">Scala</a> <a href="/tags/Spring/" style="font-size: 1.4em; color: #99a5b6">Spring</a> <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 1.5em; color: #99a9bf">区块链</a> <a href="/tags/CoffeeScript/" style="font-size: 1.1em; color: #999">CoffeeScript</a> <a href="/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" style="font-size: 1.15em; color: #999b9e">架构设计</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 1.2em; color: #999da3">数学</a> <a href="/tags/Go/" style="font-size: 1.25em; color: #999fa7">Go</a> <a href="/tags/%E9%87%91%E8%9E%8D%E7%A7%91/" style="font-size: 1.1em; color: #999">金融科</a> <a href="/tags/%E8%AE%A4%E7%9F%A5%E8%BF%AD%E4%BB%A3/" style="font-size: 1.25em; color: #999fa7">认知迭代</a> <a href="/tags/UML/" style="font-size: 1.1em; color: #999">UML</a> <a href="/tags/Kibana/" style="font-size: 1.1em; color: #999">Kibana</a> <a href="/tags/%E4%BA%92%E8%81%94%E7%BD%91%E9%87%91%E8%9E%8D/" style="font-size: 1.1em; color: #999">互联网金融</a> <a href="/tags/Fabric/" style="font-size: 1.1em; color: #999">Fabric</a> <a href="/tags/%E7%BB%8F%E6%B5%8E%E5%AD%A6/" style="font-size: 1.1em; color: #999">经济学</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 1.1em; color: #999">密码学</a> <a href="/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/" style="font-size: 1.1em; color: #999">推荐系统</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size: 1.15em; color: #999b9e">哲学</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 1.1em; color: #999">机器学习</a> <a href="/tags/%E8%8B%B1%E8%AF%AD/" style="font-size: 1.2em; color: #999da3">英语</a> <a href="/tags/misc/" style="font-size: 1.1em; color: #999">misc</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 1.1em; color: #999">消息队列</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 1.1em; color: #999">编程语言</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" style="font-size: 1.3em; color: #99a1ac">系统设计</a></div></div><div class="card-widget card-archives">
    <div class="item-headline">
      <i class="fas fa-archive"></i>
      <span>Archives</span>
      <a class="card-more-btn" href="/archives/"
            title="View More">
            <i class="fas fa-angle-right"></i>
          </a>
    </div>
  
    <ul class="card-archive-list">
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2026/02/">
            <span class="card-archive-list-date">
              February 2026
            </span>
            <span class="card-archive-list-count">2</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2026/01/">
            <span class="card-archive-list-date">
              January 2026
            </span>
            <span class="card-archive-list-count">5</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/09/">
            <span class="card-archive-list-date">
              September 2025
            </span>
            <span class="card-archive-list-count">2</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/08/">
            <span class="card-archive-list-date">
              August 2025
            </span>
            <span class="card-archive-list-count">2</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/07/">
            <span class="card-archive-list-date">
              July 2025
            </span>
            <span class="card-archive-list-count">5</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/05/">
            <span class="card-archive-list-date">
              May 2025
            </span>
            <span class="card-archive-list-count">2</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/04/">
            <span class="card-archive-list-date">
              April 2025
            </span>
            <span class="card-archive-list-count">1</span>
          </a>
        </li>
      
        <li class="card-archive-list-item">
          <a class="card-archive-list-link" href="/archives/2025/02/">
            <span class="card-archive-list-date">
              February 2025
            </span>
            <span class="card-archive-list-count">1</span>
          </a>
        </li>
      
    </ul>
  </div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Website Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article Count :</div><div class="item-count">342</div></div><div class="webinfo-item"><div class="item-name">Total Word Count :</div><div class="item-count">1439.3k</div></div><div class="webinfo-item"><div class="item-name">Unique Visitors :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Page Views :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Update :</div><div class="item-count" id="last-push-date" data-lastPushDate="2026-02-07T05:17:59.372Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">簡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>