<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>如何做全链路压测 | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="如何做全链路压测 | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="性能测试压测问题.xmind 性能测试的必要性 营销活动周期首先引入一个营销活动周期的概念，它是一个闭环流程： PS：1和2之间再加一个步骤。环境改造和基础数据准备。强调必须在生产环境。  压测环境准备：需要复用真实的线上环境，压测结果和问题暴露才都是最真实情况。可通过压测流量全局识别、透传（数据进入影子区域）。 基础数据准备：以电商场景为例，构造满足大促场景的核心基础相关数据（如买家、卖家、商品 - magicliang - 守株阁"><meta name="keywords" content="性能测试"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E5%8E%8B%E6%B5%8B%E9%97%AE%E9%A2%98.png"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7.png"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E8%90%A5%E9%94%80%E6%B4%BB%E5%8A%A8%E5%91%A8%E6%9C%9F%E9%97%AD%E7%8E%AF.png"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E5%8E%8B%E6%B5%8B%E6%B4%BB%E5%8A%A8%E7%94%98%E7%89%B9%E5%9B%BE.png"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E5%8E%8B%E6%B5%8B%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%94%B9%E9%80%A0.png"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E5%BD%A2%E6%88%90%E6%9C%80%E7%BB%88%E7%9A%84%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%B5%81%E7%A8%8B.png"><meta property="og:image" content="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/%E4%B8%9A%E5%8A%A1%E9%87%8F%E7%BA%A7%E6%BC%8F%E6%96%97%E5%9B%BE.png"><meta property="article:published_time" content="2019-11-10T08:26:09.000Z"><meta property="article:modified_time" content="2021-07-28T05:52:33.000Z"><meta property="og:updated_time" content="2021-07-28T05:52:33.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="性能测试"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/"
    },
    "headline": "如何做全链路压测 | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2019-11-10T08:26:09.000Z",
    "dateModified": "2021-07-28T05:52:33.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "性能测试",
    "description": "性能测试压测问题.xmind 性能测试的必要性 营销活动周期首先引入一个营销活动周期的概念，它是一个闭环流程： PS：1和2之间再加一个步骤。环境改造和基础数据准备。强调必须在生产环境。  压测环境准备：需要复用真实的线上环境，压测结果和问题暴露才都是最真实情况。可通过压测流量全局识别、透传（数据进入影子区域）。 基础数据准备：以电商场景为例，构造满足大促场景的核心基础相关数据（如买家、卖家、商品 - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=如何做全链路压测" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=如何做全链路压测&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=如何做全链路压测" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMQAAADECAAAAADlzdG3AAADKElEQVR42u3a0W5iMQxFUf7/p9tXSonPdm4MtNq8jAbB3KyRTBIf377+wesmQoQIESLGEbfi9eMLxXuP75cPfvKM++/fv5fWJULEFGL1sOq9x0WsMI+fWaFWmHINIkQMIlbFVi22+k610F8FCgtchIhPQawK8Fmhr7632ixTkYsQ8amIagOqDnjVplVBRYh4NyId3GiBpuJdPYMcQEWIeBWiWug7/zzW7RAhooHobF7VQ6sGW7UJdptvW11xESKa+QQ9uFWNgKvN6eqStfy8CBFDiNUBLi0ifZa+R5rWT/8uQsQAghZ3PIyFEGV3Eyx/IESIGECcLETSkEthCw1uRIiYQuwEHmmBVxrSNNwXIWISQUPDaqMjFyjSICANbhEiJhHVhYdcUMirGs5KwX8JFiFiGEEXTxvJZECLBPGtwhYh4iKCDEuRQV56SExDJ6RxLULEqxFp0KpaAB1aIYO88UdChIhBxGrBNPioLj8kNEkbY2yeiRAxjCBAGuCTxvKlMF6EiIOIzsEvFSQZiNxpOuCbnQgRBxF0ELHTQN69RKUfEREiJhEkaKGHRByiN5pk7TBehIiLiNigCoOOJEBpDWLBJoEIEZOITnBIQ0NyUaIXrWWDToSIAUQqKnqYSwXcaVzTwS8RIiYQaSCFhOqpwZyaw+RiVAaPIkQcRJAmAGksExAZYkyHTREiphEpMEy4ziBKKv72cIAIEQMIcuknl5xq2IQENZ0fDBEiJhGdoqSX/07gSC5AreaZCBEHEGkAK11OSCFTSDpMihAxjSD/OC3QzuJTKIkOiiJEDCDiYFSjiUwLPDXl6AFUhIgJRLocpcYXvcCkMKX7oyBCxCQiDYyQEGZ3kyTBDToAihBxCNFpaKWBlBRYptCk830RIqYQZCOqILuFjYu3M/AuQsQBBBke7A5pkdCm+k/BzQcRIoYQ6XJEizptkimg6Qb3IkRMIjqF2SnyVpB4ZWpfhIgXIqrD4E6gH4exYGNbhIh3IlJQTsIUOihGNzwRIiYRtEGQDn2d0DE1nGNwL0LEECI1cemhsGqGoWFdsBYRIqYRf/klQoQIESLGXt8eij9sDBimywAAAABJRU5ErkJggg==" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">如何做全链路压测</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2019-11-10</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=如何做全链路压测&url=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=如何做全链路压测&url=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2019/11/10/%E5%A6%82%E4%BD%95%E5%81%9A%E5%85%A8%E9%93%BE%E8%B7%AF%E5%8E%8B%E6%B5%8B/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMQAAADECAAAAADlzdG3AAADKElEQVR42u3a0W5iMQxFUf7/p9tXSonPdm4MtNq8jAbB3KyRTBIf377+wesmQoQIESLGEbfi9eMLxXuP75cPfvKM++/fv5fWJULEFGL1sOq9x0WsMI+fWaFWmHINIkQMIlbFVi22+k610F8FCgtchIhPQawK8Fmhr7632ixTkYsQ8amIagOqDnjVplVBRYh4NyId3GiBpuJdPYMcQEWIeBWiWug7/zzW7RAhooHobF7VQ6sGW7UJdptvW11xESKa+QQ9uFWNgKvN6eqStfy8CBFDiNUBLi0ifZa+R5rWT/8uQsQAghZ3PIyFEGV3Eyx/IESIGECcLETSkEthCw1uRIiYQuwEHmmBVxrSNNwXIWISQUPDaqMjFyjSICANbhEiJhHVhYdcUMirGs5KwX8JFiFiGEEXTxvJZECLBPGtwhYh4iKCDEuRQV56SExDJ6RxLULEqxFp0KpaAB1aIYO88UdChIhBxGrBNPioLj8kNEkbY2yeiRAxjCBAGuCTxvKlMF6EiIOIzsEvFSQZiNxpOuCbnQgRBxF0ELHTQN69RKUfEREiJhEkaKGHRByiN5pk7TBehIiLiNigCoOOJEBpDWLBJoEIEZOITnBIQ0NyUaIXrWWDToSIAUQqKnqYSwXcaVzTwS8RIiYQaSCFhOqpwZyaw+RiVAaPIkQcRJAmAGksExAZYkyHTREiphEpMEy4ziBKKv72cIAIEQMIcuknl5xq2IQENZ0fDBEiJhGdoqSX/07gSC5AreaZCBEHEGkAK11OSCFTSDpMihAxjSD/OC3QzuJTKIkOiiJEDCDiYFSjiUwLPDXl6AFUhIgJRLocpcYXvcCkMKX7oyBCxCQiDYyQEGZ3kyTBDToAihBxCNFpaKWBlBRYptCk830RIqYQZCOqILuFjYu3M/AuQsQBBBke7A5pkdCm+k/BzQcRIoYQ6XJEizptkimg6Qb3IkRMIjqF2SnyVpB4ZWpfhIgXIqrD4E6gH4exYGNbhIh3IlJQTsIUOihGNzwRIiYRtEGQDn2d0DE1nGNwL0LEECI1cemhsGqGoWFdsBYRIqYRf/klQoQIESLGXt8eij9sDBimywAAAABJRU5ErkJggg==" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="post-toc-number">1.</span> <span class="post-toc-text">性能测试</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7"><span class="post-toc-number"></span> <span class="post-toc-text">性能测试的必要性</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E8%90%A5%E9%94%80%E6%B4%BB%E5%8A%A8%E5%91%A8%E6%9C%9F"><span class="post-toc-number"></span> <span class="post-toc-text">营销活动周期</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8E%8B%E6%B5%8B%E7%8E%AF%E5%A2%83%E6%94%B9%E9%80%A0"><span class="post-toc-number"></span> <span class="post-toc-text">压测环境改造</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%94%B9%E9%80%A0"><span class="post-toc-number">1.</span> <span class="post-toc-text">业务改造</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%94%B9%E9%80%A0"><span class="post-toc-number">2.</span> <span class="post-toc-text">中间件改造</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="post-toc-number"></span> <span class="post-toc-text">数据准备</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9E%8B%E6%95%B0%E6%8D%AE"><span class="post-toc-number">1.</span> <span class="post-toc-text">业务模型数据</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8E%8B%E6%B5%8B%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE"><span class="post-toc-number">2.</span> <span class="post-toc-text">压测基础数据</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%B5%81%E9%87%8F%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5"><span class="post-toc-number"></span> <span class="post-toc-text">流量安全策略</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8E%8B%E6%B5%8B%E5%AE%9E%E6%96%BD"><span class="post-toc-number"></span> <span class="post-toc-text">压测实施</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%99%BB%E5%BD%95%E5%87%86%E5%A4%87"><span class="post-toc-number">1.</span> <span class="post-toc-text">登录准备</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%AD%A3%E5%BC%8F%E5%8E%8B%E6%B5%8B"><span class="post-toc-number">2.</span> <span class="post-toc-text">正式压测</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D%E5%88%86%E6%9E%90"><span class="post-toc-number"></span> <span class="post-toc-text">问题定位分析</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%80%BB%E7%BB%93"><span class="post-toc-number"></span> <span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8E%8B%E6%B5%8B%E6%94%B9%E9%80%A0%E4%B8%BE%E4%BE%8B"><span class="post-toc-number"></span> <span class="post-toc-text">压测改造举例</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A6%82%E4%BD%95%E6%94%B9%E9%80%A0%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="post-toc-number">1.</span> <span class="post-toc-text">如何改造数据源</span></a></li></ol></div>
                        
                    
                    <article id="post-content">
                        <h2 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h2><p><img src="%E5%8E%8B%E6%B5%8B%E9%97%AE%E9%A2%98.png" alt="压测问题.png"><br><a href="%E5%8E%8B%E6%B5%8B%E9%97%AE%E9%A2%98.xmind">压测问题.xmind</a></p>
<h1 id="性能测试的必要性"><a href="#性能测试的必要性" class="headerlink" title="性能测试的必要性"></a>性能测试的必要性</h1><p><img src="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7.png" alt="性能测试的必要性.png"></p>
<h1 id="营销活动周期"><a href="#营销活动周期" class="headerlink" title="营销活动周期"></a>营销活动周期</h1><p>首先引入一个营销活动周期的概念，它是一个闭环流程：</p>
<p>PS：1和2之间再加一个步骤。环境改造和基础数据准备。强调必须在生产环境。</p>
<ol>
<li>压测环境准备：需要复用真实的线上环境，压测结果和问题暴露才都是最真实情况。可通过压测流量全局识别、透传（数据进入影子区域）。</li>
<li>基础数据准备：以电商场景为例，构造满足大促场景的核心基础相关数据（如买家、卖家、商品信息），以线上数据为数据源，进行采样、过滤、脱敏，并保持同等量级。</li>
</ol>
<p><img src="%E8%90%A5%E9%94%80%E6%B4%BB%E5%8A%A8%E5%91%A8%E6%9C%9F%E9%97%AD%E7%8E%AF.png" alt="营销活动周期闭环.png"></p>
<p><strong>阿里实际上是 2013 年才开始做全链路压测的</strong>，现在的压测周期更加智能化。可以在白天由几个人值守进行，包含以下活动：</p>
<p><img src="%E5%8E%8B%E6%B5%8B%E6%B4%BB%E5%8A%A8%E7%94%98%E7%89%B9%E5%9B%BE.png" alt="压测活动甘特图.png"></p>
<h1 id="压测环境改造"><a href="#压测环境改造" class="headerlink" title="压测环境改造"></a>压测环境改造</h1><p>整个阿里经济体的压测环境，包括双十一压测，全部选择的是线上环境，此时需要评估：</p>
<ol>
<li>如果要进行全链路压测，是否直接可以使用现有环境。</li>
<li>同一个API多次压测是否会被拦截-容易被忽略。</li>
<li>是否会有脏数据影响、如果有影响应该如何改造避免-必须进行的改造项目：1 识别+ 透传流量标，2 构造影子数据区域。</li>
</ol>
<p>以上这些问题总结下来即为两类问题：<strong>业务问题和数据传递问题</strong>。问题比较明确，我们就根据这两类问题来做逐一的改造。</p>
<p>改造分为2方面：<strong>业务改造和中间件改造</strong>，这些在内部全链路压测1.0 时代就已经完成了，对于外部客户来说，可以作为一个技术改造上的参考点。同时我们已经有成熟的产品化方案提供一站式的能力，免去复杂的改造和维护成本。</p>
<h2 id="业务改造"><a href="#业务改造" class="headerlink" title="业务改造"></a>业务改造</h2><p>业务改造即为了解决压测过程中的业务异常问题，或者压测请求无法正常被执行的问题。举例如下：</p>
<ul>
<li>流量区分与识别：压测流量和业务流量的区分，并可在全链路系统中识别出来；</li>
<li>流量单一性问题：比如下单，同一个人执行一次下单后再重复执行就会失败；</li>
<li>流量的限流拦截：如果日常有限制，需要改造为接入流量降级能实时生效调整配置；</li>
<li>剔除压测数据对报表的影响</li>
<li>动态校验</li>
</ul>
<p>业务改造涉及的内容无法一一穷举，需要根据不同的业务模型、业务架构及配置，一一梳理。一般梳理改造之后，后续所有新应用都按照规范去开发，每年的压测前进行基础的查漏补缺即可。- <strong>面向压测设计</strong>。</p>
<h2 id="中间件改造"><a href="#中间件改造" class="headerlink" title="中间件改造"></a>中间件改造</h2><p>中间件作为衔接业务应用之间的组件，在压测中有个至关重要的功能就是将流量标识传递下去，一直到最终的数据库层面。虽然我们在13年开始，从核心应用使用到的中间件已经升级改造完成，中间我们踩过不少坑，诸如改造全面性、改造带来的业务代码修改成本、版本兼容问题等。</p>
<p><img src="%E5%8E%8B%E6%B5%8B%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%94%B9%E9%80%A0.png" alt="压测的中间件改造.png"></p>
<h1 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h1><p>大促活动确定之后，会对业务模型进行一次评审，即确定该业务模式对应的技术架构应用有哪些，需要做压测的业务范围有哪些、以及数据量级、数据形式是什么样的。所以数据准备包括准备业务模型数据和压测流量数据两部分。<br>数据的准备，主要分为两部分：业务模型的建立和基础数据的构造。</p>
<h2 id="业务模型数据"><a href="#业务模型数据" class="headerlink" title="业务模型数据"></a>业务模型数据</h2><p>业务模型数据，即压测的业务模型相关的数据，包括涉及到哪些API，这些API之间的压测量级是什么样的或者有什么样的比例关系等。业务模型的构造准确度，直接影响了压测结果的可参考性。</p>
<p>模型设计的目的主要是将业务进行采集并抽象成可执行的压测模型，并对各个子模型中的元素进行预测和设计，最终产生可以执行的压测模型。在双十一大促前，我们会确定好相关的业务，进行场景分类。</p>
<ul>
<li>已有业务场景：采集以往数据并做处理，作为预测数据，形成一个模型雏形，结合新的业务玩法，形成已有业务的模型；</li>
<li>新业务场景：直接按照新的业务，模型配比，形成一个新业务模型。</li>
</ul>
<p>最终会将两种业务场景类型进行组合，形成最终的终态业务模型。以下图作为示例：</p>
<p><img src="%E5%BD%A2%E6%88%90%E6%9C%80%E7%BB%88%E7%9A%84%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%B5%81%E7%A8%8B.png" alt="形成最终的业务模型的流程.png"></p>
<p>在组装业务模型数据的时候，需要注意一些关键因素，比如修改具体的电商业务模型关键因素：</p>
<p>1对N ：上游业务一个请求对应下游业务接口是否会存在调用多次的情况；<br>业务属性的比例：根据历史数据计算不同类型业务的比例关系；</p>
<p>业务模型组装之后，单一事务中的业务模型，应该是一个漏斗状的。而每层之间的漏斗比例，是根据不同的层级、不同的玩法、不同的规则会有不一样的比例关系。在一次大促活动中，这个比例关系理论上是不会变化的。漏斗模型参考如下：</p>
<p><img src="%E4%B8%9A%E5%8A%A1%E9%87%8F%E7%BA%A7%E6%BC%8F%E6%96%97%E5%9B%BE.png" alt="业务量级漏斗图.png"></p>
<p>业务模型在压测时对应的就是压测量级，淘宝大促用的全部都是RPS模式压测，即从服务端角度出发每个API之间是漏斗比例关系、能够很好地应用于容量规划上。<strong>商业化产品PTS</strong>（性能测试服务，Performance Testing Service）中也很好的支持了RPS模式。</p>
<h2 id="压测基础数据"><a href="#压测基础数据" class="headerlink" title="压测基础数据"></a>压测基础数据</h2><p><strong>如果说业务模型对应的是确定要压测的接口/API的话，那压测流量数据，就是确定这些压测API到底压测的是什么内容</strong>，比如：登录哪些用户、查看哪些商品和店铺、购买哪些商品，甚至是付款价格是什么。</p>
<p>流量数据中，有一部分为上述业务模型对应具体RPS值，模型体现的是比例关系，而流量数据即有每次压测具体的RPS值。</p>
<p>流量数据中最重要的部分，即为真实的压测数据，我们可以称之为基础数据，比如交易的买家、卖家、商品数据等。全链路压测的目的是为了模拟双11，所以模拟的真实性非常重要，基础数据的真实性就是至关重要的一环。<strong>全链路压测会以线上数据作为数据源，经过采样、过滤、脱敏等操作，形成可作为压测使用的数据。</strong></p>
<p>线上数据拿出来使用的时候，<strong>特别涉及到写数据的时候，避免造成脏数据</strong>，我们落地或者读取的时候，采用影子表的形式。当识别到压测流量，则读写影子表，否则就读写线上正式表。影子表的产生为的是压测流量安全。</p>
<p>淘宝内部系统使用的压测体系，数据平台和压测平台是两套平台。<strong>数据平台管理/提供压测数据（包括模型数据和流量数据），压测平台提供施压能力</strong>，即保证压测请求能够以指定的“协议”、指定的量级速率、从全国各地发送出来。商业化产品PTS（性能测试服务，Performance Testing Service）中提供的数据工厂能力，很好的将内部的数据平台和压测平台结合起来，产出为统一的一个压测系统，<strong>只需用户构造好压测数据以文件/自定义的形式定义好参数，在使用处配置即</strong>可。</p>
<h1 id="流量安全策略"><a href="#流量安全策略" class="headerlink" title="流量安全策略"></a>流量安全策略</h1><p>流量安全策略主要是为了保证能够正常的施压流量且数据不错乱，安全地、符合预期地进行。这里面就包括了两层考虑：</p>
<ol>
<li>测试数据和正常数据的严格隔离，即非法流量的监控和保护机制；</li>
</ol>
<ul>
<li>手段：影子表数据。影子表为和线上结构一致，但是处于隔离位置的可写压测数据表。</li>
<li>效果：数据隔离，避免了数据错乱。</li>
</ul>
<ol start="2">
<li>压测流量的安全过滤，即不被识别为攻击流量；</li>
</ol>
<ul>
<li>手段：将安全相关策略接入流控降级功能；针对压测适当放松安全策略，或根据特殊标记识别；</li>
<li>效果：压测流量不被判定为攻击流量，成功压测的同时保障线上业务的安全性。</li>
</ul>
<p>此处，涉及到第三方的系统，诸如支付宝、短信等服务，因业务特殊性需要做压测系统的打通。13年淘宝实现了第一次全链路压测，但是未能打通下游业务链路。在14年双十一压测前，和支付宝、物流环节等打通了全面的压测系统。对于外部客户来说，支付宝、短信等都有对应的<strong>挡板服务（mock）</strong>（测试领域里专门有“挡板测试”的概念）可提供，用来供用户做全链路压测时使用。</p>
<h1 id="压测实施"><a href="#压测实施" class="headerlink" title="压测实施"></a>压测实施</h1><p>根据最开始介绍到的流程管控，一切准备就绪之后，即可开始进行全链路压测。除常规理解的正式压测之外，我们还有额外的两个预操作：系统预热、登录准备。</p>
<p>关于系统预热 这里说的预热，未包含我们内部提到的<strong>预跑</strong>（预跑应该是一个低流量的压测小脉冲压测）。预热是为了该缓存的数据提前缓存好，达到大促缓存态的状态，也更好地实现我们缓存的目的。大促缓存的使用应该利用到极致，故需要通过预热来进行。</p>
<p>对外部客户来说，可以通<strong>过先一轮、低量级的全链路压测，来提前预热系统</strong>，包括在真正大促活动之前也可这样操作，即提前缓存住需要缓存的数据。</p>
<h2 id="登录准备"><a href="#登录准备" class="headerlink" title="登录准备"></a>登录准备</h2><p>登录准备主要是用于需要长连接保持、秒杀等场景，即用户都是逐步登录上来，然后再进行业务操作的场景。故如果量级特别大的时候，可以提前做登录的准备，一则来模拟真实用户登录场景，二则是对登录系统的保护。</p>
<h2 id="正式压测"><a href="#正式压测" class="headerlink" title="正式压测"></a>正式压测</h2><p>一般正式压测会按照压测计划，执行多种压测策略。淘宝的双11大促压测，一般包含这样几步：</p>
<p>1）峰值脉冲：即完全模拟0点大促目标峰值流量，进行大促态压测，观察系统表现。</p>
<p>2）系统摸高：取消限流降级保护功能，抬高当前压测值（前提是当前的目标压测值已经达到，则可以进行摸高测试），观察系统的极限值是多少。可进行多轮提升压力值压测，直到系统出现异常为止。</p>
<p>3）限流降级验证：即验证限流降级保护功能是否正常。 （AHAS引入）商业化产品AHAS(应用高可用服务，Application High Availability Service）提供了全面的限流降级能力，可进行全链路的降级保护。</p>
<p>4）破坏性测试：这个主要是为了验证预案的有效性，类似于容灾演练时的预案执行演练。即为持续保持大促态压测，并验证预案的有效性，观察执行预案之后对系统的影响。</p>
<p>对外部客户来说，可以配置不同的压测量级数据，来进行多轮压测，并观察其系统表现。压测不应该是一次性的操作，而应该是反复的、多轮验证的操作。</p>
<h1 id="问题定位分析"><a href="#问题定位分析" class="headerlink" title="问题定位分析"></a>问题定位分析</h1><p>压测结束之后，会将压测过程中的系统表现、监控数据等整理，进行压测复盘，分析当前系统瓶颈、后续改进修复计划及下一轮压测时间等。在分析定位问题时，因涉及的系统较多、子业务系统的形态不一，需要具体问题具体分析，其中不免需要一线研发的介入。</p>
<p>商业化产品PTS（性能测试服务，Performance Testing Service）的压测报告，有详细统计数据及趋势图数据，采样日志以及添加了的监控数据。后续PTS还会提供架构监控，帮助性能测试执行同学，更好地从系统架构角度判定压测过程中系统是否正常，大致瓶颈点。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>压测前要先评估再改造。</li>
<li>评估要从 API 的语义，应对流量的高可用保障措施（限流、熔断）、请求涉及的模型、模型推导出的真实数据进行完整建模。</li>
<li>改造的时候要确保改造能够覆盖到 major case ：流量标能够在各个流程里传递，包括业务系统和中间件和数据库。数据库能够正确存储影子表。</li>
<li>改造的时候要确保能够覆盖到 major case：如何保证影子影子流量标不丢？如果影子流量丢了如何自保？这需要流程做专门的评估和设计，可能还涉及到压测数据的制造。</li>
<li>制造压测数据的时候，尽量录制真实流量，重现真实流量。</li>
<li>环境的预热很重要，特别是预热缓存、连接和登录 session 等系统状态（state）。</li>
<li>测试的过程要有预压测（预跑）的过程，类似一种灰度能力，看看系统各个场景的压测冒烟状况是否正常。</li>
<li>压测本身<strong>首先</strong>要验证容量是否达到规划要求。</li>
<li>压测的主要目的达到以后，要进行摸高测试和破坏性测试（类似 netflix 的混沌工程）。</li>
<li>压测的环境改造会产出一个压测平台和数据平台，实际上应该也会产生一个全链路跟踪平台和压测分析平台。</li>
</ol>
<h1 id="压测改造举例"><a href="#压测改造举例" class="headerlink" title="压测改造举例"></a>压测改造举例</h1><h2 id="如何改造数据源"><a href="#如何改造数据源" class="headerlink" title="如何改造数据源"></a>如何改造数据源</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addHikariInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transformTemplate.transform(<span class="string">&quot;com.zaxxer.hikari.HikariConfig&quot;</span>, <span class="keyword">new</span> TransformCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">byte</span>[] doInTransform(Instrumentor instrumentor, ClassLoader classLoader, String className,</span><br><span class="line">                    Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="keyword">byte</span>[] classfileBuffer)</span><br><span class="line">                    <span class="keyword">throws</span> InstrumentException &#123;</span><br><span class="line">                InstrumentClass target = instrumentor.getInstrumentClass(classLoader, className, classfileBuffer);</span><br><span class="line">                InstrumentMethod setJdbcUrlMethod = InstrumentUtils.findMethod(target, <span class="string">&quot;setJdbcUrl&quot;</span>,</span><br><span class="line">                        String.class.getName());</span><br><span class="line">                setJdbcUrlMethod.addInterceptor(SetJdbcUrlInterceptor.class.getName());</span><br><span class="line">                <span class="keyword">return</span> target.toBytecode();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        addGetConnectionInterceptor(<span class="string">&quot;com.zaxxer.hikari.HikariDataSource&quot;</span>, TransformHandler.EMPTY_HANDLER);</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addGetConnectionInterceptor</span><span class="params">(String className, TransformHandler handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.transformTemplate.transform(className, <span class="keyword">new</span> TransformCallback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">byte</span>[] doInTransform(Instrumentor instrumentor, ClassLoader classLoader, String className,</span><br><span class="line">                    Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="keyword">byte</span>[] classfileBuffer)</span><br><span class="line">                    <span class="keyword">throws</span> InstrumentException &#123;</span><br><span class="line">                InstrumentClass target = instrumentor.getInstrumentClass(classLoader, className, classfileBuffer);</span><br><span class="line">                handler.handle(target);</span><br><span class="line">                InstrumentMethod getConnectionMethod = InstrumentUtils.findMethod(target, <span class="string">&quot;getConnection&quot;</span>);</span><br><span class="line">                getConnectionMethod.addInterceptor(JdbcInterceptor.class.getName());</span><br><span class="line">                <span class="keyword">return</span> target.toBytecode();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Ret <span class="title">before</span><span class="params">(Object target, Object[] args)</span> </span>&#123;</span><br><span class="line">    SofaTracerSpan span = SofaTraceContextHolder.getSofaTraceContext().getCurrentSpan();</span><br><span class="line">    <span class="keyword">if</span> (span != <span class="keyword">null</span> &amp;&amp; span.getSofaTracerSpanContext().isLoadTest()) &#123;</span><br><span class="line">        Object testDb = DataSourceHolder.getInstance().getLoadTestDb(target);</span><br><span class="line">        <span class="keyword">if</span> (testDb != <span class="keyword">null</span>) &#123;</span><br><span class="line">            DataSource dateSource = (DataSource)testDb;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> Ret.newInstanceForReturn(dateSource.getConnection());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                    logger.warn(<span class="string">&quot;Failed to getConnection. &#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(DataSourceHolder.getInstance().isLoadTestDb(target)) &#123;</span><br><span class="line">            <span class="comment">//压测数据源拦截不处理，返回none</span></span><br><span class="line">            <span class="keyword">return</span> Ret.newInstanceForNone();</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//数据源无配置或者有异常，则返回null，保证压测不影响数据库正常逻辑</span></span><br><span class="line">            <span class="keyword">return</span> Ret.newInstanceForReturn(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Ret.newInstanceForNone();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/nXVyjl2odSLBGmQL1pFczg">《独家揭秘 | 阿里怎么做双11全链路压测？》</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ACxzeOKCU0ZxmogsBMB6OQ">《阿里如何做好双11技术保障？大队长霜波分享4点经验》</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/5uY50nJoBsFYetO7jhQ16w">《全链路压测在网易传媒的落地与实践》</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/vrdjio3Q71LasHyZsyoidQ">《高德全链路压测——精准控压的建设实践》</a></li>
</ol>

                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2021-07-28");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2019-11-10T08:26:09.000Z" itemprop="datePublished">2019-11-10</time>

    , Updated at&nbsp;<time datetime="2021-07-28T05:52:33.000Z" itemprop="dateModified">2021-07-28</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" rel="tag">#&nbsp;性能测试</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2019/11/27/binlog-%E6%94%B6%E9%9B%86%E6%9C%8D%E5%8A%A1/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">binlog 收集服务</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2019/11/09/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8D%81%E4%B8%80-%E9%9B%86%E7%BE%A4-Cluster/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">Redis 笔记之十一-集群 Cluster</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>