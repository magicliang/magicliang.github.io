<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>Redis 笔记之四：常用命令 | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="Redis 笔记之四：常用命令 | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="全局命令查看所有键12# 查看所有键，支持 glob 风格通配符keys *  这个命令会不加区别地，做全局的键扫描，返回且只返回键。它的时间复杂度是O（N），线上环境因为无法预测键的数量，应该禁用这个命令。 看起来 redis 并没有做一个全局的 keys 的缓存，所以并没有办法优化局部性能，但即使存在一个全局的 keys 列表，对这个列表进行遍历，其时间复杂度依然是 O(N)。 键总数12#  - magicliang - 守株阁"><meta name="keywords" content="Redis"><meta property="article:published_time" content="2019-07-22T15:29:49.000Z"><meta property="article:modified_time" content="2022-01-24T08:47:46.000Z"><meta property="og:updated_time" content="2022-01-24T08:47:46.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="Redis"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"
    },
    "headline": "Redis 笔记之四：常用命令 | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2019-07-22T15:29:49.000Z",
    "dateModified": "2022-01-24T08:47:46.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "Redis",
    "description": "全局命令查看所有键12# 查看所有键，支持 glob 风格通配符keys *  这个命令会不加区别地，做全局的键扫描，返回且只返回键。它的时间复杂度是O（N），线上环境因为无法预测键的数量，应该禁用这个命令。 看起来 redis 并没有做一个全局的 keys 的缓存，所以并没有办法优化局部性能，但即使存在一个全局的 keys 列表，对这个列表进行遍历，其时间复杂度依然是 O(N)。 键总数12#  - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=Redis 笔记之四：常用命令" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=Redis 笔记之四：常用命令&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=Redis 笔记之四：常用命令" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANQAAADUCAAAAADBtVLEAAADp0lEQVR42u3a24rjQBAEUf//T+88DSweqTJS2Khswi8LXkuj06C+ZNXj3xd+HqJEiRIl6utQj+Hz+////+7oGvrd8/8/3//5u6O/P95LlKglqMOX7uBmR7+fBoOgj/4u/e2fARAlahFqusnZZHH2Yj+/wM/XTvdKf298TlGiPgA1QY5+QyabtJiTgRUl6lNRZ4ti+/00eZxNFO1mQJSoTahpo5gWQrqgTsDpvi/fpYsS9WYUDV7u/vctaZIoUS9GxdA9LJrpMHn18Hg2mbyk6iFK1BtRqQCQFtk2yE8L71nhgAyeKFEbUVeKX2RymX6TwFNgKkrUNlQTrpy9uGShboP/diBFidqKSoUA+uKSTWlanB/wI0rUJhQ9AF5ptJoGggSmpNA9HhJFiboBlRZQUryeHpyGNVNIkyYbUaI2okg4QgtoU0CZBi6FQeNEI0rUAhR5eeugHoaVbfCSYKJEbUCRUHOaHFKYQh92ClqmwRclaiMqPWjzPWnwoLgmNBUlahuqmQxIENJsaMkiSzbeokRtQI2BOwhFSABKinXk8Bi/FyVqEYpubNuXl25gyaEzXSdK1AZU87B0k0oLd+0BNRbjRIlagEqF6bYZMTV2pIFIYc94D1GiFqHIjafFkDR+NOHlpeYVUaKWoGhA2RSsp80nbdQnAzA2MYoStQjVFKDbTSkpTqcGxhhmihK1CDWFm6mg3NyPDhbdYIsStQFFAk0yKVDw9KLTQDMWCESJuhHVbjhpaN80LdKmyTQgokRtQKUmj9Q0Qh7o6uLbNEyKErUNRRbRtPiSZpOrB8WEEyVqI2p6+NRs1SzEzcA0hQhRojagmoD/6kufJptU4KMBqShRG1C06EwPixOSFMVpyInSJFGibkCRTSspwF0J+adFOQEPn0eUqEUo2hhCNqvpGlLgbg+xokRtQ6UL243mlQGgRbzTiUyUqCWoFHikMCRtVpsmKrqIx5OvKFE3oUiRjWx4SUNIKtiRgR2vFSVqEYqGk3RBbIrSJNhBh1RRohagSNNT2yjcFLRJ8wcObUSJWoBKn7bQnMKUtOFtCnuxOUSUqBtQKewgi2a6Ph386MY4HTBFidqCogXq9MAkXGmar+imQJSojaimyJwOayT0bw+p0/WiRH0SKjVrpDD0CjBNIHVziChRy1DNwpp+l4oEZLJ6yUQhStSbUSmYTy8wCV7GB4ITBiq6iRJ1M4oGL2QiocVv2nzV3EeUqA2ob/qIEiVKlKiv+fwAYvyyr3/MC+cAAAAASUVORK5CYII=" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">Redis 笔记之四：常用命令</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2019-07-22</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=Redis 笔记之四：常用命令&url=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=Redis 笔记之四：常用命令&url=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%9B%9B%EF%BC%9A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANQAAADUCAAAAADBtVLEAAADp0lEQVR42u3a24rjQBAEUf//T+88DSweqTJS2Khswi8LXkuj06C+ZNXj3xd+HqJEiRIl6utQj+Hz+////+7oGvrd8/8/3//5u6O/P95LlKglqMOX7uBmR7+fBoOgj/4u/e2fARAlahFqusnZZHH2Yj+/wM/XTvdKf298TlGiPgA1QY5+QyabtJiTgRUl6lNRZ4ti+/00eZxNFO1mQJSoTahpo5gWQrqgTsDpvi/fpYsS9WYUDV7u/vctaZIoUS9GxdA9LJrpMHn18Hg2mbyk6iFK1BtRqQCQFtk2yE8L71nhgAyeKFEbUVeKX2RymX6TwFNgKkrUNlQTrpy9uGShboP/diBFidqKSoUA+uKSTWlanB/wI0rUJhQ9AF5ptJoGggSmpNA9HhJFiboBlRZQUryeHpyGNVNIkyYbUaI2okg4QgtoU0CZBi6FQeNEI0rUAhR5eeugHoaVbfCSYKJEbUCRUHOaHFKYQh92ClqmwRclaiMqPWjzPWnwoLgmNBUlahuqmQxIENJsaMkiSzbeokRtQI2BOwhFSABKinXk8Bi/FyVqEYpubNuXl25gyaEzXSdK1AZU87B0k0oLd+0BNRbjRIlagEqF6bYZMTV2pIFIYc94D1GiFqHIjafFkDR+NOHlpeYVUaKWoGhA2RSsp80nbdQnAzA2MYoStQjVFKDbTSkpTqcGxhhmihK1CDWFm6mg3NyPDhbdYIsStQFFAk0yKVDw9KLTQDMWCESJuhHVbjhpaN80LdKmyTQgokRtQKUmj9Q0Qh7o6uLbNEyKErUNRRbRtPiSZpOrB8WEEyVqI2p6+NRs1SzEzcA0hQhRojagmoD/6kufJptU4KMBqShRG1C06EwPixOSFMVpyInSJFGibkCRTSspwF0J+adFOQEPn0eUqEUo2hhCNqvpGlLgbg+xokRtQ6UL243mlQGgRbzTiUyUqCWoFHikMCRtVpsmKrqIx5OvKFE3oUiRjWx4SUNIKtiRgR2vFSVqEYqGk3RBbIrSJNhBh1RRohagSNNT2yjcFLRJ8wcObUSJWoBKn7bQnMKUtOFtCnuxOUSUqBtQKewgi2a6Ph386MY4HTBFidqCogXq9MAkXGmar+imQJSojaimyJwOayT0bw+p0/WiRH0SKjVrpDD0CjBNIHVziChRy1DNwpp+l4oEZLJ6yUQhStSbUSmYTy8wCV7GB4ITBiq6iRJ1M4oGL2QiocVv2nzV3EeUqA2ob/qIEiVKlKiv+fwAYvyyr3/MC+cAAAAASUVORK5CYII=" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4"><span class="post-toc-number">1.</span> <span class="post-toc-text">全局命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E9%94%AE"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">查看所有键</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%94%AE%E6%80%BB%E6%95%B0"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">键总数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%A3%80%E6%9F%A5%E9%94%AE%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">检查键是否存在</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%A0%E9%99%A4%E9%94%AE"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">删除键</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%94%AE%E8%BF%87%E6%9C%9F"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">键过期</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%94%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%B1%BB%E5%9E%8B"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">键的数据结构类型</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%91%BD%E4%BB%A4"><span class="post-toc-number">2.</span> <span class="post-toc-text">字符串命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%AE%BE-%E5%8F%96%E5%80%BC"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">设&#x2F;取值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%89%B9%E9%87%8F%E8%AE%BE-%E5%8F%96%E5%80%BC"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">批量设&#x2F;取值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8A%A0-%E5%87%8F%E5%80%BC"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">加&#x2F;减值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BD%8D%E6%93%8D%E4%BD%9C%E5%91%BD%E4%BB%A4"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">位操作命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">其他命令</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%93%88%E5%B8%8C%E5%91%BD%E4%BB%A4"><span class="post-toc-number">3.</span> <span class="post-toc-text">哈希命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%89%B9%E9%87%8F%E8%AE%BE-%E5%8F%96%E5%80%BC-1"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">批量设&#x2F;取值</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%95%B0%E5%80%BC%E6%93%8D%E4%BD%9C"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">数值操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E6%93%8D%E4%BD%9C"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">其他操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%88%97%E8%A1%A8%E5%91%BD%E4%BB%A4"><span class="post-toc-number">4.</span> <span class="post-toc-text">列表命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A2%9E%E5%88%A0%E6%93%8D%E4%BD%9C"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">增删操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%98%BB%E5%A1%9E%E6%93%8D%E4%BD%9C"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">阻塞操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%9B%86%E5%90%88%E5%91%BD%E4%BB%A4"><span class="post-toc-number">5.</span> <span class="post-toc-text">集合命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A2%9E%E5%88%A0%E6%93%8D%E4%BD%9C-1"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">增删操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">集合操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E5%91%BD%E4%BB%A4"><span class="post-toc-number">6.</span> <span class="post-toc-text">有序集合命令</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A2%9E%E5%88%A0%E6%93%8D%E4%BD%9C-2"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">增删操作</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C-1"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">集合操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%94%AE%E7%AE%A1%E7%90%86"><span class="post-toc-number">7.</span> <span class="post-toc-text">键管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%8D%95%E4%B8%AA%E9%94%AE%E7%AE%A1%E7%90%86"><span class="post-toc-number">7.1.</span> <span class="post-toc-text">单个键管理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%BF%81%E7%A7%BB%E9%94%AE"><span class="post-toc-number">7.2.</span> <span class="post-toc-text">迁移键</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%81%8D%E5%8E%86%E9%94%AE"><span class="post-toc-number">7.3.</span> <span class="post-toc-text">遍历键</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86"><span class="post-toc-number">7.4.</span> <span class="post-toc-text">数据库管理</span></a></li></ol></li></ol></div>
                        
                    
                    <article id="post-content">
                        <h1 id="全局命令"><a href="#全局命令" class="headerlink" title="全局命令"></a>全局命令</h1><h2 id="查看所有键"><a href="#查看所有键" class="headerlink" title="查看所有键"></a>查看所有键</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有键，支持 glob 风格通配符</span></span><br><span class="line">keys *</span><br></pre></td></tr></table></figure>

<p>这个命令会不加区别地，<strong>做全局的键扫描，返回且只返回键。</strong>它的时间复杂度是O（N），线上环境因为无法预测键的数量，应该禁用这个命令。</p>
<p><em>看起来 redis 并没有做一个全局的 keys 的缓存，所以并没有办法优化局部性能，但即使存在一个全局的 keys 列表，对这个列表进行遍历，其时间复杂度依然是 O(N)。</em></p>
<h2 id="键总数"><a href="#键总数" class="headerlink" title="键总数"></a>键总数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有键</span></span><br><span class="line">dbsize</span><br></pre></td></tr></table></figure>

<p>这个操作的性能是 O(1)，也就意味着可以直接被线上使用。</p>
<p><em>它可以作为查询全部数据以前的预优化，至少全局的记录数量可以预先提取出来，以获得分页查询的依据</em>。</p>
<h2 id="检查键是否存在"><a href="#检查键是否存在" class="headerlink" title="检查键是否存在"></a>检查键是否存在</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确认 java 作为一个键是否存在</span></span><br><span class="line">exists java</span><br></pre></td></tr></table></figure>

<p>如果存在返回 1，不存在返回 0。</p>
<p>注1：在存在多个候选返回值的时候，redis会返回语义更加丰富的返回值。如返回成功或失败，可以直接返回true或false，但返回0既可以表示失败，也可以表示操作的操作数（operand）为0，而返回非0不仅可以告诉我们操作成功了，而且还会精确地告诉我们操作了多少个对象，可谓一举两得。这种设计思路遍布 Redis API 中。</p>
<p>问题：估计有个全局优化，能够不返回具体值的情况下得到是否存在某个 key 的结论。</p>
<h2 id="删除键"><a href="#删除键" class="headerlink" title="删除键"></a>删除键</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除 java 键</span></span><br><span class="line">del java</span><br></pre></td></tr></table></figure>

<p>如果删除成功则返回 1，否则返回 0</p>
<h2 id="键过期"><a href="#键过期" class="headerlink" title="键过期"></a>键过期</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> hello world</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> hello world EX 10 NX</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 redis 中，最早支持的时间单位为second，如果不特别指定单位，指定时间时数字都代表秒。这个策略可以推广到其他系统里。美团的 redis 系统里面的默认时间单位就是秒。如果值是负数，键会立即被删除。</span></span><br><span class="line">expire hello 10</span><br></pre></td></tr></table></figure>

<p>set 是为比较少的返回“OK”的 command。</p>
<p>因为这个命令有复合的EX、PX、NX、XX等选项，所以其他相对的命令（如SETNX）可能会被设为过期，且被移除。</p>
<p>expire 命令的结果也是 0 和 1。</p>
<p>如果使用了 expire 命令，还有一个可以拿来轮询的 ttl 命令，可以告诉我们键的剩余时间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ttl hello</span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"><span class="comment"># 如果返回-2，意味着键已被删除</span></span><br><span class="line">ttl hello</span><br><span class="line">(<span class="built_in">integer</span>) -2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这时候试着取健值，则得到 nil</span></span><br><span class="line"></span><br><span class="line">get hello</span><br><span class="line">(nil) </span><br></pre></td></tr></table></figure>

<h2 id="键的数据结构类型"><a href="#键的数据结构类型" class="headerlink" title="键的数据结构类型"></a>键的数据结构类型</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> a b</span><br><span class="line"><span class="built_in">type</span> a </span><br><span class="line">string</span><br><span class="line"></span><br><span class="line"><span class="comment"># rpush 会强制转化一个 key 到 list 类型</span></span><br><span class="line">rpush mylist a b c</span><br><span class="line"><span class="comment"># 返回结果为 7</span></span><br><span class="line">(<span class="built_in">integer</span>) 7</span><br><span class="line"><span class="built_in">type</span> mylist</span><br><span class="line">list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不存在的键</span></span><br><span class="line"><span class="built_in">type</span> non_exist_key</span><br><span class="line"><span class="comment"># 返回 none</span></span><br></pre></td></tr></table></figure>

<h1 id="字符串命令"><a href="#字符串命令" class="headerlink" title="字符串命令"></a>字符串命令</h1><h2 id="设-取值"><a href="#设-取值" class="headerlink" title="设/取值"></a>设/取值</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> hello world</span><br><span class="line">exsts hello</span><br><span class="line">setnx hello wolrd</span><br><span class="line"><span class="comment">## 若存在才设值</span></span><br><span class="line"><span class="built_in">set</span> hello jedix xx</span><br><span class="line"></span><br><span class="line">get hello</span><br></pre></td></tr></table></figure>

<h2 id="批量设-取值"><a href="#批量设-取值" class="headerlink" title="批量设/取值"></a>批量设/取值</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mset a 1 b 2 c 3</span><br><span class="line">get a</span><br><span class="line">get b</span><br><span class="line">get c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取不到返回nil</span></span><br><span class="line">mget a b c d</span><br></pre></td></tr></table></figure>

<p>如果使用平凡的取/设值命令，时间开销为：</p>
<p>总开销= n * (一次网络开销 + 一次操作开销)</p>
<p>如果使用批量取/设值命令，时间开销为：</p>
<p>总开销= 一次网络开销 + n * (一次操作开销)</p>
<p>redis每秒可以处理上万的读写操作，相当于每次读写操作的开销小于0.1毫秒，而网络开销很难低于1毫秒。根据阿姆达尔定律，网络开销的减少才是性能优化的大头。</p>
<h2 id="加-减值"><a href="#加-减值" class="headerlink" title="加/减值"></a>加/减值</h2><p>因为 Redis 本身是单线程架构，所以本身不需要其他设计中的悲观锁或者 cas 操作保证操作正确性。<br>返回的自增结果永远是正确的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 值不是整数，返回错误</span></span><br><span class="line"><span class="comment"># 值是整数，返回自增后的结果</span></span><br><span class="line"><span class="comment"># 值不存在，按照结果为0自增，返回结果1</span></span><br><span class="line">incr java</span><br><span class="line"></span><br><span class="line">decr java</span><br><span class="line"></span><br><span class="line">incrby java 10</span><br><span class="line">decrby java 5</span><br><span class="line"><span class="comment"># 没有 decrbyfloat 命令</span></span><br><span class="line">incrbyfloat java 4.3</span><br></pre></td></tr></table></figure>
<p><strong>注意，java里涉及数字的缺省值都是0，而且只是缺省值，并不是终值。</strong></p>
<h2 id="位操作命令"><a href="#位操作命令" class="headerlink" title="位操作命令"></a>位操作命令</h2><p>背景见：<a target="_blank" rel="noopener" href="https://redis.io/topics/data-types-intro#bitmaps">https://redis.io/topics/data-types-intro#bitmaps</a></p>
<p>Redis 并不只是一个平凡的 kv 数据存储，而是一个拥有许多数据类型的服务器。其中有一种类型是用 String 来解释为位图-“Bitmaps are not an actual data type, but a set of bit-oriented operations defined on the String type”。字符串是safe blobs，最大长度是 512 MB，恰好等于一个2的32次方的位图。字符串的英文字符，都符合（comply to）ascii编码。</p>
<p>所谓的位图，可以用紧凑的方式来表示一个大的 true/false 值域，而且这个 true/false 的点还带有 position 信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把键的 offset 的位取出来，如果offset无值，则取0</span></span><br><span class="line">getbit hello 10</span><br><span class="line"><span class="comment"># 把键的 offset 的位设值，只能设值0或1，返回旧值</span></span><br><span class="line">setbit hello 1000 1</span><br><span class="line"><span class="comment"># Number of set bits in the range</span></span><br><span class="line">bitcount hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1st position of 1 or 0 in the key in range. O(N)</span></span><br><span class="line">BITPOS hello  0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与或非</span></span><br><span class="line">SET key1 <span class="string">&quot;foobar&quot;</span></span><br><span class="line">SET key2 <span class="string">&quot;abcdef&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># and or not xor</span></span><br><span class="line">BITOP AND dest key1 key2</span><br><span class="line">GET dest</span><br></pre></td></tr></table></figure>


<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回最后结果的长度</span></span><br><span class="line">append hello 123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回结果的长度</span></span><br><span class="line">strlen hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原子化地设值并返回旧值</span></span><br><span class="line">getset hello world123</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设值指定位置的字符，返回修改后的字符串长度</span></span><br><span class="line">setrange hello 1 a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定指定位置的值，并返回。start 和 end 都是闭区间</span></span><br><span class="line">getrange hello 1 2</span><br></pre></td></tr></table></figure>

<h1 id="哈希命令"><a href="#哈希命令" class="headerlink" title="哈希命令"></a>哈希命令</h1><p>3.1 设/取值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设值，在 key 和 value 之间加入了一个 field</span></span><br><span class="line">hset user:1 name tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取值，在 key 和 value 之间加入了一个 field</span></span><br><span class="line">hget user:1 name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 field，而不删除key</span></span><br><span class="line">hdel user:1 name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 key 数目</span></span><br><span class="line">hlen user:1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若 field 不存在，则设值</span></span><br><span class="line">hsetnx user:1 name jerry</span><br></pre></td></tr></table></figure>

<p>注意，len 往往是计数，而 strlen 往往是计值。</p>
<h2 id="批量设-取值-1"><a href="#批量设-取值-1" class="headerlink" title="批量设/取值"></a>批量设/取值</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 批量设值</span></span><br><span class="line">hmset user:1 name tom age 20 city beijing</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量获取</span></span><br><span class="line">hmget user:1 name age city</span><br></pre></td></tr></table></figure>

<p>对于mset的升级，就是把数据结构写在最前头。set -&gt; mset -&gt; hmset。</p>
<h2 id="数值操作"><a href="#数值操作" class="headerlink" title="数值操作"></a>数值操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照指定值加值，这里的命令没有缺省被加数1了，必须显式指定被加数</span></span><br><span class="line">hincrby user:1 age 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照指定值加浮点值，这里的命令没有缺省被加数1了，必须显式指定被加数</span></span><br><span class="line">hincrbyfloat user:1 age 5.1</span><br></pre></td></tr></table></figure>

<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断一个 field 是否存在</span></span><br><span class="line">hexists user:1 name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历一个 key 下面所有的 fields，实际上应该叫 hfields 比较恰当。时间复杂度为O(N)。一个key下面的N比较小的时候，可以直接在生产上使用。</span></span><br><span class="line">hkeys user:1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历一个 key 下面所有的 fields 的值</span></span><br><span class="line">hvals user:1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历一个 key 下面所有的 fields 和值</span></span><br><span class="line">hgetall user:1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取一个 key 下面指定 field 的字符串长度</span></span><br><span class="line">hstrlen user:1 name</span><br></pre></td></tr></table></figure>

<h1 id="列表命令"><a href="#列表命令" class="headerlink" title="列表命令"></a>列表命令</h1><h2 id="增删操作"><a href="#增删操作" class="headerlink" title="增删操作"></a>增删操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从右至左插入元素，这个命令天然就是多参数的</span></span><br><span class="line">rpush listkey c b a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左至右插入元素</span></span><br><span class="line">lpush listkey c b a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按范围取元素。index从左至右为0至N-1，从右至左为-1至-N。</span></span><br><span class="line">lrange listkey 0 -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在枢轴前后插入元素，注意方向和前后的关系</span></span><br><span class="line">linsert listkey before b  java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定 index 的元素</span></span><br><span class="line">LINDEX listkey -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取指定 key 的 size</span></span><br><span class="line">llen listkey</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表类型总是没有删除操作，而使用弹出操作作为替代品</span></span><br><span class="line">lpop listkey</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左至右删除元素，1表示从左至右删除1个元素，0表示删除全部元素，-1表示从右至左删除1个元素</span></span><br><span class="line">lrem listkey 1 a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留列表的1到最后一个元素-即去掉第一个元素</span></span><br><span class="line">LTRIM listkey 1 -1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置特定 index 的元素的 value，这里的 index 不能 out of bound。</span></span><br><span class="line">LSET listkey 1 python</span><br></pre></td></tr></table></figure>

<p>redis里涉及区间的 end，都是闭区间的 end。</p>
<h2 id="阻塞操作"><a href="#阻塞操作" class="headerlink" title="阻塞操作"></a>阻塞操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从左至右阻塞操作，第一个返回值总是 listkey1，只要有一个元素可以弹出，blpop就会立即返回。如果时间参数为0，则无限阻塞。可以使用这个命令制造一个延时队列、阻塞队列。blpop 可以同时监听多个 key，类似 selector 方案。每个 value 只能在多个客户端中被 pop 一次。</span></span><br><span class="line">blpop listkey1 listkey2 20</span><br></pre></td></tr></table></figure>

<h1 id="集合命令"><a href="#集合命令" class="headerlink" title="集合命令"></a>集合命令</h1><h2 id="增删操作-1"><a href="#增删操作-1" class="headerlink" title="增删操作"></a>增删操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 往集合里加元素，因为是无序的，所以也无所谓insert和左右</span></span><br><span class="line">sadd myset a b c d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指名道姓直接删除集合里的元素</span></span><br><span class="line">srem myset a b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算集合的大小，注意这不是len。直接使用内置变量，所以其操作时间复杂度为 O(1)。</span></span><br><span class="line">scard myset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确认 d 是不是 myset 的元素</span></span><br><span class="line">sismember myset d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从集合中随机弹出1个元素。因为强调 set 是无序的，所以产生了这个操作。</span></span><br><span class="line">srandmember myset 1</span><br><span class="line"><span class="comment"># 默认值为1</span></span><br><span class="line">srandmember myset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从集合中弹出一个元素，元素会被删除</span></span><br><span class="line">spop myset 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取集合中的所有元素</span></span><br><span class="line">smembers myset</span><br></pre></td></tr></table></figure>

<h2 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 求交集</span></span><br><span class="line">sinter myset1 myset2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求并集</span></span><br><span class="line">sunion myset1 myset2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求差集</span></span><br><span class="line">sdiff myset1 myset2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为集合操作比较耗时（m*n的乘法二项式复杂度），求交集并存储到目标key里。</span></span><br><span class="line">sinterstore interset myset1 myset2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为集合操作比较耗时（m*n的乘法二项式复杂度），求并集并存储到目标key里。</span></span><br><span class="line">sunionstore unionset myset1 myset2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为集合操作比较耗时（m*n的乘法二项式复杂度），求差集并存储到目标key里。</span></span><br><span class="line">sdiff myset1 myset2</span><br></pre></td></tr></table></figure>

<h1 id="有序集合命令"><a href="#有序集合命令" class="headerlink" title="有序集合命令"></a>有序集合命令</h1><h2 id="增删操作-2"><a href="#增删操作-2" class="headerlink" title="增删操作"></a>增删操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给一个 zset 增加，成员，先写score再写元素。因为有这个排序操作，这个操作的时间复杂度是O(log(n))。也支持 nx、xx、ch、incr 几个 argument。</span></span><br><span class="line">zadd user:ranking 250 tom 1 kris 91 mike 200 frank 220 tim 250 martin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取集合大小。时间复杂度O(1)。</span></span><br><span class="line">zcard user:ranking</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取集合中指定成员的分数</span></span><br><span class="line">zscore user:ranking tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取集合中指定成员的从低到高排名</span></span><br><span class="line">zrank user:ranking tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取集合中指定成员的从高到低排名</span></span><br><span class="line">zrevrank user:ranking tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除集合中指定成员</span></span><br><span class="line">zrem user:ranking tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加集合中指定成员的score</span></span><br><span class="line">zincrby user:ranking 10 tom</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回集合中从低到高指定排名的成员，withscores 可以被去掉</span></span><br><span class="line">zrange user:ranking 0 1 withscores</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回集合中从高到低指定排名的成员，withscores 可以被去掉</span></span><br><span class="line">zrevrange user:ranking 0 1 withscores</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回集合中从低到高指定分数范围的成员，withscores 可以被去掉。此外也支持开、闭区间、正负无穷参数。</span></span><br><span class="line">zrangebyscore user:ranking 200 250 withscores</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回集合中从高到低指定分数范围的成员（注意，参数是反的），withscores 可以被去掉。此外也支持开、闭区间、正负无穷参数。</span></span><br><span class="line">zrevrangebyscore user:ranking 250 200 withscores</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回集合中指定分数段的成员的数量</span></span><br><span class="line">zcount user:ranking 200 250</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除集合中指定排名的成员</span></span><br><span class="line">zremrangebyrank user:ranking 0 2</span><br></pre></td></tr></table></figure>

<h2 id="集合操作-1"><a href="#集合操作-1" class="headerlink" title="集合操作"></a>集合操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 交集聚合存储操作，2代表了要做交集的 keys 数目。如果不指定聚合类型，结果就是加权后相加sum。</span></span><br><span class="line">zinterstore user:ranking:1_inter_0 2 user:ranking:1 user:ranking:2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交集聚合存储操作，2代表了要做交集的 keys 数目。1代表集合1的权重，0.5代表集合2的权重。</span></span><br><span class="line">zinterstore user:ranking:1_inter_0 2 user:ranking:1 user:ranking:2 weights 1 0.5 aggregate max</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并集聚合存储操作</span></span><br><span class="line">zunionstore user:ranking:1_inter_0 2 user:ranking:1 user:ranking:2</span><br></pre></td></tr></table></figure>
<h1 id="键管理"><a href="#键管理" class="headerlink" title="键管理"></a>键管理</h1><h2 id="单个键管理"><a href="#单个键管理" class="headerlink" title="单个键管理"></a>单个键管理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 换 key 名称，rename会删除掉 java 的旧值，所以值比较大的时候可能会阻塞 redis 实例（类似关系型数据库的 alter）。python会直接返回nil。</span></span><br><span class="line">rename python java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果key不存在，则换 key 名称。这是为了防止误操作。</span></span><br><span class="line">renamenx python java</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机返回一个key</span></span><br><span class="line">randomkey</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让一个键在一个特定的秒级时间戳过期</span></span><br><span class="line">expireat hello 2000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让一个键在10毫秒后过期</span></span><br><span class="line">pexpire hello 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除过期时间</span></span><br><span class="line">persist hello</span><br></pre></td></tr></table></figure>

<p>注意，如果字符串的value为string类型，set 操作也会去除过期时间。</p>
<p>Redis不支持二级数据结构（例如列表或者哈希）里元素的过期时间。</p>
<h2 id="迁移键"><a href="#迁移键" class="headerlink" title="迁移键"></a>迁移键</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在一个 redis 实例内的多个 db 迁移。</span></span><br><span class="line">move key db</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先导出一个键</span></span><br><span class="line">dump hello</span><br><span class="line"><span class="comment"># 再另一个实例里面重建key。0代表没有ttl，非0代表ttl。</span></span><br><span class="line">restore hello 0  <span class="string">&quot;\x00\x05world\t\x00\xc9#mH\x84/\x11s&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># migrate 原子化地结合了 dump、restore和del的操作，可以支持多个键操作。批量地迁移键到目标主机和端口，超时时间为5000.</span></span><br><span class="line">migrate 127.0.0.1 6380 <span class="string">&quot;&quot;</span> 0 5000 keys key1 key2 key3</span><br></pre></td></tr></table></figure>

<h2 id="遍历键"><a href="#遍历键" class="headerlink" title="遍历键"></a>遍历键</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 遍历 videos 模式的键值对，删除键</span></span><br><span class="line">redis-cli keys videos | xargs redis-cli del</span><br></pre></td></tr></table></figure>

<p>keys命令本身很容易阻塞redis节点，在以下情况下可以考虑使用：</p>
<ul>
<li>在不对外服务的从节点上使用。但会影响主从复制。</li>
<li>如果确认键值总数比较少，可以使用以下命令</li>
</ul>
<p>其他情况下，应该考虑使用 scan 命令，渐进式地遍历所有键。</p>
<p>scan的模式为： scan cursor [match pattern] [count number]</p>
<p>其中 cursor 是必须的，从0开始，到0又结束，周而复始。count 默认为10。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回若干个键，而不是值。scan并不是并发安全的。相当于隔离性非常差的事务。</span></span><br><span class="line">scan 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 衍生命令</span></span><br><span class="line">HSCAN hello 0</span><br><span class="line">SSCAN hello 0</span><br><span class="line">zscan hello 0</span><br></pre></td></tr></table></figure>

<h2 id="数据库管理"><a href="#数据库管理" class="headerlink" title="数据库管理"></a>数据库管理</h2><p>关系型数据库用字符来区分不同的数据库名不同。Redis只是使用数字来区分不同的数据库。<br>Redis 默认拥有16个数据库，默认选中的数据库的 dbindex 是0。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到 db 0</span></span><br><span class="line">SELECT 0</span><br></pre></td></tr></table></figure>

<p>未来的 redis-cluster 功能默认只使用 db 0。不同的db之间的数据（KV）是相互隔离的。但用不同的 redis instance 一样可以实现这个效果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除当前db的所有数据！慎用</span></span><br><span class="line">flushdb</span><br><span class="line"><span class="comment"># 清除所有db的所有数据！慎用</span></span><br><span class="line">flushall</span><br></pre></td></tr></table></figure>
                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2022-01-24");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2019-07-22T15:29:49.000Z" itemprop="datePublished">2019-07-22</time>

    , Updated at&nbsp;<time datetime="2022-01-24T08:47:46.000Z" itemprop="dateModified">2022-01-24</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/Redis/" rel="tag">#&nbsp;Redis</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2019/08/30/how-to-recognize-domain/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">如何进行域划分</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2019/07/22/Redis-%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%B8%89%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E5%86%85%E9%83%A8%E7%BC%96%E7%A0%81/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">Redis 笔记之三：数据结构和内部编码</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>