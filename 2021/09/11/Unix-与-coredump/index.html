<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>Unix 与 coredump | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="Unix 与 coredump | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="coredump 是什么当程序运行的过程中异常终止或崩溃，操作系统会将程序当时的内存状态记录下来，保存在一个文件中，这种行为就叫做Core Dump（中文有的翻译成“核心转储”)。 我们可以认为 core dump 是“内存快照”，但实际上，除了内存信息之外，还有些关键的程序运行状态也会同时 dump 下来，例如寄存器信息（包括程序指针、栈指针等）、内存管理信息、其他处理器和操作系统状态和信息。  - magicliang - 守株阁"><meta name="keywords" content="Linux, Unix"><meta property="article:published_time" content="2021-09-11T13:52:35.000Z"><meta property="article:modified_time" content="2021-11-08T09:20:25.000Z"><meta property="og:updated_time" content="2021-11-08T09:20:25.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="Linux, Unix"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/"
    },
    "headline": "Unix 与 coredump | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2021-09-11T13:52:35.000Z",
    "dateModified": "2021-11-08T09:20:25.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "Linux, Unix",
    "description": "coredump 是什么当程序运行的过程中异常终止或崩溃，操作系统会将程序当时的内存状态记录下来，保存在一个文件中，这种行为就叫做Core Dump（中文有的翻译成“核心转储”)。 我们可以认为 core dump 是“内存快照”，但实际上，除了内存信息之外，还有些关键的程序运行状态也会同时 dump 下来，例如寄存器信息（包括程序指针、栈指针等）、内存管理信息、其他处理器和操作系统状态和信息。  - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=Unix 与 coredump" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=Unix 与 coredump&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=Unix 与 coredump" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKQAAACkCAAAAAA83tqdAAACKElEQVR42u3a0U7DMAxG4b3/S8MVEhqJ/+OsiFGf3mywbvkq1a7j5PHxD46HSJEiRb4B8lEcP7709L/vf3+9X73uzkvjipyLXN60APT8+e6cFYKMK3I2cvcjqwBYBdb25l9gybgiRVZIkqDT90lSFynyNHBWn+8eALuHgkiRpwVGStrVRVHMy1WQyNshqwnRb75eNlsUeStkbBot0KSoTede2lUTeStkdSMTNEnyu6I3NshEjkXShufuPQmIqrGwLZpFjkZWg6dJWbqgKnDKRqzIscg0oU9NUJLwd4n8aLYo8vZIcrOnpE8a/fThIFIkWaTsFLUpqOjETORMJN3AQRN6laS7iwMiZyJTo/108FjQgu+JFNktOkjCTg2FcnInciQyNZTo5o5XFvNjw0rkWGRqtqeETDd5pgeDyNlIsmCZil7SEDhZJBU5E5kS9W6g1FigsDK5ixyJJE14WuCmi6kKlthVEzkO+UrR0AmuzsRO5Fxkp8nU+Zw0Z0WKvGIiVgUVgZDAEzkXSRaPups9qs1ync3HIuciU4OpanTSyRlpgh0vNom8LTJt3Lx6Q10KKpEiyU1OFp5S0YKDSuRIJC0MThbYyaZmkSKrJioJmtMA6xQiIkV2i1iyOJV+96joFTkKeVLU0gWobiNVpMhOYKSGfLXZrrOYJVJkB0kwJJGnc0TORtINIK8sRpELEykyPfBT4HQSfDVmLHpFjkG+8yFSpEiRf3h8AvutVvUCZXAsAAAAAElFTkSuQmCC" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">Unix 与 coredump</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2021-09-11</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=Unix 与 coredump&url=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=Unix 与 coredump&url=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2021/09/11/Unix-%E4%B8%8E-coredump/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKQAAACkCAAAAAA83tqdAAACKElEQVR42u3a0U7DMAxG4b3/S8MVEhqJ/+OsiFGf3mywbvkq1a7j5PHxD46HSJEiRb4B8lEcP7709L/vf3+9X73uzkvjipyLXN60APT8+e6cFYKMK3I2cvcjqwBYBdb25l9gybgiRVZIkqDT90lSFynyNHBWn+8eALuHgkiRpwVGStrVRVHMy1WQyNshqwnRb75eNlsUeStkbBot0KSoTede2lUTeStkdSMTNEnyu6I3NshEjkXShufuPQmIqrGwLZpFjkZWg6dJWbqgKnDKRqzIscg0oU9NUJLwd4n8aLYo8vZIcrOnpE8a/fThIFIkWaTsFLUpqOjETORMJN3AQRN6laS7iwMiZyJTo/108FjQgu+JFNktOkjCTg2FcnInciQyNZTo5o5XFvNjw0rkWGRqtqeETDd5pgeDyNlIsmCZil7SEDhZJBU5E5kS9W6g1FigsDK5ixyJJE14WuCmi6kKlthVEzkO+UrR0AmuzsRO5Fxkp8nU+Zw0Z0WKvGIiVgUVgZDAEzkXSRaPups9qs1ync3HIuciU4OpanTSyRlpgh0vNom8LTJt3Lx6Q10KKpEiyU1OFp5S0YKDSuRIJC0MThbYyaZmkSKrJioJmtMA6xQiIkV2i1iyOJV+96joFTkKeVLU0gWobiNVpMhOYKSGfLXZrrOYJVJkB0kwJJGnc0TORtINIK8sRpELEykyPfBT4HQSfDVmLHpFjkG+8yFSpEiRf3h8AvutVvUCZXAsAAAAAElFTkSuQmCC" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#coredump-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="post-toc-number">1.</span> <span class="post-toc-text">coredump 是什么</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E4%BA%A7%E7%94%9Fcoredump%E6%96%87%E4%BB%B6"><span class="post-toc-number">2.</span> <span class="post-toc-text">为什么会产生coredump文件</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#coredump%E4%BA%A7%E7%94%9F%E5%9C%BA%E6%99%AF"><span class="post-toc-number">3.</span> <span class="post-toc-text">coredump产生场景</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8Fcoredump%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%9C%89%E5%BE%88%E5%A4%9A%EF%BC%8C%E8%BF%99%E9%87%8C%E6%80%BB%E7%BB%93%E4%B8%80%E4%BA%9B%E6%AF%94%E8%BE%83%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BB%8F%E9%AA%8C"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">造成程序coredump的原因有很多，这里总结一些比较常用的经验</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%9D%9E%E4%B8%9A%E5%8A%A1%E7%A8%8B%E5%BA%8F"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">非业务程序</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%9F%AD%E6%9C%9F%E5%BA%94%E6%80%A5%E6%96%B9%E6%B3%95"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">短期应急方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E9%95%BF%E6%9C%9F%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">长期处理方法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#coredump%E6%88%AA%E6%96%AD%E9%97%AE%E9%A2%98"><span class="post-toc-number">4.</span> <span class="post-toc-text">coredump截断问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Linux-%E6%94%AF%E6%8C%81%E7%9A%84%E4%BF%A1%E5%8F%B7%E5%88%97%E8%A1%A8"><span class="post-toc-number">5.</span> <span class="post-toc-text">Linux 支持的信号列表</span></a></li></ol></div>
                        
                    
                    <article id="post-content">
                        <h1 id="coredump-是什么"><a href="#coredump-是什么" class="headerlink" title="coredump 是什么"></a>coredump 是什么</h1><p>当程序运行的过程中异常终止或崩溃，操作系统会将程序当时的内存状态记录下来，保存在一个文件中，这种行为就叫做Core Dump（中文有的翻译成“核心转储”)。</p>
<p>我们可以认为 core dump 是“内存快照”，但实际上，除了内存信息之外，还有些关键的程序运行状态也会同时 dump 下来，例如寄存器信息（包括程序指针、栈指针等）、内存管理信息、其他处理器和操作系统状态和信息。</p>
<p>core dump 对于编程人员诊断和调试程序是非常有帮助的，因为对于有些程序错误是很难重现的，例如指针异常，而 core dump 文件可以再现程序出错时的情景。</p>
<h1 id="为什么会产生coredump文件"><a href="#为什么会产生coredump文件" class="headerlink" title="为什么会产生coredump文件"></a>为什么会产生coredump文件</h1><p>core产生的原因很多，比如过去一些Unix的版本不支持现代Linux上这种gdb直接附着到进程上进行调试的机制，需要先向进程发送终止信号，然后用工具阅读core文件。在Linux上，我们就可以使用kill向一个指定的进程发送信号或者使用gcore命令来使其主动出core并退出。</p>
<p>如果从浅层次的原因上来讲，出core意味着当前进程存在BUG，需要程序员修复。</p>
<p>从深层次的原因上讲，是当前进程触犯了某些OS层级的保护机制，逼迫OS向当前进程发送诸如SIGSEGV(即signal 11)之类的信号, 例如访问空指针或数组越界出core，实际上是触犯了OS的内存管理，访问了非当前进程的内存空间，OS需要通过出core来进行警示，这就好像一个人身体内存在病毒，免疫系统就会通过发热来警示，并导致人体发烧是一个道理（有意思的是，并不是每次数组越界都会出Core，这和OS的内存管理中虚拟页面分配大小和边界有关，即使不出core，也很有可能读到脏数据，引起后续程序行为紊乱，这是一种很难追查的BUG）。</p>
<h1 id="coredump产生场景"><a href="#coredump产生场景" class="headerlink" title="coredump产生场景"></a>coredump产生场景</h1><p>上面说当程序运行过程中异常终止或崩溃时会发生 core dump，但还没说到什么具体的情景程序会发生异常终止或崩溃，例如我们使用 kill -9 命令杀死一个进程会发生 core dump 吗？实验证明是不能的，那么什么情况会产生呢？</p>
<p>Linux 中信号是一种异步事件处理的机制，每种信号对应有其默认的操作，你可以在 这里查看 Linux 系统提供的信号以及默认处理。默认操作主要包括忽略该信号（Ingore）、暂停进程（Stop）、终止进程（Terminate）、终止并发生core dump（core）等。如果我们信号均是采用默认操作，那么，以下列出几种信号，它们在发生时会产生 core dump:</p>
<table>
<thead>
<tr>
<th align="center">Signal</th>
<th align="center">Action</th>
<th align="center">Comment</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SIGTRAP</td>
<td align="center">Core</td>
<td align="center">Trace/breakpoint trap</td>
</tr>
<tr>
<td align="center">SIGSEGV</td>
<td align="center">Core</td>
<td align="center">Invalid memory reference</td>
</tr>
<tr>
<td align="center">SIGQUIT</td>
<td align="center">Core</td>
<td align="center">Quit from keyboard</td>
</tr>
<tr>
<td align="center">SIGILL</td>
<td align="center">Core</td>
<td align="center">Illegal Instruction</td>
</tr>
<tr>
<td align="center">SIGABRT</td>
<td align="center">Core</td>
<td align="center">Abort signal from <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man3/abort.3.html">abort</a></td>
</tr>
</tbody></table>
<p>当然不仅限于上面的几种信号。这就是为什么我们使用 Ctrl+z 来挂起一个进程或者 Ctrl+C 结束一个进程均不会产生 core dump，因为前者会向进程发出 SIGTSTP 信号，该信号的默认操作为暂停进程（Stop Process）；后者会向进程发出SIGINT 信号，该信号默认操作为终止进程（Terminate Process）。同样上面提到的 kill -9 命令会发出 SIGKILL 命令，该命令默认为终止进程。而如果我们使用 Ctrl+\ 来终止一个进程，会向进程发出 SIGQUIT 信号，默认是会产生 core dump 的。还有其它情景会产生 core dump， 如：程序调用 abort() 函数、访存错误、非法指令等等。</p>
<h2 id="造成程序coredump的原因有很多，这里总结一些比较常用的经验"><a href="#造成程序coredump的原因有很多，这里总结一些比较常用的经验" class="headerlink" title="造成程序coredump的原因有很多，这里总结一些比较常用的经验"></a>造成程序coredump的原因有很多，这里总结一些比较常用的经验</h2><ol>
<li>内存访问越界<br>a) 由于使用错误的下标，导致数组访问越界。</li>
</ol>
<p>  b) 搜索字符串时，依靠字符串结束符来判断字符串是否结束，但是字符串没有正常的使用结束符。</p>
<p>  c) 使用strcpy, strcat, sprintf, strcmp,strcasecmp等字符串操作函数，将目标字符串读/写爆。应该使用strncpy, strlcpy, strncat, strlcat, snprintf, strncmp, strncasecmp等函数防止读写越界。</p>
<ol start="2">
<li>多线程程序使用了线程不安全的函数。</li>
</ol>
<p>应该使用下面这些可重入的函数，它们很容易被用错：</p>
<blockquote>
<p>asctime_r(3c) gethostbyname_r(3n) getservbyname_r(3n)ctermid_r(3s)<br>gethostent_r(3n) getservbyport_r(3n) ctime_r(3c)<br>getlogin_r(3c)getservent_r(3n) fgetgrent_r(3c) getnetbyaddr_r(3n)<br>getspent_r(3c)fgetpwent_r(3c) getnetbyname_r(3n) getspnam_r(3c)<br>fgetspent_r(3c)getnetent_r(3n) gmtime_r(3c) gamma_r(3m)<br>getnetgrent_r(3n) lgamma_r(3m) getauclassent_r(3)getprotobyname_r(3n)<br>localtime_r(3c) getauclassnam_r(3)<br>etprotobynumber_r(3n)nis_sperror_r(3n) getauevent_r(3)<br>getprotoent_r(3n) rand_r(3c) getauevnam_r(3)getpwent_r(3c)<br>readdir_r(3c) getauevnum_r(3) getpwnam_r(3c) strtok_r(3c)<br>getgrent_r(3c)getpwuid_r(3c) tmpnam_r(3s) getgrgid_r(3c)<br>getrpcbyname_r(3n) ttyname_r(3c)getgrnam_r(3c) getrpcbynumber_r(3n)<br>gethostbyaddr_r(3n) getrpcent_r(3n)</p>
</blockquote>
<ol start="3">
<li>多线程读写的数据未加锁保护。</li>
</ol>
<p>对于会被多个线程同时访问的全局数据，应该注意加锁保护，否则很容易造成coredump</p>
<ol start="4">
<li>非法指针</li>
</ol>
<p>  a) 使用空指针</p>
<p>  b) 随意使用指针转换。一个指向一段内存的指针，除非确定这段内存原先就分配为某种结构或类型，或者这种结构或类型的数组，否则不要将它转换为这种结构或类型的指针，而应该将这段内存拷贝到一个这种结构或类型中，再访问这个结构或类型。这是因为如果这段内存的开始地址不是按照这种结构或类型对齐的，那么访问它时就很容易因为bus error而core dump。</p>
<p> 5，堆栈溢出</p>
<p>不要使用大的局部变量（因为局部变量都分配在栈上），这样容易造成堆栈溢出，破坏系统的栈和堆结构，导致出现莫名其妙的错误。</p>
<ol start="4">
<li>coredump文件配置</li>
</ol>
<ol>
<li><p>在终端中输入ulimit -c 如果结果为0，说明当程序崩溃时，系统并不能生成core dump。</p>
</li>
<li><p>使用ulimit -c unlimited命令，开启core dump功能，并且不限制生成core dump文件的大小。如果需要限制，加数字限制即可。ulimit - c 1024</p>
</li>
<li><p>默认情况下，core dump生成的文件名为core，而且就在程序当前目录下。新的core会覆盖已存在的core。通过修改/proc/sys/kernel/core_uses_pid文件，可以将进程的pid作为作为扩展名，生成的core文件格式为core.xxx，其中xxx即为pid</p>
</li>
<li><p>通过修改/proc/sys/kernel/core_pattern可以控制core文件保存位置和文件格式。例如：将所有的core文件生成到/corefile目录下，文件名的格式为core-命令名-pid-时间戳. echo “/corefile/core-%e-%p-%t” &gt; /proc/sys/kernel/core_pattern</p>
</li>
</ol>
<p>当前系统配置：<br>/proc/sys/kernel/core_pattern           </p>
<p>core文件所在目录：/opt/logs/logs/core/</p>
<ol start="5">
<li>coredump如何排查<br>业务程序（以java为例）<br>排查方式可以参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/559f939d7931">《JDK core dump分析》</a>。</li>
</ol>
<p>总而言之，<strong>jmap、jstack 都可以直接分析 core</strong>，也可以把它转成 hprof 格式的文件，进行进一步地可视化分析。<br><code>gdb $JAVA_HOME$/bin/java core-26492</code><br><code>/data/soft/jdk/bin/jstack /data/soft/jdk/bin/java core.26492</code><br><code>/data/soft/jdk/bin/jmap /data/soft/jdk/bin/java core.14652</code><br><code>/data/soft/jdk/bin/jmap -dump:format=b,file=dump.hprof /data/soft/jdk/bin/java core.14652</code></p>
<p>进入gdb上下文后再执行bt命令，可以看到进程退出时的线程栈。</p>
<p>代码块<br><code>gdb /data/soft/jdk/bin/java core.11668</code></p>
<blockquote>
<p>GNU gdb (GDB) Red Hat Enterprise Linux 7.6.1-80.el7 Copyright (C) 2013<br>Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or<br>later <a target="_blank" rel="noopener" href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a> This is free software: you<br>are free to change and redistribute it. There is NO WARRANTY, to the<br>extent permitted by law.  Type “show copying” and “show warranty” for<br>details. This GDB was configured as “x86_64-redhat-linux-gnu”. For bug<br>reporting instructions, please see:<br><a target="_blank" rel="noopener" href="http://www.gnu.org/software/gdb/bugs/">http://www.gnu.org/software/gdb/bugs/</a>… Reading symbols from<br>/data/soft/jdk1.8.0_141/bin/java…Missing separate debuginfo for<br>/data/soft/jdk1.8.0_141/bin/java Try: yum –enablerepo=’<em>debug</em>‘<br>install<br>/usr/lib/debug/.build-id/c9/0f19ee0af98c47ccaa7181853cfd14867bc931.debug<br>(no debugging symbols found)…done. [New LWP 14367] … [New LWP<br>14355] [New LWP 11685] [Thread debugging using libthread_db enabled]<br>Using host libthread_db library “/lib64/libthread_db.so.1”. Missing<br>separate debuginfo for<br>/data/soft/jdk1.8.0_141/jre/lib/amd64/server/libjvm.so Try: yum<br>–enablerepo=’<em>debug</em>‘ install /usr/lib/debug/.build-id/43/a2bc419314aa566cd5ba54779ae18b47022cad.debug<br>Missing separate debuginfo for<br>/data/soft/jdk1.8.0_141/jre/lib/amd64/libverify.so Try: yum<br>–enablerepo=’<em>debug</em>‘ install /usr/lib/debug/.build-id/b3/de2701fa3aef182d8e7b2db8d294a91af1eb7c.debug<br>Missing separate debuginfo for<br>/data/soft/jdk1.8.0_141/jre/lib/amd64/libmanagement.so Try: yum<br>–enablerepo=’<em>debug</em>‘ install /usr/lib/debug/.build-id/ee/7e746ef83f2c2fbe8ea0cb42706b63cd74de3f.debug<br>Missing separate debuginfo for<br>/data/soft/jdk1.8.0_141/jre/lib/amd64/libinstrument.so Try: yum<br>–enablerepo=’<em>debug</em>‘ install /usr/lib/debug/.build-id/13/552fe85b2af551ab806735bc5e5f2a5e00fbb1.debug<br>Core was generated by `/data/soft/jdk/bin/java<br>-Djava.util.logging.config.file=/data/home/aics/taskbot’. Program terminated with signal 6, Aborted.<br>#0  0x00007f50d652b1d7 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56 56        return<br>INLINE_SYSCALL (tgkill, 3, pid, selftid, sig); (gdb) bt<br>#0  0x00007f50d652b1d7 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56<br>#1  0x00007f50d652c8c8 in __GI_abort () at abort.c:90<br>#2  0x00007f50397417f4 in tensorflow::internal::LogMessageFatal::~LogMessageFatal() () from<br>/data/home/aics/taskbot-tomcat/temp/tensorflow_native_libraries-1545395060637-0/libtensorflow_framework.so<br>#3  0x00007f5039721cf0 in tensorflow::monitoring::CollectionRegistry::Register(tensorflow::monitoring::AbstractMetricDef<br>const*, std::function&lt;void<br>(tensorflow::monitoring::MetricCollectorGetter)&gt; const&amp;) ()    from<br>/data/home/aics/taskbot-tomcat/temp/tensorflow_native_libraries-1545395060637-0/libtensorflow_framework.so<br>#4  0x00007f501520951f in ?? () from /data/home/aics/taskbot-tomcat/temp/tensorflow_native_libraries-1545633543384-0/libtensorflow_jni.so<br>#5  0x00007f50151334db in ?? () from /data/home/aics/taskbot-tomcat/temp/tensorflow_native_libraries-1545633543384-0/libtensorflow_jni.so<br>#6  0x00007f50d6efd1e3 in call_init (env=0x7f50d00c4460, argv=0x7ffe7bc01488, argc=21, l=<optimized out>) at dl-init.c:82<br>#7  _dl_init (main_map=main_map@entry=0x7f50249fa900, argc=21, argv=0x7ffe7bc01488, env=0x7f50d00c4460) at dl-init.c:131<br>#8  0x00007f50d6f018f6 in dl_open_worker (a=a@entry=0x7f503b2f7b98) at dl-open.c:560<br>#9  0x00007f50d6efcff4 in _dl_catch_error (objname=objname@entry=0x7f503b2f7b88,<br>errstring=errstring@entry=0x7f503b2f7b90,<br>mallocedp=mallocedp@entry=0x7f503b2f7b80,<br>operate=operate@entry=0x7f50d6f01540 <dl_open_worker>,<br>    args=args@entry=0x7f503b2f7b98) at dl-error.c:177<br>#10 0x00007f50d6f00feb in _dl_open (file=0x7f5024008550 “/data/home/aics/taskbot-tomcat/temp/tensorflow_native_libraries-1545633543384-0/libtensorflow_jni.so”,<br>mode=-2147483647, caller_dlopen=<optimized out>, nsid=-2, argc=21,<br>    argv=0x7ffe7bc01488, env=0x7f50d00c4460) at dl-open.c:650<br>#11 0x00007f50d68b8fbb in dlopen_doit (a=a@entry=0x7f503b2f7da0) at dlopen.c:66<br>#12 0x00007f50d6efcff4 in _dl_catch_error (objname=0x7f5024ae73e0, errstring=0x7f5024ae73e8, mallocedp=0x7f5024ae73d8,<br>operate=0x7f50d68b8f60 <dlopen_doit>, args=0x7f503b2f7da0) at<br>dl-error.c:177<br>#13 0x00007f50d68b95bd in _dlerror_run (operate=operate@entry=0x7f50d68b8f60 <dlopen_doit>,<br>args=args@entry=0x7f503b2f7da0) at dlerror.c:163<br>#14 0x00007f50d68b9051 in __dlopen (file=<optimized out>, mode=<optimized out>) at dlopen.c:87<br>#15 0x00007f50d5e2a24e in os::dll_load(char const*, char*, int) () from /data/soft/jdk1.8.0_141/jre/lib/amd64/server/libjvm.so<br>#16 0x00007f50d5c2198c in JVM_LoadLibrary () from /data/soft/jdk1.8.0_141/jre/lib/amd64/server/libjvm.so<br>#17 0x00007f50d4ac7df8 in Java_java_lang_ClassLoader_00024NativeLibrary_load () from<br>/data/soft/jdk1.8.0_141/jre/lib/amd64/libjava.so</p>
</blockquote>
<h2 id="非业务程序"><a href="#非业务程序" class="headerlink" title="非业务程序"></a>非业务程序</h2><p>原则上不建议随便升级容器内部的各种库，如gcc，glibc等，这种随机安装可能导致容器组件不稳定</p>
<h2 id="短期应急方法"><a href="#短期应急方法" class="headerlink" title="短期应急方法"></a>短期应急方法</h2><p>关闭相应组件，例如crond程序经常产生core，可以通过/etc/init.d/crond stop关闭。</p>
<h2 id="长期处理方法"><a href="#长期处理方法" class="headerlink" title="长期处理方法"></a>长期处理方法</h2><p>非业务程序的coredump，可以联系运维人员。</p>
<h1 id="coredump截断问题"><a href="#coredump截断问题" class="headerlink" title="coredump截断问题"></a>coredump截断问题</h1><p>coredump截断分两种情况<br>第一种：通过ulimit的方法限制coredump生成的大小，比如通过ulimit  -c命令限制coredump的大小。</p>
<p>但是这个命令无法限制容器内的coredump的大小。</p>
<p>被ulimit限制后生成截断的大小都是固定的。</p>
<p>第二种：没有限制coredump的大小，但是每次都是随机出现coredump截断的情况。</p>
<p>一般这种情况coredump的core文件本身就已经是完全乱了，导致存储coredump大小的数据也是不准确的。</p>
<p>这种情况下生成的coredump的大小是随机的，每次core大小都不固定。</p>
<p>怎么分辨是什么原因导致的截断</p>
<p>方法1：查看每次生成的core的大小，如果每次生成的coredump的大小都是固定的，那么说明是通过生成coredump的脚本文件限制的</p>
<p>处理方法：业务可以TT到SRE，绑定取消coredump限制。具体方法：取消coredump大小限制</p>
<p>方法2：可以查看生成coredump的Py脚本，查看在生成coredump的时候有没有大小限制。</p>
<p>方法3：如果每次生成的coredump的大小不固定。</p>
<p>这时可以查看tcmalloc等内存管理是不是异常。</p>
<p>有一个比较明显的现象是生成coredump的时间和 tcmalloc异常的时间点每次都是基本吻合，这时候可以找《hulk技术支持》确认即可。</p>
<p>这种情况下tcmalloc的问题修复了，那么coredump被截断的情况也就消失了</p>
<p>coredump截断的影响</p>
<p>在通过gdb调试core文件的时候会提示coredump的大小异常，无法进行gdb的调试。</p>
<h1 id="Linux-支持的信号列表"><a href="#Linux-支持的信号列表" class="headerlink" title="Linux 支持的信号列表"></a>Linux 支持的信号列表</h1><p>一共有 64 种。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -l</span><br><span class="line">1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL</span><br><span class="line"> 5) SIGTRAP      6) SIGABRT      7) SIGBUS       8) SIGFPE</span><br><span class="line"> 9) SIGKILL     10) SIGUSR1     11) SIGSEGV     12) SIGUSR2</span><br><span class="line">13) SIGPIPE     14) SIGALRM     15) SIGTERM     17) SIGCHLD</span><br><span class="line">18) SIGCONT     19) SIGSTOP     20) SIGTSTP     21) SIGTTIN</span><br><span class="line">22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ</span><br><span class="line">26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO</span><br><span class="line">30) SIGPWR      31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1</span><br><span class="line">36) SIGRTMIN+2  37) SIGRTMIN+3  38) SIGRTMIN+4  39) SIGRTMIN+5</span><br><span class="line">40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8  43) SIGRTMIN+9</span><br><span class="line">44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13</span><br><span class="line">48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13</span><br><span class="line">52) SIGRTMAX-12 53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9</span><br><span class="line">56) SIGRTMAX-8  57) SIGRTMAX-7  58) SIGRTMAX-6  59) SIGRTMAX-5</span><br><span class="line">60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2  63) SIGRTMAX-1</span><br><span class="line">64) SIGRTMAX</span><br></pre></td></tr></table></figure>


                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2021-11-08");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2021-09-11T13:52:35.000Z" itemprop="datePublished">2021-09-11</time>

    , Updated at&nbsp;<time datetime="2021-11-08T09:20:25.000Z" itemprop="dateModified">2021-11-08</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/Linux/" rel="tag">#&nbsp;Linux</a>

<a class="post-tags-list-item" href="/tags/Unix/" rel="tag">#&nbsp;Unix</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2021/09/14/%E5%A6%82%E4%BD%95%E5%81%9A%E5%A5%BD%E6%8A%80%E6%9C%AF%E8%A7%84%E5%88%92%EF%BC%8C%E4%B8%80/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">如何做好技术规划，一</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2021/09/08/%E4%BC%8A%E6%96%AF%E5%85%B0%E6%95%99%E4%B8%8E%E6%B8%85%E7%9C%9F%E9%A3%9F%E5%93%81/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">伊斯兰教与清真食品</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>