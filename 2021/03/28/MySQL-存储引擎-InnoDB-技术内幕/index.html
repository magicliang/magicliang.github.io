<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>MySQL 存储引擎- InnoDB 技术内幕 | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="MySQL 存储引擎- InnoDB 技术内幕 | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="前言MySQL 是处理海量数据（尤其 是OLTP 写入）时仍能获得最佳性能的最佳选择之一，它的 CPU 效率可能其他任何基于磁盘的关系型数据库所不能匹敌的-但它应该能够匹敌 Redis。 Think Different 而不是 Think Differently，这意味着要思考不同的东西，而不只是思考不同的方式。 不要相信网上的传言，去做测试，根据自己的实践做决定。 change buffer 是 - magicliang - 守株阁"><meta name="keywords" content="数据库, MySQL"><meta property="article:published_time" content="2021-03-28T08:22:25.000Z"><meta property="article:modified_time" content="2021-03-30T08:08:20.000Z"><meta property="og:updated_time" content="2021-03-30T08:08:20.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="数据库, MySQL"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/"
    },
    "headline": "MySQL 存储引擎- InnoDB 技术内幕 | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2021-03-28T08:22:25.000Z",
    "dateModified": "2021-03-30T08:08:20.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "数据库, MySQL",
    "description": "前言MySQL 是处理海量数据（尤其 是OLTP 写入）时仍能获得最佳性能的最佳选择之一，它的 CPU 效率可能其他任何基于磁盘的关系型数据库所不能匹敌的-但它应该能够匹敌 Redis。 Think Different 而不是 Think Differently，这意味着要思考不同的东西，而不只是思考不同的方式。 不要相信网上的传言，去做测试，根据自己的实践做决定。 change buffer 是 - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=MySQL 存储引擎- InnoDB 技术内幕" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=MySQL 存储引擎- InnoDB 技术内幕&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=MySQL 存储引擎- InnoDB 技术内幕" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANQAAADUCAAAAADBtVLEAAADq0lEQVR42u3cUW7rMAwFUe9/0+1XgSK1eIdyEzPB+KfpS2zr5MESRRI9vj7wOESJEiVK1MehjuL4/f7P68ef9Nw/A1hc9/Ecei9RoiahVjdd3Wjny9jFPb63GqcoUdNQ6SLVw7t6vTonXSNNUqtxihL1DqizgZ29Xk0G1USzmiyqe4sS9e6oclO2EYBWi28VEIgS9W6oKlDsLKCr81cTS1rUO+MUJWoKKm32pvz812ySKFFPQtEFlgSbnUQNCVhJALBV9RAl6omobuKEJj7JxJOunzaosUAgStQNqJQEoYnNNMmQAZMNZzlhiRI1BHVl8esWA6pNILlO+UWJEjUAhU8IRek02aQvJBUmVpNFK0MrStQLUGRDeCnBWGwKaSCMCwuiRA1CpcWWNEalhim6+Uwby+XmUZSoIahOUjENgmzyaCKHFO2WE4UoUTehqk1Zep8mRKrrk+QLTfyIEjUBlR7CVrP74uZpsSZFBlTEECVqAKq7MFYTBE0+Jtz2Yi9K1EBUlcxPC3WaJFLAvBPwihI1FUULcGkw3QTpTsF8+XlRogagaDBKiwLVYpuaT7qTDm4OESXqxShS4LpSoFv93g2A45cnStQAVDc5khKZnQQKSX6SJmNRoqajYhMGKMylc0gSphpPe6IQJerFqBRs0gJdpymxs6lEjSKiRA1C0Qc1Hd0Jhwaw6T9BlKhJKBKEkoA2BaGdCYIEtH+uIUrUEFS3oYrePC3O3URPKnSLEjUJlZqZaPG524yYYNX7OKIQJeqFKFJYS5NAp7EqDbJbEBclahpqZyFNzb10YKmITScaUaKmorrNiqR5ijZIpoW3Kt6JEjUJRYLZDpg0T6FGD1jYEyVqIooWpasHmATAuzjaUClK1BQUKQRUiUSaJKETB1mYRYmajCKDpPDquighCZKXseFKlKibUTSg7Dz8ZPHsFtO3o3RRom5AERwtIHSS+50gNm5mRYkahqInkyRnt9BNCuWx+C1K1CBUCkrJzUmxgRTbSDB8+llRogag6ERAE450Q9dNlm51O4sSdQOKTArk31OjCNkokiRoBRQlagIqNRpWv5PNXWruoIlNUngTJWoKihQLSJMIuTktFqSg4HRyEiVqEKr7ENMky06z/QGOGKWLEjUUlRbb6rNXkqSpeF42h4gS9QYoGqR2gtmESomayxOFKFFPRHUbPFoF5oP9wahOAa4suokSdTOKJF5o0rGzYJaJSVhYuJRNEiXqCahPOkSJEiVK1Mcc320+MU3weMeuAAAAAElFTkSuQmCC" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">MySQL 存储引擎- InnoDB 技术内幕</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2021-03-28</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=MySQL 存储引擎- InnoDB 技术内幕&url=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=MySQL 存储引擎- InnoDB 技术内幕&url=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2021/03/28/MySQL-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E-InnoDB-%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANQAAADUCAAAAADBtVLEAAADq0lEQVR42u3cUW7rMAwFUe9/0+1XgSK1eIdyEzPB+KfpS2zr5MESRRI9vj7wOESJEiVK1MehjuL4/f7P68ef9Nw/A1hc9/Ecei9RoiahVjdd3Wjny9jFPb63GqcoUdNQ6SLVw7t6vTonXSNNUqtxihL1DqizgZ29Xk0G1USzmiyqe4sS9e6oclO2EYBWi28VEIgS9W6oKlDsLKCr81cTS1rUO+MUJWoKKm32pvz812ySKFFPQtEFlgSbnUQNCVhJALBV9RAl6omobuKEJj7JxJOunzaosUAgStQNqJQEoYnNNMmQAZMNZzlhiRI1BHVl8esWA6pNILlO+UWJEjUAhU8IRek02aQvJBUmVpNFK0MrStQLUGRDeCnBWGwKaSCMCwuiRA1CpcWWNEalhim6+Uwby+XmUZSoIahOUjENgmzyaCKHFO2WE4UoUTehqk1Zep8mRKrrk+QLTfyIEjUBlR7CVrP74uZpsSZFBlTEECVqAKq7MFYTBE0+Jtz2Yi9K1EBUlcxPC3WaJFLAvBPwihI1FUULcGkw3QTpTsF8+XlRogagaDBKiwLVYpuaT7qTDm4OESXqxShS4LpSoFv93g2A45cnStQAVDc5khKZnQQKSX6SJmNRoqajYhMGKMylc0gSphpPe6IQJerFqBRs0gJdpymxs6lEjSKiRA1C0Qc1Hd0Jhwaw6T9BlKhJKBKEkoA2BaGdCYIEtH+uIUrUEFS3oYrePC3O3URPKnSLEjUJlZqZaPG524yYYNX7OKIQJeqFKFJYS5NAp7EqDbJbEBclahpqZyFNzb10YKmITScaUaKmorrNiqR5ijZIpoW3Kt6JEjUJRYLZDpg0T6FGD1jYEyVqIooWpasHmATAuzjaUClK1BQUKQRUiUSaJKETB1mYRYmajCKDpPDquighCZKXseFKlKibUTSg7Dz8ZPHsFtO3o3RRom5AERwtIHSS+50gNm5mRYkahqInkyRnt9BNCuWx+C1K1CBUCkrJzUmxgRTbSDB8+llRogag6ERAE450Q9dNlm51O4sSdQOKTArk31OjCNkokiRoBRQlagIqNRpWv5PNXWruoIlNUngTJWoKihQLSJMIuTktFqSg4HRyEiVqEKr7ENMky06z/QGOGKWLEjUUlRbb6rNXkqSpeF42h4gS9QYoGqR2gtmESomayxOFKFFPRHUbPFoF5oP9wahOAa4suokSdTOKJF5o0rGzYJaJSVhYuJRNEiXqCahPOkSJEiVK1Mcc320+MU3weMeuAAAAAElFTkSuQmCC" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%89%8D%E8%A8%80"><span class="post-toc-number">1.</span> <span class="post-toc-text">前言</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MySQL-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%92%8C%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="post-toc-number">2.</span> <span class="post-toc-text">MySQL 体系结构和存储引擎</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E5%AE%9E%E4%BE%8B"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">定义数据库和实例</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#InnoDB-%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="post-toc-number">3.</span> <span class="post-toc-text">InnoDB 的存储引擎</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#InnoDB-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%A6%82%E8%BF%B0"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">InnoDB 存储引擎概述</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%90%8E%E5%8F%B0%E7%BA%BF%E7%A8%8B%E5%8C%85%E6%8B%AC"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">后台线程包括</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#master-thread"><span class="post-toc-number">3.1.1.1.</span> <span class="post-toc-text">master thread</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#IO-thread"><span class="post-toc-number">3.1.1.2.</span> <span class="post-toc-text">IO thread</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#purge-thread"><span class="post-toc-number">3.1.1.3.</span> <span class="post-toc-text">purge thread</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#page-cleaner-thread"><span class="post-toc-number">3.1.1.4.</span> <span class="post-toc-text">page cleaner thread</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%86%85%E5%AD%98"><span class="post-toc-number">3.1.2.</span> <span class="post-toc-text">内存</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%BC%93%E5%86%B2%E6%B1%A0"><span class="post-toc-number">3.1.2.1.</span> <span class="post-toc-text">缓冲池</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#LRU-list%E3%80%81free-list-%E5%92%8C-Flush-list"><span class="post-toc-number">3.1.2.2.</span> <span class="post-toc-text">LRU list、free list 和 Flush list</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#redo-log-buffer"><span class="post-toc-number">3.1.2.3.</span> <span class="post-toc-text">redo log buffer</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#additional-mem-pool"><span class="post-toc-number">3.1.2.4.</span> <span class="post-toc-text">additional mem pool</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#checkpoint-%E6%8A%80%E6%9C%AF"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">checkpoint 技术</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#innodb-%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">innodb 关键特性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#insert-buffer"><span class="post-toc-number">3.3.1.</span> <span class="post-toc-text">insert buffer</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#change-buffer"><span class="post-toc-number">3.3.2.</span> <span class="post-toc-text">change buffer</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#insert-buffer-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="post-toc-number">3.3.3.</span> <span class="post-toc-text">insert buffer 的实现</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#doublewrite"><span class="post-toc-number">3.3.4.</span> <span class="post-toc-text">doublewrite</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%87%AA%E9%80%82%E5%BA%94%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95"><span class="post-toc-number">3.3.5.</span> <span class="post-toc-text">自适应哈希索引</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%BC%82%E6%AD%A5-io"><span class="post-toc-number">3.3.6.</span> <span class="post-toc-text">异步 io</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%88%B7%E6%96%B0%E9%82%BB%E6%8E%A5%E9%A1%B5%EF%BC%88flush-neighbor-page%EF%BC%89"><span class="post-toc-number">3.3.7.</span> <span class="post-toc-text">刷新邻接页（flush neighbor page）</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%90%AF%E5%8A%A8%E3%80%81%E5%85%B3%E9%97%AD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">启动、关闭与恢复</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E6%96%87%E4%BB%B6"><span class="post-toc-number">4.</span> <span class="post-toc-text">文件</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E8%A1%A8"><span class="post-toc-number">5.</span> <span class="post-toc-text">表</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%94%81"><span class="post-toc-number">6.</span> <span class="post-toc-text">锁</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="post-toc-number">7.</span> <span class="post-toc-text">事务</span></a></li></ol></div>
                        
                    
                    <article id="post-content">
                        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>MySQL 是处理海量数据（尤其 是OLTP 写入）时仍能获得最佳性能的最佳选择之一，它的 CPU 效率可能其他任何基于磁盘的关系型数据库所不能匹敌的-但它应该能够匹敌 Redis。</p>
<p>Think Different 而不是 Think Differently，这意味着要思考不同的东西，而不只是思考不同的方式。</p>
<p>不要相信网上的传言，去做测试，根据自己的实践做决定。</p>
<p>change buffer 是 inert buffer 的升级版本。</p>
<h1 id="MySQL-体系结构和存储引擎"><a href="#MySQL-体系结构和存储引擎" class="headerlink" title="MySQL 体系结构和存储引擎"></a>MySQL 体系结构和存储引擎</h1><h2 id="定义数据库和实例"><a href="#定义数据库和实例" class="headerlink" title="定义数据库和实例"></a>定义数据库和实例</h2><ul>
<li>数据库：物理操作系统文件或其他形式文件类型的集合。</li>
<li>实例：操作系统后台进程（线程和一堆共享内存）。</li>
<li>存储引擎：基于表而不是基于库的，所以一个库可以有不同的表使用不同的存储引擎。</li>
</ul>
<p>InnoDB 将数据存储在逻辑的表空间中，这个表空间就像黑盒一样。</p>
<p>存储引擎不一定需要事务。比如没有 ETL 的操作，单纯的查询操作不需要考虑并发控制问题，不需要产生一致性视图。</p>
<p>NDB 存储引擎是一个集群存储引擎，类似 RAC 集群。不过与 Oracle RAC share everything 不同，NDB share nothing，而且把数据放在内存中。</p>
<p>如果不需要事务，文件系统就可以当做数据库。数据库区别于文件系统的地方就是，数据库可以支持事务（不代表必然使用事务）。</p>
<p>用户可以按照文档 16 章自己写自己的存储引擎。</p>
<h1 id="InnoDB-的存储引擎"><a href="#InnoDB-的存储引擎" class="headerlink" title="InnoDB 的存储引擎"></a>InnoDB 的存储引擎</h1><p>InnoDB 是 transactional-safe 的 MySQL 存储引擎。</p>
<h2 id="InnoDB-存储引擎概述"><a href="#InnoDB-存储引擎概述" class="headerlink" title="InnoDB 存储引擎概述"></a>InnoDB 存储引擎概述</h2><p>InnoDB 当前支持每秒 800 次的写入，也可以存储 1tb 以上的数据。</p>
<p>InnoDB 的体系结构可以大体包括：</p>
<p>后台线程 + 内存池 + 文件</p>
<h3 id="后台线程包括"><a href="#后台线程包括" class="headerlink" title="后台线程包括"></a>后台线程包括</h3><h4 id="master-thread"><a href="#master-thread" class="headerlink" title="master thread"></a>master thread</h4><p>负责异步地将缓冲池中的数据异步地刷新到磁盘，dirty page refresh、merging insert buffer。</p>
<h4 id="IO-thread"><a href="#IO-thread" class="headerlink" title="IO thread"></a>IO thread</h4><p>在 InnoDB 中大量使用 AIO 来处理 IO 写请求。</p>
<h4 id="purge-thread"><a href="#purge-thread" class="headerlink" title="purge thread"></a>purge thread</h4><p>purge 操作是从 master thread 里单独分离出来的一部分职能，专门处理 undo log。</p>
<h4 id="page-cleaner-thread"><a href="#page-cleaner-thread" class="headerlink" title="page cleaner thread"></a>page cleaner thread</h4><p>定时将之前版本中的 dirty page refresh 的职责分离出来。</p>
<h3 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h3><h4 id="缓冲池"><a href="#缓冲池" class="headerlink" title="缓冲池"></a>缓冲池</h4><p>为了弥合 cpu 和磁盘的性能鸿沟，基于磁盘的数据库必然引入内存缓冲池。</p>
<p>主要的内存缓冲池有：</p>
<ul>
<li>innodb_buffer_pool</li>
<li>redo_log_buffer</li>
<li>innodb_additional_mem_pool_size</li>
</ul>
<p>有了内存缓冲池，就允许出现脏页。把脏页刷新到磁盘上，是通过 checkpoint 机制实现的。</p>
<h4 id="LRU-list、free-list-和-Flush-list"><a href="#LRU-list、free-list-和-Flush-list" class="headerlink" title="LRU list、free list 和 Flush list"></a>LRU list、free list 和 Flush list</h4><p>innodb 使用这三种 list，来调度不同的脏页。</p>
<p>所有的数据页，调度进内存，都要调度进 lru list 里（调度进某个 midpoint）。所以，有时候查询数据会导致新页加载进内存，脏页刷盘，引发 checkpoint。</p>
<h4 id="redo-log-buffer"><a href="#redo-log-buffer" class="headerlink" title="redo log buffer"></a>redo log buffer</h4><p>这个 buffer 是 wal 写入磁盘之前的 buffer。注意 wal 的 buffer 刷新到磁盘，不是脏页的刷新到磁盘（checkpoint 实际上就是 dirty page refresh）。</p>
<p>通常情况下，每一秒钟这个 buffer 会被刷新到磁盘上（通过 page cleaner thread），只要用户每秒产生的事务量在这个缓冲大小之内即可。</p>
<p>总共有三种情况下会发生内容刷新：</p>
<ul>
<li>一秒定时</li>
<li>事务提交</li>
<li>buffer 的大小小于 1/2时</li>
</ul>
<p>这代表了三种策略：</p>
<ul>
<li>时间</li>
<li>空间阈值</li>
<li>持久化事件</li>
</ul>
<h4 id="additional-mem-pool"><a href="#additional-mem-pool" class="headerlink" title="additional mem pool"></a>additional mem pool</h4><p>管理一些 buffer controll block。</p>
<h2 id="checkpoint-技术"><a href="#checkpoint-技术" class="headerlink" title="checkpoint 技术"></a>checkpoint 技术</h2><p>checkpoint 保证，在灾难恢复时，过了 checkpoint 的 redo 日志才需要关注。这样可以减少宕机恢复时间。</p>
<p>重做日志不可能无限被使用，所以一旦要重用重做日志，必然带来强制的 checkpoint，导致脏页至少被刷新到 redolog 当前的位置。</p>
<p>标记 redolog 的位置方法是 LSN（log sequence number）。</p>
<p>有以下几种情况会触发 checkpoint：</p>
<ul>
<li>Master Thread 定时刷新脏页</li>
<li>LRU 脏页列表大小不够</li>
<li>redo log 大小不够</li>
<li>脏页数量太多</li>
</ul>
<h2 id="innodb-关键特性"><a href="#innodb-关键特性" class="headerlink" title="innodb 关键特性"></a>innodb 关键特性</h2><h3 id="insert-buffer"><a href="#insert-buffer" class="headerlink" title="insert buffer"></a>insert buffer</h3><p>Insert Buffer 既是内存缓冲池的一部分，也是物理页的一部分。</p>
<p>对于非唯一的辅助索引，为了减少随机插入，InnoDB 在插入更新数据页的时候，会想办法校验缓冲池里有没有该数据页。如果有，则先处理缓冲池里的数据；否则，在插入缓冲里插入一页，欺骗（mock）全流程，然后继续剩下的 buffer pool 操作。</p>
<h3 id="change-buffer"><a href="#change-buffer" class="headerlink" title="change buffer"></a>change buffer</h3><p>change buffer 可以缓冲 dml 了，insert、delete 和 purge 都可以缓冲。</p>
<h3 id="insert-buffer-的实现"><a href="#insert-buffer-的实现" class="headerlink" title="insert buffer 的实现"></a>insert buffer 的实现</h3><p>全局有一个 insert buffer b+树，存放在 ibdata 中。</p>
<p>非唯一的辅助索引在插入到数据库中时，会构造一条记录，然后插入到这棵树中。当读写发生的是，只要需要读最终数据，都要触发 merging。这种索引的性能提升借助于不做唯一性检查。</p>
<h3 id="doublewrite"><a href="#doublewrite" class="headerlink" title="doublewrite"></a>doublewrite</h3><p>写入一个数据页不一定能够原子成功。有可能发生部分写失效（partial page write）。因为 redo log 是物理日志，所以强依赖于页的状态。</p>
<p>doublewrite 的意思是，重做发生时，需要先把页副本还原出特定的页，然后再 apply redo log。</p>
<p>innodb 在刷新脏页时，会先写入 double write buffer，然后双写到表空间里的 double write extent 里，最后再用 fsync 把脏页刷新到 ibd 数据文件里。</p>
<h3 id="自适应哈希索引"><a href="#自适应哈希索引" class="headerlink" title="自适应哈希索引"></a>自适应哈希索引</h3><p>innodb 会自动根据访问的频率和模式来自动地某些热点页建立哈希索引。</p>
<h3 id="异步-io"><a href="#异步-io" class="headerlink" title="异步 io"></a>异步 io</h3><p>native aio 需要操作系统的支持。</p>
<h3 id="刷新邻接页（flush-neighbor-page）"><a href="#刷新邻接页（flush-neighbor-page）" class="headerlink" title="刷新邻接页（flush neighbor page）"></a>刷新邻接页（flush neighbor page）</h3><p>机械硬盘需要这个功能，固态硬盘不怎么需要。</p>
<h2 id="启动、关闭与恢复"><a href="#启动、关闭与恢复" class="headerlink" title="启动、关闭与恢复"></a>启动、关闭与恢复</h2><p>默认的情况下，MySQL 会在关闭和重启时，把脏页刷新回磁盘。所以有时候 MySQL 重启的速度可能非常慢。</p>
<h1 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h1><p>现在默认的 binlog 格式是 row。</p>
<p>redolog 使用的是 ib_logfile1、ib_logfile2，循环使用。</p>
<h1 id="表"><a href="#表" class="headerlink" title="表"></a>表</h1><p>tablespace 下分为 段 segment、区 extent 和页 page。</p>
<p>默认的行格式是 compact。</p>
<h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><p>注意意向锁之间的兼容性。</p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>redo 保证持久性。它的地址空间需要用来重用。</p>
<p>undo 保证原子性和 mvcc。它的地址空间需要被 purge 线程消除。</p>

                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2021-03-30");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2021-03-28T08:22:25.000Z" itemprop="datePublished">2021-03-28</time>

    , Updated at&nbsp;<time datetime="2021-03-30T08:08:20.000Z" itemprop="dateModified">2021-03-30</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">#&nbsp;数据库</a>

<a class="post-tags-list-item" href="/tags/MySQL/" rel="tag">#&nbsp;MySQL</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2021/04/12/%E7%BB%93%E7%AE%97%E9%97%AE%E9%A2%98/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">结算问题</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2021/03/24/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%B9%E7%81%BE%E4%BD%93%E7%B3%BB%E7%9A%84%E6%BC%94%E5%8F%98/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">数据库容灾体系的演变</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>