<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>é¢å‘æµ‹è¯•ç¼–ç¨‹ | å®ˆæ ªé˜</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Œä»€ä¹ˆæ˜¯é›†æˆæµ‹è¯• å•å…ƒæµ‹è¯•æ˜¯åªæµ‹è¯•ä¸€ä¸ªç‰¹å®šå•å…ƒçš„æµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•éœ€è¦å¯åŠ¨å¤šä¸ªå±‚è€Œä¸æ˜¯åªå¯åŠ¨è¿™ä¸ªè¢«æµ‹è¯•å•å…ƒï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªé›†æˆæµ‹è¯•ã€‚ æµ‹è¯•é‡‘å­—å¡” æµ‹è¯•é‡‘å­—å¡”æè¿°äº†ç†æƒ³æµ‹è¯•å¥—ä»¶çš„ç»“æ„ï¼šå¤§é‡å¿«é€Ÿçš„å•å…ƒæµ‹è¯•æ„æˆåº•å±‚ï¼Œé€‚é‡çš„é›†æˆæµ‹è¯•æ„æˆä¸­å±‚ï¼Œå°‘é‡çš„ç«¯åˆ°ç«¯æµ‹è¯•æ„æˆé¡¶å±‚ã€‚å•å…ƒæµ‹è¯•è¿è¡Œé€Ÿåº¦å¿«ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œåº”å æµ‹è¯•å¥—ä»¶çš„70%ä»¥ä¸Šï¼›é›†æˆæµ‹è¯•éªŒè¯ç»„ä»¶åä½œï¼Œçº¦å 20%ï¼›ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯å®Œæ•´ç”¨æˆ·åœºæ™¯ï¼Œçº¦å 10%ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="é¢å‘æµ‹è¯•ç¼–ç¨‹">
<meta property="og:url" content="https://magicliang.github.io/2021/12/28/%E9%9D%A2%E5%90%91%E6%B5%8B%E8%AF%95%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="å®ˆæ ªé˜">
<meta property="og:description" content="ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Œä»€ä¹ˆæ˜¯é›†æˆæµ‹è¯• å•å…ƒæµ‹è¯•æ˜¯åªæµ‹è¯•ä¸€ä¸ªç‰¹å®šå•å…ƒçš„æµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•éœ€è¦å¯åŠ¨å¤šä¸ªå±‚è€Œä¸æ˜¯åªå¯åŠ¨è¿™ä¸ªè¢«æµ‹è¯•å•å…ƒï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªé›†æˆæµ‹è¯•ã€‚ æµ‹è¯•é‡‘å­—å¡” æµ‹è¯•é‡‘å­—å¡”æè¿°äº†ç†æƒ³æµ‹è¯•å¥—ä»¶çš„ç»“æ„ï¼šå¤§é‡å¿«é€Ÿçš„å•å…ƒæµ‹è¯•æ„æˆåº•å±‚ï¼Œé€‚é‡çš„é›†æˆæµ‹è¯•æ„æˆä¸­å±‚ï¼Œå°‘é‡çš„ç«¯åˆ°ç«¯æµ‹è¯•æ„æˆé¡¶å±‚ã€‚å•å…ƒæµ‹è¯•è¿è¡Œé€Ÿåº¦å¿«ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œåº”å æµ‹è¯•å¥—ä»¶çš„70%ä»¥ä¸Šï¼›é›†æˆæµ‹è¯•éªŒè¯ç»„ä»¶åä½œï¼Œçº¦å 20%ï¼›ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯å®Œæ•´ç”¨æˆ·åœºæ™¯ï¼Œçº¦å 10%ã€‚">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/img/wall-paper-50.jpg">
<meta property="article:published_time" content="2021-12-28T03:27:55.000Z">
<meta property="article:modified_time" content="2026-02-07T16:13:15.144Z">
<meta property="article:author" content="magicliang">
<meta property="article:tag" content="æµ‹è¯•">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/img/wall-paper-50.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é¢å‘æµ‹è¯•ç¼–ç¨‹",
  "url": "https://magicliang.github.io/2021/12/28/%E9%9D%A2%E5%90%91%E6%B5%8B%E8%AF%95%E7%BC%96%E7%A8%8B/",
  "image": "https://magicliang.github.io/img/wall-paper-50.jpg",
  "datePublished": "2021-12-28T03:27:55.000Z",
  "dateModified": "2026-02-07T16:13:15.144Z",
  "author": [
    {
      "@type": "Person",
      "name": "magicliang",
      "url": "https://magicliang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/2021/12/28/%E9%9D%A2%E5%90%91%E6%B5%8B%E8%AF%95%E7%BC%96%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: å®ˆæ ªé˜","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'é¢å‘æµ‹è¯•ç¼–ç¨‹',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="å®ˆæ ªé˜" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/wall-paper-50.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å®ˆæ ªé˜</span></a><a class="nav-page-title" href="/"><span class="site-name">é¢å‘æµ‹è¯•ç¼–ç¨‹</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">é¢å‘æµ‹è¯•ç¼–ç¨‹</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-12-28T03:27:55.000Z" title="Created 2021-12-28 11:27:55">2021-12-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-07T16:13:15.144Z" title="Updated 2026-02-08 00:13:15">2026-02-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">5.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>24mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1>ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Œä»€ä¹ˆæ˜¯é›†æˆæµ‹è¯•</h1>
<p>å•å…ƒæµ‹è¯•æ˜¯åªæµ‹è¯•ä¸€ä¸ªç‰¹å®šå•å…ƒçš„æµ‹è¯•ï¼Œå¦‚æœæµ‹è¯•éœ€è¦å¯åŠ¨å¤šä¸ªå±‚è€Œä¸æ˜¯åªå¯åŠ¨è¿™ä¸ªè¢«æµ‹è¯•å•å…ƒï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªé›†æˆæµ‹è¯•ã€‚</p>
<h2 id="æµ‹è¯•é‡‘å­—å¡”">æµ‹è¯•é‡‘å­—å¡”</h2>
<p>æµ‹è¯•é‡‘å­—å¡”æè¿°äº†ç†æƒ³æµ‹è¯•å¥—ä»¶çš„ç»“æ„ï¼šå¤§é‡å¿«é€Ÿçš„å•å…ƒæµ‹è¯•æ„æˆåº•å±‚ï¼Œé€‚é‡çš„é›†æˆæµ‹è¯•æ„æˆä¸­å±‚ï¼Œå°‘é‡çš„ç«¯åˆ°ç«¯æµ‹è¯•æ„æˆé¡¶å±‚ã€‚å•å…ƒæµ‹è¯•è¿è¡Œé€Ÿåº¦å¿«ã€ç»´æŠ¤æˆæœ¬ä½ï¼Œåº”å æµ‹è¯•å¥—ä»¶çš„70%ä»¥ä¸Šï¼›é›†æˆæµ‹è¯•éªŒè¯ç»„ä»¶åä½œï¼Œçº¦å 20%ï¼›ç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯å®Œæ•´ç”¨æˆ·åœºæ™¯ï¼Œçº¦å 10%ã€‚éµå¾ªé‡‘å­—å¡”åŸåˆ™èƒ½ä¿è¯æµ‹è¯•åé¦ˆé€Ÿåº¦å’Œæˆæœ¬æ•ˆç›Šçš„å¹³è¡¡ã€‚</p>
<h2 id="æµ‹è¯•ç­–ç•¥é€‰æ‹©">æµ‹è¯•ç­–ç•¥é€‰æ‹©</h2>
<p>é€‰æ‹©æµ‹è¯•ç±»å‹æ—¶éœ€æƒè¡¡é€Ÿåº¦ã€å¯é æ€§å’Œæˆæœ¬ã€‚å•å…ƒæµ‹è¯•é€‚åˆéªŒè¯å¤æ‚ä¸šåŠ¡é€»è¾‘å’Œè¾¹ç•Œæ¡ä»¶ï¼Œåº”ä¼˜å…ˆç¼–å†™ï¼›é›†æˆæµ‹è¯•é€‚åˆéªŒè¯ç»„ä»¶åä½œå’Œé…ç½®æ­£ç¡®æ€§ï¼Œç”¨äºè¦†ç›–å•å…ƒæµ‹è¯•æ— æ³•è§¦åŠçš„è¾¹ç•Œï¼›ç«¯åˆ°ç«¯æµ‹è¯•é€‚åˆéªŒè¯å…³é”®ç”¨æˆ·è·¯å¾„ï¼Œä½†ç»´æŠ¤æˆæœ¬é«˜ï¼Œåº”è°¨æ…ä½¿ç”¨ã€‚</p>
<h2 id="ä»£ç åˆ†ç±»æµ‹è¯•ç­–ç•¥">ä»£ç åˆ†ç±»æµ‹è¯•ç­–ç•¥</h2>
<p>ä¸€ç§æ¯”è¾ƒå‰æ²¿çš„è§‚ç‚¹è®¤ä¸ºï¼šè®¿é—®ä»£ç ã€ç®¡ç†è€…ä»£ç ã€å­˜å‚¨ä»£ç å’Œä¸šåŠ¡ä»£ç é‡Œï¼Œåªæœ‰ç¬¬å››ç§éœ€è¦æµ‹è¯•ï¼Œå…¶ä»–çš„é€»è¾‘çš„æ­£ç¡®æ€§åªè¦ç”±é¡ºåºæ‰§è¡Œä¿è¯å°±è¡Œäº†ã€‚è¿™ç¬¬å››ç§æµ‹è¯•ï¼Œæ˜¯ä¸éœ€è¦mockçš„ï¼Œå°½é‡ä½¿ç”¨mainå°±èƒ½å¯åŠ¨ã€‚è¿™å°±è¦æ±‚æŠŠä¸šåŠ¡é€»è¾‘å’Œè¾“å…¥è¾“å‡ºè§£è€¦ã€‚å’Œè¾“å…¥è§£è€¦æ¯”è¾ƒç®€å•ï¼Œå’Œè¾“å‡ºè§£è€¦éœ€è¦ä¸€å®šçš„å·§æ€â€”â€”æŠŠä¸šåŠ¡é€»è¾‘å†™æˆçº¯å‡½æ•°ä¹Ÿè®¸èƒ½è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚</p>
<p>è€Œé›†æˆæµ‹è¯•æ„å‘³ç€è¦å¯åŠ¨å°½å¯èƒ½å¤§çš„å®Œæ•´ç¨‹åºï¼Œè¿›è¡Œï¼š</p>
<ul>
<li>åŠŸèƒ½æµ‹è¯•</li>
<li>éªŒæ”¶æµ‹è¯•</li>
<li>ç«¯åˆ°ç«¯æµ‹è¯•</li>
</ul>
<h1>mock object</h1>
<p>å†å²ä¸Šçš„ mock object æ˜¯ä¸ºäº† peel out æ•´ä¸ª frameworkï¼Œè®©æµ‹è¯•å˜è½»è€Œè®¾è®¡å‡ºæ¥çš„ã€‚ä½†å¦‚æœ mock çš„é…ç½®æ¯”è¾ƒç¹çï¼Œåˆ™ mock ä»ç„¶å¾ˆé‡ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡çš„ä¾èµ–çš„è¡Œä¸ºå¾ˆéš¾å®šåˆ¶è€Œéœ€è¦å®šåˆ¶çš„æ—¶å€™ï¼Œmock å¯¹è±¡å°±ç™»åœºäº†ã€‚åœ¨å†å²ä¸Šï¼Œè½¯ä»¶å·¥ç¨‹çš„è¯­è¨€é‡Œï¼Œå…³äºä»€ä¹ˆæ˜¯ mockã€stubã€fake å’Œ stub æœ‰æ¼«é•¿çš„äº‰è®ºï¼Œå®ƒä»¬çš„å…±åŒç‚¹æ˜¯éƒ½æ˜¯<strong>çœŸæ¥å£çš„å‡å®ç°</strong>ã€‚</p>
<p>Mockito å·²ç»å®Œæˆäº†ä¸€ä¸ª mock çš„ç²¾ç¡®å®šä¹‰ï¼Œstub å’Œ spy éƒ½æ˜¯ mock çš„ä¸€äº›å­è¡Œä¸ºï¼Œæˆ–è€…ç‰¹å®šç±»å‹ã€‚</p>
<h2 id="mockito-æ ¸å¿ƒç”¨æ³•">Mockito æ ¸å¿ƒç”¨æ³•</h2>
<h3 id="stubbingï¼šé…ç½®è¡Œä¸º">Stubbingï¼šé…ç½®è¡Œä¸º</h3>
<p>Stubbing é€šè¿‡ <code>when().thenReturn()</code> è¯­æ³•é…ç½® mock å¯¹è±¡çš„è¡Œä¸ºï¼Œè¿™æ˜¯æœ€å¸¸è§çš„ mock æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.mockito.Mockito.*;<br><br>List&lt;String&gt; mockedList = mock(List.class);<br><span class="hljs-keyword">when</span>(mockedList.get(<span class="hljs-number">0</span>)).thenReturn(<span class="hljs-string">&quot;first&quot;</span>);<br><span class="hljs-keyword">when</span>(mockedList.get(anyInt())).thenReturn(<span class="hljs-string">&quot;element&quot;</span>);<br><br>assertEquals(<span class="hljs-string">&quot;first&quot;</span>, mockedList.get(<span class="hljs-number">0</span>));<br>assertEquals(<span class="hljs-string">&quot;element&quot;</span>, mockedList.get(<span class="hljs-number">999</span>));<br></code></pre></td></tr></table></figure>
<h3 id="verificationï¼šéªŒè¯è°ƒç”¨">Verificationï¼šéªŒè¯è°ƒç”¨</h3>
<p>Mockito æ”¯æŒéªŒè¯ mock å¯¹è±¡çš„æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ã€è°ƒç”¨æ¬¡æ•°ã€è°ƒç”¨é¡ºåºç­‰è¡Œä¸ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">List</span> <span class="hljs-variable">mockedList</span> <span class="hljs-operator">=</span> mock(List.class);<br>mockedList.add(<span class="hljs-string">&quot;once&quot;</span>);<br>mockedList.add(<span class="hljs-string">&quot;twice&quot;</span>);<br>mockedList.add(<span class="hljs-string">&quot;twice&quot;</span>);<br><br>verify(mockedList).add(<span class="hljs-string">&quot;once&quot;</span>);<br>verify(mockedList, times(<span class="hljs-number">2</span>)).add(<span class="hljs-string">&quot;twice&quot;</span>);<br>verify(mockedList, never()).add(<span class="hljs-string">&quot;never happened&quot;</span>);<br>verify(mockedList, atLeastOnce()).add(<span class="hljs-string">&quot;once&quot;</span>);<br>verify(mockedList, atLeast(<span class="hljs-number">2</span>)).add(<span class="hljs-string">&quot;twice&quot;</span>);<br>verify(mockedList, atMost(<span class="hljs-number">5</span>)).add(<span class="hljs-string">&quot;twice&quot;</span>);<br></code></pre></td></tr></table></figure>
<h3 id="argumentcaptorï¼šæ•è·å‚æ•°">ArgumentCaptorï¼šæ•è·å‚æ•°</h3>
<p>ArgumentCaptor ç”¨äºæ•è·æ–¹æ³•è°ƒç”¨æ—¶çš„å‚æ•°ï¼Œä¾¿äºå¯¹å‚æ•°è¿›è¡Œæ–­è¨€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.mockito.ArgumentCaptor;<br><br>ArgumentCaptor&lt;String&gt; captor = ArgumentCaptor.forClass(String.class);<br>verify(mockedList).add(captor.capture());<br>assertEquals(<span class="hljs-string">&quot;actual value&quot;</span>, captor.getValue());<br></code></pre></td></tr></table></figure>
<h3 id="æ³¨è§£é©±åŠ¨-mock">æ³¨è§£é©±åŠ¨ Mock</h3>
<p><code>@Mock</code> å’Œ <code>@InjectMocks</code> æ³¨è§£ç®€åŒ–äº† mock å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–æ³¨å…¥ï¼Œéœ€è¦é…åˆ <code>MockitoAnnotations.openMocks()</code> æˆ– <code>@ExtendWith(MockitoExtension.class)</code> ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.mockito.Mock;<br><span class="hljs-keyword">import</span> org.mockito.InjectMocks;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;<br><span class="hljs-keyword">import</span> org.mockito.junit.jupiter.MockitoExtension;<br><br><span class="hljs-meta">@ExtendWith(MockitoExtension.class)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Mock</span><br>    <span class="hljs-keyword">private</span> InventoryService inventoryService;<br>    <br>    <span class="hljs-meta">@Mock</span><br>    <span class="hljs-keyword">private</span> PaymentService paymentService;<br>    <br>    <span class="hljs-meta">@InjectMocks</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldPlaceOrderSuccessfully</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">when</span>(inventoryService.checkStock(anyString(), anyInt())).thenReturn(<span class="hljs-literal">true</span>);<br>        <span class="hljs-keyword">when</span>(paymentService.charge(anyString(), anyBigDecimal())).thenReturn(<span class="hljs-literal">true</span>);<br>        <br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> orderService.placeOrder(<span class="hljs-string">&quot;product-123&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&quot;user-456&quot;</span>);<br>        <br>        assertTrue(result);<br>        verify(inventoryService).checkStock(<span class="hljs-string">&quot;product-123&quot;</span>, <span class="hljs-number">2</span>);<br>        verify(paymentService).charge(<span class="hljs-string">&quot;user-456&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">&quot;199.99&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="mock-vs-stub-vs-spy">Mock vs Stub vs Spy</h2>
<h3 id="mockï¼šéªŒè¯è¡Œä¸º">Mockï¼šéªŒè¯è¡Œä¸º</h3>
<p>Mock å¯¹è±¡ä¸“æ³¨äºéªŒè¯è¡Œä¸ºï¼Œå³éªŒè¯æŸä¸ªæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ã€è°ƒç”¨äº†å¤šå°‘æ¬¡ã€è°ƒç”¨é¡ºåºç­‰ã€‚Mockito çš„é»˜è®¤ mock å¯¹è±¡å°±æ˜¯ Mockã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">List</span> <span class="hljs-variable">mockList</span> <span class="hljs-operator">=</span> mock(List.class);<br>mockList.add(<span class="hljs-string">&quot;one&quot;</span>);<br>verify(mockList).add(<span class="hljs-string">&quot;one&quot;</span>); <span class="hljs-comment">// éªŒè¯è¡Œä¸º</span><br></code></pre></td></tr></table></figure>
<h3 id="stubï¼šé…ç½®è¿”å›å€¼">Stubï¼šé…ç½®è¿”å›å€¼</h3>
<p>Stub æ˜¯ mock çš„ä¸€ç§å­è¡Œä¸ºï¼Œä¸“æ³¨äºé…ç½® mock å¯¹è±¡çš„è¿”å›å€¼ï¼Œä¸å…³å¿ƒæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">List</span> <span class="hljs-variable">stubList</span> <span class="hljs-operator">=</span> mock(List.class);<br><span class="hljs-keyword">when</span>(stubList.get(<span class="hljs-number">0</span>)).thenReturn(<span class="hljs-string">&quot;stubbed value&quot;</span>); <span class="hljs-comment">// é…ç½®è¿”å›å€¼</span><br>assertEquals(<span class="hljs-string">&quot;stubbed value&quot;</span>, stubList.get(<span class="hljs-number">0</span>));<br></code></pre></td></tr></table></figure>
<h3 id="spyï¼šéƒ¨åˆ†-mock">Spyï¼šéƒ¨åˆ† Mock</h3>
<p>Spy æ˜¯å¯¹çœŸå®å¯¹è±¡çš„éƒ¨åˆ† mockï¼Œå¯ä»¥ä¿ç•™çœŸå®å¯¹è±¡çš„éƒ¨åˆ†è¡Œä¸ºï¼ŒåŒæ—¶è¦†ç›–å…¶ä»–è¡Œä¸ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>List&lt;String&gt; spy = spy(list);<br><br><span class="hljs-keyword">when</span>(spy.size()).thenReturn(<span class="hljs-number">100</span>); <span class="hljs-comment">// è¦†ç›– size() æ–¹æ³•</span><br>spy.add(<span class="hljs-string">&quot;one&quot;</span>); <span class="hljs-comment">// è°ƒç”¨çœŸå®çš„ add() æ–¹æ³•</span><br><br>assertEquals(<span class="hljs-number">100</span>, spy.size()); <span class="hljs-comment">// è¿”å› stubbed å€¼</span><br>assertEquals(<span class="hljs-number">1</span>, list.size()); <span class="hljs-comment">// çœŸå®å¯¹è±¡è¢«ä¿®æ”¹</span><br></code></pre></td></tr></table></figure>
<h3 id="é€‰æ‹©å»ºè®®">é€‰æ‹©å»ºè®®</h3>
<ul>
<li>ä½¿ç”¨ Mock å½“éœ€è¦éªŒè¯æ–¹æ³•è°ƒç”¨è¡Œä¸ºæ—¶</li>
<li>ä½¿ç”¨ Stub å½“åªéœ€è¦é…ç½®è¿”å›å€¼æ—¶</li>
<li>ä½¿ç”¨ Spy å½“éœ€è¦ä¿ç•™éƒ¨åˆ†çœŸå®è¡Œä¸ºæ—¶</li>
<li>é¿å…è¿‡åº¦ä½¿ç”¨ Spyï¼Œé€šå¸¸æ„å‘³ç€è®¾è®¡éœ€è¦é‡æ„</li>
</ul>
<h3 id="ğŸ”‘-æ¨¡å¼æç‚¼ï¼šéš”ç¦»ä¾èµ–">ğŸ”‘ æ¨¡å¼æç‚¼ï¼šéš”ç¦»ä¾èµ–</h3>
<p><strong>æ¨¡å¼å…¬å¼</strong>ï¼š<code>MOCK {ä¾èµ–æ¥å£} WITH {è¡Œä¸ºé…ç½®} TO ISOLATE {è¢«æµ‹å•å…ƒ}</code></p>
<p><strong>è¿ç§»è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>Mock å¯¹è±¡</th>
<th>è¡Œä¸ºé…ç½®</th>
<th>éš”ç¦»ç›®æ ‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ•°æ®åº“è®¿é—®</td>
<td>Repository</td>
<td>when().thenReturn()</td>
<td>ä¸šåŠ¡é€»è¾‘</td>
</tr>
<tr>
<td>å¤–éƒ¨ API</td>
<td>HttpClient</td>
<td>stub() è¿”å›å›ºå®šå“åº”</td>
<td>æœåŠ¡å±‚</td>
</tr>
<tr>
<td>ç¼“å­˜æ“ä½œ</td>
<td>CacheManager</td>
<td>verify() éªŒè¯ç¼“å­˜å‘½ä¸­</td>
<td>ç¼“å­˜ç­–ç•¥</td>
</tr>
<tr>
<td>æ¶ˆæ¯é˜Ÿåˆ—</td>
<td>MessageProducer</td>
<td>ArgumentCaptor æ•è·æ¶ˆæ¯</td>
<td>æ¶ˆæ¯å‘é€é€»è¾‘</td>
</tr>
</tbody>
</table>
<p><strong>æ ¸å¿ƒæ´å¯Ÿ</strong>ï¼šå½“è¢«æµ‹å•å…ƒçš„ä¾èµ–è¡Œä¸ºéš¾ä»¥æ§åˆ¶æˆ–è¿è¡Œæˆæœ¬é«˜æ˜‚æ—¶ï¼Œé€šè¿‡ mock å¯¹è±¡æ¨¡æ‹Ÿä¾èµ–çš„è¡Œä¸ºï¼Œå®ç°è¢«æµ‹å•å…ƒçš„éš”ç¦»æµ‹è¯•ã€‚å¬åˆ°&quot;æ•°æ®åº“æ…¢&quot;ã€â€œå¤–éƒ¨æœåŠ¡ä¸ç¨³å®šâ€ã€&quot;éœ€è¦éªŒè¯è°ƒç”¨&quot;æ—¶ï¼Œåº”æƒ³åˆ°éš”ç¦»ä¾èµ–æ¨¡å¼ã€‚</p>
<h1>Case åˆ†ç±»</h1>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/47560177/what-is-the-explicit-difference-between-an-edge-case-and-a-corner-case">What is the explicit difference between an edge case and a corner case?</a></li>
<li><a target="_blank" rel="noopener" href="https://softwareengineering.stackexchange.com/questions/125587/what-are-the-difference-between-an-edge-case-a-corner-case-a-base-case-and-a-b">What are the difference between an edge case, a corner case, a base case and a boundary case?</a></li>
</ol>
<h2 id="edge-case">edge case</h2>
<p>An edge case is a problem or situation that occurs only at an extreme (<strong>maximum or minimum</strong>) operating parameter. For example, a stereo speaker might noticeably distort audio when played at its maximum rated volume, even in the absence of other extreme settings or conditions.</p>
<p>è¾¹ç¼˜æƒ…å†µæ˜¯ä»…åœ¨æç«¯ï¼ˆæœ€å¤§æˆ–æœ€å°ï¼‰æ“ä½œå‚æ•°ä¸‹å‘ç”Ÿçš„é—®é¢˜æˆ–æƒ…å†µã€‚ä¾‹å¦‚ï¼Œç«‹ä½“å£°æ‰¬å£°å™¨åœ¨ä»¥æœ€å¤§é¢å®šéŸ³é‡æ’­æ”¾æ—¶å¯èƒ½ä¼šæ˜æ˜¾å¤±çœŸï¼Œå³ä½¿æ²¡æœ‰å…¶ä»–æç«¯è®¾ç½®æˆ–æ¡ä»¶ã€‚</p>
<h2 id="corner-case">corner case</h2>
<p>Corner case occurs outside of normal operating parameters, specifically when multiple environmental variables or conditions are simultaneously at extreme levels, even though each parameter is within the specified range for that parameter. (The â€œoutside normal operating parametersâ€ obviously means something like â€œoutside typical combination of operating parametersâ€, not strictly â€œoutside allowed operating parametersâ€. That is, youâ€™re still within the valid parameter space, but near its corner.)</p>
<p>åœ¨å·¥ç¨‹ä¸­ï¼Œæç«¯æƒ…å†µ corner caseï¼ˆæˆ–ç—…ç†æƒ…å†µ pathological caseï¼‰æ¶‰åŠä»…åœ¨æ­£å¸¸æ“ä½œå‚æ•°<strong>ä¹‹å¤–</strong>å‘ç”Ÿçš„é—®é¢˜æˆ–æƒ…å†µâ€”â€”ç‰¹åˆ«æ˜¯å½“å¤šä¸ªç¯å¢ƒå˜é‡æˆ–æ¡ä»¶åŒæ—¶å¤„äºæç«¯æ°´å¹³æ—¶è¡¨ç°å‡ºæ¥çš„é—®é¢˜æˆ–æƒ…å†µï¼Œå³ä½¿æ¯ä¸ªå‚æ•°éƒ½åœ¨è¯¥å‚æ•°çš„æŒ‡å®šçš„èŒƒå›´å†…ã€‚</p>
<h2 id="boundary-case">boundary case</h2>
<p>Boundary case occurs when one of inputs is at or just beyond maximum or minimum limits.</p>
<p>å½“è¾“å…¥ä¹‹ä¸€å¤„äºæˆ–åˆšå¥½è¶…è¿‡æœ€å¤§æˆ–æœ€å°é™åˆ¶æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¾¹ç•Œæƒ…å†µã€‚<br>
æˆ‘ä»¬å¸¸è¯´çš„ corner caseï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ boundary caseã€‚</p>
<h2 id="base-case">base case</h2>
<p>Base case is where Recursion ends.</p>
<p>åŸºæœ¬æƒ…å†µæ˜¯é€’å½’ç»“æŸçš„åœ°æ–¹ã€‚</p>
<h1>developer-side test framework æ­å»º</h1>
<h2 id="æ¡†æ¶é€‰æ‹©å»ºè®®">æ¡†æ¶é€‰æ‹©å»ºè®®</h2>
<h3 id="æµ‹è¯•æ¡†æ¶">æµ‹è¯•æ¡†æ¶</h3>
<ul>
<li><strong>JUnit 5</strong>ï¼šäº‹å®æ ‡å‡†ï¼Œæä¾›å¼ºå¤§çš„æ–­è¨€ã€å‚æ•°åŒ–æµ‹è¯•ã€åµŒå¥—æµ‹è¯•ç­‰ç‰¹æ€§</li>
<li><strong>TestNG</strong>ï¼šåŠŸèƒ½ä¸°å¯Œçš„æ›¿ä»£æ–¹æ¡ˆï¼Œé€‚åˆéœ€è¦æ•°æ®é©±åŠ¨æµ‹è¯•çš„åœºæ™¯</li>
<li><strong>Spock</strong>ï¼šåŸºäº Groovy çš„ BDD é£æ ¼æµ‹è¯•æ¡†æ¶ï¼Œé€‚åˆå¤æ‚ä¸šåŠ¡é€»è¾‘éªŒè¯</li>
</ul>
<h3 id="mock-æ¡†æ¶">Mock æ¡†æ¶</h3>
<ul>
<li><strong>Mockito</strong>ï¼šJava ç”Ÿæ€æœ€æµè¡Œçš„ mock æ¡†æ¶ï¼ŒAPI ç®€æ´ç›´è§‚</li>
<li><strong>EasyMock</strong>ï¼šæ—©æœŸæµè¡Œçš„ mock æ¡†æ¶ï¼ŒAPI ç›¸å¯¹ç¹ç</li>
<li><strong>PowerMock</strong>ï¼šæ”¯æŒ mock é™æ€æ–¹æ³•å’Œç§æœ‰æ–¹æ³•ï¼Œä½†ä¼šç ´åå°è£…ï¼Œæ…ç”¨</li>
</ul>
<h3 id="æ–­è¨€åº“">æ–­è¨€åº“</h3>
<ul>
<li><strong>AssertJ</strong>ï¼šæµå¼ APIï¼Œæä¾›ä¸°å¯Œçš„æ–­è¨€æ–¹æ³•ï¼Œæ¨èä½¿ç”¨</li>
<li><strong>Hamcrest</strong>ï¼šåŒ¹é…å™¨é£æ ¼ï¼Œå¯è¯»æ€§å¼ºä½†é“¾å¼è°ƒç”¨ç•¥æ˜¾å†—é•¿</li>
<li><strong>Truth</strong>ï¼šGoogle å‡ºå“çš„æ–­è¨€åº“ï¼ŒAPI è®¾è®¡ä¼˜é›…</li>
</ul>
<h2 id="é›†æˆæµ‹è¯•æ­å»ºæ­¥éª¤">é›†æˆæµ‹è¯•æ­å»ºæ­¥éª¤</h2>
<h3 id="1-é€‰æ‹©æµ‹è¯•æ¡†æ¶å’Œæµ‹è¯•æ’ä»¶">1. é€‰æ‹©æµ‹è¯•æ¡†æ¶å’Œæµ‹è¯•æ’ä»¶</h3>
<p>æ ¹æ®é¡¹ç›®æŠ€æœ¯æ ˆé€‰æ‹©åˆé€‚çš„æµ‹è¯•æ¡†æ¶ç»„åˆã€‚Spring Boot é¡¹ç›®æ¨èä½¿ç”¨ JUnit 5 + Mockito + AssertJã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h3 id="2-ç¡®å®šåˆ†åŒ…">2. ç¡®å®šåˆ†åŒ…</h3>
<p>å¯¹äº Gradle é¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨ source sets è¿›è¡Œæµ‹è¯•ä»£ç åˆ†ç¦»ï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs groovy">sourceSets &#123;<br>    test &#123;<br>        java &#123;<br>            srcDirs <span class="hljs-string">&#x27;src/test/unit&#x27;</span>, <span class="hljs-string">&#x27;src/test/integration&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="3-å»ºç«‹åŸºç±»">3. å»ºç«‹åŸºç±»</h3>
<p>å»ºç«‹ç»Ÿä¸€çš„æµ‹è¯•åŸºç±»ï¼Œå°è£…å…¬å…±çš„åˆå§‹åŒ–é€»è¾‘å’Œé…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@ActiveProfiles(&quot;test&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseIntegrationTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">protected</span> TestRestTemplate restTemplate;<br>    <br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// å…¬å…±åˆå§‹åŒ–é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="4-ç¡®å®šå¯æ’æ‹”çš„-mock-æ–¹æ³•">4. ç¡®å®šå¯æ’æ‹”çš„ Mock æ–¹æ³•</h3>
<h4 id="å…¨å±€-mock-é…ç½®">å…¨å±€ Mock é…ç½®</h4>
<p>é€šè¿‡é…ç½®æ–‡ä»¶æˆ–æµ‹è¯•é…ç½®ç±»å®šä¹‰å…¨å±€ mock è¡Œä¸ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TestConfiguration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestConfig</span> &#123;<br>    <br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@Primary</span><br>    <span class="hljs-keyword">public</span> ExternalService <span class="hljs-title function_">externalService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> mock(ExternalService.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="å±€éƒ¨-mock-æ›¿ä»£">å±€éƒ¨ Mock æ›¿ä»£</h4>
<p>åœ¨æµ‹è¯•ç±»ä¸­é€šè¿‡ <code>@MockBean</code> æ›¿æ¢ Spring å®¹å™¨ä¸­çš„ beanã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceTest</span> &#123;<br>    <br>    <span class="hljs-meta">@MockBean</span><br>    <span class="hljs-keyword">private</span> PaymentService paymentService;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldPlaceOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">when</span>(paymentService.charge(any())).thenReturn(<span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">// æµ‹è¯•é€»è¾‘</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="5-æ•°æ®å‡†å¤‡ç­–ç•¥">5. æ•°æ®å‡†å¤‡ç­–ç•¥</h3>
<p>ç¡®å®šæµ‹è¯•æ•°æ®çš„å‡†å¤‡æ–¹å¼ï¼šä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼ˆH2ï¼‰ã€TestContainers æˆ–å›ºå®šæµ‹è¯•æ•°æ®é›†ã€‚</p>
<h3 id="6-case-å‘½åè§„èŒƒ">6. Case å‘½åè§„èŒƒ</h3>
<p>é‡‡ç”¨ç»Ÿä¸€çš„æµ‹è¯•å‘½åè§„èŒƒï¼Œæ¨èä½¿ç”¨ <code>should{ExpectedBehavior}When{StateUnderTest}</code> æ ¼å¼ã€‚</p>
<h1>JUnit</h1>
<p>JUnit æ˜¯äº‹å®ä¸Šçš„å•å…ƒæµ‹è¯•æ¡†æ¶æ ‡å‡†ï¼Œä½†äº‹å®ä¸Š JUnit is more than a unit test frame work, but a developer-side test frameworkã€‚</p>
<p>JUnit 5 is modularizedï¼Œcomposed of several modules: platformã€vintage å’Œ jupiterã€‚å…¶ä¸­ The JUnit Platform serves as a foundation for launching testing frameworks on the JVMã€‚åœ¨ä¸Šé¢å¯ä»¥å¼€å‘é’ˆå¯¹ JUnit 5 çš„ testframeworkï¼Œå› ä¸ºæä¾›äº†ä¸“é—¨çš„ TestEngine APIã€‚jupiter æ˜¯è¢«é‡å†™çš„æ–° apiï¼Œæ‹¥æœ‰æ–°çš„ TestEngine å®ç°ï¼Œè€Œ vintage å…¼å®¹è€ç‰ˆæœ¬çš„æµ‹è¯•ï¼Œæ‹¥æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ TestEngine å®ç°ã€‚</p>
<p>å½“ä»£çš„ JUnit å·²ç»å˜æˆäº†ä¸€ä¸ª annotation-driven è¿è¡Œçš„ framework äº†ã€‚å…¨éƒ¨çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">JUnit 5 ç”¨æˆ·æŒ‡å—</a>ã€‚</p>
<h2 id="ç”Ÿå‘½å‘¨æœŸæ³¨è§£">ç”Ÿå‘½å‘¨æœŸæ³¨è§£</h2>
<p>JUnit 5 æä¾›äº†å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼Œç”¨äºæ§åˆ¶æµ‹è¯•çš„åˆå§‹åŒ–å’Œæ¸…ç†è¿‡ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.*;<br><br><span class="hljs-meta">@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LifecycleTest</span> &#123;<br>    <br>    <span class="hljs-meta">@BeforeAll</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeAll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œä¸€æ¬¡ï¼ˆé™æ€æ–¹æ³•ï¼‰</span><br>        System.out.println(<span class="hljs-string">&quot;BeforeAll - åˆå§‹åŒ–é™æ€èµ„æº&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œ</span><br>        System.out.println(<span class="hljs-string">&quot;BeforeEach - åˆå§‹åŒ–æµ‹è¯•æ•°æ®&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOne</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Test One&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTwo</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Test Two&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ</span><br>        System.out.println(<span class="hljs-string">&quot;AfterEach - æ¸…ç†æµ‹è¯•æ•°æ®&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@AfterAll</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterAll</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// åœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œä¸€æ¬¡ï¼ˆé™æ€æ–¹æ³•ï¼‰</span><br>        System.out.println(<span class="hljs-string">&quot;AfterAll - é‡Šæ”¾é™æ€èµ„æº&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="ç”Ÿå‘½å‘¨æœŸæ³¨è§£å¯¹æ¯”">ç”Ÿå‘½å‘¨æœŸæ³¨è§£å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>æ‰§è¡Œæ—¶æœº</th>
<th>æ–¹æ³•ç±»å‹</th>
<th>å…¸å‹ç”¨é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@BeforeAll</code></td>
<td>æ‰€æœ‰æµ‹è¯•å‰</td>
<td>static</td>
<td>åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ã€å¯åŠ¨æœåŠ¡å™¨</td>
</tr>
<tr>
<td><code>@BeforeEach</code></td>
<td>æ¯ä¸ªæµ‹è¯•å‰</td>
<td>å®ä¾‹</td>
<td>åˆ›å»ºæµ‹è¯•å¯¹è±¡ã€å‡†å¤‡æµ‹è¯•æ•°æ®</td>
</tr>
<tr>
<td><code>@AfterEach</code></td>
<td>æ¯ä¸ªæµ‹è¯•å</td>
<td>å®ä¾‹</td>
<td>æ¸…ç†æµ‹è¯•æ•°æ®ã€é‡ç½®çŠ¶æ€</td>
</tr>
<tr>
<td><code>@AfterAll</code></td>
<td>æ‰€æœ‰æµ‹è¯•å</td>
<td>static</td>
<td>å…³é—­æ•°æ®åº“è¿æ¥ã€åœæ­¢æœåŠ¡å™¨</td>
</tr>
</tbody>
</table>
<h2 id="å‚æ•°åŒ–æµ‹è¯•">å‚æ•°åŒ–æµ‹è¯•</h2>
<p>JUnit 5 çš„ <code>@ParameterizedTest</code> å…è®¸ä½¿ç”¨ä¸åŒçš„è¾“å…¥å€¼å¤šæ¬¡è¿è¡ŒåŒä¸€ä¸ªæµ‹è¯•æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.jupiter.params.ParameterizedTest;<br><span class="hljs-keyword">import</span> org.junit.jupiter.params.provider.*;<br><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@ValueSource(strings = &#123;&quot;racecar&quot;, &quot;radar&quot;, &quot;level&quot;&#125;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">palindromes</span><span class="hljs-params">(String candidate)</span> &#123;<br>    assertTrue(StringUtils.isPalindrome(candidate));<br>&#125;<br><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@CsvSource(&#123;&quot;apple, 10&quot;, &quot;banana, 20&quot;, &quot;orange, 15&quot;&#125;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithCsvSource</span><span class="hljs-params">(String fruit, <span class="hljs-type">int</span> quantity)</span> &#123;<br>    assertNotNull(fruit);<br>    assertTrue(quantity &gt; <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-meta">@ParameterizedTest</span><br><span class="hljs-meta">@MethodSource(&quot;provideStringsForIsBlank&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testWithMethodSource</span><span class="hljs-params">(String input, <span class="hljs-type">boolean</span> expected)</span> &#123;<br>    assertEquals(expected, StringUtils.isBlank(input));<br>&#125;<br><br><span class="hljs-keyword">static</span> Stream&lt;Arguments&gt; <span class="hljs-title function_">provideStringsForIsBlank</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> Stream.of(<br>        Arguments.of(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>),<br>        Arguments.of(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">true</span>),<br>        Arguments.of(<span class="hljs-string">&quot;  &quot;</span>, <span class="hljs-literal">true</span>),<br>        Arguments.of(<span class="hljs-string">&quot;not blank&quot;</span>, <span class="hljs-literal">false</span>)<br>    );<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="åµŒå¥—æµ‹è¯•">åµŒå¥—æµ‹è¯•</h2>
<p><code>@Nested</code> æ³¨è§£ç”¨äºç»„ç»‡ç›¸å…³çš„æµ‹è¯•æ–¹æ³•ï¼Œä½¿æµ‹è¯•ç»“æ„æ›´æ¸…æ™°ï¼Œæ”¯æŒåµŒå¥—ç±»çš„ç”Ÿå‘½å‘¨æœŸç»§æ‰¿ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DisplayName(&quot;Stack æµ‹è¯•&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StackTest</span> &#123;<br>    <br>    Stack&lt;Object&gt; stack;<br>    <br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">createNewStack</span><span class="hljs-params">()</span> &#123;<br>        stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stack</span>&lt;&gt;();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@DisplayName(&quot;æ–°æ ˆåº”è¯¥ä¸ºç©º&quot;)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">isNewStack</span><span class="hljs-params">()</span> &#123;<br>        assertTrue(stack.isEmpty());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Nested</span><br>    <span class="hljs-meta">@DisplayName(&quot;æ¨å…¥å…ƒç´ å&quot;)</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterPushing</span> &#123;<br>        <br>        <span class="hljs-type">String</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;an element&quot;</span>;<br>        <br>        <span class="hljs-meta">@BeforeEach</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">pushElement</span><span class="hljs-params">()</span> &#123;<br>            stack.push(element);<br>        &#125;<br>        <br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName(&quot;æ ˆä¸åº”ä¸ºç©º&quot;)</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">isNotEmpty</span><span class="hljs-params">()</span> &#123;<br>            assertFalse(stack.isEmpty());<br>        &#125;<br>        <br>        <span class="hljs-meta">@Test</span><br>        <span class="hljs-meta">@DisplayName(&quot;æ ˆåº”è¯¥è¿”å›å…ƒç´ &quot;)</span><br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnElement</span><span class="hljs-params">()</span> &#123;<br>            assertEquals(element, stack.pop());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="æ¡ä»¶æ‰§è¡Œ">æ¡ä»¶æ‰§è¡Œ</h2>
<p>JUnit 5 æä¾›äº†å¤šç§æ¡ä»¶æ‰§è¡Œæ³¨è§£ï¼Œæ ¹æ®è¿è¡Œç¯å¢ƒæˆ–é…ç½®å†³å®šæ˜¯å¦æ‰§è¡Œæµ‹è¯•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@EnabledOnOs(OS.MAC)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">onlyOnMac</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä»…åœ¨ macOS ä¸Šè¿è¡Œ</span><br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@DisabledOnJre(JRE.JAVA_8)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">notOnJava8</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä¸åœ¨ Java 8 ä¸Šè¿è¡Œ</span><br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@EnabledIfSystemProperty(named = &quot;test.env&quot;, matches = &quot;ci&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">onlyInCI</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä»…åœ¨ CI ç¯å¢ƒä¸­è¿è¡Œ</span><br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@EnabledIf(&quot;customCondition()&quot;)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">customCondition</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è‡ªå®šä¹‰æ¡ä»¶</span><br>&#125;<br><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">customCondition</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> System.getenv().containsKey(<span class="hljs-string">&quot;SPECIAL_ENV&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="æ–­è¨€-api">æ–­è¨€ API</h2>
<p>JUnit 5 æä¾›äº†ä¸°å¯Œçš„æ–­è¨€æ–¹æ³•ï¼Œæ”¯æŒåˆ†ç»„æ–­è¨€ã€å¼‚å¸¸æ–­è¨€ã€è¶…æ—¶æ–­è¨€ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">groupedAssertions</span><span class="hljs-params">()</span> &#123;<br>    assertAll(<span class="hljs-string">&quot;person&quot;</span>,<br>        () -&gt; assertEquals(<span class="hljs-string">&quot;John&quot;</span>, person.getFirstName()),<br>        () -&gt; assertEquals(<span class="hljs-string">&quot;Doe&quot;</span>, person.getLastName()),<br>        () -&gt; assertEquals(<span class="hljs-string">&quot;john.doe@example.com&quot;</span>, person.getEmail())<br>    );<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">exceptionTesting</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Exception</span> <span class="hljs-variable">exception</span> <span class="hljs-operator">=</span> assertThrows(IllegalArgumentException.class, () -&gt; &#123;<br>        person.setAge(-<span class="hljs-number">1</span>);<br>    &#125;);<br>    <br>    assertEquals(<span class="hljs-string">&quot;Age cannot be negative&quot;</span>, exception.getMessage());<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">timeoutNotExceeded</span><span class="hljs-params">()</span> &#123;<br>    assertTimeout(ofMillis(<span class="hljs-number">100</span>), () -&gt; &#123;<br>        <span class="hljs-comment">// åœ¨ 100ms å†…å®Œæˆ</span><br>        Thread.sleep(<span class="hljs-number">50</span>);<br>    &#125;);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">timeoutExceeded</span><span class="hljs-params">()</span> &#123;<br>    assertTimeoutPreemptively(ofMillis(<span class="hljs-number">100</span>), () -&gt; &#123;<br>        <span class="hljs-comment">// è¶…è¿‡ 100ms ä¼šç«‹å³ä¸­æ–­</span><br>        Thread.sleep(<span class="hljs-number">200</span>);<br>    &#125;);<br>&#125;<br># Spring ä¸ Test<br><br>## Unit Test<br><br>### Mock Object<br><br>org.springframework.mock ä¸‹æœ‰ envã€httpã€jndiã€web å››ä¸ªå­åŒ…ã€‚å®ƒå®é™…ä¸ŠåŒ…å« Environmentã€JNDIã€Servlet APIã€Spring Web Reactive è¿™å››ç±» mock objectsã€‚æ‰€è°“çš„ mock objects å®é™…ä¸Šæ˜¯å¯¹ä¸€äº› Spring ä¼ ç»Ÿ API æ¥å£çš„ mock implementationã€‚<br><br>### Unit Testing Support Classes<br><br>#### General Testing Utilities<br><br>- **AopTestUtils**ï¼šç”¨äºè·å– AOP ä»£ç†èƒŒåçš„ç›®æ ‡å¯¹è±¡<br>- **ReflectionTestUtils**ï¼šé€šè¿‡åå°„è®¿é—®å’Œä¿®æ”¹ç§æœ‰å­—æ®µå’Œæ–¹æ³•<br>- **TestSocketUtils**ï¼šæŸ¥æ‰¾å¯ç”¨çš„ TCP/UDP ç«¯å£<br><br>#### Spring MVC Testing Utilities<br><br>- **ModelAndViewAssert**ï¼šç”¨äºæ–­è¨€ ModelAndView çš„å†…å®¹<br><br>### MockMvc ç‹¬ç«‹æ¨¡å¼<br><br>MockMvc ç‹¬ç«‹æ¨¡å¼æ— éœ€å¯åŠ¨å®Œæ•´çš„ Spring å®¹å™¨ï¼Œä»…åŠ è½½ Web å±‚ç»„ä»¶ï¼Œé€‚åˆæµ‹è¯• Controller å±‚é€»è¾‘ã€‚<br><br>```java<br><span class="hljs-keyword">import</span> org.springframework.test.web.servlet.MockMvc;<br><span class="hljs-keyword">import</span> org.springframework.test.web.servlet.setup.MockMvcBuilders;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;<br><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserControllerTest</span> &#123;<br>    <br>    <span class="hljs-keyword">private</span> MockMvc mockMvc;<br>    <br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">UserController</span> <span class="hljs-variable">controller</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserController</span>(userService);<br>        mockMvc = MockMvcBuilders.standaloneSetup(controller).build();<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldReturnUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        mockMvc.perform(get(<span class="hljs-string">&quot;/api/users/1&quot;</span>))<br>            .andExpect(status().isOk())<br>            .andExpect(jsonPath(<span class="hljs-string">&quot;$.id&quot;</span>, is(<span class="hljs-number">1</span>)))<br>            .andExpect(jsonPath(<span class="hljs-string">&quot;$.name&quot;</span>, is(<span class="hljs-string">&quot;John&quot;</span>)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="webmvctest">@WebMvcTest</h3>
<p><code>@WebMvcTest</code> æ˜¯ Spring Boot æä¾›çš„æµ‹è¯•åˆ‡ç‰‡æ³¨è§£ï¼Œä»…åŠ è½½ Web å±‚ç›¸å…³ç»„ä»¶ï¼Œè‡ªåŠ¨é…ç½® MockMvcã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WebMvcTest(UserController.class)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserControllerWebMvcTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MockMvc mockMvc;<br>    <br>    <span class="hljs-meta">@MockBean</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldReturnUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">when</span>(userService.findById(<span class="hljs-number">1L</span>)).thenReturn(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">&quot;John&quot;</span>));<br>        <br>        mockMvc.perform(get(<span class="hljs-string">&quot;/api/users/1&quot;</span>))<br>            .andExpect(status().isOk())<br>            .andExpect(jsonPath(<span class="hljs-string">&quot;$.name&quot;</span>, is(<span class="hljs-string">&quot;John&quot;</span>)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="integration-test">Integration Test</h2>
<p>å¦‚æœéœ€è¦ deploy a serverã€connecting to other enterprise infrastructureã€init a contextã€‚</p>
<p>é›†æˆæµ‹è¯•çš„æ”¯æŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>ç®¡ç† Spring IoC å®¹å™¨åœ¨æµ‹è¯•ä¹‹é—´çš„ç¼“å­˜</li>
<li>ä¸ºæµ‹è¯• fixture å®ä¾‹æä¾›ä¾èµ–æ³¨å…¥ï¼Œå¯¹å›ºå®šè£…ç½®å¯¹è±¡çš„æ³¨å…¥å¯¹äºæµ‹è¯•çš„å¸®åŠ©å¾ˆå¤§</li>
<li>æä¾›é€‚åˆé›†æˆæµ‹è¯•çš„äº‹åŠ¡ç®¡ç†</li>
<li>æä¾›å¸®åŠ©å¼€å‘è€…ç¼–å†™é›†æˆæµ‹è¯•çš„ Spring ç‰¹å®šåŸºç±»</li>
</ul>
<h3 id="springboottest">@SpringBootTest</h3>
<p><code>@SpringBootTest</code> å¯åŠ¨å®Œæ•´çš„ Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œç”¨äºç¼–å†™é›†æˆæµ‹è¯•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@AutoConfigureMockMvc</span><br><span class="hljs-meta">@ActiveProfiles(&quot;test&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderIntegrationTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MockMvc mockMvc;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRepository orderRepository;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCreateOrder</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">orderJson</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;productId\&quot;: 1, \&quot;quantity\&quot;: 2&#125;&quot;</span>;<br>        <br>        mockMvc.perform(post(<span class="hljs-string">&quot;/api/orders&quot;</span>)<br>                .contentType(MediaType.APPLICATION_JSON)<br>                .content(orderJson))<br>            .andExpect(status().isCreated())<br>            .andExpect(jsonPath(<span class="hljs-string">&quot;$.id&quot;</span>).exists());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="testcontext-ç¼“å­˜æœºåˆ¶">TestContext ç¼“å­˜æœºåˆ¶</h3>
<p>Spring TestContext Framework æä¾› ApplicationContext ç¼“å­˜æœºåˆ¶ï¼Œé¿å…åœ¨å¤šä¸ªæµ‹è¯•ç±»ä¹‹é—´é‡å¤å¯åŠ¨å®¹å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç›¸åŒé…ç½®çš„æµ‹è¯•ç±»ä¼šå…±äº«åŒä¸€ä¸ª ApplicationContextã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸¤ä¸ªæµ‹è¯•ç±»ä½¿ç”¨ç›¸åŒçš„é…ç½®ï¼Œå…±äº«åŒä¸€ä¸ª ApplicationContext</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass1</span> &#123; &#125;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass2</span> &#123; &#125;<br></code></pre></td></tr></table></figure>
<h3 id="transactional-å›æ»š">@Transactional å›æ»š</h3>
<p>æµ‹è¯•æ–¹æ³•ä¸Šçš„ <code>@Transactional</code> æ³¨è§£é»˜è®¤åœ¨æµ‹è¯•ç»“æŸåå›æ»šäº‹åŠ¡ï¼Œä¿æŒæ•°æ®åº“å¹²å‡€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRepositoryTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRepository orderRepository;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldSaveOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;product-123&quot;</span>, <span class="hljs-number">2</span>);<br>        orderRepository.save(order);<br>        <br>        <span class="hljs-comment">// æµ‹è¯•ç»“æŸåè‡ªåŠ¨å›æ»šï¼Œæ•°æ®åº“ä¸­ä¸ä¼šä¿å­˜è¯¥è®¢å•</span><br>        assertNotNull(order.getId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="sql-æ•°æ®å‡†å¤‡">@Sql æ•°æ®å‡†å¤‡</h3>
<p><code>@Sql</code> æ³¨è§£ç”¨äºåœ¨æµ‹è¯•æ‰§è¡Œå‰æˆ–æ‰§è¡Œåæ‰§è¡Œ SQL è„šæœ¬ï¼Œå‡†å¤‡æˆ–æ¸…ç†æµ‹è¯•æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@Sql(&quot;/test-data.sql&quot;)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldFindAllOrders</span><span class="hljs-params">()</span> &#123;<br>        List&lt;Order&gt; orders = orderService.findAll();<br>        assertEquals(<span class="hljs-number">3</span>, orders.size());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@Sql(scripts = &quot;/cleanup.sql&quot;, </span><br><span class="hljs-meta">         executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCleanUpAfterTest</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æµ‹è¯•ç»“æŸåæ‰§è¡Œæ¸…ç†è„šæœ¬</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="jdbc-testing-support">JDBC Testing Support</h3>
<p>Spring Test æä¾› <code>JdbcTestUtils</code> ç”¨äºç®€åŒ–æ•°æ®åº“æµ‹è¯•çš„ SQL æ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.test.context.jdbc.Sql;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">JdbcTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-meta">@Sql(scripts = &quot;/schema.sql&quot;, executionPhase = BEFORE_TEST_METHOD)</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCountRows</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> JdbcTestUtils.countRowsInTable(jdbcTemplate, <span class="hljs-string">&quot;users&quot;</span>);<br>        assertEquals(<span class="hljs-number">5</span>, count);<br>        <br>        JdbcTestUtils.deleteFromTables(jdbcTemplate, <span class="hljs-string">&quot;users&quot;</span>);<br>        assertEquals(<span class="hljs-number">0</span>, JdbcTestUtils.countRowsInTable(jdbcTemplate, <span class="hljs-string">&quot;users&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="spring-testcontext-framework">Spring TestContext Framework</h3>
<p>Spring TestContext Framework æä¾›äº†æµ‹è¯•æ‰§è¡Œçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œæ”¯æŒï¼š</p>
<ul>
<li>ApplicationContext çš„åŠ è½½å’Œç®¡ç†</li>
<li>TestExecutionListener çš„æ‰©å±•æœºåˆ¶</li>
<li>æµ‹è¯•ä¸Šä¸‹æ–‡çš„ç¼“å­˜å’Œå…±äº«</li>
</ul>
<h3 id="webtestclient">WebTestClient</h3>
<p>WebTestClient æ˜¯ç”¨äºæµ‹è¯• WebFlux åº”ç”¨çš„å“åº”å¼æµ‹è¯•å®¢æˆ·ç«¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@AutoConfigureWebTestClient</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserControllerTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> WebTestClient webTestClient;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldReturnUser</span><span class="hljs-params">()</span> &#123;<br>        webTestClient.get().uri(<span class="hljs-string">&quot;/api/users/1&quot;</span>)<br>            .exchange()<br>            .expectStatus().isOk()<br>            .expectBody(User.class)<br>            .isEqualTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">&quot;John&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="testing-client-applications">Testing Client Applications</h3>
<p>ä½¿ç”¨ <code>TestRestTemplate</code> æµ‹è¯• REST å®¢æˆ·ç«¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest(webEnvironment = RANDOM_PORT)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientIntegrationTest</span> &#123;<br>    <br>    <span class="hljs-meta">@LocalServerPort</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> port;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TestRestTemplate restTemplate;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCallExternalApi</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://localhost:&quot;</span> + port + <span class="hljs-string">&quot;/api/users/1&quot;</span>;<br>        ResponseEntity&lt;User&gt; response = restTemplate.getForEntity(url, User.class);<br>        <br>        assertEquals(HttpStatus.OK, response.getStatusCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•åˆ‡ç‰‡æ³¨è§£">æµ‹è¯•åˆ‡ç‰‡æ³¨è§£</h3>
<p>Spring Boot æä¾›äº†å¤šä¸ªæµ‹è¯•åˆ‡ç‰‡æ³¨è§£ï¼Œç”¨äºæµ‹è¯•ç‰¹å®šå±‚è€Œä¸åŠ è½½å®Œæ•´çš„åº”ç”¨ä¸Šä¸‹æ–‡ã€‚</p>
<h4 id="datajpatest">@DataJpaTest</h4>
<p><code>@DataJpaTest</code> ä»…åŠ è½½ JPA ç›¸å…³ç»„ä»¶ï¼Œé…ç½®å†…å­˜æ•°æ®åº“ï¼Œé€‚åˆæµ‹è¯• Repository å±‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DataJpaTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepositoryTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TestEntityManager entityManager;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserRepository userRepository;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldFindUserByEmail</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;john@example.com&quot;</span>, <span class="hljs-string">&quot;John&quot;</span>);<br>        entityManager.persist(user);<br>        <br>        Optional&lt;User&gt; found = userRepository.findByEmail(<span class="hljs-string">&quot;john@example.com&quot;</span>);<br>        <br>        assertTrue(found.isPresent());<br>        assertEquals(<span class="hljs-string">&quot;John&quot;</span>, found.get().getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="webmvctest">@WebMvcTest</h4>
<p><code>@WebMvcTest</code> ä»…åŠ è½½ Web å±‚ç»„ä»¶ï¼Œè‡ªåŠ¨é…ç½® MockMvcã€‚</p>
<h4 id="jsontest">@JsonTest</h4>
<p><code>@JsonTest</code> ä»…åŠ è½½ JSON åºåˆ—åŒ–ç›¸å…³ç»„ä»¶ï¼Œæµ‹è¯• JSON åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@JsonTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserJsonTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JacksonTester&lt;User&gt; json;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldSerializeUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> JsonProcessingException &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">&quot;John&quot;</span>);<br>        assertThat(json.write(user)).extractingJsonPathStringValue(<span class="hljs-string">&quot;$.name&quot;</span>)<br>            .isEqualTo(<span class="hljs-string">&quot;John&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldDeserializeUser</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;John\&quot;&#125;&quot;</span>;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> json.parse(content).getObject();<br>        <br>        assertEquals(<span class="hljs-string">&quot;John&quot;</span>, user.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="annotations">Annotations</h3>
<p>Spring Test æä¾›çš„æ ¸å¿ƒæ³¨è§£ï¼š</p>
<ul>
<li><code>@SpringBootTest</code>ï¼šå¯åŠ¨å®Œæ•´åº”ç”¨ä¸Šä¸‹æ–‡</li>
<li><code>@WebMvcTest</code>ï¼šæµ‹è¯• Web å±‚</li>
<li><code>@DataJpaTest</code>ï¼šæµ‹è¯• JPA å±‚</li>
<li><code>@MockBean</code>ï¼šæ›¿æ¢ Spring å®¹å™¨ä¸­çš„ bean</li>
<li><code>@TestConfiguration</code>ï¼šæä¾›æµ‹è¯•ç‰¹å®šçš„é…ç½®</li>
<li><code>@ActiveProfiles</code>ï¼šæ¿€æ´»æŒ‡å®šçš„ profile</li>
<li><code>@Transactional</code>ï¼šæµ‹è¯•æ–¹æ³•äº‹åŠ¡ç®¡ç†</li>
<li><code>@Sql</code>ï¼šæ‰§è¡Œ SQL è„šæœ¬</li>
</ul>
<h3 id="annotations">Annotations</h3>
<h1>æµ‹è¯•æœ€ä½³å®è·µ</h1>
<h2 id="given-when-then-æ¨¡å¼">Given-When-Then æ¨¡å¼</h2>
<p>Given-When-Then æ˜¯ä¸€ç§æµ‹è¯•ç»“æ„æ¨¡å¼ï¼Œå°†æµ‹è¯•åˆ†ä¸ºä¸‰ä¸ªæ¸…æ™°çš„é˜¶æ®µï¼šå‡†å¤‡æ•°æ®ã€æ‰§è¡Œæ“ä½œã€éªŒè¯ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCalculateTotalPrice</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// Given: å‡†å¤‡æµ‹è¯•æ•°æ®</span><br>    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Product</span>(<span class="hljs-string">&quot;Laptop&quot;</span>, <span class="hljs-number">1000.0</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">quantity</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <br>    <span class="hljs-comment">// When: æ‰§è¡Œè¢«æµ‹æ“ä½œ</span><br>    <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> orderService.calculateTotal(product, quantity);<br>    <br>    <span class="hljs-comment">// Then: éªŒè¯ç»“æœ</span><br>    assertEquals(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">&quot;2000.00&quot;</span>), total);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™ç§ç»“æ„ä½¿æµ‹è¯•æ„å›¾æ¸…æ™°ï¼Œä¾¿äºé˜…è¯»å’Œç»´æŠ¤ã€‚</p>
<h2 id="æµ‹è¯•å‘½åè§„èŒƒ">æµ‹è¯•å‘½åè§„èŒƒ</h2>
<p>è‰¯å¥½çš„æµ‹è¯•å‘½ååº”è¯¥æ¸…æ™°è¡¨è¾¾æµ‹è¯•çš„ç›®çš„å’Œé¢„æœŸè¡Œä¸ºã€‚æ¨èä½¿ç”¨ <code>should{ExpectedBehavior}When{StateUnderTest}</code> æ ¼å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¥½çš„å‘½å</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldReturnOrderNotFoundWhenOrderIdDoesNotExist</span><span class="hljs-params">()</span> &#123; &#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldThrowExceptionWhenQuantityIsNegative</span><span class="hljs-params">()</span> &#123; &#125;<br><br><span class="hljs-comment">// ä¸å¥½çš„å‘½å</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testOrder</span><span class="hljs-params">()</span> &#123; &#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span> &#123; &#125;<br></code></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•è¦†ç›–ç‡ç­–ç•¥">æµ‹è¯•è¦†ç›–ç‡ç­–ç•¥</h2>
<p>æµ‹è¯•è¦†ç›–ç‡æ˜¯è¡¡é‡æµ‹è¯•å®Œæ•´æ€§çš„æŒ‡æ ‡ï¼Œä½†ä¸æ˜¯å”¯ä¸€æ ‡å‡†ã€‚åˆç†çš„è¦†ç›–ç‡ç­–ç•¥åº”è€ƒè™‘ï¼š</p>
<ul>
<li><strong>è¡Œè¦†ç›–ç‡</strong>ï¼šè‡³å°‘è¾¾åˆ° 80%ï¼Œæ ¸å¿ƒä¸šåŠ¡ä»£ç åº”è¾¾åˆ° 100%</li>
<li><strong>åˆ†æ”¯è¦†ç›–ç‡</strong>ï¼šç¡®ä¿æ‰€æœ‰æ¡ä»¶åˆ†æ”¯éƒ½è¢«æµ‹è¯•</li>
<li><strong>æ–¹æ³•è¦†ç›–ç‡</strong>ï¼šå…¬å…± API åº”è¯¥æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–</li>
</ul>
<p>é¿å…ä¸ºäº†è¿½æ±‚è¦†ç›–ç‡è€Œç¼–å†™æ— æ„ä¹‰çš„æµ‹è¯•ï¼Œæµ‹è¯•åº”è¯¥å…³æ³¨ä¸šåŠ¡é€»è¾‘çš„æ­£ç¡®æ€§å’Œè¾¹ç•Œæ¡ä»¶ã€‚</p>
<h2 id="ğŸ”‘-æ¨¡å¼æç‚¼ï¼šæµ‹è¯•ä¸‰æ®µå¼">ğŸ”‘ æ¨¡å¼æç‚¼ï¼šæµ‹è¯•ä¸‰æ®µå¼</h2>
<p><strong>æ¨¡å¼å…¬å¼</strong>ï¼š<code>GIVEN {æµ‹è¯•å‡†å¤‡} WHEN {æ‰§è¡Œæ“ä½œ} THEN {éªŒè¯ç»“æœ}</code></p>
<p><strong>è¿ç§»è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>æµ‹è¯•ç±»å‹</th>
<th>Given</th>
<th>When</th>
<th>Then</th>
</tr>
</thead>
<tbody>
<tr>
<td>å•å…ƒæµ‹è¯•</td>
<td>å‡†å¤‡ mock å¯¹è±¡å’Œè¾“å…¥æ•°æ®</td>
<td>è°ƒç”¨è¢«æµ‹æ–¹æ³•</td>
<td>æ–­è¨€è¿”å›å€¼å’ŒéªŒè¯ mock</td>
</tr>
<tr>
<td>é›†æˆæµ‹è¯•</td>
<td>å‡†å¤‡æ•°æ®åº“æ•°æ®å’Œè¯·æ±‚</td>
<td>å‘é€ HTTP è¯·æ±‚</td>
<td>æ–­è¨€å“åº”çŠ¶æ€å’Œå†…å®¹</td>
</tr>
<tr>
<td>ç«¯åˆ°ç«¯æµ‹è¯•</td>
<td>ç™»å½•ç”¨æˆ·å¹¶è¿›å…¥é¡µé¢</td>
<td>æ‰§è¡Œç”¨æˆ·æ“ä½œ</td>
<td>éªŒè¯é¡µé¢å…ƒç´ å’ŒçŠ¶æ€</td>
</tr>
</tbody>
</table>
<p><strong>æ ¸å¿ƒæ´å¯Ÿ</strong>ï¼šæ‰€æœ‰æµ‹è¯•éƒ½å¯ä»¥æŠ½è±¡ä¸ºå‡†å¤‡ã€æ‰§è¡Œã€éªŒè¯ä¸‰ä¸ªé˜¶æ®µã€‚å¬åˆ°&quot;æµ‹è¯•ç»“æ„ä¸æ¸…æ™°&quot;ã€&quot;æµ‹è¯•éš¾ä»¥ç†è§£&quot;æ—¶ï¼Œåº”æƒ³åˆ°æµ‹è¯•ä¸‰æ®µå¼æ¨¡å¼ã€‚</p>
<h1>æµ‹è¯•åæ¨¡å¼</h1>
<h2 id="è¿‡åº¦-mock">è¿‡åº¦ Mock</h2>
<p>è¿‡åº¦ mock æ˜¯æŒ‡å¯¹ä¸åº”è¯¥ mock çš„ä¾èµ–è¿›è¡Œ mockï¼Œå¯¼è‡´æµ‹è¯•å¤±å»äº†éªŒè¯çœŸå®è¡Œä¸ºçš„èƒ½åŠ›ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è¿‡åº¦ mock çš„ç¤ºä¾‹</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCreateOrder</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();<br>    <span class="hljs-keyword">when</span>(orderRepository.save(order)).thenReturn(order); <span class="hljs-comment">// ä¸å¿…è¦çš„ mock</span><br>    <span class="hljs-keyword">when</span>(orderService.calculateTotal(any())).thenReturn(BigDecimal.ZERO); <span class="hljs-comment">// ä¸å¿…è¦çš„ mock</span><br>    <br>    orderService.createOrder(order);<br>    <br>    verify(orderRepository).save(order); <span class="hljs-comment">// ä»…éªŒè¯è°ƒç”¨ï¼ŒæœªéªŒè¯å®é™…æ•ˆæœ</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿‡åº¦ mock çš„åæœåŒ…æ‹¬ï¼šæµ‹è¯•ä¸å®ç°ç»†èŠ‚è€¦åˆã€æ— æ³•å‘ç°è®¾è®¡é—®é¢˜ã€é‡æ„å›°éš¾ã€‚</p>
<p><strong>é¿å…æ–¹æ³•</strong>ï¼šåªåœ¨æµ‹è¯•çœŸæ­£çš„å¤–éƒ¨ä¾èµ–æ—¶ä½¿ç”¨ mockï¼Œå¦‚æ•°æ®åº“ã€å¤–éƒ¨ APIã€æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚</p>
<h2 id="è„†å¼±æµ‹è¯•">è„†å¼±æµ‹è¯•</h2>
<p>è„†å¼±æµ‹è¯•æ˜¯æŒ‡å¯¹å®ç°ç»†èŠ‚è¿‡äºæ•æ„Ÿçš„æµ‹è¯•ï¼Œä»£ç é‡æ„æ—¶å®¹æ˜“å¤±è´¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è„†å¼±æµ‹è¯•ï¼šä¾èµ–å†…éƒ¨å®ç°ç»†èŠ‚</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldProcessOrder</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();<br>    orderService.processOrder(order);<br>    <br>    <span class="hljs-comment">// ç›´æ¥éªŒè¯å†…éƒ¨çŠ¶æ€ï¼Œè„†å¼±</span><br>    assertEquals(<span class="hljs-string">&quot;PROCESSING&quot;</span>, order.getStatus());<br>    assertEquals(<span class="hljs-number">1</span>, order.getAuditLog().size());<br>&#125;<br><br><span class="hljs-comment">// å¥å£®æµ‹è¯•ï¼šéªŒè¯å¯è§‚å¯Ÿçš„è¡Œä¸º</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldSendOrderConfirmationEmail</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();<br>    orderService.processOrder(order);<br>    <br>    <span class="hljs-comment">// éªŒè¯å¯è§‚å¯Ÿçš„è¡Œä¸º</span><br>    verify(emailService).sendConfirmationEmail(order.getCustomerEmail());<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>é¿å…æ–¹æ³•</strong>ï¼šæµ‹è¯•å…¬å…± API å’Œå¯è§‚å¯Ÿçš„è¡Œä¸ºï¼Œè€Œéå†…éƒ¨å®ç°ç»†èŠ‚ã€‚</p>
<h2 id="æµ‹è¯•é—´ä¾èµ–">æµ‹è¯•é—´ä¾èµ–</h2>
<p>æµ‹è¯•é—´ä¾èµ–æ˜¯æŒ‡æµ‹è¯•çš„æ‰§è¡Œä¾èµ–äºå…¶ä»–æµ‹è¯•çš„çŠ¶æ€ï¼Œå¯¼è‡´æµ‹è¯•æ— æ³•ç‹¬ç«‹è¿è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é”™è¯¯ï¼šæµ‹è¯•é—´æœ‰ä¾èµ–</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRepositoryTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRepository orderRepository;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCreateOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;product-123&quot;</span>, <span class="hljs-number">1</span>);<br>        orderRepository.save(order);<br>        <span class="hljs-comment">// æœªæ¸…ç†æ•°æ®ï¼Œå½±å“åç»­æµ‹è¯•</span><br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldFindAllOrders</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ä¾èµ–ä¸Šä¸€ä¸ªæµ‹è¯•çš„æ•°æ®</span><br>        List&lt;Order&gt; orders = orderRepository.findAll();<br>        assertFalse(orders.isEmpty());<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ­£ç¡®ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRepositoryTest</span> &#123;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRepository orderRepository;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldCreateOrder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;product-123&quot;</span>, <span class="hljs-number">1</span>);<br>        orderRepository.save(order);<br>        assertNotNull(order.getId());<br>    &#125;<br>    <br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">shouldFindAllOrders</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// ç‹¬ç«‹å‡†å¤‡æ•°æ®</span><br>        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;product-456&quot;</span>, <span class="hljs-number">2</span>);<br>        orderRepository.save(order);<br>        <br>        List&lt;Order&gt; orders = orderRepository.findAll();<br>        assertEquals(<span class="hljs-number">1</span>, orders.size());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>é¿å…æ–¹æ³•</strong>ï¼šæ¯ä¸ªæµ‹è¯•åº”è¯¥æ˜¯ç‹¬ç«‹çš„ï¼Œä½¿ç”¨ <code>@Transactional</code> å›æ»šæˆ– <code>@BeforeEach</code>/<code>@AfterEach</code> æ¸…ç†æ•°æ®ã€‚</p>
<h2 id="ğŸ”‘-æ¨¡å¼æç‚¼ï¼šæµ‹è¯•ç‹¬ç«‹æ€§">ğŸ”‘ æ¨¡å¼æç‚¼ï¼šæµ‹è¯•ç‹¬ç«‹æ€§</h2>
<p><strong>æ¨¡å¼å…¬å¼</strong>ï¼š<code>ENSURE {æµ‹è¯•éš”ç¦»} BY {ç‹¬ç«‹å‡†å¤‡} AND {ç‹¬ç«‹æ¸…ç†} AND {æ— å…±äº«çŠ¶æ€}</code></p>
<p><strong>è¿ç§»è¡¨</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>éš”ç¦»æ–¹å¼</th>
<th>æ¸…ç†æ–¹å¼</th>
<th>é¿å…å…±äº«</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ•°æ®åº“æµ‹è¯•</td>
<td><code>@Transactional</code> å›æ»š</td>
<td>è‡ªåŠ¨å›æ»š</td>
<td>æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹å‡†å¤‡æ•°æ®</td>
</tr>
<tr>
<td>æ–‡ä»¶ç³»ç»Ÿæµ‹è¯•</td>
<td>ä¸´æ—¶ç›®å½•</td>
<td><code>@AfterEach</code> åˆ é™¤</td>
<td>ä½¿ç”¨å”¯ä¸€æ–‡ä»¶å</td>
</tr>
<tr>
<td>å†…å­˜çŠ¶æ€æµ‹è¯•</td>
<td>æ¯æ¬¡æ–°å»ºå¯¹è±¡</td>
<td>GC è‡ªåŠ¨å›æ”¶</td>
<td>é¿å…é™æ€å˜é‡</td>
</tr>
<tr>
<td>Mock å¯¹è±¡</td>
<td><code>@MockBean</code> æ¯æ¬¡é‡æ–°åˆ›å»º</td>
<td>è‡ªåŠ¨é‡ç½®</td>
<td>ä¸è·¨æµ‹è¯•å…±äº«</td>
</tr>
</tbody>
</table>
<p><strong>æ ¸å¿ƒæ´å¯Ÿ</strong>ï¼šæµ‹è¯•å¿…é¡»ç‹¬ç«‹è¿è¡Œï¼Œé¡ºåºæ— å…³ã€‚å¬åˆ°&quot;æµ‹è¯•æœ‰æ—¶é€šè¿‡æœ‰æ—¶å¤±è´¥&quot;ã€&quot;å•ç‹¬è¿è¡Œé€šè¿‡ä½†æ‰¹é‡è¿è¡Œå¤±è´¥&quot;æ—¶ï¼Œåº”æƒ³åˆ°æµ‹è¯•ç‹¬ç«‹æ€§æ¨¡å¼ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://magicliang.github.io">magicliang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://magicliang.github.io/2021/12/28/%E9%9D%A2%E5%90%91%E6%B5%8B%E8%AF%95%E7%BC%96%E7%A8%8B/">https://magicliang.github.io/2021/12/28/%E9%9D%A2%E5%90%91%E6%B5%8B%E8%AF%95%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B5%8B%E8%AF%95/">æµ‹è¯•</a></div><div class="post-share"><div class="social-share" data-image="/img/wall-paper-50.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2019/12/30/JUnit4-JUnit5-%E6%B3%A8%E8%A7%A3/" title="JUnit4&#x2F;JUnit5 æ³¨è§£"><img class="cover" src="/img/wall-paper-170.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-30</div><div class="info-item-2">JUnit4&#x2F;JUnit5 æ³¨è§£</div></div><div class="info-2"><div class="info-item-1">   junit4 junit5 ç‰¹ç‚¹     @BeforeClass @BeforeAll åœ¨å½“å‰ç±»çš„æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚æ³¨è§£åœ¨ã€é™æ€æ–¹æ³•ã€‘ä¸Šã€‚   @AfterClass @AfterAll åœ¨å½“å‰ç±»ä¸­çš„æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚æ³¨è§£åœ¨ã€é™æ€æ–¹æ³•ã€‘ä¸Šã€‚   @Before @BeforeEach åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚æ³¨è§£åœ¨ã€éé™æ€æ–¹æ³•ã€‘ä¸Šã€‚   @After @AfterEach åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹åæ‰§è¡Œã€‚æ³¨è§£åœ¨ã€éé™æ€æ–¹æ³•ã€‘ä¸Šã€‚    </div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Œä»€ä¹ˆæ˜¯é›†æˆæµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%87%91%E5%AD%97%E5%A1%94"><span class="toc-number">1.1.</span> <span class="toc-text">æµ‹è¯•é‡‘å­—å¡”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%AD%96%E7%95%A5%E9%80%89%E6%8B%A9"><span class="toc-number">1.2.</span> <span class="toc-text">æµ‹è¯•ç­–ç•¥é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E7%B1%BB%E6%B5%8B%E8%AF%95%E7%AD%96%E7%95%A5"><span class="toc-number">1.3.</span> <span class="toc-text">ä»£ç åˆ†ç±»æµ‹è¯•ç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">mock object</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#mockito-%E6%A0%B8%E5%BF%83%E7%94%A8%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">Mockito æ ¸å¿ƒç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stubbing%EF%BC%9A%E9%85%8D%E7%BD%AE%E8%A1%8C%E4%B8%BA"><span class="toc-number">2.1.1.</span> <span class="toc-text">Stubbingï¼šé…ç½®è¡Œä¸º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#verification%EF%BC%9A%E9%AA%8C%E8%AF%81%E8%B0%83%E7%94%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">Verificationï¼šéªŒè¯è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#argumentcaptor%EF%BC%9A%E6%8D%95%E8%8E%B7%E5%8F%82%E6%95%B0"><span class="toc-number">2.1.3.</span> <span class="toc-text">ArgumentCaptorï¼šæ•è·å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8-mock"><span class="toc-number">2.1.4.</span> <span class="toc-text">æ³¨è§£é©±åŠ¨ Mock</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mock-vs-stub-vs-spy"><span class="toc-number">2.2.</span> <span class="toc-text">Mock vs Stub vs Spy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mock%EF%BC%9A%E9%AA%8C%E8%AF%81%E8%A1%8C%E4%B8%BA"><span class="toc-number">2.2.1.</span> <span class="toc-text">Mockï¼šéªŒè¯è¡Œä¸º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stub%EF%BC%9A%E9%85%8D%E7%BD%AE%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">2.2.2.</span> <span class="toc-text">Stubï¼šé…ç½®è¿”å›å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spy%EF%BC%9A%E9%83%A8%E5%88%86-mock"><span class="toc-number">2.2.3.</span> <span class="toc-text">Spyï¼šéƒ¨åˆ† Mock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">2.2.4.</span> <span class="toc-text">é€‰æ‹©å»ºè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%94%91-%E6%A8%A1%E5%BC%8F%E6%8F%90%E7%82%BC%EF%BC%9A%E9%9A%94%E7%A6%BB%E4%BE%9D%E8%B5%96"><span class="toc-number">2.2.5.</span> <span class="toc-text">ğŸ”‘ æ¨¡å¼æç‚¼ï¼šéš”ç¦»ä¾èµ–</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">Case åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#edge-case"><span class="toc-number">3.1.</span> <span class="toc-text">edge case</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#corner-case"><span class="toc-number">3.2.</span> <span class="toc-text">corner case</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#boundary-case"><span class="toc-number">3.3.</span> <span class="toc-text">boundary case</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#base-case"><span class="toc-number">3.4.</span> <span class="toc-text">base case</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">developer-side test framework æ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">4.1.</span> <span class="toc-text">æ¡†æ¶é€‰æ‹©å»ºè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6"><span class="toc-number">4.1.1.</span> <span class="toc-text">æµ‹è¯•æ¡†æ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mock-%E6%A1%86%E6%9E%B6"><span class="toc-number">4.1.2.</span> <span class="toc-text">Mock æ¡†æ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E5%BA%93"><span class="toc-number">4.1.3.</span> <span class="toc-text">æ–­è¨€åº“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.2.</span> <span class="toc-text">é›†æˆæµ‹è¯•æ­å»ºæ­¥éª¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%80%89%E6%8B%A9%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6%E5%92%8C%E6%B5%8B%E8%AF%95%E6%8F%92%E4%BB%B6"><span class="toc-number">4.2.1.</span> <span class="toc-text">1. é€‰æ‹©æµ‹è¯•æ¡†æ¶å’Œæµ‹è¯•æ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%A1%AE%E5%AE%9A%E5%88%86%E5%8C%85"><span class="toc-number">4.2.2.</span> <span class="toc-text">2. ç¡®å®šåˆ†åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%BB%BA%E7%AB%8B%E5%9F%BA%E7%B1%BB"><span class="toc-number">4.2.3.</span> <span class="toc-text">3. å»ºç«‹åŸºç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%A1%AE%E5%AE%9A%E5%8F%AF%E6%8F%92%E6%8B%94%E7%9A%84-mock-%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.4.</span> <span class="toc-text">4. ç¡®å®šå¯æ’æ‹”çš„ Mock æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80-mock-%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.4.1.</span> <span class="toc-text">å…¨å±€ Mock é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%83%A8-mock-%E6%9B%BF%E4%BB%A3"><span class="toc-number">4.2.4.2.</span> <span class="toc-text">å±€éƒ¨ Mock æ›¿ä»£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87%E7%AD%96%E7%95%A5"><span class="toc-number">4.2.5.</span> <span class="toc-text">5. æ•°æ®å‡†å¤‡ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-case-%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-number">4.2.6.</span> <span class="toc-text">6. Case å‘½åè§„èŒƒ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">JUnit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B3%A8%E8%A7%A3"><span class="toc-number">5.1.</span> <span class="toc-text">ç”Ÿå‘½å‘¨æœŸæ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%B3%A8%E8%A7%A3%E5%AF%B9%E6%AF%94"><span class="toc-number">5.1.1.</span> <span class="toc-text">ç”Ÿå‘½å‘¨æœŸæ³¨è§£å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">5.2.</span> <span class="toc-text">å‚æ•°åŒ–æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-number">5.3.</span> <span class="toc-text">åµŒå¥—æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%89%A7%E8%A1%8C"><span class="toc-number">5.4.</span> <span class="toc-text">æ¡ä»¶æ‰§è¡Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80-api"><span class="toc-number">5.5.</span> <span class="toc-text">æ–­è¨€ API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#webmvctest"><span class="toc-number">5.5.1.</span> <span class="toc-text">@WebMvcTest</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#integration-test"><span class="toc-number">5.6.</span> <span class="toc-text">Integration Test</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#springboottest"><span class="toc-number">5.6.1.</span> <span class="toc-text">@SpringBootTest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#testcontext-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">5.6.2.</span> <span class="toc-text">TestContext ç¼“å­˜æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#transactional-%E5%9B%9E%E6%BB%9A"><span class="toc-number">5.6.3.</span> <span class="toc-text">@Transactional å›æ»š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql-%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">5.6.4.</span> <span class="toc-text">@Sql æ•°æ®å‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jdbc-testing-support"><span class="toc-number">5.6.5.</span> <span class="toc-text">JDBC Testing Support</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-testcontext-framework"><span class="toc-number">5.6.6.</span> <span class="toc-text">Spring TestContext Framework</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webtestclient"><span class="toc-number">5.6.7.</span> <span class="toc-text">WebTestClient</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#testing-client-applications"><span class="toc-number">5.6.8.</span> <span class="toc-text">Testing Client Applications</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%88%87%E7%89%87%E6%B3%A8%E8%A7%A3"><span class="toc-number">5.6.9.</span> <span class="toc-text">æµ‹è¯•åˆ‡ç‰‡æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#datajpatest"><span class="toc-number">5.6.9.1.</span> <span class="toc-text">@DataJpaTest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#webmvctest"><span class="toc-number">5.6.9.2.</span> <span class="toc-text">@WebMvcTest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jsontest"><span class="toc-number">5.6.9.3.</span> <span class="toc-text">@JsonTest</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#annotations"><span class="toc-number">5.6.10.</span> <span class="toc-text">Annotations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#annotations"><span class="toc-number">5.6.11.</span> <span class="toc-text">Annotations</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">æµ‹è¯•æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#given-when-then-%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">Given-When-Then æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"><span class="toc-number">6.2.</span> <span class="toc-text">æµ‹è¯•å‘½åè§„èŒƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87%E7%AD%96%E7%95%A5"><span class="toc-number">6.3.</span> <span class="toc-text">æµ‹è¯•è¦†ç›–ç‡ç­–ç•¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%91-%E6%A8%A1%E5%BC%8F%E6%8F%90%E7%82%BC%EF%BC%9A%E6%B5%8B%E8%AF%95%E4%B8%89%E6%AE%B5%E5%BC%8F"><span class="toc-number">6.4.</span> <span class="toc-text">ğŸ”‘ æ¨¡å¼æç‚¼ï¼šæµ‹è¯•ä¸‰æ®µå¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">æµ‹è¯•åæ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E5%BA%A6-mock"><span class="toc-number">7.1.</span> <span class="toc-text">è¿‡åº¦ Mock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%84%86%E5%BC%B1%E6%B5%8B%E8%AF%95"><span class="toc-number">7.2.</span> <span class="toc-text">è„†å¼±æµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%97%B4%E4%BE%9D%E8%B5%96"><span class="toc-number">7.3.</span> <span class="toc-text">æµ‹è¯•é—´ä¾èµ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%94%91-%E6%A8%A1%E5%BC%8F%E6%8F%90%E7%82%BC%EF%BC%9A%E6%B5%8B%E8%AF%95%E7%8B%AC%E7%AB%8B%E6%80%A7"><span class="toc-number">7.4.</span> <span class="toc-text">ğŸ”‘ æ¨¡å¼æç‚¼ï¼šæµ‹è¯•ç‹¬ç«‹æ€§</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">ç°¡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>