<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CoffeeScript2 简明教程 | 守株阁</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="写在前面的话   之前在工作群里看到一个排行榜:    在羡慕美国同行的薪水超高的同时，也奇怪为何 CoffeeScript 的生命力超过了自己之前的想象。   JavaScript 本是 Brendan Eich 在10天内做完的急就章之作，在设计之初，即带有大量的大意设计和缺陷。可以说，即使到了 1.5 时代，JavaScript 作为一门现代语言，依然要提防 Douglas Crockfor">
<meta property="og:type" content="article">
<meta property="og:title" content="CoffeeScript2 简明教程">
<meta property="og:url" content="https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="守株阁">
<meta property="og:description" content="写在前面的话   之前在工作群里看到一个排行榜:    在羡慕美国同行的薪水超高的同时，也奇怪为何 CoffeeScript 的生命力超过了自己之前的想象。   JavaScript 本是 Brendan Eich 在10天内做完的急就章之作，在设计之初，即带有大量的大意设计和缺陷。可以说，即使到了 1.5 时代，JavaScript 作为一门现代语言，依然要提防 Douglas Crockfor">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/coffeescript.jpg">
<meta property="article:published_time" content="2017-12-29T11:50:37.000Z">
<meta property="article:modified_time" content="2026-01-24T07:32:06.471Z">
<meta property="article:author" content="magicliang">
<meta property="article:tag" content="CoffeeScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/coffeescript.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CoffeeScript2 简明教程",
  "url": "https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/",
  "image": "https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/coffeescript.jpg",
  "datePublished": "2017-12-29T11:50:37.000Z",
  "dateModified": "2026-01-24T07:32:06.471Z",
  "author": [
    {
      "@type": "Person",
      "name": "magicliang",
      "url": "https://magicliang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: 守株阁","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CoffeeScript2 简明教程',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /><link rel="alternate" href="/atom.xml" title="守株阁" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/coffeescript.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">守株阁</span></a><a class="nav-page-title" href="/"><span class="site-name">CoffeeScript2 简明教程</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">CoffeeScript2 简明教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2017-12-29T11:50:37.000Z" title="Created 2017-12-29 19:50:37">2017-12-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:06.471Z" title="Updated 2026-01-24 15:32:06">2026-01-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">8.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>38mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1>写在前面的话</h1>
<p>  之前在工作群里看到一个排行榜:</p>
<p><img src="https://ws1.sinaimg.cn/large/66dd581fly1fmf6zwaftnj20iw0iqmz7.jpg" alt=""></p>
<p>  在羡慕美国同行的薪水超高的同时，也奇怪为何 CoffeeScript 的生命力超过了自己之前的想象。</p>
<p>  JavaScript 本是 Brendan Eich 在10天内做完的急就章之作，在设计之初，即带有大量的大意设计和缺陷。可以说，即使到了 1.5 时代，JavaScript 作为一门现代语言，依然要提防 Douglas Crockford 在《JavaScript:The Good Parts》中提出的种种陷阱。历年来，各路框架作者和超集语言作者，都不断在 JavaScript 上做出各种各样炫目的模式用法和衍生方言，足见其可提高空间之大。包括 CoffeeScript/TypeScript/Dart/Elm 等解决方案的出现，其实就是在倡导使用 Pre-JavaScript 的语言编写抽象逻辑，然后编译成原生 JavaScript 运行。</p>
<p>  CoffeeScript 即是 JavaScript 1.5 时代的 Pre-JavaScript 语言中的佼佼者。其设计的语法和句法利用了 Ruby 和 Python 的优点，然而又能去除 JavaScript 中容易产生二义性的部分，可以认为是一种变换写法的 JavaScript 语言子集，也就是美化过的“The Good Parts”。CoffeeScript 的定位，本来是一门 little language，它的目的不是取代 JavaScript，而是用更好的风格来编写 JavaScript，因此其最终目标也是编译成 JavaScript。因此，很多人都把它当做下一代 JavaScript 标准出现以前的过渡用法。</p>
<p>  2015年以来，ES6.0以及后来的 ES2015等标准的制定以及现代浏览器对原生语法支持的逐步实现，使得大部分众望所归的语言特性都可以在原生 JavaScript 中找到。旧的 CoffeeScript(CoffeeScript 1) 编译的结果已然不兼容新的ES2015的发展方向，CoffeeScript 作为一个过渡时期的产物，似乎已然完成了它的历史使命。</p>
<p>  但 CoffeeScript 的发展并没有停止。CofffeeScript 紧随现代 JavaScript 推出了 CoffeeScript 2。这一版本的 CoffeeScript 不仅保留了大部分上一版本 Ruby/Python 风格的优美语法，也大量兼容了 ES2015 的新特性（除了 import/export 这个在前后端实行起来经常需要转义和 polyfill 的特性以外），成为了一门更加现代的 little langugage。</p>
<p>  可能有读者会问，既然已经有了 ES2015，为什么还要再来一门编程语言呢？笔者认为，不同的编程语言，其实是不同的思考和设计工具。虽说图灵完备的语言总是等价的，但通过另一个角度来对问题和解建模，可以更有效地提高自己对原本掌握的语言的理解。因此，了解 CoffeeScript 的设计和使用理念，一定能对使用原生 JavaScript 编程有所脾益。</p>
<p>  本文基本上是 <a target="_blank" rel="noopener" href="http://coffeescript.org">coffeescript.org</a> 在2.0版本后文档的摘译和简化。每一个小的知识点会配上若干的代码块，两个相连的代码块总是代表一段 CoffeeScript 代码和它编译生成的 JavaScript 代码。阅读本文需要一定的 JavaScript 基础。</p>
<h1>简明教程</h1>
<h2 id="coffeescript-是什么？">CoffeeScript 是什么？</h2>
<p>**CoffeeScript 是一门编译成 Javascript 的小语言。**在 Java 风格的笨拙锈色之下，JavaScript 有着一颗华丽的心。CoffeeScript 试图用简明的方式，把 JavaScript 中的精粹部分表现出来。</p>
<p>CoffeeScript 的黄金法则是：“它只是 JavaScript”。代码会被一对一地编译成对等的 JS，不会有运行时解释。可以在 CoffeeScript 中无缝地使用任何现存的 JavaScript 库（反之亦然）。编译输出是可读，美化打印过的，而且趋向于和等价的手写 JavaScript 跑得一样快。</p>
<h2 id="安装和试用-coffee">安装和试用 coffee</h2>
<p>最新版本：2.1.0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 为一个项目局部安装:</span><br>npm install --save-dev coffeescript<br><br><span class="hljs-comment"># 全局安装以在任意处执行.coffee 文件:</span><br>npm install --global coffeescript<br></code></pre></td></tr></table></figure>
<p>假设我们有一个 test.coffee 的文件如下：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-comment"># Assignment:</span><br>number   = <span class="hljs-number">42</span><br>opposite = <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># Conditions:</span><br>number = <span class="hljs-number">-42</span> <span class="hljs-keyword">if</span> opposite<br><br><span class="hljs-comment"># Functions:</span><br><span class="hljs-function"><span class="hljs-title">square</span> = <span class="hljs-params">(x)</span> -&gt;</span> x * x<br><br><span class="hljs-comment"># Arrays:</span><br>list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><br><span class="hljs-comment"># Objects:</span><br>math =<br>  root:   <span class="hljs-built_in">Math</span>.sqrt<br>  square: square<br>  cube:   <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span> x * square x<br><br><span class="hljs-comment"># Splats:</span><br><span class="hljs-function"><span class="hljs-title">race</span> = <span class="hljs-params">(winner, runners...)</span> -&gt;</span><br>  <span class="hljs-built_in">print</span> winner, runners<br><br><span class="hljs-comment"># Existence:</span><br>alert <span class="hljs-string">&quot;I knew it!&quot;</span> <span class="hljs-keyword">if</span> elvis?<br><br><span class="hljs-comment"># Array comprehensions:</span><br>cubes = (math.cube num <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> list)<br></code></pre></td></tr></table></figure>
<p>运行<code>coffee -c test.coffee</code>就会得到一个test.js 文件如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Generated by CoffeeScript 2.1.0</span><br>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// Assignment:</span><br>  <span class="hljs-keyword">var</span> cubes, list, math, num, number, opposite, race, square;<br><br>  number = <span class="hljs-number">42</span>;<br><br>  opposite = <span class="hljs-literal">true</span>;<br><br>  <span class="hljs-keyword">if</span> (opposite) &#123;<br>    <span class="hljs-comment">// Conditions:</span><br>    number = -<span class="hljs-number">42</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// Functions:</span><br>  square = <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> x * x;<br>  &#125;;<br><br>  <span class="hljs-comment">// Arrays:</span><br>  list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br><br>  <span class="hljs-comment">// Objects:</span><br>  math = &#123;<br>    <span class="hljs-attr">root</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">sqrt</span>,<br>    <span class="hljs-attr">square</span>: square,<br>    <span class="hljs-attr">cube</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) &#123;<br>      <span class="hljs-keyword">return</span> x * <span class="hljs-title function_">square</span>(x);<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-comment">// Splats:</span><br>  race = <span class="hljs-keyword">function</span>(<span class="hljs-params">winner, ...runners</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">print</span>(winner, runners);<br>  &#125;;<br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> elvis !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; elvis !== <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// Existence:</span><br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;I knew it!&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// Array comprehensions:</span><br>  cubes = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> i, len, results;<br>    results = [];<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = list.<span class="hljs-property">length</span>; i &lt; len; i++) &#123;<br>      num = list[i];<br>      results.<span class="hljs-title function_">push</span>(math.<span class="hljs-title function_">cube</span>(num));<br>    &#125;<br>    <span class="hljs-keyword">return</span> results;<br>  &#125;)();<br><br>&#125;).<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>);<br></code></pre></td></tr></table></figure>
<p>缺省的 coffee 编译结果为了最大限度地保证不污染顶层的变量，总是会把文件编译成一个立即执行的函数，使得所有变量的声明和使用局限在一个小作用域里面。当然，它也有个 bare 模式可以去掉这种立即执行函数，如果使用<code>import</code>和<code>export</code> 的功能，也可以自动进入 bare 模式。这个模式的细节很繁琐，请读者自行查阅文档。</p>
<h2 id="普通函数">普通函数</h2>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">square</span> = <span class="hljs-params">(x)</span> -&gt;</span> x * x<br><span class="hljs-function"><span class="hljs-title">cube</span>   = <span class="hljs-params">(x)</span> -&gt;</span> square(x) * x<br><br><span class="hljs-comment"># 带有默认值的函数参数</span><br><span class="hljs-function"><span class="hljs-title">fill</span> = <span class="hljs-params">(container, liquid = <span class="hljs-string">&quot;coffee&quot;</span>)</span> -&gt;</span><br>  <span class="hljs-string">&quot;Filling the <span class="hljs-subst">#&#123;container&#125;</span> with <span class="hljs-subst">#&#123;liquid&#125;</span>...&quot;</span><br>  <br><span class="hljs-comment"># 空函数</span><br><span class="hljs-function"><span class="hljs-title">a</span> = -&gt;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> cube, square;<br><br>square = <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) &#123;<br>  <span class="hljs-keyword">return</span> x * x;<br>&#125;;<br><br>cube = <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">square</span>(x) * x;<br>&#125;;<br><br><span class="hljs-keyword">var</span> fill;<br><br><span class="hljs-comment">// 带有默认值的函数参数</span><br>fill = <span class="hljs-keyword">function</span>(<span class="hljs-params">container, liquid = <span class="hljs-string">&quot;coffee&quot;</span></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`Filling the <span class="hljs-subst">$&#123;container&#125;</span> with <span class="hljs-subst">$&#123;liquid&#125;</span>...`</span>;<br>&#125;;<br><br>  <span class="hljs-comment">// 空函数</span><br>  <span class="hljs-keyword">var</span> a;<br><br>  a = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;&#125;;<br></code></pre></td></tr></table></figure>
<p>使用<code>-&gt;</code>生成 function 函数。带默认值的参数，同样是 ES2015 的内容。</p>
<h2 id="字符串">字符串</h2>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffee">author = <span class="hljs-string">&quot;Wittgenstein&quot;</span><br>quote  = <span class="hljs-string">&quot;A picture is a fact. -- <span class="hljs-subst">#&#123; author &#125;</span>&quot;</span><br><br>sentence = <span class="hljs-string">&quot;<span class="hljs-subst">#&#123; <span class="hljs-number">22</span> / <span class="hljs-number">7</span> &#125;</span> is a decent approximation of π&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> author, quote, sentence;<br><br>author = <span class="hljs-string">&quot;Wittgenstein&quot;</span>;<br><br>quote = <span class="hljs-string">`A picture is a fact. -- <span class="hljs-subst">$&#123;author&#125;</span>`</span>;<br><br>sentence = <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-number">22</span> / <span class="hljs-number">7</span>&#125;</span> is a decent approximation of π`</span>;<br></code></pre></td></tr></table></figure>
<p>CoffeeScript 的字符串同 JavaScript 一样，可以用<code>&quot;</code>和<code>'</code>分界。用&quot;引用的字符串，可以用<code>#{}</code> 来进行内插（甚至可以在对象的key 里执行内插）。用’引用的字符串是字面量。</p>
<p>双引号的多行字符串可以自动被编译器连接起来，当然，所有的缩进都失效了：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs coffee">mobyDick = <span class="hljs-string">&quot;Call me Ishmael. Some years ago --</span><br><span class="hljs-string">  never mind how long precisely -- having little</span><br><span class="hljs-string">  or no money in my purse, and nothing particular</span><br><span class="hljs-string">  to interest me on shore, I thought I would sail</span><br><span class="hljs-string">  about a little and see the watery part of the</span><br><span class="hljs-string">  world...&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> mobyDick;<br><br>mobyDick = <span class="hljs-string">&quot;Call me Ishmael. Some years ago -- never mind how long precisely -- having little or no money in my purse, and nothing particular to interest me on shore, I thought I would sail about a little and see the watery part of the world...&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>使用三引号<code>&quot;&quot;&quot;</code>和三个单引号<code>'''</code>，还可以生成保留格式（特别是缩进）的<strong>块</strong>字符串：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs coffee">html = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">       &lt;strong&gt;</span><br><span class="hljs-string">         cup of coffeescript</span><br><span class="hljs-string">       &lt;/strong&gt;</span><br><span class="hljs-string">       &quot;&quot;&quot;</span><br>       <br>html = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">       &lt;strong&gt;</span><br><span class="hljs-string">         cup of coffeescript</span><br><span class="hljs-string">       &lt;/strong&gt;</span><br><span class="hljs-string">       &#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> html;<br><br>html = <span class="hljs-string">&quot;&lt;strong&gt;\n  cup of coffeescript\n&lt;/strong&gt;&quot;</span>;<br><br><span class="hljs-keyword">var</span> html;<br><br>html = <span class="hljs-string">&#x27;&lt;strong&gt;\n  cup of coffeescript\n&lt;/strong&gt;&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>用双引号制造出来的块字符串，也一样支持字符串内插功能。</p>
<h2 id="对象和数组">对象和数组</h2>
<p>CoffeeScript 支持 JavaScript 格式的对象和数组字面量，也支持更简明的无逗号的、依靠换行的字面量：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs coffee">song = [<span class="hljs-string">&quot;do&quot;</span>, <span class="hljs-string">&quot;re&quot;</span>, <span class="hljs-string">&quot;mi&quot;</span>, <span class="hljs-string">&quot;fa&quot;</span>, <span class="hljs-string">&quot;so&quot;</span>]<br><br>singers = &#123;Jagger: <span class="hljs-string">&quot;Rock&quot;</span>, Elvis: <span class="hljs-string">&quot;Roll&quot;</span>&#125;<br><br><span class="hljs-comment"># 用换行来代替分隔符</span><br>bitlist = [<br>  <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>  <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span><br>  <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span><br>]<br><br><span class="hljs-comment"># 类 YAML 格式，用换行来代替分隔符</span><br>kids =<br>  brother:<br>    name: <span class="hljs-string">&quot;Max&quot;</span><br>    age:  <span class="hljs-number">11</span><br>  sister:<br>    name: <span class="hljs-string">&quot;Ida&quot;</span><br>    age:  <span class="hljs-number">9</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> bitlist, kids, singers, song;<br><br>song = [<span class="hljs-string">&quot;do&quot;</span>, <span class="hljs-string">&quot;re&quot;</span>, <span class="hljs-string">&quot;mi&quot;</span>, <span class="hljs-string">&quot;fa&quot;</span>, <span class="hljs-string">&quot;so&quot;</span>];<br><br>singers = &#123;<br>  <span class="hljs-title class_">Jagger</span>: <span class="hljs-string">&quot;Rock&quot;</span>,<br>  <span class="hljs-title class_">Elvis</span>: <span class="hljs-string">&quot;Roll&quot;</span><br>&#125;;<br><br>bitlist = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>];<br><br>kids = &#123;<br>  <span class="hljs-attr">brother</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Max&quot;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">11</span><br>  &#125;,<br>  <span class="hljs-attr">sister</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Ida&quot;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">9</span><br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>CoffeeScript 也支持 ES2015的字面量语法：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffee">name = <span class="hljs-string">&quot;Michelangelo&quot;</span><br>mask = <span class="hljs-string">&quot;orange&quot;</span><br>weapon = <span class="hljs-string">&quot;nunchuks&quot;</span><br>turtle = &#123;name, mask, weapon&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> mask, name, output, turtle, weapon;<br><br>name = <span class="hljs-string">&quot;Michelangelo&quot;</span>;<br><br>mask = <span class="hljs-string">&quot;orange&quot;</span>;<br><br>weapon = <span class="hljs-string">&quot;nunchuks&quot;</span>;<br><br>turtle = &#123;name, mask, weapon&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="注释">注释</h2>
<p>聪明的读者可能已经发现了注释应该怎么写，但这里还是要总结下。CoffeeScript 里的注释其实是脚本语言的注释的应用：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-comment">###</span><br><span class="hljs-comment">Fortune Cookie Reader v1.0</span><br><span class="hljs-comment">Released under the MIT License</span><br><span class="hljs-comment">###</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">sayFortune</span> = <span class="hljs-params">(fortune)</span> -&gt;</span><br>  console.log fortune <span class="hljs-comment"># in bed!</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Fortune Cookie Reader v1.0</span><br><span class="hljs-comment">Released under the MIT License</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">var</span> sayFortune;<br><br>sayFortune = <span class="hljs-keyword">function</span>(<span class="hljs-params">fortune</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fortune); <span class="hljs-comment">// in bed!</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>
<p>值得注意的是，<code>###</code>支持了类型注解。</p>
<h2 id="词法作用域和变量安全">词法作用域和变量安全</h2>
<p>聪明的读者可能也发现了，在 CoffeeScript 中，是不需要手写<code>var</code>这样的关键字的。实际上，ES2015为了解决过去的 JavaScript 中不存在块级作用域这样的问题，专门提出的<code>const</code>和<code>let</code>解决方案，CoffeeScript 也不支持。在有多层变量的时候，CoffeeScript <strong>会自动地推导变量的作用域</strong>，保证内层的变量绝不会污染任何外层变量。每个变量的实际作用域，会被限制在它首次被声明的地方。JavaScript 无意之中忘加<code>var</code>关键字而污染全局变量的情况便不复存在了。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffee">outer = <span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">changeNumbers</span> = -&gt;</span><br>  inner = <span class="hljs-number">-1</span><br>  outer = <span class="hljs-number">10</span><br>inner = changeNumbers()<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> changeNumbers, inner, outer;<br><br>outer = <span class="hljs-number">1</span>;<br><br>changeNumbers = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> inner;<br>  inner = -<span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> outer = <span class="hljs-number">10</span>;<br>&#125;;<br><br>inner = <span class="hljs-title function_">changeNumbers</span>();<br></code></pre></td></tr></table></figure>
<p><code>outer</code> 因为在外部作用域里已经声明过了，所以不需要重复声明。而<code>inner</code>只是在内部作用域里被使用，所以还额外声明了一个函数内的 <code>inner</code>来专门隔离它的作用域。外部专门声明的<code>var inner</code>其实就是一个编译器为了谨慎做的声明顶部上推，在这个编译的例子里不影响任何语义。</p>
<p>因为无法使用<code>var</code>关键字，所以实际上我们是无法遮蔽（shadow）住外部变量的，只能在内部作用域引用外部变量。</p>
<h2 id="if-else-unless-与条件赋值">If,Else,Unless, 与条件赋值</h2>
<p>if/else 里可以不用写小括号和大括号，使用 python 式的缩进定界，用户也可以使用单行 if 和 unless。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coffee">mood = greatlyImproved <span class="hljs-keyword">if</span> singing<br><br><span class="hljs-keyword">if</span> happy <span class="hljs-keyword">and</span> knowsIt<br>  <span class="hljs-comment"># 用缩进来确定这一段代码是在条件块里的</span><br>  clapsHands()<br>  chaChaCha()<br><span class="hljs-keyword">else</span><br>  showIt()<br><br>date = <span class="hljs-keyword">if</span> friday <span class="hljs-keyword">then</span> sue <span class="hljs-keyword">else</span> jill<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> date, mood;<br><br><span class="hljs-keyword">if</span> (singing) &#123;<br>  mood = greatlyImproved;<br>&#125;<br><br><span class="hljs-keyword">if</span> (happy &amp;&amp; knowsIt) &#123;<br>  <span class="hljs-title function_">clapsHands</span>();<br>  <span class="hljs-title function_">chaChaCha</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-title function_">showIt</span>();<br>&#125;<br><br>date = friday ? sue : jill;<br></code></pre></td></tr></table></figure>
<h2 id="不定参数语法">不定参数语法</h2>
<p>Java 程序员里面可能都习惯了类似 … 语法的不定参数语法来了。在 CoffeeScript 中它被称为 Splats 参数。ES2015吸收了这一语法，做出了 rest 参数。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs coffee">gold = silver = rest = <span class="hljs-string">&quot;unknown&quot;</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">awardMedals</span> = <span class="hljs-params">(first, second, others...)</span> -&gt;</span><br>  gold   = first<br>  silver = second<br>  rest   = others<br><br>contenders = [<br>  <span class="hljs-string">&quot;Michael Phelps&quot;</span><br>  <span class="hljs-string">&quot;Liu Xiang&quot;</span><br>  <span class="hljs-string">&quot;Yao Ming&quot;</span><br>  <span class="hljs-string">&quot;Allyson Felix&quot;</span><br>  <span class="hljs-string">&quot;Shawn Johnson&quot;</span><br>  <span class="hljs-string">&quot;Roman Sebrle&quot;</span><br>  <span class="hljs-string">&quot;Guo Jingjing&quot;</span><br>  <span class="hljs-string">&quot;Tyson Gay&quot;</span><br>  <span class="hljs-string">&quot;Asafa Powell&quot;</span><br>  <span class="hljs-string">&quot;Usain Bolt&quot;</span><br>]<br><br>awardMedals contenders...<br><br>alert <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Gold: <span class="hljs-subst">#&#123;gold&#125;</span></span><br><span class="hljs-string">Silver: <span class="hljs-subst">#&#123;silver&#125;</span></span><br><span class="hljs-string">The Field: <span class="hljs-subst">#&#123;rest.join <span class="hljs-string">&#x27;, &#x27;</span>&#125;</span></span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 特殊的数组省略语法</span><br>popular  = [<span class="hljs-string">&#x27;pepperoni&#x27;</span>, <span class="hljs-string">&#x27;sausage&#x27;</span>, <span class="hljs-string">&#x27;cheese&#x27;</span>]<br>unwanted = [<span class="hljs-string">&#x27;anchovies&#x27;</span>, <span class="hljs-string">&#x27;olives&#x27;</span>]<br><br>all = [popular..., unwanted..., <span class="hljs-string">&#x27;mushrooms&#x27;</span>]<br><br><span class="hljs-comment"># 对象属性语法</span><br><br>user =<br>  name: <span class="hljs-string">&#x27;Werner Heisenberg&#x27;</span><br>  occupation: <span class="hljs-string">&#x27;theoretical physicist&#x27;</span><br><br>currentUser = &#123; user..., status: <span class="hljs-string">&#x27;Uncertain&#x27;</span> &#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> awardMedals, contenders, gold, rest, silver;<br><br>gold = silver = rest = <span class="hljs-string">&quot;unknown&quot;</span>;<br><br>awardMedals = <span class="hljs-keyword">function</span>(<span class="hljs-params">first, second, ...others</span>) &#123;<br>  gold = first;<br>  silver = second;<br>  <span class="hljs-keyword">return</span> rest = others;<br>&#125;;<br><br>contenders = [<span class="hljs-string">&quot;Michael Phelps&quot;</span>, <span class="hljs-string">&quot;Liu Xiang&quot;</span>, <span class="hljs-string">&quot;Yao Ming&quot;</span>, <span class="hljs-string">&quot;Allyson Felix&quot;</span>, <span class="hljs-string">&quot;Shawn Johnson&quot;</span>, <span class="hljs-string">&quot;Roman Sebrle&quot;</span>, <span class="hljs-string">&quot;Guo Jingjing&quot;</span>, <span class="hljs-string">&quot;Tyson Gay&quot;</span>, <span class="hljs-string">&quot;Asafa Powell&quot;</span>, <span class="hljs-string">&quot;Usain Bolt&quot;</span>];<br><br><span class="hljs-title function_">awardMedals</span>(...contenders);<br><br><span class="hljs-title function_">alert</span>(<span class="hljs-string">`Gold: <span class="hljs-subst">$&#123;gold&#125;</span>\nSilver: <span class="hljs-subst">$&#123;silver&#125;</span>\nThe Field: <span class="hljs-subst">$&#123;rest.join(<span class="hljs-string">&#x27;, &#x27;</span>)&#125;</span>`</span>);<br><br># 特殊的数组省略语法<br><span class="hljs-keyword">var</span> all, popular, unwanted;<br><br>popular = [<span class="hljs-string">&#x27;pepperoni&#x27;</span>, <span class="hljs-string">&#x27;sausage&#x27;</span>, <span class="hljs-string">&#x27;cheese&#x27;</span>];<br><br>unwanted = [<span class="hljs-string">&#x27;anchovies&#x27;</span>, <span class="hljs-string">&#x27;olives&#x27;</span>];<br><br>all = [...popular, ...unwanted, <span class="hljs-string">&#x27;mushrooms&#x27;</span>];<br><br><span class="hljs-comment">// 特殊的对象属性语法</span><br><span class="hljs-keyword">var</span> currentUser, user,<br>  _extends = <span class="hljs-title class_">Object</span>.<span class="hljs-property">assign</span> || <span class="hljs-keyword">function</span> (<span class="hljs-params">target</span>) &#123; <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>; i++) &#123; <span class="hljs-keyword">var</span> source = <span class="hljs-variable language_">arguments</span>[i]; <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> source) &#123; <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hasOwnProperty</span>.<span class="hljs-title function_">call</span>(source, key)) &#123; target[key] = source[key]; &#125; &#125; &#125; <span class="hljs-keyword">return</span> target; &#125;;<br><br>user = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Werner Heisenberg&#x27;</span>,<br>  <span class="hljs-attr">occupation</span>: <span class="hljs-string">&#x27;theoretical physicist&#x27;</span><br>&#125;;<br><br>currentUser = <span class="hljs-title function_">_extends</span>(&#123;&#125;, user, &#123;<br>  <span class="hljs-attr">status</span>: <span class="hljs-string">&#x27;Uncertain&#x27;</span><br>&#125;);<br></code></pre></td></tr></table></figure>
<h2 id="循环和表处理">循环和表处理</h2>
<p>CoffeeScript 的 for 循环可以处理数组、对象和 range，有点类似 Python。而且，它的 for 循环是有返回值的。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-comment"># Eat lunch.</span><br><span class="hljs-function"><span class="hljs-title">eat</span> = <span class="hljs-params">(food)</span> -&gt;</span> <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;food&#125;</span> eaten.&quot;</span><br>eat food <span class="hljs-keyword">for</span> food <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;toast&#x27;</span>, <span class="hljs-string">&#x27;cheese&#x27;</span>, <span class="hljs-string">&#x27;wine&#x27;</span>]<br><br><span class="hljs-comment"># Fine five course dining.</span><br>courses = [<span class="hljs-string">&#x27;greens&#x27;</span>, <span class="hljs-string">&#x27;caviar&#x27;</span>, <span class="hljs-string">&#x27;truffles&#x27;</span>, <span class="hljs-string">&#x27;roast&#x27;</span>, <span class="hljs-string">&#x27;cake&#x27;</span>]<br><span class="hljs-function"><span class="hljs-title">menu</span> = <span class="hljs-params">(i, dish)</span> -&gt;</span> <span class="hljs-string">&quot;Menu Item <span class="hljs-subst">#&#123;i&#125;</span>: <span class="hljs-subst">#&#123;dish&#125;</span>&quot;</span> <br>menu i + <span class="hljs-number">1</span>, dish <span class="hljs-keyword">for</span> dish, i <span class="hljs-keyword">in</span> courses<br><br><span class="hljs-comment"># Health conscious meal.</span><br>foods = [<span class="hljs-string">&#x27;broccoli&#x27;</span>, <span class="hljs-string">&#x27;spinach&#x27;</span>, <span class="hljs-string">&#x27;chocolate&#x27;</span>]<br>eat food <span class="hljs-keyword">for</span> food <span class="hljs-keyword">in</span> foods <span class="hljs-keyword">when</span> food <span class="hljs-keyword">isnt</span> <span class="hljs-string">&#x27;chocolate&#x27;</span><br><br><span class="hljs-comment"># 一个使用返回值的例子</span><br>countdown = (num <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> [<span class="hljs-number">10.</span><span class="hljs-number">.1</span>])<br><br><span class="hljs-comment"># 遍历对象的例子</span><br>yearsOld = max: <span class="hljs-number">10</span>, ida: <span class="hljs-number">9</span>, tim: <span class="hljs-number">11</span><br><br>ages = <span class="hljs-keyword">for</span> child, age <span class="hljs-keyword">of</span> yearsOld<br>  <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;child&#125;</span> is <span class="hljs-subst">#&#123;age&#125;</span>&quot;</span><br><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Eat lunch.</span><br><span class="hljs-keyword">var</span> courses, dish, eat, food, foods, i, j, k, l, len, len1, len2, menu, ref;<br><br>eat = <span class="hljs-keyword">function</span>(<span class="hljs-params">food</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">$&#123;food&#125;</span> eaten.`</span>;<br>&#125;;<br><br>ref = [<span class="hljs-string">&#x27;toast&#x27;</span>, <span class="hljs-string">&#x27;cheese&#x27;</span>, <span class="hljs-string">&#x27;wine&#x27;</span>];<br><span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, len = ref.<span class="hljs-property">length</span>; j &lt; len; j++) &#123;<br>  food = ref[j];<br>  <span class="hljs-title function_">eat</span>(food);<br>&#125;<br><br><span class="hljs-comment">// Fine five course dining.</span><br>courses = [<span class="hljs-string">&#x27;greens&#x27;</span>, <span class="hljs-string">&#x27;caviar&#x27;</span>, <span class="hljs-string">&#x27;truffles&#x27;</span>, <span class="hljs-string">&#x27;roast&#x27;</span>, <span class="hljs-string">&#x27;cake&#x27;</span>];<br><br>menu = <span class="hljs-keyword">function</span>(<span class="hljs-params">i, dish</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`Menu Item <span class="hljs-subst">$&#123;i&#125;</span>: <span class="hljs-subst">$&#123;dish&#125;</span>`</span>;<br>&#125;;<br><br><span class="hljs-keyword">for</span> (i = k = <span class="hljs-number">0</span>, len1 = courses.<span class="hljs-property">length</span>; k &lt; len1; i = ++k) &#123;<br>  dish = courses[i];<br>  <span class="hljs-title function_">menu</span>(i + <span class="hljs-number">1</span>, dish);<br>&#125;<br><br><span class="hljs-comment">// Health conscious meal.</span><br>foods = [<span class="hljs-string">&#x27;broccoli&#x27;</span>, <span class="hljs-string">&#x27;spinach&#x27;</span>, <span class="hljs-string">&#x27;chocolate&#x27;</span>];<br><br><span class="hljs-keyword">for</span> (l = <span class="hljs-number">0</span>, len2 = foods.<span class="hljs-property">length</span>; l &lt; len2; l++) &#123;<br>  food = foods[l];<br>  <span class="hljs-keyword">if</span> (food !== <span class="hljs-string">&#x27;chocolate&#x27;</span>) &#123;<br>    <span class="hljs-title function_">eat</span>(food);<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// 返回值的例子转化为 Javascript 变得如此之长，可以看到 CoffeeScript 的精炼</span><br><span class="hljs-keyword">var</span> countdown, num;<br><br>countdown = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> i, results;<br>  results = [];<br>  <span class="hljs-keyword">for</span> (num = i = <span class="hljs-number">10</span>; i &gt;= <span class="hljs-number">1</span>; num = --i) &#123;<br>    results.<span class="hljs-title function_">push</span>(num);<br>  &#125;<br>  <span class="hljs-keyword">return</span> results;<br>&#125;)();<br><br><span class="hljs-comment">// 遍历对象的例子</span><br><span class="hljs-keyword">var</span> age, ages, child, yearsOld;<br><br>yearsOld = &#123;<br>  <span class="hljs-attr">max</span>: <span class="hljs-number">10</span>,<br>  <span class="hljs-attr">ida</span>: <span class="hljs-number">9</span>,<br>  <span class="hljs-attr">tim</span>: <span class="hljs-number">11</span><br>&#125;;<br><br>ages = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> results;<br>  results = [];<br>  <span class="hljs-keyword">for</span> (child <span class="hljs-keyword">in</span> yearsOld) &#123;<br>    age = yearsOld[child];<br>    results.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;child&#125;</span> is <span class="hljs-subst">$&#123;age&#125;</span>`</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> results;<br>&#125;)();<br><br></code></pre></td></tr></table></figure>
<p>特别地，CoffeScript 提供一个低级的 while 循环，它同样是带有返回值的。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-comment"># Econ 101</span><br><span class="hljs-keyword">if</span> this.studyingEconomics<br>  buy()  <span class="hljs-keyword">while</span> supply &gt; demand<br>  sell() <span class="hljs-keyword">until</span> supply &gt; demand<br><br><span class="hljs-comment"># Nursery Rhyme</span><br>num = <span class="hljs-number">6</span><br>lyrics = <span class="hljs-keyword">while</span> num -= <span class="hljs-number">1</span><br>  <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;num&#125;</span> little monkeys, jumping on the bed.</span><br><span class="hljs-string">    One fell out and bumped his head.&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Econ 101</span><br><span class="hljs-keyword">var</span> lyrics, num;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">studyingEconomics</span>) &#123;<br>  <span class="hljs-keyword">while</span> (supply &gt; demand) &#123;<br>    <span class="hljs-title function_">buy</span>();<br>  &#125;<br>  <span class="hljs-keyword">while</span> (!(supply &gt; demand)) &#123;<br>    <span class="hljs-title function_">sell</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// Nursery Rhyme</span><br>num = <span class="hljs-number">6</span>;<br><br>lyrics = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> results;<br>  results = [];<br>  <span class="hljs-keyword">while</span> (num -= <span class="hljs-number">1</span>) &#123;<br>    results.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;num&#125;</span> little monkeys, jumping on the bed. One fell out and bumped his head.`</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> results;<br>&#125;)();<br><br></code></pre></td></tr></table></figure>
<p>JavaScript 老手可能会很习惯匿名函数立即执行的用法，CoffeeScript 用 do 关键字支持把循环和匿名函数立即执行结合起来：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> list<br>  <span class="hljs-keyword">do</span> (filename) -&gt;<br>    <span class="hljs-keyword">if</span> filename <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;.DS_Store&#x27;</span>, <span class="hljs-string">&#x27;Thumbs.db&#x27;</span>, <span class="hljs-string">&#x27;ehthumbs.db&#x27;</span>]<br>      fs.readFile filename, <span class="hljs-function"><span class="hljs-params">(err, contents)</span> -&gt;</span><br>        compile filename, contents.toString()<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> filename, fn, i, len;<br><br>fn = <span class="hljs-keyword">function</span>(<span class="hljs-params">filename</span>) &#123;<br>  <span class="hljs-keyword">if</span> (filename !== <span class="hljs-string">&#x27;.DS_Store&#x27;</span> &amp;&amp; filename !== <span class="hljs-string">&#x27;Thumbs.db&#x27;</span> &amp;&amp; filename !== <span class="hljs-string">&#x27;ehthumbs.db&#x27;</span>) &#123;<br>    <span class="hljs-keyword">return</span> fs.<span class="hljs-title function_">readFile</span>(filename, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, contents</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title function_">compile</span>(filename, contents.<span class="hljs-title function_">toString</span>());<br>    &#125;);<br>  &#125;<br>&#125;;<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = list.<span class="hljs-property">length</span>; i &lt; len; i++) &#123;<br>  filename = list[i];<br>  <span class="hljs-title function_">fn</span>(filename);<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h2 id="数组分片和-range-分片">数组分片和 range 分片</h2>
<p>CoffeeScript 同样以索引操作符的形式（类 Python 和 C++）支持对数组的 slicing。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs coffee">numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]<br><br>start   = numbers[<span class="hljs-number">0.</span><span class="hljs-number">.2</span>]<br><br>middle  = numbers[<span class="hljs-number">3.</span>..<span class="hljs-number">-2</span>]<br><br>end     = numbers[<span class="hljs-number">-2.</span>.]<br><br>copy    = numbers[..]<br><br>numbers = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]<br><br>numbers[<span class="hljs-number">3.</span><span class="hljs-number">.6</span>] = [<span class="hljs-number">-3</span>, <span class="hljs-number">-4</span>, <span class="hljs-number">-5</span>, <span class="hljs-number">-6</span>]<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> copy, end, middle, numbers, start;<br><br>numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];<br><br>start = numbers.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>);<br><br>middle = numbers.<span class="hljs-title function_">slice</span>(<span class="hljs-number">3</span>, -<span class="hljs-number">2</span>);<br><br>end = numbers.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">2</span>);<br><br>copy = numbers.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">var</span> numbers, ref,<br>  splice = [].<span class="hljs-property">splice</span>;<br><br>numbers = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>];<br><br>splice.<span class="hljs-title function_">apply</span>(numbers, [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_">concat</span>(ref = [-<span class="hljs-number">3</span>, -<span class="hljs-number">4</span>, -<span class="hljs-number">5</span>, -<span class="hljs-number">6</span>])), ref;<br></code></pre></td></tr></table></figure>
<h2 id="一切皆表达式">一切皆表达式</h2>
<p>表达式特别于普通语句的地方，就是它们总是可以求值的。<br>
诸位读者可能已经注意到，CoffeeScript 中几乎没有 return。在函数中，最后一行表达式，就是整个块的表达式返回值，这点也是 CoffeeScript 从 Ruby 那里吸收来的特性。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">grade</span> = <span class="hljs-params">(student)</span> -&gt;</span><br>  <span class="hljs-keyword">if</span> student.excellentWork<br>    <span class="hljs-string">&quot;A+&quot;</span><br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> student.okayStuff<br>    <span class="hljs-keyword">if</span> student.triedHard <span class="hljs-keyword">then</span> <span class="hljs-string">&quot;B&quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;B-&quot;</span><br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-string">&quot;C&quot;</span><br><br>eldest = <span class="hljs-keyword">if</span> <span class="hljs-number">24</span> &gt; <span class="hljs-number">21</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&quot;Liz&quot;</span> <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;Ike&quot;</span><br><br>six = (one = <span class="hljs-number">1</span>) + (two = <span class="hljs-number">2</span>) + (three = <span class="hljs-number">3</span>)<br><br><span class="hljs-comment"># The first ten global properties.</span><br><br>globals = (name <span class="hljs-keyword">for</span> name <span class="hljs-keyword">of</span> window)[<span class="hljs-number">0.</span>.<span class="hljs-number">.10</span>]<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> eldest, grade;<br><br>grade = <span class="hljs-keyword">function</span>(<span class="hljs-params">student</span>) &#123;<br>  <span class="hljs-keyword">if</span> (student.<span class="hljs-property">excellentWork</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;A+&quot;</span>;<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (student.<span class="hljs-property">okayStuff</span>) &#123;<br>    <span class="hljs-keyword">if</span> (student.<span class="hljs-property">triedHard</span>) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;B&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;B-&quot;</span>;<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;C&quot;</span>;<br>  &#125;<br>&#125;;<br><br>eldest = <span class="hljs-number">24</span> &gt; <span class="hljs-number">21</span> ? <span class="hljs-string">&quot;Liz&quot;</span> : <span class="hljs-string">&quot;Ike&quot;</span>;<br><br><span class="hljs-keyword">var</span> one, six, three, two;<br><br>six = (one = <span class="hljs-number">1</span>) + (two = <span class="hljs-number">2</span>) + (three = <span class="hljs-number">3</span>);<br><br><span class="hljs-comment">// The first ten global properties.</span><br><span class="hljs-keyword">var</span> globals, name;<br><br>globals = ((<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> results;<br>  results = [];<br>  <span class="hljs-keyword">for</span> (name <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) &#123;<br>    results.<span class="hljs-title function_">push</span>(name);<br>  &#125;<br>  <span class="hljs-keyword">return</span> results;<br>&#125;)()).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure>
<p>比较有意思的是，try/catch 也是可以有返回值的：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coffee">alert(<br>  <span class="hljs-keyword">try</span><br>    nonexistent / <span class="hljs-literal">undefined</span><br>  <span class="hljs-keyword">catch</span> error<br>    <span class="hljs-string">&quot;And the error is ... <span class="hljs-subst">#&#123;error&#125;</span>&quot;</span><br>)<br><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> error;<br><br><span class="hljs-title function_">alert</span>((<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">return</span> nonexistent / <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;<br>  &#125; <span class="hljs-keyword">catch</span> (error1) &#123;<br>    error = error1;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`And the error is ... <span class="hljs-subst">$&#123;error&#125;</span>`</span>;<br>  &#125;<br>&#125;)());<br></code></pre></td></tr></table></figure>
<p>当然，有些语句在 JavaScript 中也是不能当做表达式的，比如<code>break</code>、<code>continue</code>和<code>return</code>，如果你在代码块中使用了它们，CoffeeScript不会试图进行转换。</p>
<h2 id="操作符与别名">操作符与别名</h2>
<p><code>==</code>操作符经常引起出乎意料的、与其他语言中表现不一致的行为。所以 CoffeeScript 里没有<code>==</code>，而会试着进行再编译。把<code>==</code>编译成<code>===</code>，<code>!=</code>编译成<code>!==</code>。另外，它还提供了可读性更好的两个操作符，<code>is</code>会被编译为<code>===</code>，isnt 会被编译为<code>isnt</code>。</p>
<p>除此之外，还可以用<code>not</code>作取反操作符<code>!</code>的别名。</p>
<p>对于逻辑操作符，<code>and</code>会被编译为<code>&amp;&amp;</code>，<code>or</code>会被便以为<code>||</code>。</p>
<p>在 JavaScript 中，有时候条件语句需要另起一行或者在单行内用分号断句，但CoffeeScript 中的 then 就可以帮我们把条件语句（特别是 while、if、switch 的结构中）和被执行语句连起来。</p>
<p>同<code>YAML</code>中一样，<code>on</code>和<code>yes</code>是布尔值<code>true</code>的同义词，<code>off</code>和<code>no</code>是布尔值<code>false</code>的同义词。</p>
<p>同其他脚本语言一样，<code>unless</code>是<code>if</code>的反写。</p>
<p>同 Ruby 一样，<code>@property</code>可以当做<code>this.property</code>来用（少写一个字符）。</p>
<p>可以用<code>in</code>来做数组元素的存在检查，用<code>of</code>来做 JavaScript 键值对的存在性检查。</p>
<p>在<code>for</code>循环中，<code>from</code>关键字会被编译成 ES2015 的<code>of</code>。</p>
<p>为了简化数学表达式，<code>**</code>代表幂运算，而<code>//</code>执行地板除法（同 Python 一样，去掉小数向下取整）</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-number">-7</span> % <span class="hljs-number">5</span> == <span class="hljs-number">-2</span> <span class="hljs-comment"># The remainder of 7 / 5</span><br><span class="hljs-number">-7</span> %% <span class="hljs-number">5</span> == <span class="hljs-number">3</span> <span class="hljs-comment"># n %% 5 is always between 0 and 4</span><br><br>tabs.selectTabAtIndex((tabs.currentIndex - count) %% tabs.length)<br><br>launch() <span class="hljs-keyword">if</span> ignition <span class="hljs-keyword">is</span> <span class="hljs-literal">on</span><br><br>volume = <span class="hljs-number">10</span> <span class="hljs-keyword">if</span> band <span class="hljs-keyword">isnt</span> SpinalTap<br><br>letTheWildRumpusBegin() <span class="hljs-keyword">unless</span> answer <span class="hljs-keyword">is</span> <span class="hljs-literal">no</span><br><br><span class="hljs-keyword">if</span> car.speed &lt; limit <span class="hljs-keyword">then</span> accelerate()<br><br>winner = <span class="hljs-literal">yes</span> <span class="hljs-keyword">if</span> pick <span class="hljs-keyword">in</span> [<span class="hljs-number">47</span>, <span class="hljs-number">92</span>, <span class="hljs-number">13</span>]<br><br><span class="hljs-built_in">print</span> inspect <span class="hljs-string">&quot;My name is <span class="hljs-subst">#&#123;@name&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> modulo = <span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) &#123; <span class="hljs-keyword">return</span> (+a % (b = +b) + b) % b; &#125;;<br><br>-<span class="hljs-number">7</span> % <span class="hljs-number">5</span> === -<span class="hljs-number">2</span>; <span class="hljs-comment">// The remainder of 7 / 5</span><br><br><span class="hljs-title function_">modulo</span>(-<span class="hljs-number">7</span>, <span class="hljs-number">5</span>) === <span class="hljs-number">3</span>; <span class="hljs-comment">// n %% 5 is always between 0 and 4</span><br><br>tabs.<span class="hljs-title function_">selectTabAtIndex</span>(<span class="hljs-title function_">modulo</span>(tabs.<span class="hljs-property">currentIndex</span> - count, tabs.<span class="hljs-property">length</span>));<br><br><span class="hljs-keyword">var</span> volume, winner;<br><br><span class="hljs-keyword">if</span> (ignition === <span class="hljs-literal">true</span>) &#123;<br>  <span class="hljs-title function_">launch</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (band !== <span class="hljs-title class_">SpinalTap</span>) &#123;<br>  volume = <span class="hljs-number">10</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (answer !== <span class="hljs-literal">false</span>) &#123;<br>  <span class="hljs-title function_">letTheWildRumpusBegin</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (car.<span class="hljs-property">speed</span> &lt; limit) &#123;<br>  <span class="hljs-title function_">accelerate</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (pick === <span class="hljs-number">47</span> || pick === <span class="hljs-number">92</span> || pick === <span class="hljs-number">13</span>) &#123;<br>  winner = <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-title function_">print</span>(<span class="hljs-title function_">inspect</span>(<span class="hljs-string">`My name is <span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.name&#125;</span>`</span>));<br></code></pre></td></tr></table></figure>
<h2 id="存在操作符">存在操作符</h2>
<p>在 JavaScript 中确认一个变量是否存在是很困难的。因为<code>if (variable)</code> 不仅会在变量不存在时生效，在变量为0值（0,空字符串，false）时也会生效。CoffeeScript 的<code>?</code>操作符只在变量为<code>null</code>和 <code>undefined</code>的时候返回<code>false</code>，这很像 Ruby 中的 <code>nil？</code>(实际上高版本的 ES 也会有一个叫 <code>Null Propagation Operator</code>的类似特性)。</p>
<p>这样我们就可以做更加安全的条件赋值了（比<code>a = a || value</code>安全）。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs coffee">solipsism = <span class="hljs-literal">true</span> <span class="hljs-keyword">if</span> mind? <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> world?<br><br>speed = <span class="hljs-number">0</span><br>speed ?= <span class="hljs-number">15</span><br><br>footprints = yeti ? <span class="hljs-string">&quot;bear&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> footprints, solipsism, speed;<br><br><span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> mind !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; mind !== <span class="hljs-literal">null</span>) &amp;&amp; (<span class="hljs-keyword">typeof</span> world === <span class="hljs-string">&quot;undefined&quot;</span> || world === <span class="hljs-literal">null</span>)) &#123;<br>  solipsism = <span class="hljs-literal">true</span>;<br>&#125;<br><br>speed = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span> (speed == <span class="hljs-literal">null</span>) &#123;<br>  speed = <span class="hljs-number">15</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>注意看，一个<code>?</code>被翻译成了对<code>undefined</code>和<code>null</code>的严格求不等<code>!==</code><br>
。但是，<code>?</code>与<code>unless</code>搭配的时候，就会被翻译成<code>==</code>。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffee">major = <span class="hljs-string">&#x27;Computer Science&#x27;</span><br><br><span class="hljs-keyword">unless</span> major?<br>  signUpForClass <span class="hljs-string">&#x27;Introduction to Wines&#x27;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> major;<br><br>major = <span class="hljs-string">&#x27;Computer Science&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (major == <span class="hljs-literal">null</span>) &#123;<br>  <span class="hljs-title function_">signUpForClass</span>(<span class="hljs-string">&#x27;Introduction to Wines&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以用存在操作符来达到其他语言中经常出现的流利调用，流利调用失败用户会得到<code>undefined</code>而不会出现烦人的空指针（在 JavaScript 中实际上是不能在<code>undefined</code>上调用特定成员的<code>TypeError</code>）异常：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffee">zip = lottery.drawWinner?().address?.zipcode<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> ref, zip;<br><br>zip = <span class="hljs-keyword">typeof</span> lottery.<span class="hljs-property">drawWinner</span> === <span class="hljs-string">&quot;function&quot;</span> ? (ref = lottery.<span class="hljs-title function_">drawWinner</span>().<span class="hljs-property">address</span>) != <span class="hljs-literal">null</span> ? ref.<span class="hljs-property">zipcode</span> : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>
<h2 id="无括号的链式调用">无括号的链式调用</h2>
<p>用<code>.</code>和断行缩进可以像其他脚本语言一样进行无括号链式调用：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs coffee">$ <span class="hljs-string">&#x27;body&#x27;</span><br>.click (e) -&gt;<br>  $ <span class="hljs-string">&#x27;.box&#x27;</span><br>  .fadeIn <span class="hljs-string">&#x27;fast&#x27;</span><br>  .addClass <span class="hljs-string">&#x27;show&#x27;</span><br>.css <span class="hljs-string">&#x27;background&#x27;</span>, <span class="hljs-string">&#x27;white&#x27;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$(<span class="hljs-string">&#x27;body&#x27;</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-keyword">return</span> $(<span class="hljs-string">&#x27;.box&#x27;</span>).<span class="hljs-title function_">fadeIn</span>(<span class="hljs-string">&#x27;fast&#x27;</span>).<span class="hljs-title function_">addClass</span>(<span class="hljs-string">&#x27;show&#x27;</span>);<br>&#125;).<span class="hljs-title function_">css</span>(<span class="hljs-string">&#x27;background&#x27;</span>, <span class="hljs-string">&#x27;white&#x27;</span>);<br></code></pre></td></tr></table></figure>
<h2 id="解构赋值">解构赋值</h2>
<p>用过 ES2015 以后版本的读者应该能够理解什么是解构赋值了：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffee">theBait   = <span class="hljs-number">1000</span><br>theSwitch = <span class="hljs-number">0</span><br><br>[theBait, theSwitch] = [theSwitch, theBait]<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> theBait, theSwitch;<br><br>theBait = <span class="hljs-number">1000</span>;<br><br>theSwitch = <span class="hljs-number">0</span>;<br><br>[theBait, theSwitch] = [theSwitch, theBait];<br></code></pre></td></tr></table></figure>
<p>解构赋值搭配上多返回值的函数调用也很有用：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">weatherReport</span> = <span class="hljs-params">(location)</span> -&gt;</span><br>  <span class="hljs-comment"># Make an Ajax request to fetch the weather...</span><br>  [location, <span class="hljs-number">72</span>, <span class="hljs-string">&quot;Mostly Sunny&quot;</span>]<br><br>[city, temp, forecast] = weatherReport <span class="hljs-string">&quot;Berkeley, CA&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> city, forecast, temp, weatherReport;<br><br>weatherReport = <span class="hljs-keyword">function</span>(<span class="hljs-params">location</span>) &#123;<br>  <span class="hljs-comment">// Make an Ajax request to fetch the weather...</span><br>  <span class="hljs-keyword">return</span> [location, <span class="hljs-number">72</span>, <span class="hljs-string">&quot;Mostly Sunny&quot;</span>];<br>&#125;;<br><br>[city, temp, forecast] = <span class="hljs-title function_">weatherReport</span>(<span class="hljs-string">&quot;Berkeley, CA&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>解构赋值对任意深度嵌套的数组和对象也是一个有用的特性：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs coffee">futurists =<br>  sculptor: <span class="hljs-string">&quot;Umberto Boccioni&quot;</span><br>  painter:  <span class="hljs-string">&quot;Vladimir Burliuk&quot;</span><br>  poet:<br>    name:   <span class="hljs-string">&quot;F.T. Marinetti&quot;</span><br>    address: [<br>      <span class="hljs-string">&quot;Via Roma 42R&quot;</span><br>      <span class="hljs-string">&quot;Bellagio, Italy 22021&quot;</span><br>    ]<br><br>&#123;sculptor&#125; = futurists<br><br>&#123;poet: &#123;name, address: [street, city]&#125;&#125; = futurists<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> city, futurists, name, sculptor, street;<br><br>futurists = &#123;<br>  <span class="hljs-attr">sculptor</span>: <span class="hljs-string">&quot;Umberto Boccioni&quot;</span>,<br>  <span class="hljs-attr">painter</span>: <span class="hljs-string">&quot;Vladimir Burliuk&quot;</span>,<br>  <span class="hljs-attr">poet</span>: &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;F.T. Marinetti&quot;</span>,<br>    <span class="hljs-attr">address</span>: [<span class="hljs-string">&quot;Via Roma 42R&quot;</span>, <span class="hljs-string">&quot;Bellagio, Italy 22021&quot;</span>]<br>  &#125;<br>&#125;;<br><br>(&#123;sculptor&#125; = futurists);<br><br>(&#123;<br>  <span class="hljs-attr">poet</span>: &#123;<br>    name,<br>    <span class="hljs-attr">address</span>: [street, city]<br>  &#125;<br>&#125; = futurists);<br></code></pre></td></tr></table></figure>
<p>解构赋值也可以搭配 splats 不定参数使用：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffee">tag = <span class="hljs-string">&quot;&lt;impossible&gt;&quot;</span><br><br>[open, contents..., close] = tag.split(<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> close, contents, i, open, ref, tag,<br>  slice = [].<span class="hljs-property">slice</span>;<br><br>tag = <span class="hljs-string">&quot;&lt;impossible&gt;&quot;</span>;<br><br>ref = tag.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&quot;</span>), open = ref[<span class="hljs-number">0</span>], contents = <span class="hljs-number">3</span> &lt;= ref.<span class="hljs-property">length</span> ? slice.<span class="hljs-title function_">call</span>(ref, <span class="hljs-number">1</span>, i = ref.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) : (i = <span class="hljs-number">1</span>, []), close = ref[i++];<br></code></pre></td></tr></table></figure>
<p>取数组末尾元素的例子：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs coffee">text = <span class="hljs-string">&quot;Every literary critic believes he will</span><br><span class="hljs-string">        outwit history and have the last word&quot;</span><br><br>[first, ..., last] = text.split <span class="hljs-string">&quot; &quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> first, last, ref, text;<br><br>text = <span class="hljs-string">&quot;Every literary critic believes he will outwit history and have the last word&quot;</span>;<br><br>ref = text.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot; &quot;</span>), first = ref[<span class="hljs-number">0</span>], last = ref[ref.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];<br></code></pre></td></tr></table></figure>
<p>与构造函数结合的例子：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span><br>  constructor: <span class="hljs-function"><span class="hljs-params">(options)</span> -&gt;</span><br>    &#123;@name, @age, @height = <span class="hljs-string">&#x27;average&#x27;</span>&#125; = options<br><br>tim = <span class="hljs-keyword">new</span> Person name: <span class="hljs-string">&#x27;Tim&#x27;</span>, age: <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Person</span>, tim;<br><br><span class="hljs-title class_">Person</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) &#123;<br>    (&#123;<span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>, <span class="hljs-attr">age</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> = <span class="hljs-string">&#x27;average&#x27;</span>&#125; = options);<br>  &#125;<br><br>&#125;;<br><br>tim = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Tim&#x27;</span>,<br>  <span class="hljs-attr">age</span>: <span class="hljs-number">4</span><br>&#125;);<br></code></pre></td></tr></table></figure>
<h2 id="绑定-胖-函数">绑定（胖）函数</h2>
<p>用<code>-&gt;</code>定义的函数会直接转化为普通的<code>function</code>。</p>
<p>JavaScript 中<code>this</code>指向的值可以被动态绑定（这真是由来已久的弊病）。有经验的读者肯定能理解，我们在传递回调的时候， 原始<code>this</code>经常会丢失，变成新作用域里的<code>this</code>。</p>
<p>而使用胖箭头<code>=&gt;</code>定义的函数，可以把当前上下文的<code>this</code>绑定到函数里（好像调用了一个隐式的<code>bind</code>一样）。当我们在 Prototype 和 JQuery 之类的毁掉库里使用函数时，这回变得非常有用。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">Account</span> = <span class="hljs-params">(customer, cart)</span> -&gt;</span><br>  @customer = customer<br>  @cart = cart<br><br>  <span class="hljs-comment"># 如果我们这里使用-&gt;箭头，就会编译出 function，function 的 this 是不绑定在当前的 this 上的。</span><br>  $(<span class="hljs-string">&#x27;.shopping_cart&#x27;</span>).<span class="hljs-literal">on</span> <span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function"><span class="hljs-params">(event)</span> =&gt;</span><br>    <span class="hljs-comment"># 此处的@customer和外部的@customer一致。</span><br>    @customer.purchase @cart<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Account</span>;<br><br><span class="hljs-title class_">Account</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">customer, cart</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">customer</span> = customer;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cart</span> = cart;<br>  <span class="hljs-comment">// JavaScript 中的=&gt;实际上使 this 进入外部上下文的了词法作用域</span><br>  <span class="hljs-keyword">return</span> $(<span class="hljs-string">&#x27;.shopping_cart&#x27;</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">customer</span>.<span class="hljs-title function_">purchase</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cart</span>);<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>如果我们在这里使用<code>-&gt;</code>，函数里的<code>@customer</code>实际上就会指向undefined。因为$(’.shopping_cart’) 这个东西指向的是 dom 变量，很可能没有<code>customer</code>这个属性。</p>
<p>胖函数是 CoffeeScript 里最受欢迎的特性，也被 ES2015 吸收了，使用 CoffeeScript 中的<code>=&gt;</code>就会被编译成JavaScript 中的<code>=&gt;</code>。</p>
<h2 id="生成器函数">生成器函数</h2>
<p>CoffeeScript 通过<code>yield</code>关键字支持 ES2015中的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*">generator functions</a>。CoffeeScript 中没有<code>function*(){}</code>这样的无意义结构，只要有<code>yield</code>就够了。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">perfectSquares</span> = -&gt;</span><br>  num = <span class="hljs-number">0</span><br>  <span class="hljs-keyword">loop</span><br>    num += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">yield</span> num * num<br>  <span class="hljs-keyword">return</span><br><br>window.ps <span class="hljs-keyword">or</span>= perfectSquares()<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> perfectSquares;<br><br>perfectSquares = <span class="hljs-keyword">function</span>*() &#123;<br>  <span class="hljs-keyword">var</span> num;<br>  num = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>    num += <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">yield</span> num * num;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p><code>yield</code>当然也可以配合<code>for...from</code>使用：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">fibonacci</span> = -&gt;</span><br>  [previous, current] = [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]<br>  <span class="hljs-keyword">loop</span><br>    [previous, current] = [current, previous + current]<br>    <span class="hljs-keyword">yield</span> current<br>  <span class="hljs-keyword">return</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">getFibonacciNumbers</span> = <span class="hljs-params">(length)</span> -&gt;</span><br>  results = [<span class="hljs-number">1</span>]<br>  <span class="hljs-keyword">for</span> n <span class="hljs-keyword">from</span> fibonacci()<br>    results.push n<br>    <span class="hljs-keyword">break</span> <span class="hljs-keyword">if</span> results.length <span class="hljs-keyword">is</span> length<br>  results<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> fibonacci, getFibonacciNumbers;<br><br>fibonacci = <span class="hljs-keyword">function</span>*() &#123;<br>  <span class="hljs-keyword">var</span> current, previous;<br>  [previous, current] = [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>];<br>  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>    [previous, current] = [current, previous + current];<br>    <span class="hljs-keyword">yield</span> current;<br>  &#125;<br>&#125;;<br><br>getFibonacciNumbers = <span class="hljs-keyword">function</span>(<span class="hljs-params">length</span>) &#123;<br>  <span class="hljs-keyword">var</span> n, ref, results;<br>  results = [<span class="hljs-number">1</span>];<br>  ref = <span class="hljs-title function_">fibonacci</span>();<br>  <span class="hljs-keyword">for</span> (n <span class="hljs-keyword">of</span> ref) &#123;<br>    results.<span class="hljs-title function_">push</span>(n);<br>    <span class="hljs-keyword">if</span> (results.<span class="hljs-property">length</span> === length) &#123;<br>      <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> results;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="异步函数">异步函数</h2>
<p>ES2017 的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">异步函数</a>是通过<code>await</code>支持的。同生成器函数一样，CoffeeScript 中的不需要<code>async</code>关键字，只要有<code>await</code>就行了。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-comment"># Your browser must support async/await and speech synthesis</span><br><span class="hljs-comment"># to run this example.</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">sleep</span> = <span class="hljs-params">(ms)</span> -&gt;</span><br>  <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span> (resolve) -&gt;<br>    window.<span class="hljs-built_in">setTimeout</span> resolve, ms<br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">say</span> = <span class="hljs-params">(text)</span> -&gt;</span><br>  window.speechSynthesis.cancel()<br>  window.speechSynthesis.speak <span class="hljs-keyword">new</span> SpeechSynthesisUtterance text<br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">countdown</span> = <span class="hljs-params">(seconds)</span> -&gt;</span><br>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [seconds.<span class="hljs-number">.1</span>]<br>    say i<br>    <span class="hljs-keyword">await</span> sleep <span class="hljs-number">1000</span> <span class="hljs-comment"># wait one second</span><br>  say <span class="hljs-string">&quot;Blastoff!&quot;</span><br><br>countdown <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// Your browser must support async/await and speech synthesis</span><br><span class="hljs-comment">// to run this example.</span><br><span class="hljs-keyword">var</span> countdown, say, sleep;<br><br>sleep = <span class="hljs-keyword">function</span>(<span class="hljs-params">ms</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(resolve, ms);<br>  &#125;);<br>&#125;;<br><br>say = <span class="hljs-keyword">function</span>(<span class="hljs-params">text</span>) &#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-property">speechSynthesis</span>.<span class="hljs-title function_">cancel</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">speechSynthesis</span>.<span class="hljs-title function_">speak</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeechSynthesisUtterance</span>(text));<br>&#125;;<br><br>countdown = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">seconds</span>) &#123;<br>  <span class="hljs-keyword">var</span> i, j, ref;<br>  <span class="hljs-keyword">for</span> (i = j = ref = seconds; ref &lt;= <span class="hljs-number">1</span> ? j &lt;= <span class="hljs-number">1</span> : j &gt;= <span class="hljs-number">1</span>; i = ref &lt;= <span class="hljs-number">1</span> ? ++j : --j) &#123;<br>    <span class="hljs-title function_">say</span>(i);<br>    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// wait one second</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">say</span>(<span class="hljs-string">&quot;Blastoff!&quot;</span>);<br>&#125;;<br><br><span class="hljs-title function_">countdown</span>(<span class="hljs-number">3</span>);<br></code></pre></td></tr></table></figure>
<h2 id="类">类</h2>
<p>CoffeeScript 1 就提供了<code>class</code>和<code>extends</code>关键字，作为原型相关函数的语法糖。ES2015吸收了这两个关键字，CoffeeScript 2 直接把这两个关键字编译成 ES2015的类。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span><br>  constructor: <span class="hljs-function"><span class="hljs-params">(@name)</span> -&gt;</span><br><br>  move: <span class="hljs-function"><span class="hljs-params">(meters)</span> -&gt;</span><br>    alert @name + <span class="hljs-string">&quot; moved <span class="hljs-subst">#&#123;meters&#125;</span>m.&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Snake</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span><br>  move: <span class="hljs-function">-&gt;</span><br>    alert <span class="hljs-string">&quot;Slithering...&quot;</span><br>    super <span class="hljs-number">5</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Horse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span><br>  move: <span class="hljs-function">-&gt;</span><br>    alert <span class="hljs-string">&quot;Galloping...&quot;</span><br>    super <span class="hljs-number">45</span><br><br>sam = <span class="hljs-keyword">new</span> Snake <span class="hljs-string">&quot;Sammy the Python&quot;</span><br>tom = <span class="hljs-keyword">new</span> Horse <span class="hljs-string">&quot;Tommy the Palomino&quot;</span><br><br>sam.move()<br>tom.move()<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Animal</span>, <span class="hljs-title class_">Horse</span>, <span class="hljs-title class_">Snake</span>, sam, tom;<br><br><span class="hljs-title class_">Animal</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>  &#125;<br><br>  <span class="hljs-title function_">move</span>(<span class="hljs-params">meters</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">alert</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">` moved <span class="hljs-subst">$&#123;meters&#125;</span>m.`</span>);<br>  &#125;<br><br>&#125;;<br><br><span class="hljs-title class_">Snake</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Snake</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> &#123;<br>  <span class="hljs-title function_">move</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Slithering...&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">move</span>(<span class="hljs-number">5</span>);<br>  &#125;<br><br>&#125;;<br><br><span class="hljs-title class_">Horse</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Horse</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> &#123;<br>  <span class="hljs-title function_">move</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Galloping...&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">move</span>(<span class="hljs-number">45</span>);<br>  &#125;<br><br>&#125;;<br><br>sam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Snake</span>(<span class="hljs-string">&quot;Sammy the Python&quot;</span>);<br><br>tom = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Horse</span>(<span class="hljs-string">&quot;Tommy the Palomino&quot;</span>);<br><br>sam.<span class="hljs-title function_">move</span>();<br><br>tom.<span class="hljs-title function_">move</span>();<br></code></pre></td></tr></table></figure>
<p>可以用<code>@</code>开头的函数来定义静态方法：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teenager</span><br>  @say: <span class="hljs-function"><span class="hljs-params">(speech)</span> -&gt;</span><br>    words = speech.split <span class="hljs-string">&#x27; &#x27;</span><br>    fillers = [<span class="hljs-string">&#x27;uh&#x27;</span>, <span class="hljs-string">&#x27;um&#x27;</span>, <span class="hljs-string">&#x27;like&#x27;</span>, <span class="hljs-string">&#x27;actually&#x27;</span>, <span class="hljs-string">&#x27;so&#x27;</span>, <span class="hljs-string">&#x27;maybe&#x27;</span>]<br>    output = []<br>    <span class="hljs-keyword">for</span> word, index <span class="hljs-keyword">in</span> words<br>      output.push word<br>      output.push fillers[<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * fillers.length)] <span class="hljs-keyword">unless</span> index <span class="hljs-keyword">is</span> words.length - <span class="hljs-number">1</span><br>    output.join <span class="hljs-string">&#x27;, &#x27;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">Teenager</span>;<br><br><span class="hljs-title class_">Teenager</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teenager</span> &#123;<br>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">say</span>(<span class="hljs-params">speech</span>) &#123;<br>    <span class="hljs-keyword">var</span> fillers, i, index, len, output, word, words;<br>    words = speech.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27; &#x27;</span>);<br>    fillers = [<span class="hljs-string">&#x27;uh&#x27;</span>, <span class="hljs-string">&#x27;um&#x27;</span>, <span class="hljs-string">&#x27;like&#x27;</span>, <span class="hljs-string">&#x27;actually&#x27;</span>, <span class="hljs-string">&#x27;so&#x27;</span>, <span class="hljs-string">&#x27;maybe&#x27;</span>];<br>    output = [];<br>    <span class="hljs-keyword">for</span> (index = i = <span class="hljs-number">0</span>, len = words.<span class="hljs-property">length</span>; i &lt; len; index = ++i) &#123;<br>      word = words[index];<br>      output.<span class="hljs-title function_">push</span>(word);<br>      <span class="hljs-keyword">if</span> (index !== words.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) &#123;<br>        output.<span class="hljs-title function_">push</span>(fillers[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * fillers.<span class="hljs-property">length</span>)]);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> output.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;, &#x27;</span>);<br>  &#125;<br><br>&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="原型式继承">原型式继承</h2>
<p>ES2015提供了一个短路操作符给原型链相关的操作：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs coffee">String::dasherize = <span class="hljs-function">-&gt;</span><br>  this.replace <span class="hljs-regexp">/_/g</span>, <span class="hljs-string">&quot;-&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">String</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">dasherize</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/_/g</span>, <span class="hljs-string">&quot;-&quot;</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="switch-when-else">Switch/When/Else</h2>
<p>CoffeeScript 中的<code>switch</code>不用担心忘记写<code>break</code>出现错误的跳转：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">switch</span> day<br>  <span class="hljs-keyword">when</span> <span class="hljs-string">&quot;Mon&quot;</span> <span class="hljs-keyword">then</span> go work<br>  <span class="hljs-keyword">when</span> <span class="hljs-string">&quot;Tue&quot;</span> <span class="hljs-keyword">then</span> go relax<br>  <span class="hljs-keyword">when</span> <span class="hljs-string">&quot;Thu&quot;</span> <span class="hljs-keyword">then</span> go iceFishing<br>  <span class="hljs-keyword">when</span> <span class="hljs-string">&quot;Fri&quot;</span>, <span class="hljs-string">&quot;Sat&quot;</span><br>    <span class="hljs-keyword">if</span> day <span class="hljs-keyword">is</span> bingoDay<br>      go bingo<br>      go dancing<br>  <span class="hljs-keyword">when</span> <span class="hljs-string">&quot;Sun&quot;</span> <span class="hljs-keyword">then</span> go church<br>  <span class="hljs-keyword">else</span> go work<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">switch</span> (day) &#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Mon&quot;</span>:<br>    <span class="hljs-title function_">go</span>(work);<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Tue&quot;</span>:<br>    <span class="hljs-title function_">go</span>(relax);<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Thu&quot;</span>:<br>    <span class="hljs-title function_">go</span>(iceFishing);<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Fri&quot;</span>:<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Sat&quot;</span>:<br>    <span class="hljs-keyword">if</span> (day === bingoDay) &#123;<br>      <span class="hljs-title function_">go</span>(bingo);<br>      <span class="hljs-title function_">go</span>(dancing);<br>    &#125;<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Sun&quot;</span>:<br>    <span class="hljs-title function_">go</span>(church);<br>    <span class="hljs-keyword">break</span>;<br>  <span class="hljs-attr">default</span>:<br>    <span class="hljs-title function_">go</span>(work);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>在之前读者已经看到了 CoffeeScript 中大量的语句都可以带有返回值，<code>switch</code>也不例外。以下的例子里面，switch 后面连表达式都没有：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coffee">score = <span class="hljs-number">76</span><br>grade = <span class="hljs-keyword">switch</span><br>  <span class="hljs-keyword">when</span> score &lt; <span class="hljs-number">60</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;F&#x27;</span><br>  <span class="hljs-keyword">when</span> score &lt; <span class="hljs-number">70</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;D&#x27;</span><br>  <span class="hljs-keyword">when</span> score &lt; <span class="hljs-number">80</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;C&#x27;</span><br>  <span class="hljs-keyword">when</span> score &lt; <span class="hljs-number">90</span> <span class="hljs-keyword">then</span> <span class="hljs-string">&#x27;B&#x27;</span><br>  <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;A&#x27;</span><br><span class="hljs-comment"># grade == &#x27;C&#x27;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> grade, score;<br><br>score = <span class="hljs-number">76</span>;<br><br>grade = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">switch</span> (<span class="hljs-literal">false</span>) &#123;<br>    <span class="hljs-keyword">case</span> !(score &lt; <span class="hljs-number">60</span>):<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;F&#x27;</span>;<br>    <span class="hljs-keyword">case</span> !(score &lt; <span class="hljs-number">70</span>):<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;D&#x27;</span>;<br>    <span class="hljs-keyword">case</span> !(score &lt; <span class="hljs-number">80</span>):<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;C&#x27;</span>;<br>    <span class="hljs-keyword">case</span> !(score &lt; <span class="hljs-number">90</span>):<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;B&#x27;</span>;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;A&#x27;</span>;<br>  &#125;<br>&#125;)();<br><br><span class="hljs-comment">// grade == &#x27;C&#x27;</span><br></code></pre></td></tr></table></figure>
<h2 id="try-catch-finally">Try/Catch/Finally</h2>
<p>CoffeeScript 中的<code>try</code>/<code>catch</code>/<code>finally</code>块可以完全不带大括号：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">try</span><br>  allHellBreaksLoose()<br>  catsAndDogsLivingTogether()<br><span class="hljs-keyword">catch</span> error<br>  <span class="hljs-built_in">print</span> error<br><span class="hljs-keyword">finally</span><br>  cleanUp()<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> error;<br><br><span class="hljs-keyword">try</span> &#123;<br>  <span class="hljs-title function_">allHellBreaksLoose</span>();<br>  <span class="hljs-title function_">catsAndDogsLivingTogether</span>();<br>&#125; <span class="hljs-keyword">catch</span> (error1) &#123;<br>  error = error1;<br>  <span class="hljs-title function_">print</span>(error);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>  <span class="hljs-title function_">cleanUp</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="链式比较">链式比较</h2>
<p>CoffeeScript 从 Python 中借来了<a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/expressions.html#not-in">链式比较</a>，这样范围比较的语句就变得更加简单了。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs coffee">cholesterol = <span class="hljs-number">127</span><br><br>healthy = <span class="hljs-number">200</span> &gt; cholesterol &gt; <span class="hljs-number">60</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> cholesterol, healthy;<br><br>cholesterol = <span class="hljs-number">127</span>;<br><br>healthy = (<span class="hljs-number">200</span> &gt; cholesterol &amp;&amp; cholesterol &gt; <span class="hljs-number">60</span>);<br></code></pre></td></tr></table></figure>
<h2 id="块状的正则表达式">块状的正则表达式</h2>
<p>我们已经看到了块状（多行）字符串和注释，CoffeeScript 同样支持块状正则表达式。模仿自 Perl 的<code>/x</code>修饰符，CoffeeScript 使用<code>///</code>来对多行表达式定界，这样多行的正则比单行的正则就更加可读了：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs coffee">NUMBER     = <span class="hljs-regexp">///</span><br><span class="hljs-regexp">  ^ 0b[01]+    |              <span class="hljs-comment"># binary</span></span><br><span class="hljs-regexp">  ^ 0o[0-7]+   |              <span class="hljs-comment"># octal</span></span><br><span class="hljs-regexp">  ^ 0x[\da-f]+ |              <span class="hljs-comment"># hex</span></span><br><span class="hljs-regexp">  ^ \d*\.?\d+ (?:e[+-]?\d+)?  <span class="hljs-comment"># decimal</span></span><br><span class="hljs-regexp">///</span>i<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">NUMBER</span>;<br><br><span class="hljs-variable constant_">NUMBER</span> = <span class="hljs-regexp">/^0b[01]+|^0o[0-7]+|^0x[\da-f]+|^\d*\.?\d+(?:e[+-]?\d+)?/i</span>; <span class="hljs-comment">// binary</span><br><span class="hljs-comment">// octal</span><br><span class="hljs-comment">// hex</span><br><span class="hljs-comment">// decimal</span><br></code></pre></td></tr></table></figure>
<h2 id="标签化的模板字面量">标签化的模板字面量</h2>
<p>CoffeeScript 支持 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_template_literals">ES2015中的标签化模板字面量</a>，提供了自定义的字符串内插的能力。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">upperCaseExpr</span> = <span class="hljs-params">(textParts, expressions...)</span> -&gt;</span><br>  textParts.reduce (text, textPart, i) -&gt;<br>    text + expressions[i - <span class="hljs-number">1</span>].toUpperCase() + textPart<br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">greet</span> = <span class="hljs-params">(name, adjective)</span> -&gt;</span><br>  upperCaseExpr<span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">               Hi <span class="hljs-subst">#&#123;name&#125;</span>. You look <span class="hljs-subst">#&#123;adjective&#125;</span>!</span><br><span class="hljs-string">               &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> greet, upperCaseExpr;<br><br>upperCaseExpr = <span class="hljs-keyword">function</span>(<span class="hljs-params">textParts, ...expressions</span>) &#123;<br>  <span class="hljs-keyword">return</span> textParts.<span class="hljs-title function_">reduce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">text, textPart, i</span>) &#123;<br>    <span class="hljs-keyword">return</span> text + expressions[i - <span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>() + textPart;<br>  &#125;);<br>&#125;;<br><br>greet = <span class="hljs-keyword">function</span>(<span class="hljs-params">name, adjective</span>) &#123;<br>  <span class="hljs-keyword">return</span> upperCaseExpr<span class="hljs-string">`Hi <span class="hljs-subst">$&#123;name&#125;</span>. You look <span class="hljs-subst">$&#123;adjective&#125;</span>!`</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="模块">模块</h2>
<p>CoffeeScript 中的模块和 ES2015中的模块很相似，都是<code>import</code>和<code>export</code>语法：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;local-file.coffee&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;coffeescript&#x27;</span><br><br><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> underscore <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><br><span class="hljs-keyword">import</span> &#123; now &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><span class="hljs-keyword">import</span> &#123; now <span class="hljs-keyword">as</span> currentTimestamp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><span class="hljs-keyword">import</span> &#123; first, last &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><span class="hljs-keyword">import</span> utilityBelt, &#123; each &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-built_in">Math</span><br><span class="hljs-keyword">export</span> square = <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span> x * x<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mathematics</span><br>  least: <span class="hljs-function"><span class="hljs-params">(x, y)</span> -&gt;</span> <span class="hljs-keyword">if</span> x &lt; y <span class="hljs-keyword">then</span> x <span class="hljs-keyword">else</span> y<br><br><span class="hljs-keyword">export</span> &#123; sqrt &#125;<br><span class="hljs-keyword">export</span> &#123; sqrt <span class="hljs-keyword">as</span> squareRoot &#125;<br><span class="hljs-keyword">export</span> &#123; Mathematics <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span>, sqrt <span class="hljs-keyword">as</span> squareRoot &#125;<br><br><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br><span class="hljs-keyword">export</span> &#123; max, min &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;local-file.coffee&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;coffeescript&#x27;</span>;<br><br><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> underscore <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123;<br>  now<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123;<br>  now <span class="hljs-keyword">as</span> currentTimestamp<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123;<br>  first,<br>  last<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">import</span> utilityBelt, &#123;<br>  each<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Math</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> square = <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) &#123;<br>  <span class="hljs-keyword">return</span> x * x;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> <span class="hljs-title class_">Mathematics</span> = <span class="hljs-keyword">class</span> <span class="hljs-title class_">Mathematics</span> &#123;<br>  <span class="hljs-title function_">least</span>(<span class="hljs-params">x, y</span>) &#123;<br>    <span class="hljs-keyword">if</span> (x &lt; y) &#123;<br>      <span class="hljs-keyword">return</span> x;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> y;<br>    &#125;<br>  &#125;<br><br>&#125;;<br><br><span class="hljs-keyword">export</span> &#123;<br>  sqrt<br>&#125;;<br><br><span class="hljs-keyword">export</span> &#123;<br>  sqrt <span class="hljs-keyword">as</span> squareRoot<br>&#125;;<br><br><span class="hljs-keyword">export</span> &#123;<br>  <span class="hljs-title class_">Mathematics</span> <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span>,<br>  sqrt <span class="hljs-keyword">as</span> squareRoot<br>&#125;;<br><br><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br><br><span class="hljs-keyword">export</span> &#123;<br>  max,<br>  min<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;underscore&#x27;</span>;<br></code></pre></td></tr></table></figure>
<h2 id="嵌入式-javascript">嵌入式 JavaScript</h2>
<p>在 CoffeeScript 中可以用倒引号（`）直接引用 JavaScript 代码：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coffee">hi = `<span class="language-javascript"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> [<span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span>, <span class="hljs-string">&quot;Hello JavaScript&quot;</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;: &quot;</span>);</span><br><span class="language-javascript">&#125;</span>`<br><br><span class="hljs-comment"># \`会被编译成`，\\\`会被编译成\`</span><br>markdown = `<span class="language-javascript"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> \</span>`In Markdown, write code like \\\`<span class="language-javascript"><span class="hljs-variable language_">this</span>\\\</span>`\`<span class="language-javascript">;</span><br><span class="language-javascript">&#125;</span>`<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> hi;<br><br>hi = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> [<span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span>, <span class="hljs-string">&quot;Hello JavaScript&quot;</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;: &quot;</span>);<br>&#125;;<br><br><span class="hljs-keyword">var</span> markdown;<br><br>markdown = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`In Markdown, write code like \`this\``</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>用三个倒引号可以很轻松地引用一大块 JavaScript 代码：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffee">\```<span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">time</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">  <span class="hljs-keyword">return</span> <span class="hljs-string">`The time is <span class="hljs-subst">$&#123;<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleTimeString()&#125;</span>`</span>;</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript">\</span>```<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">time</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`The time is <span class="hljs-subst">$&#123;<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toLocaleTimeString()&#125;</span>`</span>;<br>&#125;<br>;<br></code></pre></td></tr></table></figure>
<h2 id="jsx">JSX</h2>
<p>CoffeeScript 不需要专门的插件或者设置，就可以理解 JSX。</p>
<p>同普通的 JSX 一样，<code>&lt;</code>和<code>&gt;</code>指明了XML 元素，由 <code>{</code>和<code>}</code>包围的代码会被内插替换。为了避免和大于、小于的比较混淆，类似<code>i &lt; len</code>的代码必须带空格，不能写作<code>i&lt;len</code>。编译器有时候能够在你忘记加空格的时候，猜到你的意图，但不要心怀侥幸，还是要尽量自己加空格。</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-function"><span class="hljs-title">renderStarRating</span> = <span class="hljs-params">(&#123; rating, maxStars &#125;)</span> -&gt;</span><br>  &lt;aside title=&#123;<span class="hljs-string">&quot;Rating: <span class="hljs-subst">#&#123;rating&#125;</span> of <span class="hljs-subst">#&#123;maxStars&#125;</span> stars&quot;</span>&#125;&gt;<br>    &#123;<span class="hljs-keyword">for</span> wholeStar <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>..<span class="hljs-built_in">Math</span>.floor(rating)]<br>      &lt;Star className=<span class="hljs-string">&quot;wholeStar&quot;</span> key=&#123;wholeStar&#125; /&gt;&#125;<br>    &#123;<span class="hljs-keyword">if</span> rating % <span class="hljs-number">1</span> <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span><br>      &lt;Star className=<span class="hljs-string">&quot;halfStar&quot;</span> /&gt;&#125;<br>    &#123;<span class="hljs-keyword">for</span> emptyStar <span class="hljs-keyword">in</span> [<span class="hljs-built_in">Math</span>.ceil(rating)...maxStars]<br>      &lt;Star className=<span class="hljs-string">&quot;emptyStar&quot;</span> key=&#123;emptyStar&#125; /&gt;&#125;<br>  &lt;/aside&gt;<br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> renderStarRating;<br><br>renderStarRating = <span class="hljs-keyword">function</span>(<span class="hljs-params">&#123;rating, maxStars&#125;</span>) &#123;<br>  <span class="hljs-keyword">var</span> emptyStar, wholeStar;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&#123;</span>`<span class="hljs-attr">Rating:</span> $&#123;<span class="hljs-attr">rating</span>&#125; <span class="hljs-attr">of</span> $&#123;<span class="hljs-attr">maxStars</span>&#125; <span class="hljs-attr">stars</span>`&#125;&gt;</span></span><br><span class="language-xml">    &#123;(function() &#123;</span><br><span class="language-xml">    var i, ref, results;</span><br><span class="language-xml">    results = [];</span><br><span class="language-xml">    for (wholeStar = i = 0, ref = Math.floor(rating); 0 &lt;= ref ? i &lt; ref : i &gt; ref; wholeStar = 0 &lt;= ref ? ++i : --i) &#123;</span><br><span class="language-xml">      results.push(<span class="hljs-tag">&lt;<span class="hljs-name">Star</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;wholeStar&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;wholeStar&#125;</span> /&gt;</span>);</span><br><span class="language-xml">    &#125;</span><br><span class="language-xml">    return results;</span><br><span class="language-xml">  &#125;)()&#125;</span><br><span class="language-xml">    &#123;(rating % 1 !== 0 ? <span class="hljs-tag">&lt;<span class="hljs-name">Star</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;halfStar&quot;</span> /&gt;</span> : void 0)&#125;</span><br><span class="language-xml">    &#123;(function() &#123;</span><br><span class="language-xml">    var i, ref, ref1, results;</span><br><span class="language-xml">    results = [];</span><br><span class="language-xml">    for (emptyStar = i = ref = Math.ceil(rating), ref1 = maxStars; ref &lt;= ref1 ? i &lt; ref1 : i &gt; ref1; emptyStar = ref &lt;= ref1 ? ++i : --i) &#123;</span><br><span class="language-xml">      results.push(<span class="hljs-tag">&lt;<span class="hljs-name">Star</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;emptyStar&quot;</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;emptyStar&#125;</span> /&gt;</span>);</span><br><span class="language-xml">    &#125;</span><br><span class="language-xml">    return results;</span><br><span class="language-xml">  &#125;)()&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="类型注解">类型注解</h2>
<p>Flow 风格的注释式类型注解可以在 CoffeeScript 中提供静态类型检查的能力（TypeScript 的粉丝可能要头痛了）：</p>
<figure class="highlight coffee"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs coffee"><span class="hljs-comment"># @flow</span><br><br><span class="hljs-comment">###::</span><br><span class="hljs-comment">type Obj = &#123;</span><br><span class="hljs-comment">  num: number,</span><br><span class="hljs-comment">&#125;;</span><br><span class="hljs-comment">###</span><br><br>fn = (str <span class="hljs-comment">###: string ###</span>, obj <span class="hljs-comment">###: Obj ###</span>) <span class="hljs-comment">###: string ###</span> -&gt;<br>  str + obj.num<br><br></code></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// @flow</span><br><span class="hljs-comment">/*::</span><br><span class="hljs-comment">type Obj = &#123;</span><br><span class="hljs-comment">  num: number,</span><br><span class="hljs-comment">&#125;;</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">var</span> fn;<br><br>fn = <span class="hljs-keyword">function</span>(<span class="hljs-params">str<span class="hljs-comment">/*: string */</span>, obj<span class="hljs-comment">/*: Obj */</span></span>)<span class="hljs-comment">/*: string */</span> &#123;<br>  <span class="hljs-keyword">return</span> str + obj.<span class="hljs-property">num</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>如果用户已经成功<a target="_blank" rel="noopener" href="https://flow.org/en/docs/install/">安装了 Flow</a> 和<a target="_blank" rel="noopener" href="http://coffeescript.org/#installation">最新的 CoffeeScript</a>，可以用如下命令进行类型检查：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">coffee --bare --no-header --compile app.coffee &amp;&amp; npm run flow<br></code></pre></td></tr></table></figure>
<p><code>--bare --no-header</code>非常重要，因为 Flow 要求文件中的第一行是<code>// @flow</code>注释。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://magicliang.github.io">magicliang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/">https://magicliang.github.io/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CoffeeScript/">CoffeeScript</a></div><div class="post-share"><div class="social-share" data-image="/2017/12/29/CoffeeScript2-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/coffeescript.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">写在前面的话</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">简明教程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#coffeescript-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.1.</span> <span class="toc-text">CoffeeScript 是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E8%AF%95%E7%94%A8-coffee"><span class="toc-number">2.2.</span> <span class="toc-text">安装和试用 coffee</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%87%BD%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">普通函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">2.4.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E7%BB%84"><span class="toc-number">2.5.</span> <span class="toc-text">对象和数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">2.6.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%8F%98%E9%87%8F%E5%AE%89%E5%85%A8"><span class="toc-number">2.7.</span> <span class="toc-text">词法作用域和变量安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if-else-unless-%E4%B8%8E%E6%9D%A1%E4%BB%B6%E8%B5%8B%E5%80%BC"><span class="toc-number">2.8.</span> <span class="toc-text">If,Else,Unless, 与条件赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%AE%9A%E5%8F%82%E6%95%B0%E8%AF%AD%E6%B3%95"><span class="toc-number">2.9.</span> <span class="toc-text">不定参数语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%92%8C%E8%A1%A8%E5%A4%84%E7%90%86"><span class="toc-number">2.10.</span> <span class="toc-text">循环和表处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%88%86%E7%89%87%E5%92%8C-range-%E5%88%86%E7%89%87"><span class="toc-number">2.11.</span> <span class="toc-text">数组分片和 range 分片</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%88%87%E7%9A%86%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.12.</span> <span class="toc-text">一切皆表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B8%8E%E5%88%AB%E5%90%8D"><span class="toc-number">2.13.</span> <span class="toc-text">操作符与别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%9C%A8%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">2.14.</span> <span class="toc-text">存在操作符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E6%8B%AC%E5%8F%B7%E7%9A%84%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-number">2.15.</span> <span class="toc-text">无括号的链式调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.16.</span> <span class="toc-text">解构赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A-%E8%83%96-%E5%87%BD%E6%95%B0"><span class="toc-number">2.17.</span> <span class="toc-text">绑定（胖）函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0"><span class="toc-number">2.18.</span> <span class="toc-text">生成器函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0"><span class="toc-number">2.19.</span> <span class="toc-text">异步函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB"><span class="toc-number">2.20.</span> <span class="toc-text">类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E5%BC%8F%E7%BB%A7%E6%89%BF"><span class="toc-number">2.21.</span> <span class="toc-text">原型式继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#switch-when-else"><span class="toc-number">2.22.</span> <span class="toc-text">Switch&#x2F;When&#x2F;Else</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#try-catch-finally"><span class="toc-number">2.23.</span> <span class="toc-text">Try&#x2F;Catch&#x2F;Finally</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E5%BC%8F%E6%AF%94%E8%BE%83"><span class="toc-number">2.24.</span> <span class="toc-text">链式比较</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9D%97%E7%8A%B6%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.25.</span> <span class="toc-text">块状的正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E5%8C%96%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">2.26.</span> <span class="toc-text">标签化的模板字面量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97"><span class="toc-number">2.27.</span> <span class="toc-text">模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F-javascript"><span class="toc-number">2.28.</span> <span class="toc-text">嵌入式 JavaScript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jsx"><span class="toc-number">2.29.</span> <span class="toc-text">JSX</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.30.</span> <span class="toc-text">类型注解</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">簡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>