<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>Java 注解和配置 | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="Java 注解和配置 | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="Java 的原生注解@Inherited@Inherited 是一个元注解（annotations applied to other annotations），也是一个标记注解，@Inherited阐述了某个被标注的类型是被继承的。 @Inherited annotation类型是被标注过的class的子类所继承。类并不从它所实现的接口继承annotation，方法并不从它所重载的方法继承anno - magicliang - 守株阁"><meta name="keywords" content="Java, JPA, Spring"><meta property="article:published_time" content="2020-03-29T15:12:07.000Z"><meta property="article:modified_time" content="2021-09-16T09:46:38.000Z"><meta property="og:updated_time" content="2021-09-16T09:46:38.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="Java, JPA, Spring"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/"
    },
    "headline": "Java 注解和配置 | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2020-03-29T15:12:07.000Z",
    "dateModified": "2021-09-16T09:46:38.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "Java, JPA, Spring",
    "description": "Java 的原生注解@Inherited@Inherited 是一个元注解（annotations applied to other annotations），也是一个标记注解，@Inherited阐述了某个被标注的类型是被继承的。 @Inherited annotation类型是被标注过的class的子类所继承。类并不从它所实现的接口继承annotation，方法并不从它所重载的方法继承anno - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=Java 注解和配置" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=Java 注解和配置&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=Java 注解和配置" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAAAAAAYplnuAAACrUlEQVR42u3c0W7CMBBEUf7/p+l7SnbubAAJ5fKCChSOo1pej5c+nj94e4gWLVr0DdGP4fbvl148dnyf6fnp9cQhWjRFkw85Pk7v08Cm1x8fFy26QR//8I+Pn8HOEA2YOESL/jR6mnhnH0onpGjR30Afn2sWijRw0aI/gZ4KI1rAk4IpFV5vqfJE3x49bSi/ef+23bjoW6Nj6DcM5tXPzeZgCncupaaib42eJkIqZjZFfdoYjAGoaNEQnRaUFKyk96ETOxZqokUDdJos06KRUKnwJ4uSaNEbdCpo2qD87CKk1ye4aNEEnRaKhCWH+M0AJrho0QSdDuubhYeG802zimjRGzRF0OYqUlilYi1ORNGiQ+7RhIVTkZ82t+mAH20CRIuG9TTZnKaQhiwe7WG/aNEbdAoeSdDYDiQFQqjpW7ToIYBsJluaXPQQiDS8iBZ9FZ0aYlPwkpoASEPW2HglWvSAJkFJG7ykYKcJJ0WL3qDpZNksGuSgk05c0aIbNDmUT00pKXCkB1Do8FO0aHign8LFbbMJbQ4YNwiiRUP01NBNDjdTM22zER5/T7ToBToVTFPTbAp10qBwwSRa9AKdmk7SokEGNC1QOIAULRpsAlI4SIr5pjkFXyDRouGZSwK1iwqZ5OTwtN7Yihb9ZF92TBvWacLRpiu02IgWvUSn5j7SUDsFltNCNF4g0aJLNC3saTE/TaqEjlWeaNEBnZpWUpiTiil64IQCSNGiQz6dihwyWTYbZDrZRYtu0GgCkMD7kf95Nt1onA5ctOjiu1tNiNg0qJBFhDS4iBb9XHwfMYWCqchKgyIXAC8uokVfQDcBDGk4bC7QeiKKFh3eiIbhm4KLLDqiRbfoK6EL2RycFVNvCyBFi4YbW7qwVKFLeQgqWnSD/qWbaNGiRd8I/QeJMrs5brtdZgAAAABJRU5ErkJggg==" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">Java 注解和配置</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2020-03-29</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=Java 注解和配置&url=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=Java 注解和配置&url=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2020/03/29/Java-%E6%B3%A8%E8%A7%A3%E5%92%8C%E9%85%8D%E7%BD%AE/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAAAAAAYplnuAAACrUlEQVR42u3c0W7CMBBEUf7/p+l7SnbubAAJ5fKCChSOo1pej5c+nj94e4gWLVr0DdGP4fbvl148dnyf6fnp9cQhWjRFkw85Pk7v08Cm1x8fFy26QR//8I+Pn8HOEA2YOESL/jR6mnhnH0onpGjR30Afn2sWijRw0aI/gZ4KI1rAk4IpFV5vqfJE3x49bSi/ef+23bjoW6Nj6DcM5tXPzeZgCncupaaib42eJkIqZjZFfdoYjAGoaNEQnRaUFKyk96ETOxZqokUDdJos06KRUKnwJ4uSaNEbdCpo2qD87CKk1ye4aNEEnRaKhCWH+M0AJrho0QSdDuubhYeG802zimjRGzRF0OYqUlilYi1ORNGiQ+7RhIVTkZ82t+mAH20CRIuG9TTZnKaQhiwe7WG/aNEbdAoeSdDYDiQFQqjpW7ToIYBsJluaXPQQiDS8iBZ9FZ0aYlPwkpoASEPW2HglWvSAJkFJG7ykYKcJJ0WL3qDpZNksGuSgk05c0aIbNDmUT00pKXCkB1Do8FO0aHign8LFbbMJbQ4YNwiiRUP01NBNDjdTM22zER5/T7ToBToVTFPTbAp10qBwwSRa9AKdmk7SokEGNC1QOIAULRpsAlI4SIr5pjkFXyDRouGZSwK1iwqZ5OTwtN7Yihb9ZF92TBvWacLRpiu02IgWvUSn5j7SUDsFltNCNF4g0aJLNC3saTE/TaqEjlWeaNEBnZpWUpiTiil64IQCSNGiQz6dihwyWTYbZDrZRYtu0GgCkMD7kf95Nt1onA5ctOjiu1tNiNg0qJBFhDS4iBb9XHwfMYWCqchKgyIXAC8uokVfQDcBDGk4bC7QeiKKFh3eiIbhm4KLLDqiRbfoK6EL2RycFVNvCyBFi4YbW7qwVKFLeQgqWnSD/qWbaNGiRd8I/QeJMrs5brtdZgAAAABJRU5ErkJggg==" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Java-%E7%9A%84%E5%8E%9F%E7%94%9F%E6%B3%A8%E8%A7%A3"><span class="post-toc-number">1.</span> <span class="post-toc-text">Java 的原生注解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Inherited"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">@Inherited</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Spring-%E5%8E%9F%E7%94%9F%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="post-toc-number">2.</span> <span class="post-toc-text">Spring 原生的功能</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#xml-%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">xml 的模式</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%B8%A6%E6%9C%89-name-%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">带有 name 的注解</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Configuration"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">@Configuration</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EnableAsync"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">@EnableAsync</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EnableScheduling"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">@EnableScheduling</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EnableTransactionManagement"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">@EnableTransactionManagement</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EnableAspectJAutoProxy"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">@EnableAspectJAutoProxy</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EnableWebMvc"><span class="post-toc-number">2.8.</span> <span class="post-toc-text">@EnableWebMvc</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ContextConfiguration"><span class="post-toc-number">2.9.</span> <span class="post-toc-text">ContextConfiguration</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PropertySource"><span class="post-toc-number">2.10.</span> <span class="post-toc-text">@PropertySource</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ComponentScan"><span class="post-toc-number">2.11.</span> <span class="post-toc-text">@ComponentScan</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%8E%AF%E5%A2%83-API"><span class="post-toc-number">2.12.</span> <span class="post-toc-text">环境 API</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9C%A8-java-%E4%B8%AD%E8%8E%B7%E5%8F%96%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%9A%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FSystem-getenv-%E6%88%96%E8%80%85-environment-getenv"><span class="post-toc-number">2.12.1.</span> <span class="post-toc-text">在 java 中获取环境变量：环境变量System.getenv() 或者 environment.getenv()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9C%A8-java-%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%B1%9E%E6%80%A7%EF%BC%9ASystem-getProperty-%E6%88%96%E8%80%85-environment-getProperty"><span class="post-toc-number">2.12.2.</span> <span class="post-toc-text">在 java 中获取属性：System.getProperty() 或者 environment.getProperty()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#profile-%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="post-toc-number">2.12.3.</span> <span class="post-toc-text">profile 的定义</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#properties-%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="post-toc-number">2.12.4.</span> <span class="post-toc-text">properties 的例子</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Aware-%E6%8E%A5%E5%8F%A3"><span class="post-toc-number">2.13.</span> <span class="post-toc-text">Aware 接口</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PropertySourcesPlaceholderConfigurer"><span class="post-toc-number">2.14.</span> <span class="post-toc-text">PropertySourcesPlaceholderConfigurer</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#xml-%E9%85%8D%E7%BD%AE"><span class="post-toc-number">2.15.</span> <span class="post-toc-text">xml 配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ResponseBody"><span class="post-toc-number">2.16.</span> <span class="post-toc-text">@ResponseBody</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#RequestBody"><span class="post-toc-number">2.17.</span> <span class="post-toc-text">@RequestBody</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Qualifier"><span class="post-toc-number">2.18.</span> <span class="post-toc-text">@Qualifier</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Autowired"><span class="post-toc-number">2.19.</span> <span class="post-toc-text">@Autowired</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Resource"><span class="post-toc-number">2.20.</span> <span class="post-toc-text">@Resource</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#RequestMapping"><span class="post-toc-number">2.21.</span> <span class="post-toc-text">@RequestMapping</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#RequestParam"><span class="post-toc-number">2.22.</span> <span class="post-toc-text">@RequestParam</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PathVariable"><span class="post-toc-number">2.23.</span> <span class="post-toc-text">@PathVariable</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ControllerAdvice"><span class="post-toc-number">2.24.</span> <span class="post-toc-text">@ControllerAdvice</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DelegatingFilterProxy"><span class="post-toc-number">2.25.</span> <span class="post-toc-text">DelegatingFilterProxy</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#JPA-%E7%89%B9%E6%80%A7"><span class="post-toc-number">3.</span> <span class="post-toc-text">JPA 特性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Table"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">@Table</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#MappedSuperClass"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">@MappedSuperClass</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#NoRepositoryBean"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">@NoRepositoryBean</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Column"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">@Column</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Id"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">@Id</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#GeneratedValue"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">@GeneratedValue</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SequenceGeneretor"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">@SequenceGeneretor</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Transient"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">@Transient</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Basic-fetch-FetchType-LAZY"><span class="post-toc-number">3.9.</span> <span class="post-toc-text">@Basic(fetch&#x3D;FetchType.LAZY)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JsonIgnore"><span class="post-toc-number">3.10.</span> <span class="post-toc-text">@JsonIgnore</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JoinColumn-name-%E2%80%9DloginId%E2%80%9D"><span class="post-toc-number">3.11.</span> <span class="post-toc-text">@JoinColumn(name&#x3D;”loginId”)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%A1%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E6%98%A0%E5%B0%84"><span class="post-toc-number">3.12.</span> <span class="post-toc-text">表之间的映射</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#OneToOne"><span class="post-toc-number">3.12.1.</span> <span class="post-toc-text">OneToOne</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Implementing-with-a-Foreign-Key-in-JPA"><span class="post-toc-number">3.12.1.1.</span> <span class="post-toc-text">Implementing with a Foreign Key in JPA</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Implementing-with-a-Shared-Primary-Key-in-JPA"><span class="post-toc-number">3.12.1.2.</span> <span class="post-toc-text">Implementing with a Shared Primary Key in JPA</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Modeling-with-a-Join-Table"><span class="post-toc-number">3.12.1.3.</span> <span class="post-toc-text">Modeling with a Join Table</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#OneToMany"><span class="post-toc-number">3.12.2.</span> <span class="post-toc-text">@OneToMany</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%B9%B3%E5%87%A1%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="post-toc-number">3.12.2.1.</span> <span class="post-toc-text">平凡解决方案</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Cart-as-the-Owning-Side"><span class="post-toc-number">3.12.2.2.</span> <span class="post-toc-text">Cart as the Owning Side</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ManyToOne"><span class="post-toc-number">3.12.3.</span> <span class="post-toc-text">@ManyToOne</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ManyToMany"><span class="post-toc-number">3.12.4.</span> <span class="post-toc-text">@ManyToMany</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%99%AE%E9%80%9A%E6%98%A0%E5%B0%84"><span class="post-toc-number">3.12.4.1.</span> <span class="post-toc-text">普通映射</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Joining-Table"><span class="post-toc-number">3.12.4.2.</span> <span class="post-toc-text">Joining Table</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Spring-Boot-%E7%89%B9%E6%80%A7"><span class="post-toc-number">4.</span> <span class="post-toc-text">Spring Boot 特性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringBootApplication"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">@SpringBootApplication</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EnableAutoConfiguration"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">@EnableAutoConfiguration</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TransactionAutoConfiguration"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">TransactionAutoConfiguration</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#org-springframework-boot-autoconfigure-condition"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">org.springframework.boot.autoconfigure.condition</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnBean"><span class="post-toc-number">4.4.1.</span> <span class="post-toc-text">@ConditionalOnBean</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnClass"><span class="post-toc-number">4.4.2.</span> <span class="post-toc-text">@ConditionalOnClass</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnCloudPlatform"><span class="post-toc-number">4.4.3.</span> <span class="post-toc-text">@ConditionalOnCloudPlatform</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnExpression"><span class="post-toc-number">4.4.4.</span> <span class="post-toc-text">@ConditionalOnExpression</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnJava"><span class="post-toc-number">4.4.5.</span> <span class="post-toc-text">@ConditionalOnJava</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnJndi"><span class="post-toc-number">4.4.6.</span> <span class="post-toc-text">@ConditionalOnJndi</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnMissingBean"><span class="post-toc-number">4.4.7.</span> <span class="post-toc-text">@ConditionalOnMissingBean</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnMissingClass"><span class="post-toc-number">4.4.8.</span> <span class="post-toc-text">@ConditionalOnMissingClass</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnNotWebApplication"><span class="post-toc-number">4.4.9.</span> <span class="post-toc-text">@ConditionalOnNotWebApplication</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnProperty"><span class="post-toc-number">4.4.10.</span> <span class="post-toc-text">@ConditionalOnProperty</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnResource"><span class="post-toc-number">4.4.11.</span> <span class="post-toc-text">@ConditionalOnResource</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnSingleCandidate"><span class="post-toc-number">4.4.12.</span> <span class="post-toc-text">@ConditionalOnSingleCandidate</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnWebApplication"><span class="post-toc-number">4.4.13.</span> <span class="post-toc-text">@ConditionalOnWebApplication</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ConditionalOnClass-1"><span class="post-toc-number">4.4.14.</span> <span class="post-toc-text">@ConditionalOnClass</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ConfigurationProperties"><span class="post-toc-number">4.5.</span> <span class="post-toc-text">@ConfigurationProperties</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%83%B0%E6%80%A7%E5%8A%A0%E8%BD%BD"><span class="post-toc-number">4.6.</span> <span class="post-toc-text">惰性加载</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E9%9A%8F%E6%9C%BA%E5%80%BC"><span class="post-toc-number">4.6.1.</span> <span class="post-toc-text">随机值</span></a></li></ol></li></ol></li></ol></div>
                        
                    
                    <article id="post-content">
                        <h1 id="Java-的原生注解"><a href="#Java-的原生注解" class="headerlink" title="Java 的原生注解"></a>Java 的原生注解</h1><h2 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h2><p>@Inherited 是<strong>一个元注解</strong>（annotations applied to other annotations），也是一个标记注解，@Inherited阐述了某个被标注的类型是被继承的。 <strong>@Inherited annotation类型是被标注过的class的子类所继承。类并不从它所实现的接口继承annotation，方法并不从它所重载的方法继承annotation。</strong>其查找过程是：反射 API 会在查找 @Inherited 标注的注解的时候，自底向上往继承树上方查找。</p>
<p>其他元注解还包括：</p>
<ul>
<li>@Target: Describes the targets to which an annotation can be applied; this directly corresponds to the nine contexts above</li>
<li>@Retention: Describes how long the annotation should be retained by the compiler</li>
<li>@Inherited: Denotes that an annotation should be inherited by a subtype if applied to a supertype</li>
<li>@Deprecated: Denotes that an annotation (or any other type) should no longer be used</li>
<li>@Repeatable: Denotes that an annotation can be applied multiple times in the same context; i.e. a class can have the same annotation applied to it two or more times 这一种注解最有意思，但平时没有什么用例，其大部分使用场景可以被一个复合值的 values 代替。</li>
</ul>
<p>注意，直接在注解上加入注解，实际上就产生了组合注解，会让配置集体生效，但这和继承元注解不一样。</p>
<h1 id="Spring-原生的功能"><a href="#Spring-原生的功能" class="headerlink" title="Spring 原生的功能"></a>Spring 原生的功能</h1><h2 id="xml-的模式"><a href="#xml-的模式" class="headerlink" title="xml 的模式"></a>xml 的模式</h2><p>spring 的配置总是：</p>
<ul>
<li>固定值的w3c 的 xsi</li>
<li>beans ns 它属于 spring org 的 schema 的一个子目录</li>
<li> 多个 attribute ns （它实际上是一个目录）</li>
<li>一个 attirbute schemaLocation（它是目录里面的真正方定义的地方） 它也属于 spring org 的 schema 的一个子目录，通常是一段 xsd</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- beans 的空间，这样我们就可以使用 beans 元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">        &lt;!<span class="attr">--</span>  <span class="attr">w3c</span> 的 <span class="attr">xsi</span>，默认总有 <span class="attr">--</span>&gt;</span></span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       <span class="comment">&lt;!-- 可以使用 context attribute --&gt;</span></span><br><span class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">       <span class="comment">&lt;!-- 可以使用 mvc attribute --&gt;</span></span><br><span class="line">       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">       <span class="comment">&lt;!-- 可以使用 aop attribute --&gt;</span></span><br><span class="line">       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">       <span class="comment">&lt;!-- 具体的 attribute 元素的定义 --&gt;</span></span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">            http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">            http://www.springframework.org/schema/context</span><br><span class="line">            http://www.springframework.org/schema/context/spring-context.xsd</span><br><span class="line">            http://www.springframework.org/schema/mvc</span><br><span class="line">            http://www.springframework.org/schema/mvc/spring-mvc.xsd</span><br><span class="line">            http://www.springframework.org/schema/aop</span><br><span class="line">            http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="带有-name-的注解"><a href="#带有-name-的注解" class="headerlink" title="带有 name 的注解"></a>带有 name 的注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;movieDao&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean(&quot;writer2&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(value=&quot;txManager1&quot;)</span></span><br></pre></td></tr></table></figure>

<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h2><p>@Configuration 注解本质上还是 @Component，但又不同于 @Component，详见<a target="_blank" rel="noopener" href="https://blog.csdn.net/isea533/article/details/78072133">《Spring @Configuration 和 @Component 区别<br>》</a>。@Configuration 里的 @Bean 方法可以嵌套使用，而@Component 里的 @Bean 方法不可以。<br>它天然可以被加载，还可以触发其他 bean 的加载。<br>它只能被放置在类型上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// instantiate, configure and return bean ...</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bootstrapping @Configuration classes</span></span><br><span class="line">AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line"> ctx.register(AppConfig.class);</span><br><span class="line"> ctx.refresh();</span><br><span class="line"> MyBean myBean = ctx.getBean(MyBean.class);</span><br><span class="line"> <span class="comment">// use myBean ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 除了它可以被  &lt;context:component-scan/&gt; 扫到，还可以自己配置 ComponentScan</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.acme.app.services&quot;,excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">        @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">     <span class="comment">// various @Bean definitions ...</span></span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="comment">// 可以定义多个源</span></span><br><span class="line"> <span class="meta">@PropertySource(&quot;classpath:/com/acme/app.properties&quot;)</span></span><br><span class="line"> <span class="meta">@PropertySource(&quot;classpath:bar.properties&quot;)</span></span><br><span class="line"> <span class="comment">// 甚至这样</span></span><br><span class="line"><span class="meta">@PropertySources(&#123;</span></span><br><span class="line"><span class="meta">    @PropertySource(&quot;classpath:foo.properties&quot;),</span></span><br><span class="line"><span class="meta">    @PropertySource(&quot;classpath:bar.properties&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带有缺省值的 value，不要用对象初始值了</span></span><br><span class="line"><span class="meta">@Value( &quot;$&#123;jdbc.url:aDefaultUrl&#125;&quot; )</span></span><br><span class="line"><span class="keyword">private</span> String jdbcUrl;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Value(&quot;$&#123;bean.name&#125;&quot;)</span> String beanName;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyBean(beanName);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 等同于 &lt;import/&gt;，需要用 AnnotationConfigApplicationContext 来 bootstrap。</span></span><br><span class="line"><span class="meta">@Import(DatabaseConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> DatabaseConfig dataConfig;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">AppConfig</span><span class="params">(DatabaseConfig dataConfig)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>.dataConfig = dataConfig;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// reference the dataSource() bean method</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyBean(dataConfig.dataSource());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 等同于 &lt;import/&gt;，需要用 AnnotationConfigApplicationContext 来 bootstrap。</span></span><br><span class="line"><span class="meta">@ImportResource(locations=&#123;&quot;classpath:applicationContext.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Profile(&quot;development&quot;)</span></span><br><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmbeddedDatabaseConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// instantiate, configure and return embedded DataSource</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductionDatabaseConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// instantiate, configure and return production DataSource</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProfileDatabaseConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">     <span class="meta">@Profile(&quot;development&quot;)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> DataSource <span class="title">embeddedDatabase</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">     <span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> DataSource <span class="title">productionDatabase</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Inject</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyBean(dataSource);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Configuration</span></span><br><span class="line">     <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseConfig</span> </span>&#123;</span><br><span class="line">         <span class="meta">@Bean</span></span><br><span class="line">         <span class="function">DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder().build();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// When we put @Lazy annotation over the @Configuration class, it indicates that all the methods with @Bean annotation should be loaded lazily.</span></span><br><span class="line"><span class="comment">// 这个注解当然也可以和 Component 一起用。相对应的是 eager initialization。</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.baeldung.lazy&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Region <span class="title">getRegion</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Region();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Country <span class="title">getCountry</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Country();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="EnableAsync"><a href="#EnableAsync" class="headerlink" title="@EnableAsync"></a>@EnableAsync</h2><p>激活异步拦截器，类似美团的 mole。</p>
<p>参考<a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-async">《How To Do @Async in Spring》</a>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// By default, Spring will be searching for an associated thread pool definition: either a unique TaskExecutor bean in the context, or an Executor bean named &quot;taskExecutor&quot; otherwise. If neither of the two is resolvable, a SimpleAsyncTaskExecutor will be used to process async method invocations.</span></span><br><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="meta">@EnableAsync</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">         executor.setCorePoolSize(<span class="number">7</span>);</span><br><span class="line">         executor.setMaxPoolSize(<span class="number">42</span>);</span><br><span class="line">         executor.setQueueCapacity(<span class="number">11</span>);</span><br><span class="line">         executor.setThreadNamePrefix(<span class="string">&quot;MyExecutor-&quot;</span>);</span><br><span class="line">         executor.initialize();</span><br><span class="line">         <span class="keyword">return</span> executor;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> AsyncUncaughtExceptionHandler <span class="title">getAsyncUncaughtExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyAsyncUncaughtExceptionHandler();</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyAsyncBean <span class="title">asyncBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyAsyncBean();</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAsyncBean</span> </span>&#123;</span><br><span class="line"> <span class="comment">// First – let&#x27;s go over the rules – @Async has two limitations:</span></span><br><span class="line"><span class="comment">// it must be applied to public methods only</span></span><br><span class="line"><span class="comment">// self-invocation – calling the async method from within the same class – won&#x27;t work</span></span><br><span class="line"><span class="comment">// The reasons are simple – the method needs to be public so that it can be proxied. And self-invocation doesn&#x27;t work because it bypasses the proxy and calls the underlying method directly.</span></span><br><span class="line"><span class="comment">// 这个注解会让 Spring 生成一个 aspect 方面</span></span><br><span class="line"> <span class="meta">@Async(&quot;threadPoolTaskExecutor&quot;)</span></span><br><span class="line"><span class="comment">// 无参数异步方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">asyncMethodWithConfiguredExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Execute method with configured executor - &quot;</span></span><br><span class="line">      + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有返回值的方法。Future.get() 会抛出 ExecutionException。从这个异常里可以取出原有的异常-不管是受检异常还是非受检异常。</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">asyncMethodWithReturnType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Execute method asynchronously - &quot;</span></span><br><span class="line">      + Thread.currentThread().getName());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;String&gt;(<span class="string">&quot;hello world !!!!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 自定义异常处理器，这要求在 AsyncConfigurer 里专门使用工厂方法生成相应的 bean。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAsyncExceptionHandler</span></span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">AsyncUncaughtExceptionHandler</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleUncaughtException</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      Throwable throwable, Method method, Object... obj)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">        System.out.println(<span class="string">&quot;Exception message - &quot;</span> + throwable.getMessage());</span><br><span class="line">        System.out.println(<span class="string">&quot;Method name - &quot;</span> + method.getName());</span><br><span class="line">        <span class="keyword">for</span> (Object param : obj) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Parameter value - &quot;</span> + param);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的 xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">executor</span>=<span class="string">&quot;myExecutor&quot;</span> <span class="attr">exception-handler</span>=<span class="string">&quot;exceptionHandler&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">task:executor</span> <span class="attr">id</span>=<span class="string">&quot;myExecutor&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;7-42&quot;</span> <span class="attr">queue-capacity</span>=<span class="string">&quot;11&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;asyncBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.MyAsyncBean&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;exceptionHandler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.MyAsyncUncaughtExceptionHandler&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="EnableScheduling"><a href="#EnableScheduling" class="headerlink" title="@EnableScheduling"></a>@EnableScheduling</h2><p>激活任务调度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="meta">@EnableScheduling</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.cron是设置定时执行的表达式，如 0 0/5 * * * ?每隔五分钟执行一次</span></span><br><span class="line">    <span class="comment">// 2.zone表示执行时间的时区</span></span><br><span class="line">    <span class="comment">// 3.fixedDelay 和fixedDelayString 表示一个固定延迟时间执行，上个任务完成后，延迟多长时间执行</span></span><br><span class="line">    <span class="comment">// 4.fixedRate 和fixedRateString表示一个固定频率执行，上个任务开始后，多长时间后开始执行</span></span><br><span class="line">     <span class="comment">// 5.initialDelay 和initialDelayString表示一个初始延迟时间，第一次被调用前延迟的时间</span></span><br><span class="line">     <span class="comment">// 每 1000 毫秒运行一次</span></span><br><span class="line">     <span class="meta">@Scheduled(fixedRate=1000)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// task execution logic</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Scheduled(fixedRate=1000)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// task execution logic</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"> <span class="meta">@EnableScheduling</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line">         taskRegistrar.setScheduler(taskExecutor());</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Executor <span class="title">taskExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> Executors.newScheduledThreadPool(<span class="number">100</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 自定义任务执行</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line">         taskRegistrar.setScheduler(taskScheduler());</span><br><span class="line">         taskRegistrar.addTriggerTask(</span><br><span class="line">             <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                     myTask().work();</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;,</span><br><span class="line">             <span class="keyword">new</span> CustomTrigger()</span><br><span class="line">         );</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Executor <span class="title">taskScheduler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> Executors.newScheduledThreadPool(<span class="number">42</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyTask <span class="title">myTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyTask();</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>对应的 xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:task</span>=<span class="string">&quot;http://www.springframework.org/schema/task&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans-3.2.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-3.2.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/task</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/task/spring-task-3.2.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">task:annotation-driven</span> <span class="attr">executor</span>=<span class="string">&quot;jobExecutor&quot;</span> <span class="attr">scheduler</span>=<span class="string">&quot;jobScheduler&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">task:executor</span> <span class="attr">id</span>=<span class="string">&quot;jobExecutor&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">task:scheduler</span> <span class="attr">id</span>=<span class="string">&quot;jobScheduler&quot;</span> <span class="attr">pool-size</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="EnableTransactionManagement"><a href="#EnableTransactionManagement" class="headerlink" title="@EnableTransactionManagement"></a>@EnableTransactionManagement</h2><p>TransactionInterceptor 是被 proxy 或者 advice 加入到调用栈中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// In both of the scenarios above, @EnableTransactionManagement and &lt;tx:annotation-driven/&gt; are responsible for registering the necessary Spring components that power annotation-driven transaction management, such as the TransactionInterceptor and the proxy- or AspectJ-based advice that weave the interceptor into the call stack when JdbcFooRepository&#x27;s @Transactional methods are invoked.</span></span><br><span class="line"> <span class="meta">@EnableTransactionManagement</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> FooRepository <span class="title">fooRepository</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// configure and return a class having @Transactional methods</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> JdbcFooRepository(dataSource());</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// configure and return the necessary JDBC DataSource</span></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">txManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">tx:annotation-driven</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;fooRepository&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.foo.JdbcFooRepository&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.vendor.VendorDataSource&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.sfwk...DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Please note that proxy mode allows for interception of calls through the proxy only; local calls within the same class cannot get intercepted that way.</p>
<p>Note that if the mode() is set to AdviceMode.ASPECTJ, then the value of the proxyTargetClass() attribute will be ignored. Note also that in this case the spring-aspects module JAR must be present on the classpath, with compile-time weaving or load-time weaving applying the aspect to the affected classes. There is no proxy involved in such a scenario; local calls will be intercepted as well.</p>
<p>aspectj 的织入可以增强本地调用，默认的 proxy mode 不可以。</p>
<p>AdviceMode.PROXY<br>AdviceMode.ASPECTJ</p>
<p>各种 mode 的解释见<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/22569438/optimal-enabletransactionmanagement-configuration">《Optimal @EnableTransactionManagement Configuration》</a>，必须配合<code>proxyTargetClass</code>配置使用：</p>
<blockquote>
<p>This configuration says how the transaction aspect will be applied.<br>Briefly:</p>
<p>adviceMode=proxy, proxyTargetClass=true Cglib is used as proxy<br>mechanism. If you use this, cglib must be on classpath, your proxied<br>classes must have nonparametric constructor and they can’t be final<br>(cglib creates a child class as the proxy).</p>
<p>adviceMode=proxy, proxyTargetClass=false Jdk proxy mechanism is used.<br>You only can proxy classes that implements a interface for methods<br>that should be transactional. Jdk proxy can be type casted to the<br>interfaces but can’t be type casted as the original proxied class.</p>
<p>So, for adviceMode=proxy, the decision relies more on how are your<br>code standards and what constraints result from used proxy mechanism.</p>
<p>adviceMode=aspectJ uses aspectJ library, which does byte code<br>intrumentation instead of proxying.</p>
<p>adviceMode=aspectJ, compile-time weaving You should incorporate<br>aspectJ instrumentation during a build process in your build scripts.</p>
<p>adviceMode=aspectJ, load-time weaving Instrumentation is performed on<br>runtime. You have to put the aspectj agent as jvm parameter.</p>
<p>Using aspectJ is more powerful and probably more performant. It is<br>also less invasive in terms of restrictions put on the classes you<br>want to be transactional. However, proxy mode is simple Spring’s out<br>of the box solution.</p>
</blockquote>
<p>基本上静态织入的 AspectJ 的性能最好（我们大多数时候都习惯使用 compile-time-weaving，但其实 AspectJ 还支持 load-time-weaving），但平时我们用得最多的还是 cglib 生成的 proxy（因为 Spring 会自动帮我们决策最优的方案）。</p>
<h2 id="EnableAspectJAutoProxy"><a href="#EnableAspectJAutoProxy" class="headerlink" title="@EnableAspectJAutoProxy"></a>@EnableAspectJAutoProxy</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// 这个注解本身和 aspectj 没什么必然关系（使用它并不一定带来编译时增强），倒是没有它 @Aspect 注解不能生效</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> FooService <span class="title">fooService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> FooService();</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyAspect <span class="title">myAspect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyAspect();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果没有 @bean 工厂方法，则这里必须加上 @Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">     <span class="meta">@Before(&quot;execution(* FooService+.*(..))&quot;)</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">advice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="comment">// advise FooService methods as appropriate</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>web application context 和 DispatcherServlet application contexts 是两个 context，需要单独声明 @EnableAspectJAutoProxy at multiple levels。</p>
<h2 id="EnableWebMvc"><a href="#EnableWebMvc" class="headerlink" title="@EnableWebMvc"></a>@EnableWebMvc</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">       basePackageClasses = &#123; MyConfiguration.class &#125;,</span></span><br><span class="line"><span class="meta">       excludeFilters = &#123; @Filter(type = FilterType.ANNOTATION, value = Configuration.class) &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFormatters</span><span class="params">(FormatterRegistry formatterRegistry)</span> </span>&#123;</span><br><span class="line">               formatterRegistry.addConverter(<span class="keyword">new</span> MyConverter());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">               converters.add(<span class="keyword">new</span> MyHttpMessageConverter());</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// @Override methods ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ContextConfiguration"><a href="#ContextConfiguration" class="headerlink" title="ContextConfiguration"></a>ContextConfiguration</h2><p><code>spring-test</code>特有,<code>ContextConfiguration</code> 要和<code>@Configuration</code>或者<code>@Component</code>配合使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@TestPropertySource(&quot;/foo.properties&quot;)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = &#123;AppConfig.class, DatabaseConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@TestPropertySource(properties = &#123;&quot;foo=bar&quot;&#125;)</span></span><br><span class="line"><span class="comment">// SpringBoot 特有</span></span><br><span class="line"><span class="meta">@SpringBootTest(properties = &#123;&quot;foo=bar&quot;&#125;, classes = SpringBootPropertiesTestApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> MyBean myBean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// assertions against myBean ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="PropertySource"><a href="#PropertySource" class="headerlink" title="@PropertySource"></a>@PropertySource</h2><p>property 跨上下文继承的关系见<a target="_blank" rel="noopener" href="https://www.baeldung.com/properties-with-spring">《Properties with Spring and Spring Boot》</a>。<br><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">《官方的列表》</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"> <span class="meta">@PropertySource(&quot;classpath:/com/acme/app.properties&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Inject</span> Environment env;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Bean</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> MyBean(env.getProperty(<span class="string">&quot;bean.name&quot;</span>));</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h2><p>它指定的扫描属性依赖于 basePackageClasses()/basePackages() (or its alias value()。</p>
<h2 id="环境-API"><a href="#环境-API" class="headerlink" title="环境 API"></a>环境 API</h2><p>环境 API 意味着对 properties 和 profile 的建模，<code>Environment</code>接口扩展了<code>PropertyResolver</code>接口。</p>
<p>参考<a target="_blank" rel="noopener" href="http://blog.zollty.com/b/archive/spring-property-configuration-loading-and-use-process-and-the-initialization-process-of-environment.html">《Spring的Property配置加载和使用过程及Environment的初始化过程<br>》</a>：</p>
<blockquote>
<p>首先，PropertySource其实就是包装的具体配置，跟Properties差不多。</p>
<p>而PropertyResolver，就是用于对PropertySource进行特殊处理，比如解析holder、转换值的类型等。</p>
<p>Spring启动时，默认会new一个StandardEnvironment，这个类里面就默认添加了两个PropertySource（SystemProperties和SystemEnvironment，分别对应System.getenv和System.getProperty）</p>
<p>注意，可能是为了使用方便，Environment实现了PropertyResolver接口。</p>
</blockquote>
<p>每一个参数，但凡可以用-D 动态传入，也应该可以使用环境变量，甚至 JNDI 的配置，其相对顺序参考<a target="_blank" rel="noopener" href="https://topic.alibabacloud.com/a/spring-boot-configuration-priority-order_8_8_30371727.html">《Spring Boot Configuration Priority order》</a>：</p>
<ol>
<li>command-line arguments.</li>
<li>The Java system parameters obtained through System.getproperties ().</li>
<li>Operating system environment variables.</li>
<li>The JNDI attribute obtained from java:comp/env.</li>
<li>The “random.*” property generated by Randomvaluepropertysource.</li>
<li>Apply the properties file outside of the Jar file . (via</li>
<li>spring.config.location parameter)</li>
<li>Apply the properties file inside the Jar file.</li>
<li>A property file that is declared through the “@PropertySource”</li>
<li>annotation in the application Configuration Java class (the Java</li>
<li>class that contains the “@Configuration” annotations).</li>
<li>The default property declared by the “Springapplication.setdefaultproperties”.</li>
</ol>
<h3 id="在-java-中获取环境变量：环境变量System-getenv-或者-environment-getenv"><a href="#在-java-中获取环境变量：环境变量System-getenv-或者-environment-getenv" class="headerlink" title="在 java 中获取环境变量：环境变量System.getenv() 或者 environment.getenv()"></a>在 java 中获取环境变量：环境变量System.getenv() 或者 environment.getenv()</h3><p>System.getenv() 方法是获取指定的环境变量的值。它有两种方法，一种是接收参数为任意字符串，当存在指定环境变量时即返回环境变量的值，否则返回null。另外一种是不接受参数，那么返回的是所有的环境变量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收参数为任意字符串</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getenv</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        SecurityManager sm = getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (sm != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sm.checkPermission(<span class="keyword">new</span> RuntimePermission(<span class="string">&quot;getenv.&quot;</span>+name));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProcessEnvironment.getenv(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不接受参数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> java.util.<span class="function">Map&lt;String,String&gt; <span class="title">getenv</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SecurityManager sm = getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (sm != <span class="keyword">null</span>) &#123;</span><br><span class="line">            sm.checkPermission(<span class="keyword">new</span> RuntimePermission(<span class="string">&quot;getenv.*&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ProcessEnvironment.getenv();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="在-java-中获取属性：System-getProperty-或者-environment-getProperty"><a href="#在-java-中获取属性：System-getProperty-或者-environment-getProperty" class="headerlink" title="在 java 中获取属性：System.getProperty() 或者 environment.getProperty()"></a>在 java 中获取属性：System.getProperty() 或者 environment.getProperty()</h3><p>获取系统的相关属性，包括文件编码、操作系统名称、区域、用户名等，此属性一般由jvm自动获取，不能设置。这个必须接受一个String类型的参数，返回值的类型也是String，如果想获取所有的系统的相关属性值可以使用System.getProperties（）</p>
<blockquote>
<p>java.version    Java 运行时环境版本<br>java.vendor Java 运行时环境供应商<br>java.vendor.url Java 供应商的 URL<br>java.home   Java 安装目录<br>java.vm.specification.version   Java 虚拟机规范版本<br>java.vm.specification.vendor    Java 虚拟机规范供应商<br>java.vm.specification.name  Java 虚拟机规范名称<br>java.vm.version Java 虚拟机实现版本<br>java.vm.vendor  Java 虚拟机实现供应商<br>java.vm.name    Java 虚拟机实现名称<br>java.specification.version  Java 运行时环境规范版本<br>java.specification.vendor   Java 运行时环境规范供应商<br>java.specification.name Java 运行时环境规范名称<br>java.class.version  Java 类格式版本号<br>java.class.path Java 类路径<br>java.library.path   加载库时搜索的路径列表<br>java.io.tmpdir  默认的临时文件路径<br>java.compiler   要使用的 JIT 编译器的名称<br>java.ext.dirs   一个或多个扩展目录的路径<br>os.name 操作系统的名称<br>os.arch 操作系统的架构<br>os.version  操作系统的版本<br>file.separator  文件分隔符（在 UNIX 系统中是“/” ）<br>path.separator  路径分隔符（在 UNIX 系统中是“:” ）<br>line.separator  行分隔符（在 UNIX 系统中是“/n” ）<br>user.name   用户的账户名称<br>user.home   用户的主目录<br>user.dir    用户的当前工作目录</p>
</blockquote>
<p>对应的命令行用法是<code>java -jar jarName -DpropertyName=value</code>，如<code>java -Djavadoop.database.password=admin4321 -jar app.jar</code>。</p>
<p>参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/javJoker/p/7262840.html">《System.getenv()和System.getProperty() 的区别》</a>。</p>
<h3 id="profile-的定义"><a href="#profile-的定义" class="headerlink" title="profile 的定义"></a>profile 的定义</h3><blockquote>
<p>a named, logical group of bean definitions to be registered with the<br>container only if the given profile is active</p>
</blockquote>
<p>和 Configuration 类似，用来聚合 bean。<strong>与之相对应地，maven 中的 profile 就是用来聚合配置用的</strong>。一旦被注册进了某个 profile，则 bean 不会轻易地被默认激活。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DevDatasourceConfig</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">Component</span></span></span><br><span class="line"><span class="class">@<span class="title">Profile</span>(&quot;!<span class="title">dev</span>&quot;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">DevDatasourceConfig</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">// 程序式地激活 <span class="title">profile</span> 的方法</span></span><br><span class="line"><span class="class">@<span class="title">Configuration</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MyWebApplicationInitializer</span> </span></span><br><span class="line"><span class="class">  <span class="keyword">implements</span> <span class="title">WebApplicationInitializer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">  </span><br><span class="line">        servletContext.setInitParameter(</span><br><span class="line">          <span class="string">&quot;spring.profiles.active&quot;</span>, <span class="string">&quot;dev&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ConfigurableEnvironment env;</span><br><span class="line">...</span><br><span class="line">env.setActiveProfiles(<span class="string">&quot;someProfile&quot;</span>);</span><br><span class="line"></span><br><span class="line">&lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;/WEB-INF/app-config.xml&lt;/param-value&gt;</span><br><span class="line">&lt;/context-param&gt;</span><br><span class="line">&lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;spring.profiles.active&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;dev&lt;/param-value&gt;</span><br><span class="line">&lt;/context-param&gt;</span><br><span class="line"></span><br><span class="line">-Dspring.profiles.active=dev</span><br><span class="line">export spring_profiles_active=dev</span><br></pre></td></tr></table></figure>

<h3 id="properties-的例子"><a href="#properties-的例子" class="headerlink" title="properties 的例子"></a>properties 的例子</h3><blockquote>
<p>properties files, JVM system properties, system environment variables,<br>JNDI, servlet context parameters, ad-hoc Properties objects, Maps, and<br>so on.</p>
</blockquote>
<p>所有的 properties 都由<code>PropertySourcesPlaceholderConfigurer</code>对<code>$&#123;&#125;</code>进行注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> Environment env;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setName(env.getProperty(<span class="string">&quot;bean.name&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> myBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Aware-接口"><a href="#Aware-接口" class="headerlink" title="Aware 接口"></a>Aware 接口</h2><ul>
<li>ApplicationContextAware</li>
<li>ApplicationEventPublisherAware</li>
<li>BeanClassLoaderAware</li>
<li>BeanFactoryAware</li>
<li>BeanNameAware</li>
<li>BootstrapContextAware</li>
<li>EmbeddedValueResolverAware</li>
<li>EnvironmentAware</li>
<li>ImportAware</li>
<li>LoadTimeWeaverAware</li>
<li>MessageSourceAware</li>
<li>NotificationPublisherAware</li>
<li>ResourceLoaderAware</li>
<li>SchedulerContextAware</li>
<li>ServletConfigAware</li>
<li>ServletContextAware</li>
</ul>
<h2 id="PropertySourcesPlaceholderConfigurer"><a href="#PropertySourcesPlaceholderConfigurer" class="headerlink" title="PropertySourcesPlaceholderConfigurer"></a>PropertySourcesPlaceholderConfigurer</h2><p>其中PropertyPlaceholderConfigurer是Spring3.1之前使用的。<br>PropertySourcesPlaceholderConfigurer是Spring3.1之后使用的。</p>
<p>有了这个机制，才能让特定的 .properties 注入到特定的 xml 占位符里面。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- bean 形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;propertyConfigurer&quot;</span><span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;location&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>conf/sqlmap/jdbc.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;fileEncoding&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;propertyConfigurer&quot;</span><span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;locations&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/mail.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath: conf/sqlmap/jdbc.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span>//注意这两种value值的写法</span><br><span class="line">     <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- spring容器中最多只能定义一个context:property-placeholder!(spring和springmvc不是同一容器，PropertyPlaceholderConfigurer可以同时存在于spring和springmvc中 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- context attribute 形式，这种形式更优于 bean 的形式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:/WEB-INF/mail.properties&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>PropertySourcesPlaceholderConfigurer本质上是一个BeanFactoryPostProcessor。解析XML的流程在BeanFactoryPostProcessor之前， 优先将配置文件的路径以及名字通过Setter传入PropertySourcesPlaceholderConfigurer。</p>
<p>如上BeanFactoryPostProcessor的优先级又优于其余的Bean。因此可以实现在bean初始化之前的注入。</p>
<p>参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qyp199312/article/details/54313784">《Spring PropertySourcesPlaceholderConfigurer工作原理》</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a3c7ff0de5ac">《Spring 常用的两种PropertyPlaceholderConfigurer》</a> 基本还是 MergedProperties 那一套。</li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ba84993d2f06">《Spring Properties Loader》</a></li>
</ol>
<h2 id="xml-配置"><a href="#xml-配置" class="headerlink" title="xml 配置"></a>xml 配置</h2><p><code>annotation-config</code>等字符串实际上指的是一个 element 的 attribute。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>  <span class="attr">profile</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xh.spring.aop&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">expression</span>=<span class="string">&quot;org.aspectj.lang.annotation.Aspect&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.RestController&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">ignore-unresolvable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:/base.properties,classpath:database.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- proxy-target-class属性值决定是基于接口的还是基于类的代理被创建。如果proxy-target-class 属性值被设置为true，那么基于类的代理将起作用（这时需要cglib库）。如果proxy-target-class属值被设置为false或者这个属性被省略，那么标准的JDK 基于接口的代理。高版本spring自动根据运行类有没有实现特定接口选择JDK或CGLIB代理，我们无需设置proxy-target-class属性，JDK动态代理是模拟接口实现的方式，cglib是模拟子类继承的方式，一般采用前者，因为前者效率高。后者不建议使用。--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;logHandler&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;printLog&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* cn.sw.study.common.test.spring.aop.service..*(..))&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;LogBefore&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;printLog&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;LogAfter&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;printLog&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.acme.AppConfig&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- PropertiesFactoryBean 也可以支持 @Value：@Value(&quot;#&#123;propBean[&#x27;filePath&#x27;]&#125;&quot;)或者@Value(&quot;#&#123;propBean.filePath&#125;&quot;) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;propBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertiesFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;locations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 事务管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;routingDatasource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 引用其它配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;a.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;b.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;springmvc-web.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- @Value(&quot;$&#123;filePath&#125;&quot;) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:/WEB-INF/mail.properties&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a>@ResponseBody</h2><p>表示该方法的返回结果直接写入HTTP response body中，一般在异步获取数据时使用，在使用@RequestMapping后，返回值通常解析为跳转路径，</p>
<p>加上@responsebody后返回结果不会被解析为跳转路径，而是直接写入HTTP response body中；比如异步获取json数据，加上@responsebody后，会直接返回json数据；</p>
<h2 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h2><p>参数前加上这个注解之后，认为该参数必填。表示接受json字符串转为对象 List等；</p>
<h2 id="Qualifier"><a href="#Qualifier" class="headerlink" title="@Qualifier"></a>@Qualifier</h2><p>当有多个同一类型的Bean时，可以用@Qualifier(“name”)来指定。与@Autowired配合使用</p>
<h2 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h2><p>按照类型（byType）装配依赖对象，默认情况下它要求依赖对象必须存在，如果允许null值，可以设置它的required属性为false。如果我们想使用按照名称（byName）来装配，可以结合@Qualifier注解一起使用。(通过类型匹配找到多个candidate,在没有@Qualifier、@Primary注解的情况下，会使用对象名作为最后的fallback匹配)。</p>
<h2 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource(name=”name”,type=”type”)</span></span><br></pre></td></tr></table></figure>
<p>默认按照ByName自动注入，由J2EE提供，需要导入包javax.annotation.Resource。@Resource有两个重要的属性：name和type，而Spring将@Resource注解的name属性解析为bean的名字，而type属性则解析为bean的类型。所以，如果使用name属性，则使用byName的自动注入策略，而使用type属性时则使用byType自动注入策略。如果既不制定name也不制定type属性，这时将通过反射机制使用byName自动注入策略。</p>
<h2 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h2><p>RequestMapping是一个用来处理请求地址映射的注解，可用于类或方法上。用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径；</p>
<p>params:指定request中必须包含某些参数值是，才让该方法处理。<br>headers:指定request中必须包含某些指定的header值，才能让该方法处理请求。<br>value:指定请求的实际地址，指定的地址可以是URI Template 模式<br>method:指定请求的method类型， GET、POST、PUT、DELETE等<br>consumes:指定处理请求的提交内容类型（Content-Type），如application/json,text/html;<br>produces:指定返回的内容类型，仅当request请求头中的(Accept)类型中包含该指定类型才返回。</p>
<p>它还有其他语法糖：@GetMapping、@PostMapping</p>
<h2 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h2><p>用在方法的参数前面。相当于 request.getParameter；</p>
<h2 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h2><p>路径变量。如 RequestMapping(“user/get/mac/{macAddress}”) ；</p>
<p>public String getByMacAddress(<br>@PathVariable(“macAddress”) String macAddress){<br>    //do something;<br>}<br>参数与大括号里的名字相同的话，注解后括号里的内容可以不填。</p>
<h2 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h2><p>@ControllerAdvice是一个特殊的 @Component，用于标识一个类，这个类中被以下三种注解标识的方法：@ExceptionHandler，@InitBinder，@ModelAttribute，将作用于所有的@Controller类的接口上。这三种方法，可以被认为是三种 advice。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActionAdvice</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注册属性编辑器，对HTTP请求参数进行处理，再绑定到对应的接口，比如格式化的时间转换等。应用于单个@Controller类的方法上时，仅对该类里的接口有效。与@ControllerAdvice组合使用可全局生效。</span></span><br><span class="line">    <span class="meta">@InitBinder</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleException</span><span class="params">(WebDataBinder binder)</span> </span>&#123;</span><br><span class="line">        binder.addCustomFormatter(<span class="keyword">new</span> DateFormatter(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 统一异常处理，也可以指定要处理的异常类型</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.OK)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">handleException</span><span class="params">(Exception ex)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>, <span class="number">400</span>);</span><br><span class="line">        map.put(<span class="string">&quot;msg&quot;</span>, ex.toString());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 一个 advice 类里可以有多个 handleException 映射</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;index&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">index</span><span class="params">(<span class="meta">@ModelAttribute(&quot;user&quot;)</span> String user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DelegatingFilterProxy"><a href="#DelegatingFilterProxy" class="headerlink" title="DelegatingFilterProxy"></a>DelegatingFilterProxy</h2><p>过滤器，它指向一个bean，这个bean在spring中的名字为testBean，testBean也必需实现javax.servlet.Filter。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>testFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetBeanName<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>testBean<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextAttribute<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>session<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>targetFilterLifecycle<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>testFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="JPA-特性"><a href="#JPA-特性" class="headerlink" title="JPA 特性"></a>JPA 特性</h1><h2 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h2><p>@Table(name=”“)<br>表明这是一个实体类。一般用于jpa ，这两个注解一般一块使用，但是如果表名和实体类名相同的话，@Table可以省略；</p>
<h2 id="MappedSuperClass"><a href="#MappedSuperClass" class="headerlink" title="@MappedSuperClass"></a>@MappedSuperClass</h2><p>用在确定是父类的entity上。父类的属性子类可以继承；</p>
<h2 id="NoRepositoryBean"><a href="#NoRepositoryBean" class="headerlink" title="@NoRepositoryBean"></a>@NoRepositoryBean</h2><p>一般用作父类的repository，有这个注解，spring不会去实例化该repository；</p>
<h2 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h2><p>如果字段名与列名相同，则可以省略；</p>
<h2 id="Id"><a href="#Id" class="headerlink" title="@Id"></a>@Id</h2><p>表示该属性为主键；</p>
<h2 id="GeneratedValue"><a href="#GeneratedValue" class="headerlink" title="@GeneratedValue"></a>@GeneratedValue</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GeneratedValue(strategy=GenerationType.SEQUENCE,generator = “repair_seq”)</span></span><br></pre></td></tr></table></figure>
<p>表示主键生成策略是sequence（可以为Auto、IDENTITY、native等，Auto表示可在多个数据库间切换），指定sequence的名字是repair_seq；</p>
<p>参考<a href="https://magicliang.github.io/2018/05/29/JPA-%E7%9A%84-id-%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/">《JPA 的 id 生成策略》</a>。</p>
<h2 id="SequenceGeneretor"><a href="#SequenceGeneretor" class="headerlink" title="@SequenceGeneretor"></a>@SequenceGeneretor</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SequenceGeneretor(name = “repair_seq”, sequenceName = “seq_repair”, allocationSize = 1)</span></span><br></pre></td></tr></table></figure>
<p>name为sequence的名称，以便使用，sequenceName为数据库的 sequence 名称，两个名称可以一致；</p>
<p>要底层的 RDBMS 能够支持 sequence 功能。</p>
<h2 id="Transient"><a href="#Transient" class="headerlink" title="@Transient"></a>@Transient</h2><p>表示该属性并非一个到数据库表的字段的映射,ORM框架将忽略该属性.</p>
<p>如果一个属性并非数据库表的字段映射,就务必将其标示为@Transient,否则,ORM框架默认其注解为@Basic；</p>
<h2 id="Basic-fetch-FetchType-LAZY"><a href="#Basic-fetch-FetchType-LAZY" class="headerlink" title="@Basic(fetch=FetchType.LAZY)"></a>@Basic(fetch=FetchType.LAZY)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Basic(fetch=FetchType.LAZY)</span></span><br></pre></td></tr></table></figure>
<p>标记可以指定实体属性的加载方式；</p>
<h2 id="JsonIgnore"><a href="#JsonIgnore" class="headerlink" title="@JsonIgnore"></a>@JsonIgnore</h2><p>作用是json序列化时将java bean中的一些属性忽略掉,序列化和反序列化都受影响</p>
<h2 id="JoinColumn-name-”loginId”"><a href="#JoinColumn-name-”loginId”" class="headerlink" title="@JoinColumn(name=”loginId”)"></a>@JoinColumn(name=”loginId”)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JoinColumn(name=”loginId”)</span></span><br></pre></td></tr></table></figure>

<p>一对一：本表中指向另一个表的外键。<br>一对多：另一个表指向本表的外键。</p>
<h2 id="表之间的映射"><a href="#表之间的映射" class="headerlink" title="表之间的映射"></a>表之间的映射</h2><p>对应Hibernate配置文件中的一对一，一对多，多对一。</p>
<p>哪一边是 owning side 很重要。</p>
<h3 id="OneToOne"><a href="#OneToOne" class="headerlink" title="OneToOne"></a>OneToOne</h3><h4 id="Implementing-with-a-Foreign-Key-in-JPA"><a href="#Implementing-with-a-Foreign-Key-in-JPA" class="headerlink" title="Implementing with a Foreign Key in JPA"></a>Implementing with a Foreign Key in JPA</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//... </span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;address_id&quot;, referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ... getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;address&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="comment">// The address side of the relationship is called the non-owning side. </span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;address&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//... getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Implementing-with-a-Shared-Primary-Key-in-JPA"><a href="#Implementing-with-a-Shared-Primary-Key-in-JPA" class="headerlink" title="Implementing with a Shared Primary Key in JPA"></a>Implementing with a Shared Primary Key in JPA</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//... getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;address&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToOne</span></span><br><span class="line">    <span class="comment">// @MapsId tells Hibernate to use the id column of address as both primary key and foreign key. Also, notice that the @Id column of the Address entity no longer uses the @GeneratedValue annotation.</span></span><br><span class="line">    <span class="meta">@MapsId</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//... getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Modeling-with-a-Join-Table"><a href="#Modeling-with-a-Join-Table" class="headerlink" title="Modeling with a Join Table"></a>Modeling with a Join Table</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;employee&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="meta">@JoinTable(name = &quot;emp_workstation&quot;, </span></span><br><span class="line"><span class="meta">      joinColumns = </span></span><br><span class="line"><span class="meta">        &#123; @JoinColumn(name = &quot;employee_id&quot;, referencedColumnName = &quot;id&quot;) &#125;,</span></span><br><span class="line"><span class="meta">      inverseJoinColumns = </span></span><br><span class="line"><span class="meta">        &#123; @JoinColumn(name = &quot;workstation_id&quot;, referencedColumnName = &quot;id&quot;) &#125;)</span></span><br><span class="line">    <span class="keyword">private</span> WorkStation workStation;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//... getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;workstation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkStation</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;workStation&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Employee employee;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//... getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="OneToMany"><a href="#OneToMany" class="headerlink" title="@OneToMany"></a>@OneToMany</h3><p>As stated in the JPA specification under section 2.9, <strong>it’s a good practice to mark many-to-one side as the owning side.</strong></p>
<h4 id="平凡解决方案"><a href="#平凡解决方案" class="headerlink" title="平凡解决方案"></a>平凡解决方案</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;CART&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cart</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy=&quot;cart&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Items&gt; items;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name=&quot;ITEMS&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Items</span> </span>&#123;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name=&quot;cart_id&quot;, nullable=false)</span></span><br><span class="line">    <span class="keyword">private</span> Cart cart;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Items</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Cart-as-the-Owning-Side"><a href="#Cart-as-the-Owning-Side" class="headerlink" title="Cart as the Owning Side"></a>Cart as the Owning Side</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemsOIO</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  ...</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;cart_id&quot;, insertable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> CartOIO cart;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartOIO</span> </span>&#123;</span><br><span class="line">    <span class="comment">//..  </span></span><br><span class="line">    <span class="meta">@OneToMany</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;cart_id&quot;)</span> <span class="comment">// we need to duplicate the physical information</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;ItemsOIO&gt; items;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ManyToOne"><a href="#ManyToOne" class="headerlink" title="@ManyToOne"></a>@ManyToOne</h3><p>缺，来日补上</p>
<h3 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="@ManyToMany"></a>@ManyToMany</h3><h4 id="普通映射"><a href="#普通映射" class="headerlink" title="普通映射"></a>普通映射</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@ManyToMany</span></span><br><span class="line">    <span class="meta">@JoinTable(</span></span><br><span class="line"><span class="meta">  name = &quot;course_like&quot;, </span></span><br><span class="line"><span class="meta">  joinColumns = @JoinColumn(name = &quot;student_id&quot;), </span></span><br><span class="line"><span class="meta">  inverseJoinColumns = @JoinColumn(name = &quot;course_id&quot;))</span></span><br><span class="line">    Set&lt;Course&gt; likedCourses;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// additional properties</span></span><br><span class="line">    <span class="comment">// standard constructors, getters, and setters</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    Long id;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@ManyToMany</span></span><br><span class="line">    Set&lt;Student&gt; likes;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// additional properties</span></span><br><span class="line">    <span class="comment">// standard constructors, getters, and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Joining-Table"><a href="#Joining-Table" class="headerlink" title="Joining Table"></a>Joining Table</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Embeddable</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseRatingKey</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Column(name = &quot;student_id&quot;)</span></span><br><span class="line">    Long studentId;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Column(name = &quot;course_id&quot;)</span></span><br><span class="line">    Long courseId;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// standard constructors, getters, and setters</span></span><br><span class="line">    <span class="comment">// hashcode and equals implementation</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseRating</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@EmbeddedId</span></span><br><span class="line">    CourseRatingKey id;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@MapsId(&quot;student_id&quot;)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;student_id&quot;)</span></span><br><span class="line">    Student student;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@MapsId(&quot;course_id&quot;)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;course_id&quot;)</span></span><br><span class="line">    Course course;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">int</span> rating;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// standard constructors, getters, and setters</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;student&quot;)</span></span><br><span class="line">    Set&lt;CourseRating&gt; ratings;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Course</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;course&quot;)</span></span><br><span class="line">    Set&lt;CourseRating&gt; ratings;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring-Boot-特性"><a href="#Spring-Boot-特性" class="headerlink" title="Spring Boot 特性"></a>Spring Boot 特性</h1><p>Spring Boot 在扫描类路径的时候扫到特定的包的时候，会自动激活事务管理、Spring MVC 等功能。</p>
<h2 id="SpringBootApplication"><a href="#SpringBootApplication" class="headerlink" title="@SpringBootApplication"></a>@SpringBootApplication</h2><p>自带其他自动化配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">        @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;&#125;</span><br></pre></td></tr></table></figure>


<h2 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h2><p>打开这个配置后，可以通过扫描类路径、配置文件自动打开某些配置。<br>必须配合 @Configuration 使用。</p>
<h2 id="TransactionAutoConfiguration"><a href="#TransactionAutoConfiguration" class="headerlink" title="TransactionAutoConfiguration"></a>TransactionAutoConfiguration</h2><p>spring-boot 不需要打开 @EnableTransactionManagement。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 一个隐藏起来的 @Configuration 也可以激活事务管理</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(AbstractTransactionManagementConfiguration.class)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionManagementConfiguration</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(PlatformTransactionManager.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; JtaAutoConfiguration.class, HibernateJpaAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">        DataSourceTransactionManagerAutoConfiguration.class, Neo4jDataAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(TransactionProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransactionManagerCustomizers <span class="title">platformTransactionManagerCustomizers</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            ObjectProvider&lt;PlatformTransactionManagerCustomizer&lt;?&gt;&gt; customizers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TransactionManagerCustomizers(customizers.orderedStream().collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(PlatformTransactionManager.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TransactionTemplateConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> PlatformTransactionManager transactionManager;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TransactionTemplateConfiguration</span><span class="params">(PlatformTransactionManager transactionManager)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.transactionManager = transactionManager;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@ConditionalOnMissingBean(TransactionOperations.class)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TransactionTemplate <span class="title">transactionTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> TransactionTemplate(<span class="keyword">this</span>.transactionManager);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(PlatformTransactionManager.class)</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(AbstractTransactionManagementConfiguration.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableTransactionManagementConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Configuration</span></span><br><span class="line">        <span class="meta">@EnableTransactionManagement(proxyTargetClass = false)</span></span><br><span class="line">        <span class="meta">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;false&quot;,</span></span><br><span class="line"><span class="meta">                matchIfMissing = false)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkDynamicAutoProxyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Configuration</span></span><br><span class="line">        <span class="meta">@EnableTransactionManagement(proxyTargetClass = true)</span></span><br><span class="line">        <span class="meta">@ConditionalOnProperty(prefix = &quot;spring.aop&quot;, name = &quot;proxy-target-class&quot;, havingValue = &quot;true&quot;,</span></span><br><span class="line"><span class="meta">                matchIfMissing = true)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibAutoProxyConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="org-springframework-boot-autoconfigure-condition"><a href="#org-springframework-boot-autoconfigure-condition" class="headerlink" title="org.springframework.boot.autoconfigure.condition"></a>org.springframework.boot.autoconfigure.condition</h2><p>这个包下面的注解都带有一个元注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Conditional(OnJavaCondition.class)</span></span><br></pre></td></tr></table></figure>

<p>Spring 自己有一套条件体系：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OnJavaCondition extends SpringBootCondition</span><br><span class="line">SpringBootCondition extends Condition</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://www.1024sky.cn/blog/article/615">《自定义 condition 的例子》</a></p>
<p>这些注解可以放在 @Bean、@Component、乃至于一堆 bean （@Configuration）上。</p>
<h3 id="ConditionalOnBean"><a href="#ConditionalOnBean" class="headerlink" title="@ConditionalOnBean"></a>@ConditionalOnBean</h3><p>在早期版本有 bug，参考<a target="_blank" rel="noopener" href="http://hengyunabc.github.io/spring-placeholder-inject-failed-cases/">《深入Spring Boot：那些注入不了的Spring占位符（${}表达式）》</a>。</p>
<p>仅仅在当前上下文中存在某个 bean 时，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(name=&quot;redisTemplate&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisOperBean</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate redisTemplate;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">RedisOperBean</span><span class="params">(RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnClass"><a href="#ConditionalOnClass" class="headerlink" title="@ConditionalOnClass"></a>@ConditionalOnClass</h3><p>只有类路径里存在特定的 class 的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DependedClz.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LoadIfClzExists <span class="title">loadIfClzExists</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LoadIfClzExists(<span class="string">&quot;dependedClz&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnCloudPlatform"><a href="#ConditionalOnCloudPlatform" class="headerlink" title="@ConditionalOnCloudPlatform"></a>@ConditionalOnCloudPlatform</h3><p>只在特定的云平台是活动的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CLOUD_FOUNDRY</span><br><span class="line">HEROKU</span><br><span class="line">KUBERNETES</span><br><span class="line">SAP</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnExpression"><a href="#ConditionalOnExpression" class="headerlink" title="@ConditionalOnExpression"></a>@ConditionalOnExpression</h3><p>当表达式为true的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.roytuts.spring.conditional.on.expression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnExpression;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnExpression(value = &quot;$&#123;module.enabled&#125; and $&#123;module.submodule.enabled&#125;&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Module <span class="title">module</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Module();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">module.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">module.submodule.enabled</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnJava"><a href="#ConditionalOnJava" class="headerlink" title="@ConditionalOnJava"></a>@ConditionalOnJava</h3><p>只有遇到特定的 JVM version，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;websocketContainerCustomizer&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnJava(JavaVersion.SEVEN)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TomcatWebSocketContainerCustomizer <span class="title">websocketContainerCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TomcatWebSocketContainerCustomizer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnJndi"><a href="#ConditionalOnJndi" class="headerlink" title="@ConditionalOnJndi"></a>@ConditionalOnJndi</h3><p>只有 jndi 路径上有特定的资源的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnJndi(&quot;java:comp/env/foo&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OnJndiModule</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnMissingBean"><a href="#ConditionalOnMissingBean" class="headerlink" title="@ConditionalOnMissingBean"></a>@ConditionalOnMissingBean</h3><p>仅仅在当前上下文中不存在某个 bean 时，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;notExistsBean&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LoadIfBeanNotExists <span class="title">loadIfBeanNotExists</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LoadIfBeanNotExists(<span class="string">&quot;notExistsBean&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnMissingClass"><a href="#ConditionalOnMissingClass" class="headerlink" title="@ConditionalOnMissingClass"></a>@ConditionalOnMissingClass</h3><p>class不存在时，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingClass(&quot;com.git.hui.boot.conditionbean.example.depends.clz.DependedClz&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LoadIfClzNotExists <span class="title">loadIfClzNotExists</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LoadIfClzNotExists(<span class="string">&quot;com.git.hui.boot.conditionbean.example.depends.clz.DependedClz&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConditionalOnNotWebApplication"><a href="#ConditionalOnNotWebApplication" class="headerlink" title="@ConditionalOnNotWebApplication"></a>@ConditionalOnNotWebApplication</h3><p>只有 application context 不是一个 web application context 时，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.roytuts.spring.conditional.on.web.notweb.application;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringConfigOnWebNotWebApp</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Module <span class="title">module</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Module();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConditionalOnProperty"><a href="#ConditionalOnProperty" class="headerlink" title="@ConditionalOnProperty"></a>@ConditionalOnProperty</h3><p>特定的属性有特定的值的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//在application.properties配置&quot;mf.assert&quot;，对应的值为true</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(prefix=&quot;mf&quot;,name = &quot;assert&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AssertConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloServiceProperties helloServiceProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HelloService helloService = <span class="keyword">new</span> HelloService();</span><br><span class="line">        helloService.setMsg(helloServiceProperties.getMsg());</span><br><span class="line">        <span class="keyword">return</span> helloService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConditionalOnResource"><a href="#ConditionalOnResource" class="headerlink" title="@ConditionalOnResource"></a>@ConditionalOnResource</h3><p>只有特定的（非 JNDI）资源存在的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnResource(resources = &quot;classpath:example.json&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">ExampleService <span class="title">exampleService</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Creating bean of example json from example.json...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    File file=<span class="keyword">new</span> ClassPathResource(<span class="string">&quot;example.json&quot;</span>, <span class="keyword">this</span>.getClass().getClassLoader()).getFile();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ExampleService(<span class="keyword">new</span> String(Files.readAllBytes(Paths.get(file.toURI()))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConditionalOnSingleCandidate"><a href="#ConditionalOnSingleCandidate" class="headerlink" title="@ConditionalOnSingleCandidate"></a>@ConditionalOnSingleCandidate</h3><p>类似 ConditionalOnBean，但要求全局只有一个 bean，或者可以决策出 primary bean 的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnEnabledInfoContributor(&quot;git&quot;)</span></span><br><span class="line"><span class="meta">@ConditionalOnSingleCandidate(GitProperties.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@Order(DEFAULT_ORDER)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GitInfoContributor <span class="title">gitInfoContributor</span><span class="params">(GitProperties gitProperties)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GitInfoContributor(gitProperties, <span class="keyword">this</span>.properties.getGit().getMode());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ConditionalOnWebApplication"><a href="#ConditionalOnWebApplication" class="headerlink" title="@ConditionalOnWebApplication"></a>@ConditionalOnWebApplication</h3><p>和 @ConditionalOnNotWebApplication 正相反。<br>只有 application context 是一个 web application context 时，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="function">HealthCheckController <span class="title">healthCheckController</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ConditionalOnClass-1"><a href="#ConditionalOnClass-1" class="headerlink" title="@ConditionalOnClass"></a>@ConditionalOnClass</h3><p>只有存在一个特定的类的时候，才会初始化一个 Bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DataSource.class)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQLAutoconfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h2><p>Spring Boot 有个更复杂的属性加载顺序，见<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">《2. Externalized Configuration》</a>：</p>
<ol>
<li>Devtools global settings properties in the $HOME/.config/spring-boot folder when devtools is active.</li>
<li>@TestPropertySource annotations on your tests.</li>
<li>properties attribute on your tests. Available on @SpringBootTest and the test annotations for testing a particular slice of your application.</li>
<li>Command line arguments</li>
<li>Properties from SPRING_APPLICATION_JSON (inline JSON embedded in an environment variable or system property).</li>
<li>ServletConfig init parameters.</li>
<li>ServletContext init parameters.</li>
<li>JNDI attributes from java:comp/env.</li>
<li>Java System properties (System.getProperties()).</li>
<li>OS environment variables.</li>
<li>A RandomValuePropertySource that has properties only in random.*.</li>
<li>Profile-specific application properties outside of your packaged jar (application-{profile}.properties and YAML variants).</li>
<li>Profile-specific application properties packaged inside your jar (application-{profile}.properties and YAML variants).</li>
<li>Application properties outside of your packaged jar (application.properties and YAML variants).</li>
<li>Application properties packaged inside your jar (application.properties and YAML variants).</li>
<li>@PropertySource annotations on your @Configuration classes. Please note that such property sources are not added to the Environment until the application context is being refreshed. This is too late to configure certain properties such as logging.* and spring.main.* which are read before refresh begins.</li>
<li>Default properties (specified by setting SpringApplication.setDefaultProperties).</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;javadoop.database&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBase</span> </span>&#123;</span><br><span class="line">String url;</span><br><span class="line">String username;</span><br><span class="line">String password;</span><br><span class="line"><span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="惰性加载"><a href="#惰性加载" class="headerlink" title="惰性加载"></a>惰性加载</h2><blockquote>
<p>By default, ApplicationContext implementations eagerly create and<br>configure all singleton beans as part of the initialization process.<br>Generally, this pre-instantiation is desirable, because errors in the<br>configuration or surrounding environment are discovered immediately,<br>as opposed to hours or even days later. When this behavior is not<br>desirable, you can prevent pre-instantiation of a singleton bean by<br>marking the bean definition as lazy-initialized. A lazy-initialized<br>bean tells the IoC container to create a bean instance when it is<br>first requested, rather than at startup.</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">lazy-initialization:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="随机值"><a href="#随机值" class="headerlink" title="随机值"></a>随机值</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 由 RandomValuePropertySource 提供</span></span><br><span class="line"><span class="string">random.number=$&#123;random.int&#125;</span></span><br><span class="line"><span class="string">random.long=$&#123;random.long&#125;</span></span><br><span class="line"><span class="string">random.uuid=$&#123;random.uuid&#125;</span></span><br></pre></td></tr></table></figure>


                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2021-09-16");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2020-03-29T15:12:07.000Z" itemprop="datePublished">2020-03-29</time>

    , Updated at&nbsp;<time datetime="2021-09-16T09:46:38.000Z" itemprop="dateModified">2021-09-16</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/Java/" rel="tag">#&nbsp;Java</a>

<a class="post-tags-list-item" href="/tags/JPA/" rel="tag">#&nbsp;JPA</a>

<a class="post-tags-list-item" href="/tags/Spring/" rel="tag">#&nbsp;Spring</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2020/04/01/ThreadLocal-%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">ThreadLocal 的设计模式</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2020/03/29/Mac-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">Mac 使用技巧</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>