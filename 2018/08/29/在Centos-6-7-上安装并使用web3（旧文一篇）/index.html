<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>在Centos 6.7 上安装并使用web3（旧文一篇） | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="在Centos 6.7 上安装并使用web3（旧文一篇） | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="不要使用默认 gcc，会编译安装 web3失败。 12345678910111213sudo yum erase -y gcc gcc-c++ sudo yum install -y centos-release-scl sudo yum install -y devtoolset-3-toolchain scl enable devtoolset-3 bash yum remove -y nod - magicliang - 守株阁"><meta name="keywords" content="区块链, Ethereum"><meta property="article:published_time" content="2018-08-29T05:39:28.000Z"><meta property="article:modified_time" content="2019-09-09T13:35:42.000Z"><meta property="og:updated_time" content="2019-09-09T13:35:42.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="区块链, Ethereum"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/"
    },
    "headline": "在Centos 6.7 上安装并使用web3（旧文一篇） | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2018-08-29T05:39:28.000Z",
    "dateModified": "2019-09-09T13:35:42.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "区块链, Ethereum",
    "description": "不要使用默认 gcc，会编译安装 web3失败。 12345678910111213sudo yum erase -y gcc gcc-c++ sudo yum install -y centos-release-scl sudo yum install -y devtoolset-3-toolchain scl enable devtoolset-3 bash yum remove -y nod - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=在Centos 6.7 上安装并使用web3（旧文一篇）" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=在Centos 6.7 上安装并使用web3（旧文一篇）&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=在Centos 6.7 上安装并使用web3（旧文一篇）" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADkCAAAAACtPNdRAAAEJ0lEQVR42u2bQY7jMAwE/f9P716zC4tdlDOA6ClfMuMkkkqAqSbZuf78gusSUkghhRRSyIeQV3H984X/7n3+//lK76/m+Hy9e6+zbiGFnAp5+9AuJrodbAFGFpnGrTY5rVtIISdDpqCxGmz14K/+TptSzXsHuVq3kEL+BsgquJDgswoid4Gt2lQhhRQyi+nq/UpIU+FOxhdSyDdBpgd95+8EXwUdOs5XshAhhTwMMgWGU1+/Vq0TUsiDIGPTJBzOKcklAYYmxz/W1RJSyIMgU0GKJMcUigjwlCSQ9Qop5HTIZdJ5A7e6V8Gn8WhzN4lzJNCFFHIgZKf4Sw/p9LkkGsj9VuARUsjDIUkzJQUBIrafCoNOcUtIIadD7hgVkkimiTINKp01CCnkRMhqUiqGd00V3WZrp9kjpJDTIdOg1ChBRHgaO2182iwhhZwOWYlhctBXxSlSDEvNpmTKF1LIN0ESQ0RKnGnS+43g1BIrQgo5HLISBqRRmkA78z1NAIQUcipkpzlKjRI4qQUJcQpipVFDSCEHQnaaK0SAd5ur1YamIBgbu0IKORQyGfOSWYIkxR3jBQ10cTwhhRwImQakxSYSfGgiTOZJGyOkkFMh6cNOhHanOUuS6xTkYlNWSCGHQnZEcRLsZINIs4YKE1xcFlLIgZBkwFRw7oh9Wpi64CWkkG+ATGKcCPbUxCXF4pRgE2N+2fARUshhkGRiWsyqNo8EFjpOnFtIIYdCJvN7eo8GLiL2iejYCjxCCjkMsjqA02eeCnQqFtKYQgr5FsjqsCcNnE6hq9q8KsBVBbblGoQUcihkesC7JiLSSCVmh53NRQJdSCEPhkyL6hohqDFiF4Y2moQUcipk93BPBWW6CctgEcRAMlJgMSCkkIdCksM+NXE6xieycFqQjoYnIYV8AWQS4SkIkWZQJyGgc2PFI6SQh0Ompk4S0ythkL5DxT41ND3qagkp5GGQtNlCg1NHCBBTUscwgdwfQgp5OCQxApEDfqd4XAF0BUSr4SOkkIdCdgNJavx0glhXnMck+dr8kaiQQh4ESRs1OyaiTrG4mpcYo5BAF1LIAZAdI+BuYksFBSlebQl0IYUcBEkKWdEUFAx+VfChCfZXsxAhhTwYkhjjU9Cg5gi6GR1z8VYWIqSQB0OSZk4S2tQ43xEcafOR4BBSyKGQpGhMCtFPk2lqmFqNJ6SQb4Okhghy2HeSXGKmSEI/ZiFCCjkE8iquToOHiPNOIWpnE2MWIqSQQyB3hDk1ULSKwQ0DLzIyCSnkYEjywxPSsCEFqh1jfucSUsi3Q6ZCLhEJ3cJYSrpJY0lIId8OSRdDkl9SDCPGiq8HHiGFPASyChbEpEBFOU2OO4HqcdIspJCHQVZCtzI8EFASVJJZkZoclw0fIYUcBPnmS0ghhRRSSCE3r7/qGOF9zQdMJQAAAABJRU5ErkJggg==" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">在Centos 6.7 上安装并使用web3（旧文一篇）</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2018-08-29</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=在Centos 6.7 上安装并使用web3（旧文一篇）&url=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=在Centos 6.7 上安装并使用web3（旧文一篇）&url=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2018/08/29/%E5%9C%A8Centos-6-7-%E4%B8%8A%E5%AE%89%E8%A3%85%E5%B9%B6%E4%BD%BF%E7%94%A8web3%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADkCAAAAACtPNdRAAAEJ0lEQVR42u2bQY7jMAwE/f9P716zC4tdlDOA6ClfMuMkkkqAqSbZuf78gusSUkghhRRSyIeQV3H984X/7n3+//lK76/m+Hy9e6+zbiGFnAp5+9AuJrodbAFGFpnGrTY5rVtIISdDpqCxGmz14K/+TptSzXsHuVq3kEL+BsgquJDgswoid4Gt2lQhhRQyi+nq/UpIU+FOxhdSyDdBpgd95+8EXwUdOs5XshAhhTwMMgWGU1+/Vq0TUsiDIGPTJBzOKcklAYYmxz/W1RJSyIMgU0GKJMcUigjwlCSQ9Qop5HTIZdJ5A7e6V8Gn8WhzN4lzJNCFFHIgZKf4Sw/p9LkkGsj9VuARUsjDIUkzJQUBIrafCoNOcUtIIadD7hgVkkimiTINKp01CCnkRMhqUiqGd00V3WZrp9kjpJDTIdOg1ChBRHgaO2182iwhhZwOWYlhctBXxSlSDEvNpmTKF1LIN0ESQ0RKnGnS+43g1BIrQgo5HLISBqRRmkA78z1NAIQUcipkpzlKjRI4qQUJcQpipVFDSCEHQnaaK0SAd5ur1YamIBgbu0IKORQyGfOSWYIkxR3jBQ10cTwhhRwImQakxSYSfGgiTOZJGyOkkFMh6cNOhHanOUuS6xTkYlNWSCGHQnZEcRLsZINIs4YKE1xcFlLIgZBkwFRw7oh9Wpi64CWkkG+ATGKcCPbUxCXF4pRgE2N+2fARUshhkGRiWsyqNo8EFjpOnFtIIYdCJvN7eo8GLiL2iejYCjxCCjkMsjqA02eeCnQqFtKYQgr5FsjqsCcNnE6hq9q8KsBVBbblGoQUcihkesC7JiLSSCVmh53NRQJdSCEPhkyL6hohqDFiF4Y2moQUcipk93BPBWW6CctgEcRAMlJgMSCkkIdCksM+NXE6xieycFqQjoYnIYV8AWQS4SkIkWZQJyGgc2PFI6SQh0Ompk4S0ythkL5DxT41ND3qagkp5GGQtNlCg1NHCBBTUscwgdwfQgp5OCQxApEDfqd4XAF0BUSr4SOkkIdCdgNJavx0glhXnMck+dr8kaiQQh4ESRs1OyaiTrG4mpcYo5BAF1LIAZAdI+BuYksFBSlebQl0IYUcBEkKWdEUFAx+VfChCfZXsxAhhTwYkhjjU9Cg5gi6GR1z8VYWIqSQB0OSZk4S2tQ43xEcafOR4BBSyKGQpGhMCtFPk2lqmFqNJ6SQb4Okhghy2HeSXGKmSEI/ZiFCCjkE8iquToOHiPNOIWpnE2MWIqSQQyB3hDk1ULSKwQ0DLzIyCSnkYEjywxPSsCEFqh1jfucSUsi3Q6ZCLhEJ3cJYSrpJY0lIId8OSRdDkl9SDCPGiq8HHiGFPASyChbEpEBFOU2OO4HqcdIspJCHQVZCtzI8EFASVJJZkZoclw0fIYUcBPnmS0ghhRRSSCE3r7/qGOF9zQdMJQAAAABJRU5ErkJggg==" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                    
                    <article id="post-content">
                        <p>不要使用默认 gcc，会编译安装 web3失败。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sudo yum erase -y gcc gcc-c++</span><br><span class="line"> </span><br><span class="line">sudo yum install -y centos-release-scl</span><br><span class="line"> </span><br><span class="line">sudo yum install -y devtoolset-3-toolchain</span><br><span class="line"> </span><br><span class="line">scl <span class="built_in">enable</span> devtoolset-3 bash</span><br><span class="line"> </span><br><span class="line">yum remove -y nodejs</span><br><span class="line"> </span><br><span class="line">curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -</span><br><span class="line"> </span><br><span class="line">sudo yum -y install nodejs</span><br></pre></td></tr></table></figure>

<p>不能使用全局安装，要尽量本地安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir calc-node</span><br><span class="line">npm init</span><br><span class="line">npm install web3</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 照理来说这样也应该 work，但就是不 work</span></span><br><span class="line">npm install -g web3 --unsafe-perm=<span class="literal">true</span> --allow-root</span><br></pre></td></tr></table></figure>

<p>web3 本身是一系列 nodejs 模块的集合，包括但不限于</p>
<ol>
<li>web3-eth 针对以太坊区块链和智能合约</li>
<li>web3-shh 针对耳语协议在 p2p 网络中的通信和广播</li>
<li>The web3-bzz 针对 swarm 协议，去中心化的存储</li>
<li>The web3-utils 针对 Dapp 的有用的功能</li>
</ol>
<p>在 nodejs 中引入和初始化 web3 对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Web3 = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>);</span><br><span class="line"><span class="comment">// 用两种端口初始化 web3 对象</span></span><br><span class="line"><span class="keyword">var</span> web3 = <span class="keyword">new</span> Web3(Web3.givenProvider || <span class="string">&quot;ws://localhost:8546&quot;</span>);#默认节点只有 ws 才支持发布和订阅</span><br><span class="line">web3 = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">&quot;http://localhost:8545&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>要使用的智能合约：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.15</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">contract Calc &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 合约的创建者,可以在外部调用 owner() 来获取当前合约的创建者 */</span></span><br><span class="line">    address public owner;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 区块链存储 */</span></span><br><span class="line">    uint public count;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* Event 是基于 log 的，写 event 类似于 写 log，外部的观察者通过过滤日志来读取事件 */</span></span><br><span class="line">    event AddEvent(address indexed <span class="keyword">from</span>, address transactionSender, uint a, uint b, uint256 result);</span><br><span class="line">  </span><br><span class="line">    event CountEvent(address indexed <span class="keyword">from</span>, address transactionSender, uint result);</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// This contract only defines a modifier but does not use</span></span><br><span class="line">    <span class="comment">// it - it will be used in derived contracts.</span></span><br><span class="line">    <span class="comment">// The function body is inserted where the special symbol</span></span><br><span class="line">    <span class="comment">// &quot;_;&quot; in the definition of a modifier appears.</span></span><br><span class="line">    <span class="comment">// This means that if the owner calls this function, the</span></span><br><span class="line">    <span class="comment">// function is executed and otherwise, an exception is</span></span><br><span class="line">    <span class="comment">// thrown.</span></span><br><span class="line">    modifier onlyOwner &#123;</span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 构造函数的写法 */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Calc</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123; owner = msg.sender; &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 执行会写入数据，所以需要`transaction`的方式执行。 */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">uint a, uint b</span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        count++;</span><br><span class="line">        uint c = realAdd(a, b);</span><br><span class="line">        AddEvent(</span><br><span class="line">            owner,</span><br><span class="line">            msg.sender,</span><br><span class="line">            a,</span><br><span class="line">            b,</span><br><span class="line">            c</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 只有高版本的编译器才支持 pure 函数，这个 Vscode 插件不支持 */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">realAdd</span>(<span class="params">uint a, uint b</span>) <span class="title">public</span> <span class="title">pure</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 执行不会写入数据，所以允许`call`的方式执行。 因为去掉了 constant 修饰符，所以这不再是个会引起警告的 view 方法了。*/</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getCount</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 下一个返回值是给函数之间调用用的，要给外部的接口调用只好用 Event。</span></span><br><span class="line">        CountEvent(owner, msg.sender, count);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一些基本操作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调和 promise 串联</span></span><br><span class="line">web3.eth.sendTransaction(&#123;<span class="attr">from</span>: <span class="string">&#x27;0x123...&#x27;</span>, <span class="attr">data</span>: <span class="string">&#x27;0x432...&#x27;</span>&#125;)</span><br><span class="line">.once(<span class="string">&#x27;transactionHash&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">hash</span>)</span>&#123; ... &#125;)</span><br><span class="line">.once(<span class="string">&#x27;receipt&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>)</span>&#123; ... &#125;)</span><br><span class="line">.on(<span class="string">&#x27;confirmation&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">confNumber, receipt</span>)</span>&#123; ... &#125;)</span><br><span class="line">.on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123; ... &#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// will be fired once the receipt its mined</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 批量操作</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">new</span> web3.BatchRequest()</span><br><span class="line"><span class="keyword">new</span> web3.eth.BatchRequest()</span><br><span class="line"><span class="keyword">new</span> web3.shh.BatchRequest()</span><br><span class="line"><span class="keyword">new</span> web3.bzz.BatchRequest()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> batch = <span class="keyword">new</span> web3.BatchRequest();</span><br><span class="line">batch.add(web3.eth.getBalance.request(<span class="string">&#x27;0x0000000000000000000000000000000000000000&#x27;</span>, <span class="string">&#x27;latest&#x27;</span>, callback));</span><br><span class="line">batch.add(contract.methods.balance(address).call.request(&#123;<span class="attr">from</span>: <span class="string">&#x27;0x0000000000000000000000000000000000000000&#x27;</span>&#125;, callback2));</span><br><span class="line">batch.execute();</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取特定的区块</span></span><br><span class="line">web3.eth.getBlock(<span class="string">&quot;12&quot;</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">block</span>)</span>&#123;<span class="built_in">console</span>.log(block)&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取所有的账户信息</span></span><br><span class="line">web3.eth.personal.getAccounts().then(<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;<span class="built_in">console</span>.log(a)&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取 coinbase（暂时不 work）</span></span><br><span class="line">web3.eth.coinbase</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取账户里的钱包（暂时不 work）</span></span><br><span class="line">web3.eth.accounts</span><br><span class="line">web3.eth.accounts.wallet</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 如果缺省的账户不存在，那么发送交易的时候就要显式指定 from 了</span></span><br><span class="line">web3.eth.defaultAccount;</span><br><span class="line">&gt; <span class="literal">undefined</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 用当前钱包的值设给 defaultAccount，这样 sendTransaction 和 call 就有默认的付账地址了</span></span><br><span class="line">  web3.eth.defaultAccount = <span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取默认的区块</span></span><br><span class="line">&gt; web3.eth.defaultBlock</span><br><span class="line"><span class="string">&#x27;latest&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取当前协议版本</span></span><br><span class="line">web3.eth.getProtocolVersion().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 查看当前是否同步了</span></span><br><span class="line">web3.eth.isSyncing().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获得 coinbase</span></span><br><span class="line">web3.eth.getCoinbase().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 当前是否挖矿</span></span><br><span class="line">web3.eth.isMining().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取当前的 gasprice</span></span><br><span class="line">web3.eth.getGasPrice().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取当前节点控制的所有账户</span></span><br><span class="line">web3.eth.getAccounts().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取当前的最晚块</span></span><br><span class="line">web3.eth.getBlockNumber().then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取某个账户的余额</span></span><br><span class="line">web3.eth.getBalance(<span class="string">&quot;bbb&quot;</span>).then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 获取某个事务的具体信息</span></span><br><span class="line">web3.eth.getTransaction(<span class="string">&#x27;0x9fc76417374aa880d4449a1f7f31ec597f00b1f6f3dd2d66f4c9c6c445836d8b§234&#x27;</span>).then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用 call 的方式在当前 VM 下执行代码，但并不写进区块里。</span></span><br><span class="line">web3.eth.call(&#123;</span><br><span class="line">    <span class="attr">to</span>: <span class="string">&quot;0x11f4d0A3c12e86B4b5F39B213F7E19D048276DAe&quot;</span>, <span class="comment">// contract address</span></span><br><span class="line">    <span class="attr">data</span>: <span class="string">&quot;0xc6888fa10000000000000000000000000000000000000000000000000000000000000003&quot;</span></span><br><span class="line">&#125;).then(<span class="built_in">console</span>.log);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 合约相关</span></span><br><span class="line"><span class="keyword">var</span> myContract = <span class="keyword">new</span> web3.eth.Contract([...], <span class="string">&#x27;0xde0B295669a9FD93d5F28D9Ec85E40f4cb697BAe&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">from</span>: <span class="string">&#x27;0x1234567890123456789012345678901234567891&#x27;</span>, <span class="comment">// default from address</span></span><br><span class="line">    <span class="attr">gasPrice</span>: <span class="string">&#x27;20000000000&#x27;</span> <span class="comment">// default gas price in wei, 20 gwei in this case</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 修改默认的值</span></span><br><span class="line">myContract.options.from = <span class="string">&#x27;0x1234567890123456789012345678901234567891&#x27;</span>; <span class="comment">// default from address</span></span><br><span class="line">myContract.options.gasPrice = <span class="string">&#x27;20000000000000&#x27;</span>; <span class="comment">// default gas price in wei</span></span><br><span class="line">myContract.options.gas = <span class="number">5000000</span>; <span class="comment">// provide as fallback always 5M gas</span></span><br></pre></td></tr></table></figure>

<p>Calc 的相关 abi 和地址,并以此产生合约调用 ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Web3 = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> web3 = <span class="keyword">new</span> Web3(Web3.givenProvider || <span class="string">&quot;ws://localhost:8546&quot;</span>);</span><br><span class="line"> </span><br><span class="line">web3.eth.defaultAccount = <span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// truffle 生成的 abi 和地址对。这个 abi 生成的 getCount签名是错的，慎用。</span></span><br><span class="line"><span class="keyword">var</span> abi = [&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;count&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;add&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>,<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;]&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;getCount&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>,<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>,<span class="string">&quot;constant&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;realAdd&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;]&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;EventSendCoin&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;constructor&quot;</span>,<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;addEvent&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;event&quot;</span>&#125;]</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> address = <span class="string">&#x27;&quot;0x46a0efeda982381e8a6d75b9b3d25cabcd6b16e9&quot;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// solcjs 生成的编译结果</span></span><br><span class="line"><span class="keyword">var</span> code = <span class="string">&#x27;0x6060604052341561000f57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061038a8061005e6000396000f30060606040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306661abd14610072578063771602f71461009b5780638da5cb5b146100db578063a87d942c14610130578063e752be4e14610159575b600080fd5b341561007d57600080fd5b610085610199565b6040518082815260200191505060405180910390f35b34156100a657600080fd5b6100c5600480803590602001909190803590602001909190505061019f565b6040518082815260200191505060405180910390f35b34156100e657600080fd5b6100ee61027d565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561013b57600080fd5b6101436102a2565b6040518082815260200191505060405180910390f35b341561016457600080fd5b6101836004808035906020019091908035906020019091905050610351565b6040518082815260200191505060405180910390f35b60015481565b6000806001600081548092919060010191905055506101be8484610351565b90506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fbcc141744793f7e93083ceb1e4a61664d4a6428dadf6db4d2e8b1a162d0582b233868685604051808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200184815260200183815260200182815260200194505050505060405180910390a28091505092915050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fd54b813e36aaac7612686fa27ef81917785024960e408194ccaeb6b17926cecc33600154604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a2600154905090565b60008183019050929150505600a165627a7a72305820d297e7e10c1b3d3f05cad089467287d5315e1957fe323040bcdea71f4eed65ad0029&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> abi = [&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;count&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;add&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;getCount&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;realAdd&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;pure&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;constructor&quot;</span>&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;from&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;AddEvent&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;event&quot;</span>&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;from&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;CountEvent&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;event&quot;</span>&#125;];</span><br><span class="line"><span class="comment">// 安装还需要这个，注意，这段不能在 web3里执行。</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">myContract = eth.contract(abi)</span></span><br><span class="line"><span class="comment">contract = myContract.new(&#123;from:eth.accounts[0],data:code,gas:1000000&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 当前合约的地址</span></span><br><span class="line"><span class="keyword">var</span> address = <span class="string">&#x27;0x980e5451d2bd9c524e33f543af81b14e787488ef&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 用这对数据生成合约</span></span><br><span class="line"><span class="keyword">var</span> myContract = <span class="keyword">new</span> web3.eth.Contract(abi, address, &#123;</span><br><span class="line">  <span class="attr">from</span>: <span class="string">&#x27;bbb&#x27;</span>,</span><br><span class="line">  <span class="attr">gasPrice</span>: <span class="string">&#x27;1&#x27;</span> <span class="comment">// default gas price in wei, 20 gwei in this case</span></span><br><span class="line">&#125;);</span><br><span class="line">myContract.options.from = <span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//调用合约的例子</span></span><br><span class="line">myContract.methods.add(<span class="number">1</span>, <span class="number">2</span>).call(&#123; <span class="attr">from</span>: web3.eth.defaultAccount&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;<span class="built_in">console</span>.log(error);<span class="built_in">console</span>.log(result)&#125;)</span><br><span class="line">myContract.methods.add(<span class="number">1</span>, <span class="number">2</span>).send(&#123; <span class="attr">from</span>: web3.eth.defaultAccount&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;<span class="built_in">console</span>.log(error);<span class="built_in">console</span>.log(result)&#125;)</span><br><span class="line">myContract.methods.add(<span class="number">1</span>, <span class="number">2</span>).call(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;<span class="built_in">console</span>.log(error);<span class="built_in">console</span>.log(result)&#125;)</span><br><span class="line">myContract.methods.owner().call(&#123; <span class="attr">from</span>: <span class="string">&#x27;bbb&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;<span class="built_in">console</span>.log(error);<span class="built_in">console</span>.log(result)&#125;)</span><br><span class="line">myContract.methods.getCount().call(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;<span class="built_in">console</span>.log(error);<span class="built_in">console</span>.log(result)&#125;)</span><br><span class="line"><span class="comment">//所有的 call 都可以变成 send 版本。单纯的 call add 不会增加 count，但 send add 增加的 count 可以被 call getCount 读出来</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 相关的事件监听</span></span><br><span class="line">myContract.events.AddEvent(&#123;</span><br><span class="line">    <span class="attr">filter</span>: &#123;<span class="attr">from</span>: web3.eth.defaultAccount&#125;,</span><br><span class="line">    <span class="attr">fromBlock</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">toBlock</span>: <span class="string">&#x27;latest&#x27;</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!error) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;the error is: &#x27;</span> + error)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;the result is: &#x27;</span> + e.returnValues.result)</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;).on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">     <span class="comment">// 这个 e 和前一个回调里的 e 是一样的</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;the result is: &#x27;</span> + e.returnValues.result)</span><br><span class="line">&#125;).on(<span class="string">&#x27;changed&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;inside the changed callback: &#x27;</span> + e);</span><br><span class="line">&#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="built_in">console</span>.error);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//打出所有的相关事件和事务处理结果</span></span><br><span class="line">myContract.methods.add(<span class="number">1</span>, <span class="number">2</span>).send(&#123; <span class="attr">from</span>: web3.eth.defaultAccount&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, result</span>)</span>&#123;<span class="built_in">console</span>.log(result)&#125;).on(<span class="string">&#x27;transactionHash&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">hash</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;on transactionHash: &#x27;</span> + hash);</span><br><span class="line">&#125;).on(<span class="string">&#x27;confirmation&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">confirmationNumber, receipt</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//console.log(&#x27;confirmationNumber: &#x27; + confirmationNumber);</span></span><br><span class="line">    <span class="comment">//console.log(&#x27;receipt: &#x27; + JSON.stringify(receipt));</span></span><br><span class="line">&#125;).on(<span class="string">&#x27;receipt&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;receipt: &#x27;</span> + <span class="built_in">JSON</span>.stringify(receipt));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;result is:&#x27;</span> + receipt.events.AddEvent.returnValues.result)</span><br><span class="line">&#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="built_in">console</span>.error);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//获取所有历史事件</span></span><br><span class="line">myContract.getPastEvents(<span class="string">&#x27;AddEvent&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">fromBlock</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">toBlock</span>: <span class="string">&#x27;latest&#x27;</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error, events</span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">&#x27;events are: &#x27;</span> + events); &#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">events</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;inside then: &quot;</span> + events) <span class="comment">// same results as the optional callback above</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>最终版本的 calc-node.js: </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> Web3 = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> Web3(Web3.givenProvider || <span class="string">&quot;ws://localhost:8546&quot;</span>);</span><br><span class="line">  </span><br><span class="line">web3.eth.defaultAccount = <span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> code = <span class="string">&#x27;0x6060604052341561000f57600080fd5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061038a8061005e6000396000f30060606040526004361061006d576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306661abd14610072578063771602f71461009b5780638da5cb5b146100db578063a87d942c14610130578063e752be4e14610159575b600080fd5b341561007d57600080fd5b610085610199565b6040518082815260200191505060405180910390f35b34156100a657600080fd5b6100c5600480803590602001909190803590602001909190505061019f565b6040518082815260200191505060405180910390f35b34156100e657600080fd5b6100ee61027d565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561013b57600080fd5b6101436102a2565b6040518082815260200191505060405180910390f35b341561016457600080fd5b6101836004808035906020019091908035906020019091905050610351565b6040518082815260200191505060405180910390f35b60015481565b6000806001600081548092919060010191905055506101be8484610351565b90506000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fbcc141744793f7e93083ceb1e4a61664d4a6428dadf6db4d2e8b1a162d0582b233868685604051808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200184815260200183815260200182815260200194505050505060405180910390a28091505092915050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fd54b813e36aaac7612686fa27ef81917785024960e408194ccaeb6b17926cecc33600154604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a2600154905090565b60008183019050929150505600a165627a7a72305820d297e7e10c1b3d3f05cad089467287d5315e1957fe323040bcdea71f4eed65ad0029&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> abi = [&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;count&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;add&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;getCount&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;constant&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;realAdd&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;pure&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;payable&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;constructor&quot;</span>&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;from&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;b&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;AddEvent&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;event&quot;</span>&#125;,&#123;<span class="string">&quot;anonymous&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;from&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;transactionSender&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;,&#123;<span class="string">&quot;indexed&quot;</span>:<span class="literal">false</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;result&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;CountEvent&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;event&quot;</span>&#125;];</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">myContract = eth.contract(abi)</span></span><br><span class="line"><span class="comment">contract = myContract.new(&#123;from:eth.accounts[0],data:code,gas:1000000&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> address = <span class="string">&#x27;0x980e5451d2bd9c524e33f543af81b14e787488ef&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> myContract = <span class="keyword">new</span> web3.eth.Contract(abi, address, &#123;</span><br><span class="line">  <span class="attr">from</span>: web3.eth.defaultAccount,</span><br><span class="line">  <span class="attr">gasPrice</span>: <span class="string">&#x27;1&#x27;</span> <span class="comment">// default gas price in wei, 20 gwei in this case</span></span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> log = <span class="built_in">console</span>.log;</span><br><span class="line"><span class="keyword">const</span> error = <span class="built_in">console</span>.error;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 相关的事件监听。注意，这是个事件扫描器，所以在安装上去的那一刻，它会先把所有历史数据都扫出来。</span></span><br><span class="line"><span class="comment">//myContract.events.AddEvent(&#123;</span></span><br><span class="line"><span class="comment">//    filter: &#123;from: web3.eth.defaultAccount&#125;,</span></span><br><span class="line"><span class="comment">//    fromBlock: 0,</span></span><br><span class="line"><span class="comment">//    toBlock: &#x27;latest&#x27;</span></span><br><span class="line"><span class="comment">//&#125;, function(error, e)&#123;</span></span><br><span class="line"><span class="comment">//  if(!error) &#123;</span></span><br><span class="line"><span class="comment">//    console.log(&#x27;the error is: &#x27; + error)</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//  if(!e) &#123;</span></span><br><span class="line"><span class="comment">//    console.log(&#x27;the result is: &#x27; + e.returnValues.result)</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">// &#125;).on(&#x27;data&#x27;, function(e)&#123;</span></span><br><span class="line">  <span class="comment">// 这个 e 和前一个回调里的 e 是一样的</span></span><br><span class="line"><span class="comment">//  console.log(&#x27;the result is: &#x27; + e.returnValues.result)</span></span><br><span class="line"><span class="comment">//&#125;).on(&#x27;changed&#x27;, function(e)&#123;</span></span><br><span class="line"><span class="comment">//    console.log(&#x27;inside the changed callback: &#x27; + e);</span></span><br><span class="line"><span class="comment">//&#125;).on(&#x27;error&#x27;, console.error);</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//myContract.methods.add(1, 2).call(&#123; from: web3.eth.defaultAccount&#125;, function(error, result)&#123;console.log(error);console.log(result)&#125;);</span></span><br><span class="line"><span class="comment">//myContract.methods.add(1, 2).send(&#123; from: web3.eth.defaultAccount&#125;, function(error, result)&#123;console.log(error);console.log(result)&#125;);</span></span><br><span class="line"> </span><br><span class="line">web3.eth.personal.unlockAccount(web3.eth.defaultAccount, <span class="string">&#x27;123456&#x27;</span>, <span class="number">0</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> finalResult = <span class="keyword">await</span> myContract.methods.add(<span class="number">1</span>, <span class="number">2</span>).send(&#123; <span class="attr">from</span>: web3.eth.defaultAccount&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> result = receipt.events.AddEvent.returnValues.result;</span><br><span class="line">      log(<span class="string">&#x27;add result is: &#x27;</span> + result);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> finalResult;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> finalResult = <span class="keyword">await</span> myContract.methods.getCount().send(&#123; <span class="attr">from</span>: web3.eth.defaultAccount&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">receipt</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> result = receipt.events.CountEvent.returnValues.result;</span><br><span class="line">      log(<span class="string">&#x27;count result is: &#x27;</span> + result);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> finalResult;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// x-response-time</span></span><br><span class="line"> </span><br><span class="line">  app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">    <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start;</span><br><span class="line">    ctx.set(<span class="string">&#x27;X-Response-Time&#x27;</span>, <span class="string">`<span class="subst">$&#123;ms&#125;</span>ms`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// logger</span></span><br><span class="line">  </span><br><span class="line">  app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">    <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start;</span><br><span class="line">    log(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;ms&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// response</span></span><br><span class="line"> </span><br><span class="line">  app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">    ctx.body = <span class="string">&#x27;Hello World: &#x27;</span> + <span class="keyword">await</span> add(<span class="number">1</span>, <span class="number">2</span>) + <span class="string">&#x27;, Count is: &#x27;</span> + <span class="keyword">await</span> getCount();</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  app.listen(<span class="number">3000</span>);</span><br><span class="line"> </span><br><span class="line">  app.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">    error(<span class="string">&#x27;server error&#x27;</span>, err, ctx)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>用一下命令来nohup 执行脚本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup node calc-node.js node.log&amp;</span><br></pre></td></tr></table></figure>

<p>需要使用的 package.json:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;calc-node&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;calc-node.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;koa&quot;</span>: <span class="string">&quot;^2.4.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;web3&quot;</span>: <span class="string">&quot;^1.0.0-beta.24&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;koa-router&quot;</span>: <span class="string">&quot;^7.3.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用 ab 进行 benchmark:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 并发数量一次发30个请求，一共发100个</span></span><br><span class="line">ab -c 30 -n 100 http://lan-consul-dev2:3000/</span><br><span class="line"> </span><br><span class="line"><span class="comment">#一个测试结果</span></span><br><span class="line">$ ab -c 1000 -n 1000 http://lan-consul-dev2:3000/</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">This is ApacheBench, Version 2.3 &lt;<span class="variable">$Revision</span>: 1757674 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"> </span><br><span class="line">Benchmarking lan-consul-dev2 (be patient)</span><br><span class="line">Completed 100 requests</span><br><span class="line">Completed 200 requests</span><br><span class="line">Completed 300 requests</span><br><span class="line">Completed 400 requests</span><br><span class="line">Completed 500 requests</span><br><span class="line">Completed 600 requests</span><br><span class="line">Completed 700 requests</span><br><span class="line">Completed 800 requests</span><br><span class="line">Completed 900 requests</span><br><span class="line">Completed 1000 requests</span><br><span class="line">Finished 1000 requests</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">Server Software:</span><br><span class="line">Server Hostname:        lan-consul-dev2</span><br><span class="line">Server Port:            3000</span><br><span class="line"> </span><br><span class="line">Document Path:          /</span><br><span class="line">Document Length:        14 bytes</span><br><span class="line"> </span><br><span class="line">Concurrency Level:      1000</span><br><span class="line">Time taken <span class="keyword">for</span> tests:   55.854 seconds</span><br><span class="line">Complete requests:      1000</span><br><span class="line">Failed requests:        0</span><br><span class="line">Total transferred:      176000 bytes</span><br><span class="line">HTML transferred:       14000 bytes</span><br><span class="line">Requests per second:    17.90 [<span class="comment">#/sec] (mean)</span></span><br><span class="line">Time per request:       55853.763 [ms] (mean)</span><br><span class="line">Time per request:       55.854 [ms] (mean, across all concurrent requests)</span><br><span class="line">Transfer rate:          3.08 [Kbytes/sec] received</span><br><span class="line"> </span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:       20  107  55.5    101     209</span><br><span class="line">Processing: 14015 38377 13924.0  41754   55628</span><br><span class="line">Waiting:    14014 38377 13924.1  41753   55628</span><br><span class="line">Total:      14213 38484 13870.7  41842   55677</span><br><span class="line"> </span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%  41842</span><br><span class="line">  66%  49023</span><br><span class="line">  75%  49181</span><br><span class="line">  80%  52633</span><br><span class="line">  90%  52716</span><br><span class="line">  95%  55616</span><br><span class="line">  98%  55634</span><br><span class="line">  99%  55645</span><br><span class="line"> 100%  55677 (longest request)</span><br></pre></td></tr></table></figure>


<p>运维须知：</p>
<p>要千万小心，重启了 node 节点以后，要重新 unlock account，不然还是连不上。koa 应用程序不需要重启。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab -n 3000 -c 3000 http://blockchain-02:3000/api/v1/insurance-order/mobileNo/28</span><br><span class="line">ab -n 3000 -c 3000 http://10.95.178.155:3000/api/v1/insurance-order/mobileNo/28</span><br></pre></td></tr></table></figure>
                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2019-09-09");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2018-08-29T05:39:28.000Z" itemprop="datePublished">2018-08-29</time>

    , Updated at&nbsp;<time datetime="2019-09-09T13:35:42.000Z" itemprop="dateModified">2019-09-09</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">#&nbsp;区块链</a>

<a class="post-tags-list-item" href="/tags/Ethereum/" rel="tag">#&nbsp;Ethereum</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2018/08/29/%E5%9C%A8%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%BD%91%E7%BB%9C%E4%B8%8A%E4%BD%BF%E7%94%A8%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-solidity%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">在以太坊网络上使用智能合约 solidity（旧文一篇）</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2018/08/29/%E5%9C%A8CentOS-6-7%E4%B8%8A%E7%94%A8-geth-%E6%90%AD%E5%BB%BA%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%A7%81%E9%93%BE%E7%BD%91%E7%BB%9C%E7%9A%84%E5%85%A8%E9%83%A8%E6%AD%A5%E9%AA%A4%EF%BC%88%E6%97%A7%E6%96%87%E4%B8%80%E7%AF%87%EF%BC%89/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">在CentOS 6.7上用 geth 搭建以太坊私链网络的全部步骤（旧文一篇）</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>