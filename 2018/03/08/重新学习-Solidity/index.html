<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>é‡æ–°å­¦ä¹  Solidity | å®ˆæ ªé˜</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ä»¥ä¸‹å†…å®¹è¿˜æ˜¯ä» Solidity æ–‡æ¡£é‡Œæ‘˜å‡ºæ¥çš„ã€‚ æ™ºèƒ½åˆçº¦å…¥é—¨&#x2F;ä»‹ç» ç¬¬ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ 12345678910111213pragma solidity ^0.4.0;contract SimpleStorage &#123;    uint storedData;    function set(uint x) public &#123;        storedData &#x3D; x;    &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="é‡æ–°å­¦ä¹  Solidity">
<meta property="og:url" content="https://magicliang.github.io/2018/03/08/%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0-Solidity/index.html">
<meta property="og:site_name" content="å®ˆæ ªé˜">
<meta property="og:description" content="ä»¥ä¸‹å†…å®¹è¿˜æ˜¯ä» Solidity æ–‡æ¡£é‡Œæ‘˜å‡ºæ¥çš„ã€‚ æ™ºèƒ½åˆçº¦å…¥é—¨&#x2F;ä»‹ç» ç¬¬ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­ 12345678910111213pragma solidity ^0.4.0;contract SimpleStorage &#123;    uint storedData;    function set(uint x) public &#123;        storedData &#x3D; x;    &amp;">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/img/wall-paper-11.jpg">
<meta property="article:published_time" content="2018-03-08T08:25:00.000Z">
<meta property="article:modified_time" content="2026-01-24T07:32:06.480Z">
<meta property="article:author" content="magicliang">
<meta property="article:tag" content="Ethereum">
<meta property="article:tag" content="åŒºå—é“¾">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/img/wall-paper-11.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "é‡æ–°å­¦ä¹  Solidity",
  "url": "https://magicliang.github.io/2018/03/08/%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0-Solidity/",
  "image": "https://magicliang.github.io/img/wall-paper-11.jpg",
  "datePublished": "2018-03-08T08:25:00.000Z",
  "dateModified": "2026-01-24T07:32:06.480Z",
  "author": [
    {
      "@type": "Person",
      "name": "magicliang",
      "url": "https://magicliang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/2018/03/08/%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0-Solidity/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: å®ˆæ ªé˜","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'é‡æ–°å­¦ä¹  Solidity',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="å®ˆæ ªé˜" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/wall-paper-11.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å®ˆæ ªé˜</span></a><a class="nav-page-title" href="/"><span class="site-name">é‡æ–°å­¦ä¹  Solidity</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">é‡æ–°å­¦ä¹  Solidity</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-03-08T08:25:00.000Z" title="Created 2018-03-08 16:25:00">2018-03-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-01-24T07:32:06.480Z" title="Updated 2026-01-24 15:32:06">2026-01-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">20.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>87mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>ä»¥ä¸‹å†…å®¹è¿˜æ˜¯ä» Solidity æ–‡æ¡£é‡Œæ‘˜å‡ºæ¥çš„ã€‚</p>
<h2 id="æ™ºèƒ½åˆçº¦å…¥é—¨-ä»‹ç»">æ™ºèƒ½åˆçº¦å…¥é—¨/ä»‹ç»</h2>
<h3 id="ç¬¬ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­">ç¬¬ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascripts">pragma solidity ^0.4.0;<br><br>contract SimpleStorage &#123;<br>    uint storedData;<br><br>    function set(uint x) public &#123;<br>        storedData = x;<br>    &#125;<br><br>    function get() public constant returns (uint) &#123;<br>        return storedData;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸€ä¸ª contract å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç±»å‹ã€‚<br>
é»˜è®¤çš„ unint å°±æ˜¯256ä½çš„ã€‚<br>
storedData å¯ä»¥è¢«è®¤ä¸ºæ˜¯ state variableï¼ŒçŠ¶æ€å˜é‡ã€‚åœ¨ Solidity çš„æ¦‚å¿µé‡Œé¢ï¼Œè¿™ä¸ªä¸œè¥¿å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ•°æ®åº“é‡Œé¢çš„ä¸€ä¸ªæ§½ï¼Œå¯ä»¥è¢«å‡½æ•°æŸ¥è¯¢å’Œä¿®æ”¹ã€‚æ³¨æ„çœ‹å®ƒä¸æ˜¯ public çš„ï¼Œæ‰€ä»¥æ²¡æœ‰åˆæˆæ–¹æ³•ã€‚</p>
<p>è®¿é—®çŠ¶æ€å˜é‡ä¸éœ€è¦ç”¨ thiså‰ç¼€ï¼ˆåœ¨ä»€ä¹ˆ scope ä¸‹éƒ½ä¸éœ€è¦å—ï¼Ÿï¼‰ã€‚</p>
<p>è¿™ä¸ªä¾‹å­æ²¡æœ‰é™åˆ¶ä»»ä½•å…¶ä»–äººè°ƒç”¨ä¿®æ”¹çŠ¶æ€å˜é‡çš„æ–¹æ³•ã€‚</p>
<h3 id="å­è´§å¸çš„ä¾‹å­">å­è´§å¸çš„ä¾‹å­</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract <span class="hljs-title class_">Coin</span> &#123;<br>    <span class="hljs-comment">// The keyword &quot;public&quot; makes those variables</span><br>    <span class="hljs-comment">// readable from outside.</span><br>    address public minter;<br>    <span class="hljs-title function_">mapping</span> (<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> uint) public balances;<br><br>    <span class="hljs-comment">// Events allow light clients to react on</span><br>    <span class="hljs-comment">// changes efficiently.</span><br>    event <span class="hljs-title class_">Sent</span>(address <span class="hljs-keyword">from</span>, address to, uint amount);<br><br>    <span class="hljs-comment">// This is the constructor whose code is</span><br>    <span class="hljs-comment">// run only when the contract is created.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Coin</span>(<span class="hljs-params"></span>) public &#123;<br>        minter = msg.<span class="hljs-property">sender</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">mint</span>(<span class="hljs-params">address receiver, uint amount</span>) public &#123;<br>        <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">sender</span> != minter) <span class="hljs-keyword">return</span>;<br>        balances[receiver] += amount;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">address receiver, uint amount</span>) public &#123;<br>        <span class="hljs-keyword">if</span> (balances[msg.<span class="hljs-property">sender</span>] &lt; amount) <span class="hljs-keyword">return</span>;<br>        balances[msg.<span class="hljs-property">sender</span>] -= amount;<br>        balances[receiver] += amount;<br>        <span class="hljs-title class_">Sent</span>(msg.<span class="hljs-property">sender</span>, receiver, amount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>address æ˜¯160ä½çš„ç±»å‹ï¼ˆé—®ï¼šä¸ºä»€ä¹ˆä¸æ˜¯2çš„æ•´æ•°æ¬¡å¹‚ï¼Ÿå¦‚ä½•ï¼‰ã€‚å¯ä»¥ç”¨æ¥å­˜å‚¨åˆçº¦åœ°å€æˆ–è€…å±äºå¤–éƒ¨äººçš„é’¥åŒ™å¯¹ï¼ˆæ‰€è°“çš„ msg.senderï¼Ÿï¼‰ã€‚public å…³é”®å­—ä¼šè®©ç¼–è¯‘å™¨è‡ªåŠ¨å¸®å¿™ç”Ÿæˆä¸€ä¸ªè®¿é—®å™¨å‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">minter</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">returns</span> (address) &#123; <span class="hljs-keyword">return</span> minter; &#125;<br></code></pre></td></tr></table></figure>
<p>è€Œ<code>mapping (address =&gt; uint) public balances</code>åˆ›é€ äº†ä¸€ä¸ªå…¬å…±çŠ¶æ€å˜é‡ï¼Œç”¨ hash è¡¨çš„å½¢å¼æ¥æŠŠåœ°å€æ˜ å°„åˆ°æ•´æ•°ï¼Œå…¶å®å°±æ˜¯æŠŠæˆ·å¤´æ˜ å°„åˆ°é‡‘é’±ä½™é¢ã€‚è¿™ä¸€ä¸ªå…¬å…±å˜é‡è¢«<strong>è™šæ‹Ÿåœ°åˆå§‹åŒ–</strong>äº†ï¼Œæ‰€ä»¥æ‰€æœ‰åˆæ³•çš„key<strong>éƒ½å­˜åœ¨</strong>ï¼Œè€Œå®ƒä»¬æ˜ å°„valueéƒ½æ˜¯é›¶å€¼ï¼ˆå¯¹æ•´æ•°è€Œè¨€ï¼Œå½“ç„¶åº”è¯¥æ˜¯0ï¼‰ã€‚å› ä¸ºè¿™ä¸ªæ— é™å¤§çš„ map çš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸å¯èƒ½éå†æ‰€æœ‰çš„ keyï¼Œä¹Ÿä¸èƒ½éå†æ‰€æœ‰çš„ valueï¼Œåªèƒ½ä¾èµ–äºå¤–éƒ¨æ•°ç»„æ¥è®°ä½æœ‰æ„ä¹‰çš„ keyã€‚è€Œç¼–è¯‘å™¨å¸®å¿™ç”Ÿæˆçš„å‡½æ•°ï¼Œåˆ™çœ‹èµ·æ¥æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">balances</span>(<span class="hljs-params">address _account</span>) public view <span class="hljs-title function_">returns</span> (uint) &#123;<br>    <span class="hljs-keyword">return</span> balances[_account];<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨çš„æ—¶å€™ï¼Œç”¨ç±» balances(0x1234567)çš„æ–¹å¼æ¥è·å–è´¦æˆ·ä½™é¢ï¼Ÿ</p>
<p>Event çš„å®šä¹‰å’Œæˆ‘ä»¬ä¹ æƒ¯çš„å°±å¾ˆç›¸ä¼¼äº†ã€‚ä½†åŸæ–‡ä¸­ä¸¾äº†ä¸€ä¸ªè§‚å¯Ÿçš„ä¾‹å­ï¼Œä¸çŸ¥é“æ˜¯åœ¨ Web3 api é‡Œé¢ä½¿ç”¨ï¼Œè¿˜æ˜¯åœ¨æ™ºèƒ½åˆçº¦é‡Œé¢ä½¿ç”¨ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Coin</span>.<span class="hljs-title class_">Sent</span>().<span class="hljs-title function_">watch</span>(&#123;&#125;, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!error) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Coin transfer: &quot;</span> + result.<span class="hljs-property">args</span>.<span class="hljs-property">amount</span> +<br>            <span class="hljs-string">&quot; coins were sent from &quot;</span> + result.<span class="hljs-property">args</span>.<span class="hljs-property">from</span> +<br>            <span class="hljs-string">&quot; to &quot;</span> + result.<span class="hljs-property">args</span>.<span class="hljs-property">to</span> + <span class="hljs-string">&quot;.&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Balances now:\n&quot;</span> +<br>            <span class="hljs-string">&quot;Sender: &quot;</span> + <span class="hljs-title class_">Coin</span>.<span class="hljs-property">balances</span>.<span class="hljs-title function_">call</span>(result.<span class="hljs-property">args</span>.<span class="hljs-property">from</span>) +<br>            <span class="hljs-string">&quot;Receiver: &quot;</span> + <span class="hljs-title class_">Coin</span>.<span class="hljs-property">balances</span>.<span class="hljs-title function_">call</span>(result.<span class="hljs-property">args</span>.<span class="hljs-property">to</span>));<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>å½“ç„¶è¿™ä¸ªä¾‹å­ä¹Ÿæä¾›äº†å¯¹ balances å‡½æ•°çš„è°ƒç”¨ç¤ºä¾‹ã€‚</p>
<p>Coin å‡½æ•°å°±æ˜¯åœ¨åˆ›å»ºåˆçº¦çš„æ—¶å€™åªæ‰§è¡Œä¸€æ¬¡ä¸èƒ½å†è¢«æ‰§è¡Œçš„ã€‚è¿™ä¸ªæ„é€ å™¨å…¶å®æ˜¾å¼åœ°æŠŠåˆ›å»ºåˆçº¦çš„ msgï¼ˆè€Œä¸åªæ˜¯ senderï¼‰ä»¥åŠ tx å’Œ block è¿™æ ·çš„é»˜è®¤å˜é‡éƒ½ä¿å­˜ä¸‹æ¥äº†ã€‚å¯¹äºæ‰€æœ‰å‡½æ•°è€Œè¨€ï¼Œmsg.sender æ°¸è¿œæŒ‡å‘å½“å‰è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨åœ°å€ã€‚</p>
<p>mint å› ä¸ºè®¾ç½®äº†å«è¯­å¥ï¼Œæ‰€ä»¥åœ¨ä¸æ˜¯åˆ›å»ºè€…çš„è°ƒç”¨é¢å‰ä¼šæå‰è¿”å›ã€‚è€Œ send åˆ™å¯ä»¥è¢«ä»»ä½•äººè°ƒç”¨ã€‚</p>
<p>è¿™äº›è½¬è´¦äº‹ä»¶å½“ç„¶ä¸å¯èƒ½è¢«é“¾è‡ªå¸¦çš„è´§å¸ç³»ç»Ÿåæ˜ å‡ºæ¥ã€‚ä½†å› ä¸ºè¿™ä¸ªåˆçº¦è‡ªå·±å¸¦äº†äº‹ä»¶ï¼Œæ‰€ä»¥å¯ä»¥å¼€å‘é’ˆå¯¹å®ƒçš„åŒºå—é“¾æµè§ˆå™¨ã€‚</p>
<h3 id="åŒºå—é“¾åŸºç¡€">åŒºå—é“¾åŸºç¡€</h3>
<h4 id="äº‹åŠ¡">äº‹åŠ¡</h4>
<p>åŒºå—é“¾æ˜¯å…¨å±€å…±äº«çš„äº‹åŠ¡å‹æ•°æ®åº“ï¼Œä»¥å¤ªåŠç”šè‡³å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåºåˆ—åŒ–éš”ç¦»çº§åˆ«çš„æ•°æ®åº“ã€‚æ‰€æœ‰åŠ å…¥ç½‘ç»œçš„äººéƒ½å¯ä»¥ä»è¿™ä¸ªæ•°æ®åº“é‡Œè¯»å–æ¡ç›®ã€‚å¦‚æœä½ æƒ³æ”¹å˜æ•°æ®åº“é‡Œçš„ä»€ä¹ˆğŸ‘»ä¸œè¥¿ï¼Œä½ åˆ›é€ çš„äº¤æ˜“å¿…é¡»è¢«æ‰€æœ‰äººæ¥å—ã€‚äº‹åŠ¡ï¼Œä¹Ÿå°±æ„å‘³ç€æ“ä½œæ˜¯åŸå­åŒ–çš„ï¼Œäº‹åŠ¡é‡Œçš„æ‰€æœ‰æ“ä½œè¦ä¹ˆéƒ½è¢«å®Œæˆï¼Œè¦ä¹ˆéƒ½æ²¡æ‰§è¡Œã€‚æ­¤å¤–ï¼Œæ²¡æœ‰äººèƒ½å¤Ÿç¯¡æ”¹å·²ç»è¢«åº”ç”¨æ•°æ®åº“é‡Œçš„äº‹åŠ¡ã€‚</p>
<p>åªæœ‰ç­¾è¿‡åçš„äº‹åŠ¡ï¼Œæ‰èƒ½åšç›¸åº”çš„ä¿®æ”¹â€“ç”¨å¯†ç å­¦å’Œæƒé™éš”ç¦»æ¥ä¿è¯å®‰å…¨æ€§ã€‚</p>
<h4 id="åŒºå—">åŒºå—</h4>
<p>ä¸€ä¸ªéœ€è¦å…‹æœçš„ä¸»è¦éšœç¢æ˜¯ï¼ŒæŒ‰ç…§æ¯”ç‰¹å¸çš„è¯´æ³•ï¼Œæ˜¯æ‰€è°“çš„â€œåŒèŠ±æ”»å‡»â€ã€‚ä¹Ÿå°±æ˜¯å¦‚æœç½‘ç»œä¸­å­˜åœ¨ç›¸äº’çŸ›ç›¾çš„ä¸¤ç¬”äº‹åŠ¡æ€ä¹ˆåŠï¼Ÿ</p>
<p>æŠ½è±¡çš„å›ç­”æ˜¯ï¼Œä½ ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªã€‚ä¸€ä¸ªäº‹åŠ¡çš„æ’åºæ€»ä¼šä¸ºä½ æŒ‘é€‰å‡ºæ¥ï¼Œï¼ˆè¢«é€‰ä¸­çš„ï¼‰äº‹åŠ¡ä¼šè¢«æ‰“åŒ…è¿›ä¸€ä¸ªæ‰€è°“çš„â€œåŒºå—â€é‡Œï¼Œç„¶åä»–ä»¬ä¼šè¢«æ‰§è¡Œå’Œåˆ†å‘åˆ°æ‰€æœ‰å‚ä¸èŠ‚ç‚¹é‡Œé¢ã€‚å¦‚æœä¸¤ä¸ªåˆçº¦ç›¸äº’çŸ›ç›¾ï¼Œé‚£ä¹ˆè¢«æ’åœ¨ç¬¬äºŒä½çš„åˆçº¦ä¼šè¢«æ‹’ç»è€Œä¸æˆä¸ºåŒºå—çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>è¿™äº›åŒºå—è¡Œç¨‹ä¸€ä¸ªçº¿æ€§åºåˆ—ï¼ŒåŒºå—é“¾è¿™ä¸ªè¯å°±æºäºæ­¤ã€‚</p>
<p>ä½œä¸ºâ€œé¡ºåºæŒ‘é€‰æœºåˆ¶â€ï¼ˆå³æ‰€è°“çš„â€œæŒ–çŸ¿â€ï¼‰çš„ä¸€éƒ¨åˆ†ï¼ŒåŒºå—å¯èƒ½ä¼šè¢«å›æ»šï¼Œä½†è¿™ç§æƒ…å†µåªä¼šå‘ç”Ÿåœ¨é“¾çš„æœ«æ¢¢ã€‚è¶Šå¤šçš„åŒºå—è¢«åŠ åˆ°é¡¶éƒ¨ï¼ŒåŸæ¥çš„åŒºå—å°±è¶Šä¸å®¹æ˜“è¢«å›æ»šã€‚</p>
<h3 id="ä»¥å¤ªåŠè™šæ‹Ÿæœº">ä»¥å¤ªåŠè™šæ‹Ÿæœº</h3>
<h4 id="æ¦‚è§ˆ">æ¦‚è§ˆ</h4>
<p>ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰æ˜¯æ™ºèƒ½åˆçº¦çš„è¿è¡Œæ—¶ã€‚å®ƒä¸åªæ˜¯ä¸€ä¸ªæ²™ç›’ï¼Œè€Œä¸”è¢«å®Œå…¨éš”ç¦»äº†ï¼Œä¹Ÿå°±æ˜¯è¯´EVM ä¸èƒ½è®¿é—®ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿå’Œå…¶ä»–è¿›ç¨‹ï¼ˆFabric çš„æ™ºèƒ½åˆçº¦ç†è®ºä¸Šæ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼‰ã€‚æ™ºèƒ½åˆçº¦ç”šè‡³å—é™è®¿é—®å…¶ä»–æ™ºèƒ½åˆçº¦ã€‚</p>
<h4 id="è´¦æˆ·">è´¦æˆ·</h4>
<p>ä»¥å¤ªåŠä¸­æœ‰ä¸¤ç±»è´¦æˆ·å…±äº«åŒæ ·çš„åœ°å€ç©ºé—´ï¼šç”±å…¬ç§é’¥å¯¹ï¼ˆå³äººç±»ï¼‰æ§åˆ¶çš„å¤–éƒ¨è´¦æˆ·ä»¥åŠä¸åˆçº¦ä¸€åŒå­˜å‚¨çš„ä»£ç æ§åˆ¶çš„åˆçº¦è´¦æˆ·ã€‚</p>
<p>å¤–éƒ¨è´¦æˆ·çš„åœ°å€æ˜¯åˆå…¬é’¥æ§åˆ¶çš„ï¼Œè€Œåˆçº¦çš„åœ°å€åˆ™æ˜¯åœ¨åˆçº¦åˆ›å»ºæ—¶å†³å®šçš„ï¼ˆç”±åˆ›å»ºè€…çš„åœ°å€å’Œä»å“ªä¸ªåœ°å€é‡Œå‘å‡ºçš„äº‹åŠ¡æ•°ï¼ˆå³ nonceï¼‰è¡ç”Ÿã€‚ï¼‰ã€‚</p>
<p>ä¸è€ƒè™‘è´¦æˆ·æ˜¯ä¸æ˜¯å­˜å‚¨æœ‰ä»£ç ï¼Œä¸¤ç§ç±»å‹è¢« EVM å¹³ç­‰å¯¹å¾…ã€‚</p>
<p>æ¯ä¸€ä¸ªè´¦æˆ·æœ‰æŒä¹…åŒ–çš„çš„é”®å€¼å­˜å‚¨å« storageï¼Œæ˜ å°„256ä½çš„å­—åˆ°256ä½çš„å­—ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ªä»¥å¤ªå¸ï¼ˆä»¥ wei ä¸ºå•ä½ï¼‰ä½™é¢ï¼Œå¯ä»¥é€šè¿‡å‘é€å«æœ‰ä»¥å¤ªå¸çš„äº‹åŠ¡è¿›è¡Œä¿®æ”¹ã€‚</p>
<h4 id="äº‹åŠ¡">äº‹åŠ¡</h4>
<p>äº‹åŠ¡æ˜¯ä»ä¸€ä¸ªè´¦æˆ·å‘é€å¾€å¦ä¸€ä¸ªè´¦æˆ·ï¼ˆå¦ä¸€ä¸ªè´¦æˆ·å¯ä»¥æ˜¯åŒä¸€ä¸ªè´¦æˆ·æˆ–è€…ç‰¹æ®Šçš„é›¶è´¦æˆ·ï¼‰çš„æ¶ˆæ¯ã€‚å®ƒå¯ä»¥åŒ…å«äºŒè¿›åˆ¶æ•°æ®ï¼ˆå®ƒçš„è½½è·ï¼‰å’Œä»¥å¤ªå¸ã€‚</p>
<p>å¦‚æœç›®æ ‡è´¦æˆ·åŒ…å«ä»£ç ï¼Œé‚£ä¹ˆä»£ç å¯ä»¥è¢«æ‰§è¡Œï¼Œè€Œè½½è·åˆ™å¯ä»¥è¢«å½“åšè¾“å…¥æ•°æ®ï¼ˆæŒ‰ï¼Œç­‰åŒäº message callï¼‰ã€‚</p>
<p>å¦‚æœç›®æ ‡è´¦æˆ·æ˜¯ä¸€ä¸ªé›¶è´¦æˆ·ï¼ˆè´¦æˆ·åœ°å€æ˜¯0ï¼‰ï¼Œäº‹åŠ¡ä¼šäº§ç”Ÿä¸€ä¸ªæ–°åˆçº¦ï¼ˆè¿™ä¹Ÿæ˜¯ç¼–ç¨‹å¼äº§ç”Ÿæ–°åˆçº¦çš„æ–¹æ³•ï¼‰ã€‚åˆ›é€ åˆçº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨äº‹åŠ¡é‡Œå‘é€çš„è½½è·å®é™…ä¸Šå¹¶ä¸æ˜¯åˆçº¦æœ¬èº«ï¼Œè€Œæ˜¯èƒ½å¤Ÿäº§ç”Ÿåˆçº¦çš„ä»£ç ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™ä¸ªé›¶è´¦æˆ·æŒ‡çš„æ˜¯ä¸€ä¸ª transaction é‡Œé¢çš„ to çš„é›¶å€¼ï¼š</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lasso">transaction = &#123;<br>  nonce: <span class="hljs-string">&#x27;0x0&#x27;</span>, <br>  gasLimit: <span class="hljs-string">&#x27;0x6acfc0&#x27;</span>, <span class="hljs-comment">// 7000000</span><br>  gasPrice: <span class="hljs-string">&#x27;0x4a817c800&#x27;</span>, <span class="hljs-comment">// 20000000000</span><br>  <span class="hljs-keyword">to</span>: <span class="hljs-string">&#x27;0x0&#x27;</span>,<br>  value: <span class="hljs-string">&#x27;0x0&#x27;</span>,<br>  <span class="hljs-built_in">data</span>: <span class="hljs-string">&#x27;0xfffff&#x27;</span><br>&#125;;<br></code></pre></td></tr></table></figure>
<p>å…·ä½“æ€è¾¨å†…å®¹è§<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/48219716/what-is-address0-in-solidity">æ­¤</a>ã€‚</p>
<h4 id="gas">Gas</h4>
<p>ä¸€åˆ›å»ºå®Œæˆï¼Œæ¯ä¸ªäº‹åŠ¡æ€»è¦æ”¶å–ä¸€å®šé‡çš„ gasï¼Œç”¨æ„æ˜¯ä¸ºäº†é™åˆ¶æ‰§è¡Œäº‹åŠ¡æ‰€éœ€çš„å·¥ä½œé‡ï¼Œå¹¶ä¸ºæ‰§è¡Œäº‹åŠ¡ä»˜è´¹ã€‚å½“ EVM æ‰§è¡Œäº‹åŠ¡çš„æ—¶å€™ï¼Œgas æ ¹æ®ç‰¹å®šè§„åˆ™è¢«é€æ¸æ¶ˆè€—ã€‚</p>
<p>gas åŠ ä¸ªæ˜¯ç”±äº‹åŠ¡åˆ›å»ºè€…è®¾ç«‹çš„ï¼Œå‘å‡ºï¼ˆäº‹åŠ¡çš„ï¼‰è´¦æˆ·å¿…é¡»ä»˜å‡º<code>gas_price * gas</code>çš„é¢„ä»˜æ¬¾ã€‚å¦‚æœæ‰§è¡Œä¹‹åè¿˜æœ‰ gas å‰©ä½™ï¼Œå®ƒä¼šè¢«åŸè·¯é€€å›ã€‚</p>
<p>å¦‚æœ gas åœ¨ä»»ä½•æ—¶åˆ»è¢«ç”¨å°½ï¼Œä¸€ä¸ª out-of-gas å¼‚å¸¸ä¼šè¢«è§¦å‘ï¼Œå› æ­¤ä¼šåè½¬å½“å‰è°ƒç”¨å¸§å¯¹çŠ¶æ€çš„æ‰€æœ‰ä¿®æ”¹ã€‚</p>
<h4 id="storage-memory-å’Œ-stack">Storageï¼Œ Memory å’Œ Stack</h4>
<p>æ¯ä¸ªè´¦æˆ·éƒ½æœ‰ä¸€ä¸ª<strong>æŒä¹…åŒ–çš„å†…å­˜åŒºåŸŸ</strong>ï¼Œè¢«ç§°ä½œ<code>storage</code>ã€‚Storage æ˜¯ä¸€ä¸ªé”®å€¼å­˜å‚¨ï¼Œå®ƒæŠŠ256ä½çš„å­—æ˜ å°„åˆ°256ä½çš„å­—ã€‚ä¸å¯èƒ½åœ¨ä¸€ä¸ªåˆçº¦å†…éƒ¨æšä¸¾ storageï¼Œè€Œè¯»storageä¹Ÿæ˜¯ç›¸å¯¹æ˜‚è´µçš„ï¼Œ ä¿®æ”¹ storage æ›´æ˜¯æ˜‚è´µã€‚ä¸€ä¸ªåˆçº¦ä¸èƒ½è¯»å’Œå†™å®ƒè‡ªå·±çš„ storage ä¸­è‡ªå·±æ‹¥æœ‰çš„éƒ¨åˆ†ä¹‹å¤–çš„ä¸œè¥¿ã€‚</p>
<p>ç¬¬äºŒä¸ªå†…å­˜åŒºåŸŸå«åš<code>memory</code>ï¼Œå®ƒè®©åˆçº¦ä¸ºæ¯ä¸€ä¸ªæ¶ˆæ¯è°ƒç”¨è·å¾—äº†ä¸€ä¸ªå…¨æ–°æ¸…ç†è¿‡çš„å®ä¾‹ã€‚memory æ˜¯çº¿æ€§çš„ï¼Œå¯ä»¥åœ¨å­—èŠ‚çº§åˆ«è¢«å¯»å€ï¼Œä½†è¯»è¢«é™åˆ¶åˆ°256ä½å®½ï¼Œå†™å¾—å¯ä»¥å†™8ä½åˆ°256ä½å®½ã€‚memory è¢«å­—ï¼ˆ256ä½ï¼‰å±•å¼€ï¼Œå½“è®¿é—®ï¼ˆä¸ç®¡æ˜¯è¯»æˆ–è€…å†™ï¼‰ä¸€ä¸ªä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡çš„å†…å­˜å­—ï¼ˆå³ï¼Œä¸€ä¸ªå­—å†…çš„ä»»ä½•åç§»ï¼‰ã€‚åœ¨å±•å¼€çš„æ—¶å€™ï¼Œgas çš„èŠ±è´¹ä¹Ÿå¿…é¡»è¦ä¹‹ä¸°å¯Œã€‚memory å¢é•¿çš„è¶Šå¤§ï¼Œè¶Šæ˜‚è´µï¼ˆå› ä¸ºå®ƒæ˜¯å¹³æ–¹çº§æ‰©å®¹çš„ï¼‰ã€‚</p>
<p>EVM ä¸æ˜¯ä¸ªå¯„å­˜å™¨æœºå™¨è€Œæ˜¯ä¸ªæ ˆæœºå™¨ï¼Œæ‰€ä»¥æ‰€æœ‰çš„è®¡ç®—éƒ½åœ¨ä¸€ä¸ªå« stack çš„åŒºåŸŸä¸Šæ‰§è¡Œã€‚æ ˆæœ‰ä¸€ä¸ª1024ä¸ªå…ƒç´ çš„æœ€å¤§å°ºå¯¸ï¼Œå¹¶ä¸”åŒ…å«256ä½çš„å­—ã€‚åªå…è®¸é€šè¿‡è¿™ç§æ–¹å¼ä»æ ˆé¡¶è®¿é—®å…ƒç´ ï¼šå¯ä»¥æ‹·è´æœ€é¡¶ä¸Šçš„16ä¸ªå…ƒç´ ä¸­çš„ä¸€ä¸ªæˆ–è€…æŠŠæœ€é¡¶ä¸Šçš„åå…­ä¸ªå…ƒç´ ä¸­çš„ä¸€ä¸ªä¸å…¶ä¸‹çš„å…ƒç´ ç¿»è½¬ã€‚æŒ‰ï¼šè¿™ä¹Ÿå°±æ˜¯ stack é‡Œçš„å±€éƒ¨å˜é‡è¡¨åªå…è®¸æœ‰16ä¸ªå˜é‡çš„åŸå› ã€‚çœ‹èµ·æ¥æ‰€æœ‰çš„ EVM è¯­è¨€ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Solidityï¼Œéƒ½å—è¿™ä¸ªé™åˆ¶å½±å“ã€‚å…¶ä»–æ“ä½œåˆ™åªèƒ½ä»æ ˆä¸Šå–æœ€é¡¶ä¸Šçš„ä¸¤ä¸ªï¼ˆæˆ–ä¸€æˆ–æ›´å¤šï¼Œå–å†³äºå…·ä½“æ“ä½œï¼‰å…ƒç´ å¹¶å°†ç»“æœæ¨ä¸Šæ ˆã€‚å½“ç„¶å¯èƒ½æŠŠæ ˆä¸Šçš„å…ƒç´ ç§»åŠ¨åˆ° storage å’Œ memoryï¼Œä½†ä¸å¯èƒ½åœ¨ä¸ç§»é™¤æ ˆé¡¶å…ƒç´ çš„å‰æä¸‹ï¼Œè®¿é—®æ ˆä¸Šæ›´æ·±çš„ä»»æ„å…ƒç´ ã€‚</p>
<h4 id="æŒ‡ä»¤é›†">æŒ‡ä»¤é›†</h4>
<p>EVM çš„æŒ‡ä»¤é›†è¢«ä¿æŒæå°è§„æ¨¡ï¼Œä»¥é˜²é”™è¯¯çš„å®ç°å¼•å‘å…±è¯†é—®é¢˜ã€‚æ‰€æœ‰çš„æŒ‡ä»¤éƒ½æ“ä½œåœ¨åŸºæœ¬æ•°æ®ç±»å‹ï¼Œ256ä½çš„å­—ä¸Šã€‚å¸¸è§çš„ç®—æ•°ã€ä½ã€é€»è¾‘å’Œæ¯”è¾ƒæ“ä½œç¬¦æ˜¯ç°æˆçš„ã€‚æ¡ä»¶å’Œéæ¡ä»¶è·³è½¬æ˜¯å¯è¡Œçš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆçº¦èƒ½å¤Ÿè®¿é—®å½“å‰åŒºå—çš„ç›¸å…³å±æ€§æ¯”å¦‚æ•°å­—å’Œæ—¶é—´æˆ³ã€‚</p>
<h4 id="æ¶ˆæ¯è°ƒç”¨">æ¶ˆæ¯è°ƒç”¨</h4>
<p>åˆçº¦å¯ä»¥è°ƒç”¨å…¶ä»–åˆçº¦ï¼Œæˆ–è€…é€šè¿‡æ¶ˆæ¯è°ƒç”¨çš„æ–¹å¼å‘é€ä»¥å¤ªå¸åˆ°éåˆçº¦è´¦æˆ·ã€‚æ¶ˆæ¯è°ƒç”¨ç±»ä¼¼äº‹åŠ¡ï¼Œæ‰€ä»¥å®ƒæœ‰æºã€ç›®æ ‡ã€æ•°æ®è½½è·ã€ä»¥å¤ªå¸ã€gas å’Œè¿”å›å€¼ã€‚äº‹å®ä¸Šï¼Œæ‰€æœ‰çš„äº‹åŠ¡éƒ½åŒ…å«ä¸€ä¸ª<strong>é¡¶çº§æ¶ˆæ¯è°ƒç”¨</strong>ï¼ˆæŒ‰ï¼šå¯ä»¥ç†è§£ä¸ºå…ƒæ¶ˆæ¯è°ƒç”¨ï¼‰ï¼Œå®ƒå¯ä»¥åˆ›é€ æ›´å¤šçš„æ¶ˆæ¯è°ƒç”¨ã€‚</p>
<p>ä¸€ä¸ªåˆçº¦å†³å®šæœ‰å¤šå°‘å®ƒçš„å‰©ä½™ gas éœ€è¦è¢«ä¼´éšå†…éƒ¨æ¶ˆæ¯è°ƒç”¨å‘é€ï¼Œæœ‰å¤šå°‘å®ƒæƒ³è¦ä¿ç•™ã€‚å¦‚æœä¸€ä¸ª out-of-gas å¼‚å¸¸åœ¨å†…éƒ¨è°ƒç”¨å‘ç”Ÿäº†ï¼ˆæˆ–è€…ä»»ä½•å…¶ä»–å¼‚å¸¸ï¼‰ï¼Œè¿™ä»¶äº‹ä¼šä»¥ä¸€ä¸ªè¢«æ”¾åœ¨æ ˆä¸Šçš„é”™è¯¯å€¼ä½œä¸ºä¿¡å·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä¼´éšç€è¿™ä¸ªè°ƒç”¨çš„ gas è¢«ç”¨å°½äº†ï¼ˆæŒ‰ï¼šå…¶å®ƒçš„ gas æ²¡æœ‰è¢«ç”¨å°½ï¼‰ã€‚åœ¨ Solidity ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ–¹åˆçº¦å¼•å‘ä¸€ä¸ªæ‰‹åŠ¨å¼‚å¸¸ï¼ˆæŒ‰ï¼šä¸‹é¢ä¼ ä¸Šæ¥çš„æ˜¯é”™è¯¯ç ï¼Œåœ¨è¿™é‡Œæ‰ raise å¼‚å¸¸ï¼‰ï¼Œæ‰€ä»¥å¼‚å¸¸çŠ¶å†µå°±åœ¨è°ƒç”¨æ ˆä¸Šè¢«å†’æ³¡ä¸Šå»äº†ã€‚</p>
<p>æ­£å¦‚å·²ç»æåˆ°çš„ï¼Œè¢«è°ƒç”¨çš„åˆçº¦ï¼ˆå®ƒå¯ä»¥æ˜¯è°ƒç”¨è€…æœ¬èº«ï¼‰ä¼šæ”¶åˆ°ä¸€ä¸ªå…¨æ–°çš„è¢«æ¸…ç†è¿‡çš„å†…å­˜å®ä¾‹ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®è°ƒç”¨è½½è·-å®ƒä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„è¢«ç§°ä½œ<code>alldata</code> çš„åŒºåŸŸé‡Œè¢«æä¾›ã€‚å½“å®ƒæ‰§è¡Œå®Œæˆä»¥åï¼Œå®ƒå¯ä»¥è¿”å›æ•°æ®ï¼Œæ•°æ®ä¼šè¢«å­˜è´®åœ¨è°ƒç”¨è€…çš„é¢„åˆ†é…å†…å­˜é‡Œçš„æŸä¸€ä¸ªéƒ¨åˆ†ã€‚æŒ‰ï¼šç±»ä¼¼ä¼ ç»Ÿè°ƒç”¨æ ˆçš„è¿”å›å€¼å¯„å­˜å™¨ã€‚è°ƒç”¨è¢«é™åˆ¶åœ¨ä¸€ä¸ª1024çš„æ·±åº¦ä¸Šï¼Œè¿™æ„å‘³ç€å¯¹æ›´å¤æ‚çš„æ“ä½œï¼Œå¾ªç¯åº”è¯¥ä¼˜äºé€’å½’ã€‚</p>
<h4 id="delegatecall-å§”æ‰˜è°ƒç”¨-callcode-è°ƒç”¨ä»£ç -å’Œ-libraries-åº“">Delegatecallï¼ˆå§”æ‰˜è°ƒç”¨ï¼‰/Callcodeï¼ˆè°ƒç”¨ä»£ç ï¼‰ å’Œ Libraries(åº“)</h4>
<p>å­˜åœ¨æ¶ˆæ¯è°ƒç”¨çš„ä¸€ä¸ªç‰¹æ®Šå˜ç§ï¼Œåä¸º delegatecallï¼Œå®ƒå’Œä¸€ä¸ªæ¶ˆæ¯è°ƒç”¨å®Œå…¨ä¸€æ ·ï¼Œé™¤äº†ç›®æ ‡åœ°å€çš„ä»£ç æ˜¯åœ¨è°ƒç”¨æ–¹åˆçº¦çš„ä¸Šä¸‹æ–‡é‡Œæ‰§è¡Œï¼ˆæŒ‰ï¼šæ„å³ï¼Œä¸æ˜¯åœ¨è¢«è°ƒç”¨åˆçº¦ä¸Šä¸‹æ–‡é‡Œæ‰§è¡Œï¼‰ï¼Œå¹¶ä¸” msg.sender å’Œ msg.value æ²¡æœ‰æ”¹å˜å®ƒä»¬çš„å€¼ï¼ˆæŒ‰ï¼šå’Œè°ƒç”¨æ–¹åˆçº¦é‡Œçš„å€¼ä¸€æ ·ï¼‰ã€‚</p>
<p>è¿™æ„å‘³ç€ä¸€ä¸ªåˆçº¦å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä»å…¶ä»–åœ°å€æå–ä»£ç ã€‚å­˜å‚¨ã€å½“å‰åœ°å€å’Œä½™é¢ï¼Œä¾æ—§æŒ‡å‘è°ƒç”¨æ–¹åˆçº¦ï¼Œåªæœ‰ä»£ç æ˜¯ä»è¢«è°ƒç”¨æ–¹åˆçº¦é‡Œæ‹¿æ¥çš„ã€‚è¿™æ„å‘³ç€åœ¨ Solidity ä¸­å®ç°åº“è¿™ä¸€ç‰¹å¾æ˜¯å¯èƒ½çš„ï¼šå¯å¤ç”¨çš„åº“ä»£ç å¯ä»¥åº”ç”¨åˆ°ä¸€ä¸ªåˆçº¦çš„å­˜å‚¨é‡Œï¼Œæ„å³ï¼Œå¯ä»¥ï¼ˆé€šè¿‡å¤ç”¨åº“ï¼‰å®ç°å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p>
<h4 id="æ—¥å¿—">æ—¥å¿—</h4>
<p>å¯ä»¥åœ¨ä¸“é—¨ç´¢å¼•è¿‡çš„æ•°æ®ç»“æ„é‡Œå­˜å‚¨æ•°æ®ï¼Œè¿™æŠŠæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜ å°„åˆ°äº†åŒºå—çº§åˆ«ï¼ˆæŒ‰ï¼šå³åœ¨åŒºå—çº§åˆ«æ¥æ€è€ƒæ€ä¹ˆè§£å†³ç›¸å…³é—®é¢˜ï¼‰ã€‚è¢«ç§°ä½œlogï¼ˆæ—¥å¿—ï¼‰çš„ç‰¹å¾è¢« Solidity ç”¨æ¥å®ç° eventsï¼ˆäº‹ä»¶ï¼‰ã€‚åˆçº¦ä¸èƒ½åœ¨æ—¥å¿—è¢«åˆ›å»ºåè®¿é—®å®ƒä»¬ï¼ˆå³ log è¢«åˆ›å»ºåå°±ä¸èƒ½åœ¨å†…éƒ¨ä»ä»»ä½•ä¸€ä¸ªåœ°æ–¹è¢«è¯»å–äº†ï¼‰ã€‚ä½†å®ƒä»¬å¯ä»¥ä»é“¾å¤–è¢«è¯»å–ã€‚ç”±äºæœ‰ä¸€éƒ¨åˆ† log æ•°æ®è¢«å­˜å‚¨åœ¨å¸ƒéš†è¿‡æ»¤å™¨é‡Œï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æœ‰æ•ˆç‡å’ŒåŠ å¯†å®‰å…¨çš„æ–¹æ³•æ¥æœç´¢å…¶ä¸­æ•°æ®ï¼Œæ‰€ä»¥ç½‘ç»œå¯¹ç­‰èŠ‚ç‚¹ï¼ˆè½»å®¢æˆ·ç«¯ï¼‰ä¸éœ€è¦ä¸‹è½½å®Œæ•´çš„åŒºå—å°±å¯ä»¥å‘è¡Œè¿™äº›æ—¥å¿—ã€‚</p>
<h4 id="åˆ›å»º">åˆ›å»º</h4>
<p>åˆçº¦ç”šè‡³å¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„opcodeï¼ˆæ“ä½œç ï¼‰åˆ›å»ºå…¶ä»–åˆçº¦ï¼ˆå®ƒä»¬å¹¶ä¸åªæ˜¯ç®€å•åœ°è°ƒç”¨é›¶åˆçº¦åœ°å€ï¼Œè¿™å·²ç»æ˜¯ç¬¬äºŒç§å·²çŸ¥çš„åˆ›å»ºåˆçº¦çš„æ–¹æ³•äº†ï¼‰ã€‚<strong>åˆ›å»ºè°ƒç”¨</strong>å’Œæ™®é€šæ¶ˆæ¯è°ƒç”¨çš„å”¯ä¸€å·®åˆ«æ˜¯è½½è·æ•°æ®è¢«æ‰§è¡Œäº†ï¼Œè€Œç»“æœè¢«å½“åšä»£ç å­˜å‚¨ã€‚è°ƒç”¨è€…/åˆ›å»ºè€…åœ¨æ ˆä¸Šæ¥æ”¶åˆ°æ–°åˆçº¦çš„åœ°å€ã€‚</p>
<h4 id="è‡ªæ¯">è‡ªæ¯</h4>
<p>ä»£ç è¢«ä»åŒºå—é“¾ä¸Šç§»å‡ºçš„å”¯ä¸€å¯èƒ½æ€§æ˜¯å½“ä¸€ä¸ªåˆçº¦æ‰§è¡Œ<code>selfdestruct</code>æ“ä½œçš„æ—¶å€™ã€‚åœ°å€ä¸­å­˜å‚¨çš„å‰©ä½™ä»¥å¤ªå¸ä¼šè¢«å‘é€ç»™ä¸€ä¸ªè®¾å®šå¥½çš„ç›®æ ‡ï¼ˆè´¦æˆ·ï¼‰ï¼Œæ¥ç€çŠ¶æ€ï¼ˆæ•°æ®åº“çš„å­˜å‚¨ï¼‰ä¸­çš„å­˜å‚¨å’ŒçŠ¶æ€å°†è¢«ç§»é™¤ã€‚</p>
<p><strong>å³ä½¿ä¸€ä¸ªåˆçº¦çš„ä»£ç ä¸­ä¸åŒ…å«ä¸€ä¸ªåˆ°<code>selfdestruct</code>çš„è°ƒç”¨ï¼Œå®ƒä»ç„¶å¯ä»¥é€šè¿‡<code>delegatecall</code>å’Œ<code>callcode</code>æ¥æ‰§è¡Œé‚£ä¸ªæ“ä½œã€‚</strong></p>
<p><strong>å¯¹äºè€ä»¥å¤ªåŠèŠ‚ç‚¹è€Œè¨€ï¼Œè¿™ä¸ªçŠç‘šå¹¶ä¸ä¸€å®šæ˜¯ç‰©ç†åˆ é™¤ï¼Œä¹Ÿå¯ä»¥æ˜¯è½¯åˆ é™¤</strong></p>
<p><strong>å½“å‰å¤–éƒ¨è´¦æˆ·ï¼ˆå³ä¸ªäººçš„ accountï¼‰æ˜¯ä¸èƒ½ä» state ä¸­ç§»é™¤æ‰çš„ã€‚æŒ‰ï¼šå³åˆçº¦è´¦æˆ·å¯ä»¥è¢«ç§»é™¤</strong></p>
<h2 id="solidityä¸¾ä¾‹">Solidityä¸¾ä¾‹</h2>
<h3 id="é€‰ä¸¾">é€‰ä¸¾</h3>
<p>æ¥ä¸‹æ¥çš„åˆçº¦å°±éå¸¸å¤æ‚äº†ï¼Œå®ƒæ˜¾ç¤ºäº† Solidity çš„ä¸€å¤§å †ä¼˜ç‚¹ã€‚å®ƒå®ç°äº†ä¸€ä¸ªæŠ•ç¥¨åˆçº¦ã€‚å½“ç„¶ï¼Œç”µå­æŠ•ç¥¨çš„ä¸»è¦é—®é¢˜æ˜¯å¦‚ä½•åˆ†é…æŠ•ç¥¨æƒç»™æ­£ç¡®çš„äººç¾¤å’Œå¦‚ä½•é˜»æ­¢æ“çºµé€‰ä¸¾ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œè§£å†³æ‰€æœ‰çš„é—®é¢˜ï¼Œä½†æœ€èµ·ç æˆ‘ä»¬ä¼šæ˜¾å¼è¢«ä»£ç†çš„é€‰ä¸¾å¦‚ä½•å®Œæˆï¼Œå¹¶ä¸”è®¡ç¥¨æ˜¯è‡ªåŠ¨å’ŒåŒæ—¶å®Œå…¨é€æ˜çš„ã€‚</p>
<p>å¥¥å¦™å°±æ˜¯æ¯ä¸€ä¸ªballotï¼ˆæŠ•ç¥¨ï¼‰ä¸€ä¸ªåˆçº¦ï¼Œä¸ºæ¯ä¸ªé€‰é¡¹æä¾›ä¸€ä¸ªçŸ­åå­—ã€‚ç„¶ååˆçº¦çš„åˆ›å»ºè€…ä½œä¸ºä¸»å¸­ä¼šæŠŠæŠ•ç¥¨æƒå•ç‹¬æˆäºˆæ¯ä¸ªåœ°å€ã€‚</p>
<p>åœ°å€åé¢çš„äººå¯ä»¥é€‰æ‹©è¦ä¹ˆè‡ªå·±æŠ•ç¥¨ï¼Œè¦ä¹ˆæŠŠä»–ä»¬çš„æŠ•ç¥¨æƒdelegateï¼ˆå§”æ‰˜ï¼‰ä¸€ä¸ªä»–ä»¬ä¿¡ä»»çš„äººã€‚</p>
<p>åœ¨é€‰ä¸¾ç»“æŸçš„æ—¶å€™ï¼Œ<code>winningProposal()</code>ä¼šè¿”å›æœ€å¤§æŠ•ç¥¨æ•°çš„å»ºè®®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br><span class="hljs-comment">/// @title Voting with delegation.</span><br>contract <span class="hljs-title class_">Ballot</span> &#123;<br>    <span class="hljs-comment">// This declares a new complex type which will</span><br>    <span class="hljs-comment">// be used for variables later.</span><br>    <span class="hljs-comment">// It will represent a single voter.</span><br>    struct <span class="hljs-title class_">Voter</span> &#123;<br>        uint weight; <span class="hljs-comment">// weight is accumulated by delegation</span><br>        bool voted;  <span class="hljs-comment">// if true, that person already voted</span><br>        address delegate; <span class="hljs-comment">// person delegated to</span><br>        uint vote;   <span class="hljs-comment">// index of the voted proposal</span><br>    &#125;<br><br>    <span class="hljs-comment">// This is a type for a single proposal.</span><br>    struct <span class="hljs-title class_">Proposal</span> &#123;<br>        bytes32 name;   <span class="hljs-comment">// short name (up to 32 bytes)</span><br>        uint voteCount; <span class="hljs-comment">// number of accumulated votes</span><br>    &#125;<br><br>    address public chairperson;<br><br>    <span class="hljs-comment">// This declares a state variable that</span><br>    <span class="hljs-comment">// stores a `Voter` struct for each possible address.</span><br>    <span class="hljs-title function_">mapping</span>(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> <span class="hljs-title class_">Voter</span>) public voters;<br><br>    <span class="hljs-comment">// A dynamically-sized array of `Proposal` structs.</span><br>    <span class="hljs-title class_">Proposal</span>[] public proposals;<br><br>    <span class="hljs-comment">/// Create a new ballot to choose one of `proposalNames`.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Ballot</span>(<span class="hljs-params">bytes32[] proposalNames</span>) public &#123;<br>        chairperson = msg.<span class="hljs-property">sender</span>;<br>        <span class="hljs-comment">// ä¸»å¸­æœ‰æŠ•ç¥¨æƒ</span><br>        voters[chairperson].<span class="hljs-property">weight</span> = <span class="hljs-number">1</span>;<br><br>        <span class="hljs-comment">// For each of the provided proposal names,</span><br>        <span class="hljs-comment">// create a new proposal object and add it</span><br>        <span class="hljs-comment">// to the end of the array.</span><br>        <span class="hljs-keyword">for</span> (uint i = <span class="hljs-number">0</span>; i &lt; proposalNames.<span class="hljs-property">length</span>; i++) &#123;<br>            <span class="hljs-comment">// `Proposal(&#123;...&#125;)` creates a temporary</span><br>            <span class="hljs-comment">// Proposal object and `proposals.push(...)`</span><br>            <span class="hljs-comment">// appends it to the end of `proposals`.</span><br>            proposals.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Proposal</span>(&#123;<br>                <span class="hljs-attr">name</span>: proposalNames[i],<br>                <span class="hljs-attr">voteCount</span>: <span class="hljs-number">0</span><br>            &#125;));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Give `voter` the right to vote on this ballot.</span><br>    <span class="hljs-comment">// May only be called by `chairperson`.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">giveRightToVote</span>(<span class="hljs-params">address voter</span>) public &#123;<br>        <span class="hljs-comment">// If the argument of `require` evaluates to `false`,</span><br>        <span class="hljs-comment">// it terminates and reverts all changes to</span><br>        <span class="hljs-comment">// the state and to Ether balances. It is often</span><br>        <span class="hljs-comment">// a good idea to use this if functions are</span><br>        <span class="hljs-comment">// called incorrectly. But watch out, this</span><br>        <span class="hljs-comment">// will currently also consume all provided gas</span><br>        <span class="hljs-comment">// (this is planned to change in the future).</span><br>        <span class="hljs-comment">// require ç±»ä¼¼æ–­è¨€ï¼Œä¼šåè½¬æ‰€æœ‰çš„åŒºå—é“¾ stateï¼Œä½†è¿˜æ˜¯ä¼šæ¶ˆè€— gasï¼ˆè¿™ç‚¹æœªæ¥ä¼šè¢«ä¿®æ”¹ï¼‰ï¼Œè¿™æ¯” return å¥½å—ï¼Ÿ</span><br>        <span class="hljs-built_in">require</span>((msg.<span class="hljs-property">sender</span> == chairperson) &amp;&amp; !voters[voter].<span class="hljs-property">voted</span> &amp;&amp; (voters[voter].<span class="hljs-property">weight</span> == <span class="hljs-number">0</span>));<br>        <span class="hljs-comment">// æŸä¸ªæŠ•ç¥¨è€…åœ°å€è·å¾—äº†æŠ•ç¥¨æƒ</span><br>        voters[voter].<span class="hljs-property">weight</span> = <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/// Delegate your vote to the voter `to`.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">delegate</span>(<span class="hljs-params">address to</span>) public &#123;<br>        <span class="hljs-comment">// assigns reference</span><br>        <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‡ºç°çš„æ˜¾å¼ storageï¼Œè¿™è¯æ˜è¯»æˆå‘˜å˜é‡èµ‹ç»™å±€éƒ¨å˜é‡æ€»æ˜¯è¦æ±‚ storage çš„</span><br>        <span class="hljs-title class_">Voter</span> storage sender = voters[msg.<span class="hljs-property">sender</span>];<br>        <span class="hljs-built_in">require</span>(!sender.<span class="hljs-property">voted</span>);<br><br>        <span class="hljs-comment">// Self-delegation is not allowed.</span><br>        <span class="hljs-built_in">require</span>(to != msg.<span class="hljs-property">sender</span>);<br><br>        <span class="hljs-comment">// Forward the delegation as long as</span><br>        <span class="hljs-comment">// `to` also delegated.</span><br>        <span class="hljs-comment">// In general, such loops are very dangerous,</span><br>        <span class="hljs-comment">// because if they run too long, they might</span><br>        <span class="hljs-comment">// need more gas than is available in a block.</span><br>        <span class="hljs-comment">// In this case, the delegation will not be executed,</span><br>        <span class="hljs-comment">// but in other situations, such loops might</span><br>        <span class="hljs-comment">// cause a contract to get &quot;stuck&quot; completely.</span><br>        <span class="hljs-comment">// è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå¯ä»¥æ¯”è¾ƒé›¶åœ°å€çš„ä¾‹å­ï¼Œè¯æ˜ä¸å¯ä»¥ç›´æ¥ != 0æ¥æ¯”è¾ƒ</span><br>        <span class="hljs-comment">// åœ¨ç°å®ä¸­è¿™æ ·çš„å¾ªç¯å¯èƒ½å¾ˆè€— gas</span><br>        <span class="hljs-keyword">while</span> (voters[to].<span class="hljs-property">delegate</span> != <span class="hljs-title function_">address</span>(<span class="hljs-number">0</span>)) &#123;<br>            to = voters[to].<span class="hljs-property">delegate</span>;<br><br>            <span class="hljs-comment">// We found a loop in the delegation, not allowed.</span><br>            <span class="hljs-comment">// å†…ç½® required æ–­è¨€</span><br>            <span class="hljs-built_in">require</span>(to != msg.<span class="hljs-property">sender</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// Since `sender` is a reference, this</span><br>        <span class="hljs-comment">// modifies `voters[msg.sender].voted`</span><br>        <span class="hljs-comment">// æŠŠè¢«å§”æ‰˜è€…çš„æ—§å€¼ä½œåºŸæ‰</span><br>        sender.<span class="hljs-property">voted</span> = <span class="hljs-literal">true</span>;<br>        sender.<span class="hljs-property">delegate</span> = to;<br>        <span class="hljs-title class_">Voter</span> storage delegate = voters[to];<br>        <span class="hljs-keyword">if</span> (delegate.<span class="hljs-property">voted</span>) &#123;<br>            <span class="hljs-comment">// If the delegate already voted,</span><br>            <span class="hljs-comment">// directly add to the number of votes</span><br>            proposals[delegate.<span class="hljs-property">vote</span>].<span class="hljs-property">voteCount</span> += sender.<span class="hljs-property">weight</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// If the delegate did not vote yet,</span><br>            <span class="hljs-comment">// add to her weight.</span><br>            delegate.<span class="hljs-property">weight</span> += sender.<span class="hljs-property">weight</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// æ¯ä¸€ä¸ªåˆçº¦éƒ½æ˜¯</span><br>    <span class="hljs-comment">/// Give your vote (including votes delegated to you)</span><br>    <span class="hljs-comment">/// to proposal `proposals[proposal].name`.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">vote</span>(<span class="hljs-params">uint proposal</span>) public &#123;<br>        <span class="hljs-title class_">Voter</span> storage sender = voters[msg.<span class="hljs-property">sender</span>];<br>        <span class="hljs-built_in">require</span>(!sender.<span class="hljs-property">voted</span>);<br>        sender.<span class="hljs-property">voted</span> = <span class="hljs-literal">true</span>;<br>        sender.<span class="hljs-property">vote</span> = proposal;<br><br>        <span class="hljs-comment">// If `proposal` is out of the range of the array,</span><br>        <span class="hljs-comment">// this will throw automatically and revert all</span><br>        <span class="hljs-comment">// changes.</span><br>        proposals[proposal].<span class="hljs-property">voteCount</span> += sender.<span class="hljs-property">weight</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/// @dev Computes the winning proposal taking all</span><br>    <span class="hljs-comment">/// previous votes into account.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">winningProposal</span>(<span class="hljs-params"></span>) public view<br>            <span class="hljs-title function_">returns</span> (uint winningProposal)<br>    &#123;<br>        <span class="hljs-comment">// solidity çš„ dummy æ•°å€¼å¯¹è±¡å°±æ˜¯è¿™æ ·å†™çš„äº†</span><br>        uint winningVoteCount = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">// æ³¨æ„ï¼Œè¿™ä¸ª proposals æ˜¯æ•°ç»„ï¼Œwinner å…¶å®åªæ˜¯è¿™ä¸ªæ•°ç»„çš„ä¸€ä¸ªç´¢å¼•</span><br>        <span class="hljs-keyword">for</span> (uint p = <span class="hljs-number">0</span>; p &lt; proposals.<span class="hljs-property">length</span>; p++) &#123;<br>            <span class="hljs-keyword">if</span> (proposals[p].<span class="hljs-property">voteCount</span> &gt; winningVoteCount) &#123;<br>                winningVoteCount = proposals[p].<span class="hljs-property">voteCount</span>;<br>                winningProposal = p;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// Calls winningProposal() function to get the index</span><br>    <span class="hljs-comment">// of the winner contained in the proposals array and then</span><br>    <span class="hljs-comment">// returns the name of the winner</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">winnerName</span>(<span class="hljs-params"></span>) public view<br>            <span class="hljs-title function_">returns</span> (bytes32 winnerName)<br>    &#123;<br>        winnerName = proposals[<span class="hljs-title function_">winningProposal</span>()].<span class="hljs-property">name</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªåˆçº¦å¯ä»¥æå‡çš„åœ°æ–¹ï¼Œå°±æ˜¯æ€æ ·æå‡äº‹åŠ¡çš„æ•ˆç‡ï¼Ÿ</p>
<h3 id="ç›²æ‹å–">ç›²æ‹å–</h3>
<h4 id="ç®€å•æ‹å–">ç®€å•æ‹å–</h4>
<p>æ¥ä¸‹æ¥å‡ºç°çš„ç®€å•æ˜æ‹å–åˆçº¦çš„å¤§æ„æ˜¯æ¯ä¸ªäººéƒ½å¯ä»¥åœ¨æŠ•æ ‡æœŸå†…æŠŠæŠ•æ ‡æŠ•å‡ºå»ã€‚æŠ•æ ‡å·²ç»åŒ…å«äº†å‘é€é‡‘é’±/ä»¥å¤ªå¸ï¼Œä»¥æŠŠæŠ•æ ‡è€…å’ŒæŠ•æ ‡ç»‘å®šèµ·æ¥ã€‚å¦‚æœæœ€é«˜æŠ•æ ‡ä¸Šå‡äº†ï¼Œå‰ä¸€ä¸ªæœ€é«˜æŠ•æ ‡è€…ä¼šæ‹¿å›å¥¹çš„é’±ã€‚åœ¨æŠ•æ ‡å‘¨æœŸçš„æœ€åï¼Œåˆçº¦è¦è®©å—ç›Šäººæ‰‹åŠ¨è°ƒç”¨æ¥è·å¾—å®ƒçš„é’±ï¼Œåˆçº¦ä¸èƒ½æ¿€æ´»å®ƒè‡ªå·±ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract <span class="hljs-title class_">SimpleAuction</span> &#123;<br>    <span class="hljs-comment">// å–ä¸œè¥¿çš„äºº</span><br>    <span class="hljs-comment">// Parameters of the auction. Times are either</span><br>    <span class="hljs-comment">// absolute unix timestamps (seconds since 1970-01-01)</span><br>    <span class="hljs-comment">// or time periods in seconds.</span><br>    address public beneficiary;<br>    <span class="hljs-comment">// ç”¨æ•´æ•°æ¥è¡¨ç¤ºæ—¶é—´</span><br>    uint public auctionEnd;<br><br>    <span class="hljs-comment">// å½“å‰æœ€é«˜æŠ•æ ‡è€…çš„åœ°å€</span><br>    <span class="hljs-comment">// Current state of the auction.</span><br>    address public highestBidder;<br>    <span class="hljs-comment">// æœ€é«˜çš„æŠ•æ ‡</span><br>    uint public highestBid;<br><br>    <span class="hljs-comment">// å—è®¸å¯çš„ä¹‹å‰æŠ•æ ‡çš„é€€æ¬¾ï¼Œåœ¨è¿™é‡Œ withdrawal ç­‰äº refund äº†</span><br>    <span class="hljs-comment">// Allowed withdrawals of previous bids</span><br>    <span class="hljs-title function_">mapping</span>(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> uint) pendingReturns;<br><br>    <span class="hljs-comment">// Set to true at the end, disallows any change</span><br>    bool ended;<br><br>    <span class="hljs-comment">// Events that will be fired on changes.</span><br>    event <span class="hljs-title class_">HighestBidIncreased</span>(address bidder, uint amount);<br>    event <span class="hljs-title class_">AuctionEnded</span>(address winner, uint amount);<br>    <br>    <span class="hljs-comment">// ä¸‰æ–œæ çš„æ˜¯æç¤ºç¬¦è¯„è®ºï¼Œå¯ä»¥æç¤ºç”¨æˆ·æ˜¯å¦ç¡®è®¤ä¸€ä¸ªäº‹åŠ¡</span><br>    <span class="hljs-comment">// The following is a so-called natspec comment,</span><br>    <span class="hljs-comment">// recognizable by the three slashes.</span><br>    <span class="hljs-comment">// It will be shown when the user is asked to</span><br>    <span class="hljs-comment">// confirm a transaction.</span><br><br>    <span class="hljs-comment">/// Create a simple auction with `_biddingTime`</span><br>    <span class="hljs-comment">/// seconds bidding time on behalf of the</span><br>    <span class="hljs-comment">/// beneficiary address `_beneficiary`.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">SimpleAuction</span>(<span class="hljs-params"></span><br><span class="hljs-params">        uint _biddingTime,</span><br><span class="hljs-params">        address _beneficiary</span><br><span class="hljs-params">    </span>) public &#123;<br>        beneficiary = _beneficiary;<br>        <span class="hljs-comment">// çœ‹æ¥ now ä¹Ÿæ˜¯ç§’æ•°çš„æ„æ€ã€‚æ¢è¨€ä¹‹ï¼Œæ²¡æœ‰æ¯«ç§’æ•°ã€‚</span><br>        auctionEnd = now + _biddingTime;<br>    &#125;<br><br>    <span class="hljs-comment">/// Bid on the auction with the value sent</span><br>    <span class="hljs-comment">/// together with this transaction.</span><br>    <span class="hljs-comment">/// The value will only be refunded if the</span><br>    <span class="hljs-comment">/// auction is not won.</span><br>    <span class="hljs-comment">// payable å°±æ˜¯æ‹¿æ¥ä¿®é¥° function çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯ payble çš„ã€‚</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">bid</span>(<span class="hljs-params"></span>) public payable &#123;<br>        <span class="hljs-comment">// No arguments are necessary, all</span><br>        <span class="hljs-comment">// information is already part of</span><br>        <span class="hljs-comment">// the transaction. The keyword payable</span><br>        <span class="hljs-comment">// is required for the function to</span><br>        <span class="hljs-comment">// be able to receive Ether.</span><br><br>        <span class="hljs-comment">// Revert the call if the bidding</span><br>        <span class="hljs-comment">// period is over.</span><br>        <span class="hljs-built_in">require</span>(now &lt;= auctionEnd);<br><br>        <span class="hljs-comment">// If the bid is not higher, send the</span><br>        <span class="hljs-comment">// money back.</span><br>        <span class="hljs-comment">// è¿™ä¸ª payable çš„åˆçº¦ä¹Ÿå¯ä»¥è¢«æ–­è¨€æ‰€ä¸­æ–­</span><br>        <span class="hljs-built_in">require</span>(msg.<span class="hljs-property">value</span> &gt; highestBid);<br>        <br>        <span class="hljs-comment">// æœ€é«˜æŠ•æ ‡è€…çš„åœ°å€çš„å¦ä¸€ç§æ¯”å¯¹æ–¹æ³•</span><br>        <span class="hljs-keyword">if</span> (highestBidder != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// Sending back the money by simply using</span><br>            <span class="hljs-comment">// highestBidder.send(highestBid) is a security risk</span><br>            <span class="hljs-comment">// because it could execute an untrusted contract.</span><br>            <span class="hljs-comment">// It is always safer to let the recipients</span><br>            <span class="hljs-comment">// withdraw their money themselves.</span><br>            pendingReturns[highestBidder] += highestBid;<br>        &#125;<br>        highestBidder = msg.<span class="hljs-property">sender</span>;<br>        highestBid = msg.<span class="hljs-property">value</span>;<br>        <span class="hljs-title class_">HighestBidIncreased</span>(msg.<span class="hljs-property">sender</span>, msg.<span class="hljs-property">value</span>);<br>        <br>        <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•æ²¡æœ‰ä»»ä½•ç›´æ¥æ‘¸åˆçº¦ account çš„åœ°æ–¹ï¼Œä½†è¿™ä¸ªpayable æ–¹æ³•çš„å†…å®¹é‡Œå¤„å¤„å……æ»¡äº† msg.value</span><br>    &#125;<br><br>    <span class="hljs-comment">/// Withdraw a bid that was overbid.</span><br>    <span class="hljs-comment">//  è¿™ä¸ªé€€æ¬¾å‡½æ•°æ˜¯è°æ¥è°ƒç”¨ ?</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params"></span>) public <span class="hljs-title function_">returns</span> (bool) &#123;<br>        uint amount = pendingReturns[msg.<span class="hljs-property">sender</span>];<br>        <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// It is important to set this to zero because the recipient</span><br>            <span class="hljs-comment">// can call this function again as part of the receiving call</span><br>            <span class="hljs-comment">// before `send` returns.</span><br>            pendingReturns[msg.<span class="hljs-property">sender</span>] = <span class="hljs-number">0</span>;<br><br>            <span class="hljs-keyword">if</span> (!msg.<span class="hljs-property">sender</span>.<span class="hljs-title function_">send</span>(amount)) &#123;<br>                <span class="hljs-comment">// No need to call throw here, just reset the amount owing</span><br>                pendingReturns[msg.<span class="hljs-property">sender</span>] = amount;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/// End the auction and send the highest bid</span><br>    <span class="hljs-comment">/// to the beneficiary.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">auctionEnd</span>(<span class="hljs-params"></span>) public &#123;<br>        <span class="hljs-comment">// It is a good guideline to structure functions that interact</span><br>        <span class="hljs-comment">// with other contracts (i.e. they call functions or send Ether)</span><br>        <span class="hljs-comment">// into three phases:</span><br>        <span class="hljs-comment">// 1. checking conditions</span><br>        <span class="hljs-comment">// 2. performing actions (potentially changing conditions)</span><br>        <span class="hljs-comment">// 3. interacting with other contracts</span><br>        <span class="hljs-comment">// If these phases are mixed up, the other contract could call</span><br>        <span class="hljs-comment">// back into the current contract and modify the state or cause</span><br>        <span class="hljs-comment">// effects (ether payout) to be performed multiple times.</span><br>        <span class="hljs-comment">// If functions called internally include interaction with external</span><br>        <span class="hljs-comment">// contracts, they also have to be considered interaction with</span><br>        <span class="hljs-comment">// external contracts.</span><br><br>        <span class="hljs-comment">// 1. Conditions</span><br>        <span class="hljs-built_in">require</span>(now &gt;= auctionEnd); <span class="hljs-comment">// auction did not yet end</span><br>        <span class="hljs-built_in">require</span>(!ended); <span class="hljs-comment">// this function has already been called</span><br><br>        <span class="hljs-comment">// 2. Effects</span><br>        ended = <span class="hljs-literal">true</span>;<br>        <span class="hljs-title class_">AuctionEnded</span>(highestBidder, highestBid);<br><br>        <span class="hljs-comment">// 3. Interaction</span><br>        beneficiary.<span class="hljs-title function_">transfer</span>(highestBid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="ç›²æ‹å–">ç›²æ‹å–</h4>
<p>ç›²æ‹å–çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰å‘ç€æ‹å–ç»ˆç‚¹çš„æ—¶é—´å‹åŠ›ã€‚</p>
<p>ç®€åŒ–ä¸€ä¸ªç›²æ‹å–æ¨¡å‹ã€‚ç”¨æˆ·å…ˆç”¨å¤´æ ‡å¿—çš„ hash æŠ•æ ‡ã€‚æŠ•æ ‡ç»“æŸåå¤§å®¶æ­ç¤ºå‡ºè‡ªå·±çš„æŠ•æ ‡å€¼ï¼ŒåŒæ—¶æ ¡éªŒ hash æ˜¯å¦ç›¸åŒä»¥åŠæ•°å€¼æ˜¯å¦æœ€é«˜ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢æœ‰äº›äººæ‹å®Œä¸ç»™é’±ï¼Œè¿™ä¸ªåˆçº¦è¿˜è¿›ä¸€æ­¥è¦æ±‚å¤§å®¶æŠŠä»·å€¼å’ŒæŠ•æ ‡ä¸€èµ·å‘é€ï¼Œå‰è€…è‡ªç„¶æ˜¯æ˜æ–‡çš„ï¼Œè€Œåè€…æ˜¯åŠ å¯†çš„ã€‚ä¸ºäº†ä¸æš´éœ²éšç§ï¼Œåˆçº¦æ¥å—ä¸€åˆ‡é™„å¸¦çš„ä»·å€¼é«˜äºå½“å‰æœ€é«˜æŠ•æ ‡ä»·çš„æ–°æŠ•æ ‡è½¬è´¦ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œåœ¨ä»·å€¼æ­ç¤ºç¯èŠ‚ï¼Œæœ‰äº›æŠ•æ ‡æ˜¯æ— æ•ˆçš„ä¸æˆç«‹çš„ã€‚æŠ•æ ‡è€…ç”šè‡³å¯ä»¥ç”¨ä¸€äº›é”™è¯¯çš„é«˜æŠ•æ ‡æˆ–è€…ä½æŠ•æ ‡æ¥è¿·æƒ‘æ•´ä¸ªç«äº‰ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract <span class="hljs-title class_">BlindAuction</span> &#123;<br>    struct <span class="hljs-title class_">Bid</span> &#123;<br>        bytes32 blindedBid;<br>        <span class="hljs-comment">// é”æ­»å­˜æ¬¾</span><br>        uint deposit;<br>    &#125;<br><br>    address public beneficiary;<br>    uint public biddingEnd;<br>    uint public revealEnd;<br>    bool public ended;<br><br>    <span class="hljs-title function_">mapping</span>(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> <span class="hljs-title class_">Bid</span>[]) public bids;<br><br>    address public highestBidder;<br>    uint public highestBid;<br><br>    <span class="hljs-comment">// Allowed withdrawals of previous bids</span><br>    <span class="hljs-title function_">mapping</span>(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> uint) pendingReturns;<br><br>    event <span class="hljs-title class_">AuctionEnded</span>(address winner, uint highestBid);<br><br>    <span class="hljs-comment">/// Modifiers are a convenient way to validate inputs to</span><br>    <span class="hljs-comment">/// functions. `onlyBefore` is applied to `bid` below:</span><br>    <span class="hljs-comment">/// The new function body is the modifier&#x27;s body where</span><br>    <span class="hljs-comment">/// `_` is replaced by the old function body.</span><br>    <span class="hljs-comment">// modifier æœ‰ç‚¹åƒè£…é¥°å™¨ï¼Œç»“åˆäº† requireï¼Œ_æŒ‡çš„å°±æ˜¯è¢«ä¿®é¥°æ–¹æ³•çš„ body</span><br>    modifier <span class="hljs-title function_">onlyBefore</span>(<span class="hljs-params">uint _time</span>) &#123; <span class="hljs-built_in">require</span>(now &lt; _time); _; &#125;<br>    modifier <span class="hljs-title function_">onlyAfter</span>(<span class="hljs-params">uint _time</span>) &#123; <span class="hljs-built_in">require</span>(now &gt; _time); _; &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">BlindAuction</span>(<span class="hljs-params"></span><br><span class="hljs-params">        uint _biddingTime,</span><br><span class="hljs-params">        uint _revealTime,</span><br><span class="hljs-params">        address _beneficiary</span><br><span class="hljs-params">    </span>) public &#123;<br>        beneficiary = _beneficiary;<br>        <span class="hljs-comment">// åœ¨è¿™é‡Œç›´æ¥æ‹¿èµ·ç‚¹æ—¶é—´æˆ³æ¥ç”Ÿæˆæ¥ä¸‹æ¥çš„æ—¶é—´èŠ‚ç‚¹å°±è¡Œäº†</span><br>        biddingEnd = now + _biddingTime;<br>        revealEnd = biddingEnd + _revealTime;<br>    &#125;<br><br>    <span class="hljs-comment">// keccak å‡½æ•°æ˜¯ SHA-3å‡½æ•°çš„åˆ«åï¼Œè¢«ä»¥å¤ªåŠæ›´åè¿‡çš„å‡½æ•°ã€‚SHA-256å®é™…ä¸Šæ˜¯ SHA-2 çš„ä¸€ä¸ªå­ç±»å‹ï¼Œkeccak ç®—æ³•æ˜¯ä¸‹ä¸€ä»£çš„ SHA-3ç®—æ³•ï¼Œæ˜¯æœ€å¼ºçš„æ•£åˆ—ç®—æ³•ã€‚http://www.atool.org/hash.php</span><br>    <span class="hljs-comment">// keccak æ˜¯ä¸ªæ¾æ•£å‚æ•°å‡½æ•°ï¼Œæ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯æ•£åˆ—çš„ç§å­ï¼Œä¼šè¢«å‡½æ•°ç›´æ¥æ‹¼æ¥èµ·æ¥ï¼Œç±»ä¼¼åˆ†æ®µç­¾åç›¸åŠ çš„æ€è·¯ã€‚</span><br>    <span class="hljs-comment">/// Place a blinded bid with `_blindedBid` = keccak256(value,</span><br>    <span class="hljs-comment">/// fake, secret).</span><br>    <span class="hljs-comment">/// The sent ether is only refunded if the bid is correctly</span><br>    <span class="hljs-comment">/// revealed in the revealing phase. The bid is valid if the</span><br>    <span class="hljs-comment">/// ether sent together with the bid is at least &quot;value&quot; and</span><br>    <span class="hljs-comment">/// &quot;fake&quot; is not true. Setting &quot;fake&quot; to true and sending</span><br>    <span class="hljs-comment">/// not the exact amount are ways to hide the real bid but</span><br>    <span class="hljs-comment">/// still make the required deposit. The same address can</span><br>    <span class="hljs-comment">/// place multiple bids.</span><br>    <span class="hljs-comment">// ä¸€ä¸ªåœ°å€å¯ä»¥åšå¤šä¸ªæŠ•æ ‡ã€‚åªæœ‰è¢«æ­£ç¡®äº®å‡ºçš„æŠ•æ ‡å€¼æ‰ä¼šè¢«è¿”è¿˜ï¼ˆå…¶ä»–çš„æŠ•æ ‡å€¼å°±ä¸è¿”è¿˜äº†å—ï¼Ÿï¼‰ã€‚åªæœ‰é™„å¸¦çš„æŠ•æ ‡å€¼å¤§äºç­‰äºvalueï¼ˆè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿï¼‰è€Œä¸” fake ä¸æ˜¯ trueã€‚è®¾ç½® fake ä¸º true è€Œä¸”å‘é€ä¸å‡†ç¡®çš„æ•°é¢æ˜¯éšè—çœŸå®æŠ•æ ‡ä½†æ»¡è¶³è¦æ±‚çš„é”å®šå­˜æ¬¾çš„æ–¹æ³•ã€‚</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">bid</span>(<span class="hljs-params">bytes32 _blindedBid</span>)<br>        public<br>        payable<br>        <span class="hljs-title function_">onlyBefore</span>(<span class="hljs-params">biddingEnd</span>)<br>    &#123;<br>        bids[msg.<span class="hljs-property">sender</span>].<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Bid</span>(&#123;<br>            <span class="hljs-attr">blindedBid</span>: _blindedBid,<br>            <span class="hljs-attr">deposit</span>: msg.<span class="hljs-property">value</span><br>        &#125;));<br>    &#125;<br>    <br>    <span class="hljs-comment">// äº®æ ‡ã€‚ç”¨æˆ·å¯ä»¥å¾—åˆ°æ‰€æœ‰è¢«æ­£ç¡®æ©ç›–çš„é”™æ ‡ï¼Œå’Œé™¤äº†æœ€é«˜æ ‡ä»¥å¤–çš„æ‰€æœ‰æ ‡ã€‚</span><br>    <span class="hljs-comment">/// Reveal your blinded bids. You will get a refund for all</span><br>    <span class="hljs-comment">/// correctly blinded invalid bids and for all bids except for</span><br>    <span class="hljs-comment">/// the totally highest.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">reveal</span>(<span class="hljs-params"></span><br><span class="hljs-params">        uint[] _values,</span><br><span class="hljs-params">        bool[] _fake,</span><br><span class="hljs-params">        bytes32[] _secret</span><br><span class="hljs-params">    </span>)<br>        public<br>        <span class="hljs-title function_">onlyAfter</span>(biddingEnd)<br>        <span class="hljs-title function_">onlyBefore</span>(<span class="hljs-params">revealEnd</span>)<br>    &#123;<br>        uint length = bids[msg.<span class="hljs-property">sender</span>].<span class="hljs-property">length</span>;<br>        <span class="hljs-built_in">require</span>(_values.<span class="hljs-property">length</span> == length);<br>        <span class="hljs-built_in">require</span>(_fake.<span class="hljs-property">length</span> == length);<br>        <span class="hljs-built_in">require</span>(_secret.<span class="hljs-property">length</span> == length);<br><br>        uint refund;<br>        <span class="hljs-keyword">for</span> (uint i = <span class="hljs-number">0</span>; i &lt; length; i++) &#123;<br>            <span class="hljs-keyword">var</span> bid = bids[msg.<span class="hljs-property">sender</span>][i];<br>            <span class="hljs-title function_">var</span> (value, fake, secret) =<br>                    (_values[i], _fake[i], _secret[i]);<br>            <span class="hljs-keyword">if</span> (bid.<span class="hljs-property">blindedBid</span> != <span class="hljs-title function_">keccak256</span>(value, fake, secret)) &#123;<br>                <span class="hljs-comment">// Bid was not actually revealed.</span><br>                <span class="hljs-comment">// Do not refund deposit.</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            refund += bid.<span class="hljs-property">deposit</span>;<br>            <span class="hljs-comment">// deposit æ˜¯å®é™…å­˜å…¥çš„é”å®šä»·å€¼ï¼Œvalue æ˜¯ç”¨æ¥åšæ•£åˆ—ç§å­çš„å£°ç§°ä»·å€¼</span><br>            <span class="hljs-keyword">if</span> (!fake &amp;&amp; bid.<span class="hljs-property">deposit</span> &gt;= value) &#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-title function_">placeBid</span>(msg.<span class="hljs-property">sender</span>, value))<br>                    refund -= value;<br>            &#125;<br>            <span class="hljs-comment">// å› ä¸ºä»¥å¤ªåŠå¯ä»¥è¢«è®¤ä¸ºæ˜¯åºåˆ—åŒ–çš„äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç½®é›¶å¯ä»¥æŠ—å¹¶å‘é—®é¢˜</span><br>            <span class="hljs-comment">// Make it impossible for the sender to re-claim</span><br>            <span class="hljs-comment">// the same deposit.</span><br>            bid.<span class="hljs-property">blindedBid</span> = <span class="hljs-title function_">bytes32</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>        msg.<span class="hljs-property">sender</span>.<span class="hljs-title function_">transfer</span>(refund);<br>    &#125;<br><br>    <span class="hljs-comment">// internal çš„ç¬¬ä¸€ä¸ªç”¨æ³•ï¼Œinternal å‡½æ•°ç±»ä¼¼ privateï¼Œåªèƒ½åœ¨åˆçº¦å†…éƒ¨ä½¿ç”¨äº†ã€‚</span><br>    <span class="hljs-comment">// This is an &quot;internal&quot; function which means that it</span><br>    <span class="hljs-comment">// can only be called from the contract itself (or from</span><br>    <span class="hljs-comment">// derived contracts).</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">placeBid</span>(<span class="hljs-params">address bidder, uint value</span>) internal<br>            <span class="hljs-title function_">returns</span> (bool success)<br>    &#123;<br>        <span class="hljs-comment">// ä¸ä¸­æ ‡ã€‚æ‰€ä»¥åœ¨è¿™é‡Œ place å°±æ˜¯æ”¾æ ‡çš„æ„æ€ï¼Ÿ</span><br>        <span class="hljs-keyword">if</span> (value &lt;= highestBid) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (highestBidder != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å…ˆæŠŠä¹‹å‰çš„æœ€é«˜æ ‡æ”¾è¿›é€€æ¬¾åå•é‡Œé¢</span><br>            <span class="hljs-comment">// Refund the previously highest bidder.</span><br>            pendingReturns[highestBidder] += highestBid;<br>        &#125;<br>        <span class="hljs-comment">// æ›¿æ¢æœ€é«˜æ ‡</span><br>        highestBid = value;<br>        highestBidder = bidder;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/// Withdraw a bid that was overbid.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params"></span>) public &#123;<br>        uint amount = pendingReturns[msg.<span class="hljs-property">sender</span>];<br>        <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// It is important to set this to zero because the recipient</span><br>            <span class="hljs-comment">// can call this function again as part of the receiving call</span><br>            <span class="hljs-comment">// before `transfer` returns (see the remark above about</span><br>            <span class="hljs-comment">// conditions -&gt; effects -&gt; interaction).</span><br>            pendingReturns[msg.<span class="hljs-property">sender</span>] = <span class="hljs-number">0</span>;<br><br>            msg.<span class="hljs-property">sender</span>.<span class="hljs-title function_">transfer</span>(amount);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// åœ¨æ‹å–ç»“æŸçš„æ—¶å€™æŠŠæŠ•æ ‡æ¬¾è½¬èµ°ã€‚</span><br>    <span class="hljs-comment">/// End the auction and send the highest bid</span><br>    <span class="hljs-comment">/// to the beneficiary.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">auctionEnd</span>(<span class="hljs-params"></span>)<br>        public<br>        <span class="hljs-title function_">onlyAfter</span>(<span class="hljs-params">revealEnd</span>)<br>    &#123;<br>        <span class="hljs-built_in">require</span>(!ended);<br>        <span class="hljs-title class_">AuctionEnded</span>(highestBidder, highestBid);<br>        ended = <span class="hljs-literal">true</span>;<br>        beneficiary.<span class="hljs-title function_">transfer</span>(highestBid);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ¯ä¸ªåˆçº¦åªæœ‰ä¸€ä¸ª payable æ–¹æ³•ã€‚</p>
<h3 id="å®‰å…¨çš„è¿œç¨‹è´­ä¹°">å®‰å…¨çš„è¿œç¨‹è´­ä¹°</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs javascript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract <span class="hljs-title class_">Purchase</span> &#123;<br>    uint public value;<br>    address public seller;<br>    address public buyer;<br>    enum <span class="hljs-title class_">State</span> &#123; <span class="hljs-title class_">Created</span>, <span class="hljs-title class_">Locked</span>, <span class="hljs-title class_">Inactive</span> &#125;<br>    <span class="hljs-title class_">State</span> public state;<br><br>    <span class="hljs-comment">// ç¡®è®¤ä»·å€¼æ˜¯å¶æ•°ï¼ˆä¸ºä»€ä¹ˆï¼Ÿï¼‰ã€‚ç”±å–æ–¹åˆå§‹åŒ–åˆçº¦ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°ä¹Ÿæ˜¯ payable çš„åˆçº¦ã€‚åˆå§‹åŒ–åˆçº¦çš„ valueï¼Œå¤§è‡´ç­‰äºä¸€ä¸ªä¹°å–çš„æŠ¼é‡‘ã€‚</span><br>    <span class="hljs-comment">// Ensure that `msg.value` is an even number.</span><br>    <span class="hljs-comment">// Division will truncate if it is an odd number.</span><br>    <span class="hljs-comment">// Check via multiplication that it wasn&#x27;t an odd number.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">Purchase</span>(<span class="hljs-params"></span>) public payable &#123;<br>        seller = msg.<span class="hljs-property">sender</span>;<br>        value = msg.<span class="hljs-property">value</span> / <span class="hljs-number">2</span>;<br>        <span class="hljs-built_in">require</span>((<span class="hljs-number">2</span> * value) == msg.<span class="hljs-property">value</span>);<br>    &#125;<br><br>    modifier <span class="hljs-title function_">condition</span>(<span class="hljs-params">bool _condition</span>) &#123;<br>        <span class="hljs-built_in">require</span>(_condition);<br>        _;<br>    &#125;<br><br>    modifier <span class="hljs-title function_">onlyBuyer</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-built_in">require</span>(msg.<span class="hljs-property">sender</span> == buyer);<br>        _;<br>    &#125;<br><br>    modifier <span class="hljs-title function_">onlySeller</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-built_in">require</span>(msg.<span class="hljs-property">sender</span> == seller);<br>        _;<br>    &#125;<br><br>    modifier <span class="hljs-title function_">inState</span>(<span class="hljs-params">State _state</span>) &#123;<br>        <span class="hljs-built_in">require</span>(state == _state);<br>        _;<br>    &#125;<br><br>    event <span class="hljs-title class_">Aborted</span>();<br>    event <span class="hljs-title class_">PurchaseConfirmed</span>();<br>    event <span class="hljs-title class_">ItemReceived</span>();<br><br>    <span class="hljs-comment">/// Abort the purchase and reclaim the ether.</span><br>    <span class="hljs-comment">/// Can only be called by the seller before</span><br>    <span class="hljs-comment">/// the contract is locked.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">abort</span>(<span class="hljs-params"></span>)<br>        public<br>        onlySeller<br>        <span class="hljs-title function_">inState</span>(<span class="hljs-params">State.Created</span>)<br>    &#123;<br>        <span class="hljs-title class_">Aborted</span>();<br>        state = <span class="hljs-title class_">State</span>.<span class="hljs-property">Inactive</span>;<br>        <span class="hljs-comment">// è¿™ä¸ª balance å°±æ˜¯åˆçº¦è‡ªå¸¦çš„æ‰€æœ‰ balance äº†ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ value ä¸€ç±»çš„æˆå‘˜å˜é‡ã€‚</span><br>        seller.<span class="hljs-title function_">transfer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">balance</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">/// Confirm the purchase as buyer.</span><br>    <span class="hljs-comment">/// Transaction has to include `2 * value` ether.</span><br>    <span class="hljs-comment">/// The ether will be locked until confirmReceived</span><br>    <span class="hljs-comment">/// is called.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">confirmPurchase</span>(<span class="hljs-params"></span>)<br>        public<br>        <span class="hljs-title function_">inState</span>(<span class="hljs-title class_">State</span>.<span class="hljs-property">Created</span>)<br>        <span class="hljs-title function_">condition</span>(msg.<span class="hljs-property">value</span> == (<span class="hljs-number">2</span> * value))<br>        payable<br>    &#123;   <br>        <span class="hljs-comment">// å‘å‡ºè´­ä¹°é”å®šäº‹ä»¶</span><br>        <span class="hljs-title class_">PurchaseConfirmed</span>();<br>        buyer = msg.<span class="hljs-property">sender</span>;<br>        state = <span class="hljs-title class_">State</span>.<span class="hljs-property">Locked</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/// Confirm that you (the buyer) received the item.</span><br>    <span class="hljs-comment">/// This will release the locked ether.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">confirmReceived</span>(<span class="hljs-params"></span>)<br>        public<br>        onlyBuyer<br>        <span class="hljs-title function_">inState</span>(<span class="hljs-params">State.Locked</span>)<br>    &#123;<br>        <span class="hljs-comment">// å‘å‡ºäº‹ä»¶</span><br>        <span class="hljs-title class_">ItemReceived</span>();<br>        <span class="hljs-comment">// It is important to change the state first because</span><br>        <span class="hljs-comment">// otherwise, the contracts called using `send` below</span><br>        <span class="hljs-comment">// can call in again here.</span><br>        state = <span class="hljs-title class_">State</span>.<span class="hljs-property">Inactive</span>;<br><br>        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> This actually allows both the buyer and the seller to</span><br>        <span class="hljs-comment">// block the refund - the withdraw pattern should be used.</span><br>        <span class="hljs-comment">// æŠŠæŠ¼é‡‘è½¬ç»™ä¹°å®¶ï¼ŒæŠŠå·®é¢äº¤ç»™å–å®¶ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿä¸ºäº†é¿å…ç©ºå£æ— å‡­çš„å–å®¶æµªè´¹åˆçº¦ä»·å€¼ï¼Ÿ</span><br>        buyer.<span class="hljs-title function_">transfer</span>(value);<br>        seller.<span class="hljs-title function_">transfer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">balance</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™è¶³ä»¥è¯æ˜ä¸€ä¸ªåˆçº¦æœ‰å¥½å‡ ä¸ª payable æ–¹æ³•ï¼Œå…è®¸å¤šè§’è‰²åšå¼ˆäº†ã€‚<br>
è¿™ä¸ªåˆçº¦æ²¡æœ‰ä»»ä½•çš„ internal å‡½æ•°ã€‚</p>
<h2 id="æ·±å…¥solidity">æ·±å…¥Solidity</h2>
<h3 id="solidity-æºæ–‡ä»¶çš„è½®å»“">Solidity æºæ–‡ä»¶çš„è½®å»“</h3>
<p>æºæ–‡ä»¶å¯ä»¥åŒ…å«ä»»æ„å¤šçš„åˆçº¦å®šä¹‰ã€‚</p>
<h4 id="ç‰ˆæœ¬-pragma">ç‰ˆæœ¬ pragma</h4>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// è¿™ä¸ªå°–è§’å·æ„å‘³ç€ä¸èƒ½ç”¨é«˜äº0.5.0çš„ç¼–è¯‘å™¨ç¼–è¯‘ã€‚è¿™ä¸ªæ•°å­—è¯´æ˜äº†åˆçº¦çš„æœ€å°ç¼–è¯‘å™¨ç¼–è¯‘å™¨æ˜¯0.4.0ã€‚æ¢è¨€ä¹‹ï¼Œè¦ç”¨é«˜çº§ç¼–è¯‘å™¨ï¼Œè¦ bump up è¿™ä¸ªæ•°å­—ã€‚</span><br><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br></code></pre></td></tr></table></figure>
<h3 id="å¼•å…¥å…¶ä»–æºæ–‡ä»¶">å¼•å…¥å…¶ä»–æºæ–‡ä»¶</h3>
<h4 id="è¯­æ³•å’Œè¯­ä¹‰">è¯­æ³•å’Œè¯­ä¹‰</h4>
<p>Solidity ç”¨ç±»ä¼¼ JavaScript çš„å¼•å…¥è¯­æ³•ï¼Œä½†ä¸æ”¯æŒâ€œdefault exportâ€ã€‚åœ¨å…¨å±€å±‚æ¬¡ï¼Œä½ å¯ä»¥ç”¨ä»¥ä¸‹å½¢å¼çš„å¼•å…¥è¯­å¥ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">import <span class="hljs-string">&quot;filename&quot;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¯­å¥æŠŠè¯¥æ–‡ä»¶åä¸‹æ‰€æœ‰çš„<strong>å…¨å±€</strong>ç¬¦å·å¼•å…¥åˆ°å½“å‰çš„<strong>å…¨å±€</strong>ä½œç”¨åŸŸä¸­ã€‚</p>
<figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs capnproto"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> symbolName <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;filename&quot;</span>;<br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¯­å¥åˆ¶é€ äº†ä¸€ä¸ªæ–°çš„å…¨å±€ç¬¦å·ï¼Œç±»ä¼¼åå­—ç©ºé—´ï¼Œæ‰€æœ‰è¯¥æ–‡ä»¶åä¸‹çš„ç¬¦å·ï¼Œéƒ½æ˜¯è¿™ä¸ªæ–°çš„å…¨å±€ç¬¦å·çš„æˆå‘˜ã€‚å®ƒå’Œ<code>import &quot;filename&quot; as symbolName;</code>ç­‰ä»·ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> &#123;symbol1 <span class="hljs-keyword">as</span> <span class="hljs-keyword">alias</span>, symbol2&#125; <span class="hljs-keyword">from</span> &quot;filename&quot;;<br></code></pre></td></tr></table></figure>
<p>éƒ¨åˆ†å¼•ç”¨å’Œåˆ«åæœºåˆ¶ã€‚</p>
<h4 id="è·¯å¾„">è·¯å¾„</h4>
<p>.å’Œâ€¦çš„æœºåˆ¶åŒ Unix ç³»ç»Ÿã€‚</p>
<p>è¦å¼•ç”¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œç”¨è¿™æ ·çš„è¯­æ³•<code>mport &quot;./x&quot; as x;</code>ã€‚å¦‚æœä½ ä½¿ç”¨äº†<code>import &quot;x&quot; as x;</code>ï¼Œä¸€ä¸ªå…¨å±€çš„â€œinclude directoryâ€é‡Œçš„åŒåæ–‡ä»¶å¤¹ä¼šè¢«å¼•ç”¨ã€‚</p>
<h4 id="é‡æ˜ å°„é—®é¢˜">é‡æ˜ å°„é—®é¢˜</h4>
<p>å¤ªæ— èŠï¼Œç›´æ¥çœ‹æ–‡æ¡£å§ã€‚</p>
<h4 id="æ³¨é‡Šé—®é¢˜">æ³¨é‡Šé—®é¢˜</h4>
<p>æ³¨æ„çœ‹ä¸‹é¢çš„æ–‡æ¡£ï¼Œå±•ç¤ºäº†å¦‚ä½•å†™æ³¨é‡Šï¼Œä¹Ÿå±•ç¤ºäº†å¦‚ä½•å†™å¤šè¿”å›å€¼ã€‚</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs zephir">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-comment">/** <span class="hljs-doctag">@title</span> Shape calculator. */</span><br>contract shapeCalculator &#123;<br>    <span class="hljs-comment">/** <span class="hljs-doctag">@dev</span> Calculates a rectangle&#x27;s surface and perimeter.</span><br><span class="hljs-comment">      * <span class="hljs-doctag">@param</span> w Width of the rectangle.</span><br><span class="hljs-comment">      * <span class="hljs-doctag">@param</span> h Height of the rectangle.</span><br><span class="hljs-comment">      * <span class="hljs-doctag">@return</span> s The calculated surface.</span><br><span class="hljs-comment">      * <span class="hljs-doctag">@return</span> p The calculated perimeter.</span><br><span class="hljs-comment">      */</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rectangle</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> w, <span class="hljs-keyword">uint</span> h)</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> s, <span class="hljs-keyword">uint</span> p)</span> </span>&#123;<br>        s = w * h;<br>        p = <span class="hljs-number">2</span> * (w + h);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="åˆçº¦çš„ç»“æ„">åˆçº¦çš„ç»“æ„</h3>
<p>åˆçº¦å’Œé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡è¯­è¨€é‡Œé¢çš„ class å¾ˆç›¸ä¼¼ã€‚æ¯ä¸ªåˆçº¦å¯ä»¥åŒ…å«<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/structure-of-a-contract.html#structure-state-variables">çŠ¶æ€å˜é‡</a>ã€<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/structure-of-a-contract.html#structure-functions">å‡½æ•°</a>ã€<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/structure-of-a-contract.html#structure-function-modifiers">å‡½æ•°ä¿®é¥°ç¬¦</a>ã€<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/structure-of-a-contract.html#structure-events">äº‹ä»¶</a>ã€<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/structure-of-a-contract.html#structure-struct-types">ç»“æ„ç±»å‹</a>å’Œ<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/structure-of-a-contract.html#structure-enum-types">æšä¸¾ç±»å‹</a>çš„å£°æ˜ã€‚</p>
<h4 id="çŠ¶æ€å˜é‡">çŠ¶æ€å˜é‡</h4>
<p>çŠ¶æ€å˜é‡ä¼šè¢«æŒä¹…åŒ–åœ¨åˆçº¦å­˜å‚¨ï¼ˆçŠ¶æ€ï¼‰é‡Œï¼š</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract SimpleStorage &#123;<br>    <span class="hljs-built_in">uint</span> storedData; <span class="hljs-comment">// State variable</span><br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="å‡½æ•°">å‡½æ•°</h4>
<p>å‡½æ•°æ˜¯ä»£ç çš„å¯æ‰§è¡Œå•å…ƒã€‚</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">0</span>;<br><br>contract SimpleAuction &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">bid</span>() public payable &#123; // <span class="hljs-keyword">Function</span><br>        <span class="hljs-title">//</span> ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/control-structures.html#function-calls">å‡½æ•°è°ƒç”¨</a>å¯ä»¥åœ¨å†…éƒ¨å‘ç”Ÿï¼Œä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨å‘ç”Ÿï¼Œè€Œä¸”é¢å¯¹ä¸åŒçš„å…¶ä»–åˆçº¦å¯ä»¥æ‹¥æœ‰ä¸åŒçš„<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/contracts.html#visibility-and-getters">å¯è§æ€§</a>ã€‚</p>
<h4 id="å‡½æ•°ä¿®é¥°ç¬¦">å‡½æ•°ä¿®é¥°ç¬¦</h4>
<p>å‡½æ•°ä¿®é¥°ç¬¦å¯ä»¥ä»¥å£°æ˜çš„æ–¹å¼ä¿®é¥°å‡½æ•°çš„è¯­ä¹‰ï¼ˆè§<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/contracts.html#modifiers">Function Modifiers</a>éƒ¨åˆ†ï¼‰ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract Purchase &#123;<br>    address <span class="hljs-keyword">public</span> seller;<br>    <br>    <span class="hljs-comment">// æ€»æ˜¯é…åˆ require å‡½æ•°ä½¿ç”¨ã€‚è¿˜å¯ä»¥çœ‹çœ‹ revert ä»€ä¹ˆçš„å‡½æ•°ã€‚</span><br>    <span class="hljs-function">modifier <span class="hljs-title">onlySeller</span>()</span> &#123; <span class="hljs-comment">// Modifier</span><br>        require(msg.sender == seller);<br>        _;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">abort</span>() <span class="hljs-keyword">public</span> onlySeller</span> &#123; <span class="hljs-comment">// Modifier usage</span><br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="äº‹ä»¶">äº‹ä»¶</h4>
<p>äº‹ä»¶å°±æ˜¯æ‹¿æ¥å’Œ EVM æ—¥å¿—è®¾æ–½æ‰“äº¤é“çš„æ–¹ä¾¿æ¥å£ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract SimpleAuction &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-title">HighestBidIncreased</span>(<span class="hljs-params">address bidder, <span class="hljs-built_in">uint</span> amount</span>)</span>; <span class="hljs-comment">// Event</span><br><br>    <span class="hljs-function">function <span class="hljs-title">bid</span>() <span class="hljs-keyword">public</span> payable</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>        HighestBidIncreased(msg.sender, msg.<span class="hljs-keyword">value</span>); <span class="hljs-comment">// Triggering event</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="struct-ç±»å‹">Struct ç±»å‹</h4>
<p>ç±»ä¼¼ C è¯­è¨€ï¼Œæ˜¯åŸºæœ¬ç±»å‹çš„å°è£…ç»„åˆã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract Ballot &#123;<br>    <span class="hljs-keyword">struct</span> Voter &#123; <span class="hljs-comment">// Struct</span><br>        <span class="hljs-built_in">uint</span> weight;<br>        <span class="hljs-built_in">bool</span> voted;<br>        address <span class="hljs-built_in">delegate</span>;<br>        <span class="hljs-built_in">uint</span> vote;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="æšä¸¾ç±»å‹">æšä¸¾ç±»å‹</h4>
<p>ä¾ç„¶ç±»ä¼¼ Javaã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract Purchase &#123;<br>    <span class="hljs-keyword">enum</span> State &#123; Created, Locked, Inactive &#125; <span class="hljs-comment">// Enum</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="ç±»å‹">ç±»å‹</h3>
<p>Solidity æ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œè¿™æ„å‘³ç€ä¸ç®¡æ˜¯çŠ¶æ€å˜é‡è¿˜æ˜¯å±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªå˜é‡çš„ç±»å‹å¿…é¡»åœ¨è¿è¡Œæ—¶è¢«æŒ‡å®šå¥½ï¼ˆè‡³å°‘æ˜¯å·²çŸ¥çš„ï¼Œè§<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/types.html#type-deduction">Type Deduction</a>ï¼‰ã€‚Solidity æä¾›å‡ ä¸ªè‡³å…³é‡è¦çš„ç±»å‹ï¼Œå¯ä»¥è¢«ç»„åˆæˆå¤åˆç±»å‹ã€‚</p>
<h4 id="å€¼ç±»å‹">å€¼ç±»å‹</h4>
<p>ä»¥ä¸‹çš„ç±»å‹æ€»æ˜¯è¢«ç§°ä½œå€¼ç±»å‹ï¼Œå› ä¸ºè¿™äº›ç±»å‹çš„å˜é‡æ€»æ˜¯ä¼šè¢«ä¼ å€¼ã€‚ä»–ä»¬ä½œä¸ºå‡½æ•°å‚æ•°æˆ–è€…èµ‹å€¼ä½¿ç”¨çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šè¢«æ‹·è´ã€‚</p>
<h5 id="å¸ƒå°”ç±»å‹">å¸ƒå°”ç±»å‹</h5>
<p>boolï¼šå¯èƒ½å€¼ä¸ºå¸¸é‡ true æˆ–è€… falseã€‚</p>
<p>é€»è¾‘æ“ä½œç¬¦å’Œå¸¸è§çš„ç¼–ç¨‹è¯­è¨€æ“ä½œç¬¦ç±»ä¼¼ï¼Œä¹Ÿæ”¯æŒ<strong>çŸ­è·¯æ“ä½œ</strong>ã€‚</p>
<h5 id="æ•´å‹">æ•´å‹</h5>
<p><code>int</code>/<code>uint</code>ï¼šå„ç§å°ºå¯¸çš„æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•´å‹æ•°ã€‚å…³é”®å­—<code>uint8</code>å’Œ <code>unint256</code>ä»¥8ä½ä¸ºæ­¥é•¿ï¼Œä»¥åŠ<code>int8</code>å’Œ<code>int256</code>ã€‚ç›¸å¯¹åœ°ï¼Œ<code>unint</code>å’Œ<code>int</code>æ˜¯<code>uint256</code>å’Œ<code>int256</code>çš„åˆ«åï¼ˆæŒ‰ï¼šå³é»˜è®¤æ•°æ®å®½åº¦å°±æ˜¯æœ€å®½ï¼‰ã€‚</p>
<p>é™¤æ³•æ€»æ˜¯ä¼šé€ æˆæˆªæ–­ï¼Œé™¤éä¸¤ä¸ªæ“ä½œç¬¦éƒ½æ˜¯å­—é¢é‡ï¼ˆï¼Ÿï¼‰æˆ–è€…å­—é¢é‡è¡¨è¾¾å¼ã€‚</p>
<p><code>x &lt;&lt; y</code>ç­‰äº<code>x * 2**y</code>ï¼Œè€Œ<code>x &gt;&gt; y</code>ç­‰äº<code>x / 2**y</code>ã€‚ç”¨è´Ÿæ•°ä½œ y å¯èƒ½ä¼šå‡ºè¿è¡Œæ—¶å¼‚å¸¸-è¿™æ˜¯å› ä¸ºä¸åŒç¼–ç¨‹è¯­è¨€çš„ç§»ä½æœ‰å‘0å’Œå‘è´Ÿæ— ç©·ç§»ä½çš„åŒºåˆ«ã€‚</p>
<h5 id="å®šç‚¹æ•°">å®šç‚¹æ•°</h5>
<p>å®šç‚¹æ•°åœ¨ Solidity é‡Œè¿˜æ²¡è¢«å®Œå…¨æ”¯æŒã€‚å®ƒä»¬å¯ä»¥è¢«å£°æ˜ï¼Œä½†ä¸èƒ½è¢«æ‹¿æ¥èµ‹å€¼æˆ–è€…å–å€¼ã€‚</p>
<p><code>fixed</code>/<code>ufixed</code>è¡¨è¾¾çš„æ˜¯ä¸åŒå°ºå¯¸çš„æœ‰ç¬¦å·å’Œæ— ç¬¦å·å®šç‚¹æ•°ã€‚å…³é”®å­—<code>ufixedMxN</code>å’Œ<code>fixedMxN</code>é‡Œï¼Œ<code>M</code> ä»£è¡¨è¿™ä¸ªç±»å‹å¯ä»¥ä½¿ç”¨çš„ä½æ•°ï¼Œè€Œ<code>N</code>ä»£è¡¨çš„æ˜¯æœ‰å¤šå°‘ä¸ªå°æ•°ä½å¯è¢«ä½¿ç”¨ã€‚<code>M</code>å¿…é¡»å¯è¢«8æ•´é™¤ï¼Œä»8å¢é•¿åˆ°256ã€‚<code>N</code>å¿…é¡»åœ¨0åˆ°80ä¹‹é—´ã€‚ç›¸åº”åœ°ï¼Œ<code>ufixed</code>å’Œ<code>fixed</code>æ˜¯<code>ufixed128x19</code> å’Œ <code>fixed128x19</code>çš„åˆ«åã€‚</p>
<p>æµ®ç‚¹æ•°ï¼ˆIEEE 754ï¼‰çš„å°æ•°ç‚¹ä½ç½®æ˜¯å¯å˜çš„ï¼Œè€Œå®šç‚¹æ•°æ˜¯ä¸å¯å˜çš„ã€‚</p>
<h5 id="åœ°å€ç±»å‹">åœ°å€ç±»å‹</h5>
<p>åœ°å€æ‹¥æœ‰20å­—èŠ‚çš„æ•°æ®ï¼Œå®ƒä¹Ÿæœ‰æˆå‘˜ï¼Œè€Œä¸”åœ¨0.5.0ä»¥å‰æ˜¯æ‰€æœ‰åˆçº¦çš„åŸºç±»ã€‚åœ¨0.5.0ä¹‹åï¼Œåˆçº¦ç±»å‹ä¸å†ä»åœ°å€ç±»å‹é‡Œè¡ç”Ÿå‡ºæ¥ï¼Œä½†å¯ä»¥è¢«æ˜¾å¼åœ°è½¬åŒ–ä¸ºåœ°å€ã€‚</p>
<p>åœ°å€çš„æˆå‘˜ï¼š</p>
<ul>
<li>balance<code>å’Œ</code>transfer</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">address x = <span class="hljs-number">0x123</span>;<br>address myAddress = <span class="hljs-variable language_">this</span>;<br><span class="hljs-keyword">if</span> (x.<span class="hljs-property">balance</span> &lt; <span class="hljs-number">10</span> &amp;&amp; myAddress.<span class="hljs-property">balance</span> &gt;= <span class="hljs-number">10</span>) x.<span class="hljs-title function_">transfer</span>(<span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure>
<p><strong>ç‰¹åˆ«åœ°ï¼Œå‘åˆçº¦åœ°å€è°ƒç”¨ transfer çš„æ—¶å€™ï¼Œæ¯ä¸ªåˆçº¦åœ°å€çš„ fallback å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</strong></p>
<ul>
<li>
<p>send æ˜¯ transfer ä½çº§å¯¹åº”ç‰©ã€‚å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œtransfer æŠ›å‡ºå¼‚å¸¸è€Œ send è¿”å› falseã€‚</p>
</li>
<li>
<p>call, callcode and delegatecall</p>
</li>
</ul>
<p>call å¯ä»¥ä½¿ç”¨ä»»æ„æ•°é‡ä»»æ„ç±»å‹çš„å‚æ•°å’Œæ¥å£äº¤äº’ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">address nameReg = <span class="hljs-number">0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2</span>;<br>nameReg.<span class="hljs-title function_">call</span>(<span class="hljs-string">&quot;register&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>);<br>nameReg.<span class="hljs-title function_">call</span>(<span class="hljs-title function_">bytes4</span>(<span class="hljs-title function_">keccak256</span>(<span class="hljs-string">&quot;fun(uint256)&quot;</span>)), a);<br></code></pre></td></tr></table></figure>
<p>ä¿®æ”¹æä¾›çš„ gas æ•°é‡çš„å‡½æ•°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">namReg.<span class="hljs-property">call</span>.<span class="hljs-title function_">gas</span>(<span class="hljs-number">1000000</span>)(<span class="hljs-string">&quot;register&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>ç±»ä¼¼åœ°ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™è½¬é’±ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nameReg</span>.call.value(<span class="hljs-number">1</span> ether)(<span class="hljs-string">&quot;register&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>æ— å…³é¡ºåºçš„ä¿®é¥°ç¬¦ä½¿ç”¨ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nameReg</span>.call.gas(<span class="hljs-number">1000000</span>).value(<span class="hljs-number">1</span> ether)(<span class="hljs-string">&quot;register&quot;</span>, <span class="hljs-string">&quot;MyName&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>delegatecallå¯ä»¥è¢«ç”¨æ¥è°ƒç”¨æŸä¸ªç‰¹å®šåˆçº¦ä¸Šçš„åœ°å€ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç”¨æ„å°±æ˜¯ç”¨æ¥è°ƒç”¨å…¶ä»–åˆçº¦ä¸Šçš„åº“å‡½æ•°ã€‚å®ƒçš„æ—©æœŸç‰ˆæœ¬ï¼ˆå®¶å›­ä»¥å‰ï¼‰callcode åŒç†ï¼Œè€Œä¸”callcode ä¸èƒ½è®¿é—®<code>msg.sender</code>å’Œ<code>msg.value</code>ã€‚<strong>callcode å°†åœ¨æœªæ¥çš„ç‰ˆæœ¬è¢«ç§»é™¤ã€‚</strong></p>
<p>å°½é‡åº”è¯¥ä½¿ç”¨ transfer è€Œä¸è¦ä½¿ç”¨ä½çº§ APIï¼Œå› ä¸ºå®ƒä»¬ç ´åäº† Solidity çš„ç±»å‹å®‰å…¨ã€‚</p>
<p><code>.gas()</code>é€‰é¡¹å¯¹äºä¸‰ä¸ªæ–¹æ³•éƒ½å¯ç”¨ï¼Œä½†<code>.value()</code>é€‰é¡¹ä¸è¢«<code>delegatecall</code>æ‰€æ”¯æŒã€‚</p>
<p>å› ä¸ºæ‰€æœ‰çš„åˆçº¦éƒ½é›†æˆäº†åœ°å€çš„æˆå‘˜ï¼Œæ‰€ä»¥åœ¨åˆçº¦é‡Œå¯ä»¥è¿™æ ·æŸ¥ä½™é¢<code>this.balance</code>ã€‚</p>
<h5 id="å®šé•¿å­—èŠ‚æ•°ç»„">å®šé•¿å­—èŠ‚æ•°ç»„</h5>
<p><code>bytes1</code>ï¼Œ<code>bytes2</code>ï¼Œ<code>bytes3</code>ï¼Œâ€¦ï¼Œ<code>bytes32</code>ã€‚ <code>byte</code> æ˜¯ <code>bytes1</code>çš„åˆ«åã€‚</p>
<p>è¿™ä¸ªç±»å‹ä¹Ÿæ”¯æŒå¸¸è§çš„æ¯”è¾ƒã€ä½æ“ä½œç¬¦ï¼Œå®ƒè¿˜æ”¯æŒæ›´é‡è¦çš„ç´¢å¼•æ“ä½œç¬¦ï¼šå¦‚æœ x æ˜¯ä¸ª<code>bytesI</code>ç±»å‹ï¼Œ<code>x[k]</code>(<code>0 &lt;= k &lt; I</code>)è¿”å›ç¬¬ k<br>
ä¸ªå­—èŠ‚ã€‚</p>
<h5 id="åŠ¨æ€é•¿åº¦å­—èŠ‚æ•°ç»„">åŠ¨æ€é•¿åº¦å­—èŠ‚æ•°ç»„</h5>
<p><code>bytes</code>ï¼šåŠ¨æ€é•¿åº¦å­—èŠ‚æ•°ç»„ï¼Œè§<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/types.html#arrays">Arrays</a>ã€‚ä¸æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼ˆä¸ºä»€ä¹ˆè¦æ”¾è¿™é‡Œï¼Ÿï¼‰ã€‚</p>
<p><code>string</code>ï¼šåŠ¨æ€utf-8ç¼–ç å­—ç¬¦ä¸²ï¼Œè§<a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/types.html#arrays">Arrays</a>ã€‚ä¸æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼ˆä¸ºä»€ä¹ˆè¦æ”¾è¿™é‡Œï¼Ÿï¼‰ã€‚</p>
<p>å¦‚æœæœ‰ä»»æ„é•¿åº¦æ•°æ®çš„éœ€æ±‚ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨<code>bytes</code>å’Œ<code>string</code>ï¼Œå¦åˆ™å°½é‡ä½¿ç”¨å®šé•¿çš„æ•°æ®æ•°æ®ç±»å‹ï¼Œ<code>bytes1</code>å’Œ<code>bytes32</code>æ¯”è¾ƒä¾¿å®œã€‚</p>
<h5 id="åœ°å€å­—é¢é‡">åœ°å€å­—é¢é‡</h5>
<p>èƒ½å¤Ÿé€šè¿‡åœ°å€æµ‹è¯•çš„åå…­è¿›åˆ¶å­—é¢é‡ï¼ˆåŠ ä¸Š0xé•¿åº¦ä¸º42çš„å­—ç¬¦ä¸²ï¼‰å¦‚<code>0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</code>æ˜¯ åœ°å€ç±»å‹ã€‚</p>
<h5 id="æœ‰ç†æ•°å’Œæ•´æ•°å­—é¢é‡">æœ‰ç†æ•°å’Œæ•´æ•°å­—é¢é‡</h5>
<p>å¸¸è§æ•´æ•°å­—é¢é‡ï¼š<code>69</code>ã€‚<br>
åè¿›ä½å°æ•°å­—é¢é‡ï¼š<code>1.3</code>ã€‚<br>
ç§‘å­¦è®¡æ•°æ³•ï¼š<code>2e10</code>ï¼Œ<code>-2e10</code>ï¼Œ<code>2e-10</code>ï¼Œ<code>2.5e1.</code>ã€‚</p>
<p>æ—©æœŸç‰ˆæœ¬çš„æœ‰ç†æ•°é™¤æ³•ä¼šå¯¼è‡´æˆªæ–­ï¼Œå½“å‰ç‰ˆæœ¬ä¸ä¼šï¼Œ<code>5/2</code>ç°åœ¨ç­‰äº2.5äº†ã€‚</p>
<h5 id="å­—ç¬¦ä¸²å­—é¢é‡">å­—ç¬¦ä¸²å­—é¢é‡</h5>
<p>å•å¼•å·å’ŒåŒå¼•å·éƒ½å¯ä»¥åŒ…è£¹å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå¦‚<code>&quot;foo&quot;</code>å’Œ<code>'bar'</code>ã€‚ä»–ä»¬æ²¡æœ‰ C ä¸­çš„å°¾éš0ã€‚<code>&quot;foo&quot;</code>ä»£è¡¨ä¸‰ä¸ªå­—èŠ‚è€Œä¸æ˜¯å››ä¸ªã€‚ä»–ä»¬å¯ä»¥è¢«éšå¼åœ°è½¬æ¢ä¸ºå„ç§å­—èŠ‚æ•°ç»„ï¼ˆè§ä¸Šæ–‡ï¼‰ï¼Œå®šé•¿ä¸å®šé•¿çš„éƒ½å¯èƒ½ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è½¬åŒ–ä¸º<code>string</code>ã€‚</p>
<p>å­—ç¬¦ä¸²å­—é¢é‡æ”¯æŒè½¬ä¹‰ç¬¦ï¼Œå¦‚<code>\n</code>ï¼Œ<code>\xNN</code>å’Œ<code>\uNNNN</code>ã€‚<code>\xNN</code>å–ä¸€ä¸ªåå…­è¿›åˆ¶çš„å€¼ï¼Œå¹¶æ’å…¥ä¸€ä¸ªæ­£ç¡®çš„å­—èŠ‚ã€‚<code>\uNNNN</code>å–ä¸€ä¸ª Unicode ç ç‚¹ï¼Œå¹¶ä¸”æ’å…¥ä¸€ä¸ªUTF-8åºæ•°ã€‚</p>
<h5 id="åå…­è¿›åˆ¶å­—é¢é‡">åå…­è¿›åˆ¶å­—é¢é‡</h5>
<p>ç”¨<code>hex</code>å¼€å¤´ï¼Œç”¨å•åŒå¼•å·æ‹¬èµ·æ¥ï¼š<code>hex&quot;001122FF&quot;</code>ã€‚</p>
<h5 id="æšä¸¾">æšä¸¾</h5>
<p>è¿™é‡Œçš„æšä¸¾ä¹Ÿæ˜¯å¯ä»¥æ˜¾å¼åœ°ä¸æ•´å‹æ•°äº’ç›¸è½¬æ¢çš„ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract test &#123;<br>    enum ActionChoices &#123; GoLeft, GoRight, GoStraight, SitStill &#125;<br>    ActionChoices choice;<br>    ActionChoices <span class="hljs-keyword">constant</span> defaultChoice = ActionChoices.GoStraight;<br><br>    <span class="hljs-keyword">function</span> setGoStraight() <span class="hljs-built_in">public</span> &#123;<br>        choice = ActionChoices.GoStraight;<br>    &#125;<br><br>    // Since enum <span class="hljs-keyword">types</span> are <span class="hljs-keyword">not</span> part <span class="hljs-keyword">of</span> the ABI, the signature <span class="hljs-keyword">of</span> &quot;getChoice&quot;<br>    // will automatically be changed <span class="hljs-keyword">to</span> &quot;getChoice() returns (uint8)&quot;<br>    // <span class="hljs-keyword">for</span> <span class="hljs-keyword">all</span> matters <span class="hljs-keyword">external</span> <span class="hljs-keyword">to</span> Solidity. The <span class="hljs-type">integer</span> <span class="hljs-keyword">type</span> used <span class="hljs-keyword">is</span> just<br>    // <span class="hljs-keyword">large</span> enough <span class="hljs-keyword">to</span> hold <span class="hljs-keyword">all</span> enum <span class="hljs-keyword">values</span>, i.e. <span class="hljs-keyword">if</span> you have more <span class="hljs-keyword">values</span>,<br>    // `uint16` will be used <span class="hljs-keyword">and</span> so <span class="hljs-keyword">on</span>.<br>    <span class="hljs-keyword">function</span> getChoice() <span class="hljs-built_in">public</span> <span class="hljs-keyword">view</span> <span class="hljs-keyword">returns</span> (ActionChoices) &#123;<br>        <span class="hljs-keyword">return</span> choice;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> getDefaultChoice() <span class="hljs-built_in">public</span> pure <span class="hljs-keyword">returns</span> (uint) &#123;<br>        <span class="hljs-keyword">return</span> uint(defaultChoice);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="å‡½æ•°ç±»å‹">å‡½æ•°ç±»å‹</h5>
<p>åŒå‡½æ•°å¼ç¼–ç¨‹é‡Œé¢çš„ä¸€ç­‰ç±»å‹å‡½æ•°å·®ä¸å¤šã€‚</p>
<p>å‡½æ•°ç±»å‹è¢«åˆ†ä¸ºä¸¤ç§ï¼šå†…éƒ¨å’Œå¤–éƒ¨å‡½æ•°ã€‚</p>
<p>å†…éƒ¨å‡½æ•°åªèƒ½åœ¨å½“å‰åˆçº¦å†…è¢«è°ƒç”¨ï¼ˆæ›´å…·ä½“åœ°è¯´ï¼Œåœ¨å½“å‰çš„ä»£ç å•å…ƒå†…ï¼Œä¹Ÿå°±åŒ…å«äº†å†…éƒ¨å‡½æ•°åº“å’Œç»§æ‰¿ä¸‹æ¥çš„å‡½æ•°ï¼‰ï¼Œå› ä¸ºä»–ä»¬ä¸èƒ½åœ¨å½“å‰åˆçº¦çš„ä¸Šä¸‹æ–‡ä¹‹å¤–è¢«æ‰§è¡Œã€‚è°ƒç”¨ä¸€ä¸ªå†…éƒ¨å‡½æ•°çš„å®ç°æ–¹å¼å°±æ˜¯è®©æ§åˆ¶æµè·³åˆ°ä¸€ä¸ªæ¡ç›®æ ‡ç­¾ä¸Šã€‚</p>
<p>å¤–éƒ¨å‡½æ•°åŒ…æ‹¬ä¸€ä¸ªåœ°å€å’Œä¸€ä¸ªå‡½æ•°ç­¾åï¼Œä»–ä»¬å¯ä»¥è¢«ä¼ é€’è¿›/ä¼ é€’å‡ºå¤–éƒ¨å‡½æ•°è°ƒç”¨ã€‚</p>
<p>å‡½æ•°ç±»å‹çš„æ ‡è®°æ³•æ˜¯ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">function</span> (&lt;parameter <span class="hljs-keyword">types</span>&gt;) &#123;<span class="hljs-type">internal</span>|<span class="hljs-keyword">external</span>&#125; [pure|<span class="hljs-keyword">constant</span>|<span class="hljs-keyword">view</span>|payable] [<span class="hljs-keyword">returns</span> (&lt;<span class="hljs-keyword">return</span> <span class="hljs-keyword">types</span>&gt;)]<br></code></pre></td></tr></table></figure>
<p>ä¸å…è®¸å‡ºç°ç©ºçš„ return è¯­å¥ã€‚</p>
<p>é»˜è®¤å‡½æ•°éƒ½æ˜¯ internal çš„ï¼Œæ‰€ä»¥ internal å®é™…ä¸Šå¯ä»¥è¢«çœç•¥ï¼ˆç±»ä¼¼ C è¯­è¨€å‘¢ï¼‰ã€‚</p>
<p><code>delete</code>ä¸€ä¸ªå‡½æ•°åï¼Œå†è°ƒç”¨å®ƒä¼šå‡ºç°è¿è¡Œæ—¶å¼‚å¸¸ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå¤–éƒ¨å‡½æ•°å˜é‡è¢« Solidity ä¹‹å¤–çš„ä¸Šä¸‹æ–‡è°ƒç”¨ï¼ˆè·¨è¯­è¨€äº’æ“ä½œ interoperabilityé—®é¢˜ï¼‰ï¼Œä»–ä»¬å°†è¢«å½“åš<code>function</code>ç±»å‹ï¼Œå®ƒåœ¨ä¸€ä¸ª<code>bytes24</code>ç±»å‹é‡Œæ”¾äº†ä¸€ä¸ªç¼–ç çš„åœ°å€ï¼Œåé¢è¿˜è·Ÿç€å‡½æ•°è¯†åˆ«ç¬¦ã€‚</p>
<p>publicï¼ˆæˆ–å¤–éƒ¨ï¼‰å‡½æ•°åŒæ ·åŒ…å«ä¸€ä¸ªå«<code>selector</code>çš„æˆå‘˜ï¼Œå®ƒè¿”å›ä¸€ä¸ª <a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/develop/abi-spec.html#abi-function-selector">ABI function selector</a></p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">16</span>;<br><br>contract Selector &#123;<br>  <span class="hljs-keyword">function</span> <span class="hljs-title">f</span>() public view returns (bytes4) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">this.f.selector</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†…éƒ¨å‡½æ•°çš„ä¾‹å­ï¼š</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs zephir">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>library ArrayUtils &#123;<br>  <span class="hljs-comment">// åŒåœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡é‡Œçš„å†…éƒ¨å‡½æ•°è°ƒç”¨ã€‚</span><br>  <span class="hljs-comment">// internal functions can be used in internal library functions because</span><br>  <span class="hljs-comment">// they will be part of the same code context</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(<span class="hljs-keyword">uint</span>[] memory <span class="hljs-keyword">self</span>, <span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> pure returns <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> f)</span></span><br><span class="hljs-function">    <span class="hljs-title">internal</span></span><br><span class="hljs-function">    <span class="hljs-title">pure</span></span><br><span class="hljs-function">    <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>[] memory r)</span></span><br><span class="hljs-function">  </span>&#123;<br>    r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">uint</span>[](<span class="hljs-keyword">self</span>.length);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">self</span>.length; i++) &#123;<br>      r[i] = f(<span class="hljs-keyword">self</span>[i]);<br>    &#125;<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">uint</span>[] memory <span class="hljs-keyword">self</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>, <span class="hljs-keyword">uint</span>)</span> pure returns <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> f</span></span><br><span class="hljs-params"><span class="hljs-function">  )</span></span><br><span class="hljs-function">    <span class="hljs-title">internal</span></span><br><span class="hljs-function">    <span class="hljs-title">pure</span></span><br><span class="hljs-function">    <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> r)</span></span><br><span class="hljs-function">  </span>&#123;<br>    r = <span class="hljs-keyword">self</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-keyword">self</span>.length; i++) &#123;<br>      r = f(r, <span class="hljs-keyword">self</span>[i]);<br>    &#125;<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">range</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> length)</span> <span class="hljs-title">internal</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>[] memory r)</span> </span>&#123;<br>    r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">uint</span>[](length);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">0</span>; i &lt; r.length; i++) &#123;<br>      r[i] = i;<br>    &#125;<br>  &#125;<br>&#125;<br><br>contract Pyramid &#123;<br>  using ArrayUtils <span class="hljs-keyword">for</span> *;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pyramid</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> l)</span> <span class="hljs-title">public</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> ArrayUtils.range(l).map(square).reduce(sum);<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">square</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> x)</span> <span class="hljs-title">internal</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> x * x;<br>  &#125;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> x, <span class="hljs-keyword">uint</span> y)</span> <span class="hljs-title">internal</span> <span class="hljs-title">pure</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> x + y;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæŠŠå¤–éƒ¨å‡½æ•°ç±»å‹ä¼ é€’è¿› struct çš„å®ä¾‹ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯ä¸ªé¢„è¨€æœºä½¿ç”¨çš„å¥½ä¾‹å­äº†ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.20</span>; // should actually be <span class="hljs-number">0.4</span><span class="hljs-number">.21</span><br><br>contract Oracle &#123;<br>  struct Request &#123;<br>    bytes data;<br>    <span class="hljs-keyword">function</span>(bytes memory) <span class="hljs-keyword">external</span> callback;<br>  &#125;<br>  Request[] requests;<br>  event NewRequest(uint);<br>  <span class="hljs-keyword">function</span> query(bytes data, <span class="hljs-keyword">function</span>(bytes memory) <span class="hljs-keyword">external</span> callback) <span class="hljs-built_in">public</span> &#123;<br>    requests.push(Request(data, callback));<br>    emit NewRequest(requests.length - <span class="hljs-number">1</span>);<br>  &#125;<br>  <span class="hljs-keyword">function</span> reply(uint requestID, bytes response) <span class="hljs-built_in">public</span> &#123;<br>    // Here goes the <span class="hljs-keyword">check</span> that the reply comes <span class="hljs-keyword">from</span> a <span class="hljs-keyword">trusted</span> source<br>    requests[requestID].callback(response);<br>  &#125;<br>&#125;<br><br>contract OracleUser &#123;<br>  Oracle <span class="hljs-keyword">constant</span> oracle = Oracle(<span class="hljs-number">0x1234567</span>); // known contract<br>  <span class="hljs-keyword">function</span> buySomething() &#123;<br>    oracle.query(&quot;USD&quot;, this.oracleResponse);<br>  &#125;<br>  <span class="hljs-keyword">function</span> oracleResponse(bytes response) <span class="hljs-built_in">public</span> &#123;<br>    require(msg.sender == address(oracle));<br>    // Use the data<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ç°åœ¨è¿˜ä¸æ”¯æŒ Lambda å‡½æ•°å’Œå†…è”å‡½æ•°ã€‚</p>
<h4 id="å¼•ç”¨ç±»å‹">å¼•ç”¨ç±»å‹</h4>
<p>å¤åˆç±»å‹ï¼Œä¹Ÿå°±æ˜¯ç±»å‹ä¸è¡¬è¿›256ä½çš„ç±»å‹ï¼Œæ€»è¦è¢«æ¯”æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„å€¼ç±»å‹æ›´ä»”ç»†åœ°å¯¹å¾…ã€‚å› ä¸ºæ‹·è´å®ƒä»¬æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»”ç»†è€ƒè™‘å®ƒä»¬åº”è¯¥è¢«å­˜å‚¨åœ¨<code>memoryé‡Œ</code>ï¼ˆä¸ä¼šè¢«æŒä¹…åŒ–ï¼‰è¿˜æ˜¯è¢«å­˜å‚¨åœ¨<code>storage</code>ï¼ˆçŠ¶æ€å˜é‡å°±æ”¾åœ¨è¿™é‡Œï¼‰é‡Œã€‚</p>
<h5 id="æ•°æ®ä½ç½®">æ•°æ®ä½ç½®</h5>
<p>æ¯ä¸ªå¤åˆç±»å‹ï¼Œæ•°ç»„å’Œç»“æ„ä½“ï¼Œéƒ½æœ‰ä¸€ä¸ªé¢å¤–çš„æ³¨è§£ï¼Œå³â€œæ•°æ®ä½ç½®â€ï¼Œå…³äºå®ƒæ˜¯è¢«å­˜å‚¨åœ¨memoryé‡Œè¿˜æ˜¯åœ¨storageé‡Œã€‚ä¾æ®ä¸Šä¸‹æ–‡çš„ä¸åŒï¼Œæ€»æœ‰ä¸€ä¸ªç¼ºçœå€¼ï¼Œä½†å®ƒå¯ä»¥è¢«å¾€ç±»å‹ä¸Šæ·»åŠ <code>storage</code>å’Œ<code>memory</code>è¦†ç›–æ‰ã€‚é»˜è®¤çš„å‡½æ•°å‚æ•°æ˜¯<code>memory</code>çš„ï¼Œé»˜è®¤çš„å±€éƒ¨å˜é‡æ˜¯<code>storage</code>çš„ï¼ˆå³è¿™ä¸¤è€…æ˜¯å¯å˜çš„ï¼‰ï¼ŒçŠ¶æ€å˜é‡çš„ä½ç½®è¢«å¼ºåˆ¶è®¾ä¸º<code>storage</code>ã€‚</p>
<p>è¿˜æœ‰ç¬¬ä¸‰ç§æ•°æ®ä½ç½®ï¼Œ<code>calldata</code>ï¼Œå®ƒæ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œä¸æŒä¹…åŒ–çš„ï¼Œå‡½æ•°å®å‚å­˜å‚¨åœ¨é‡Œé¢ã€‚å¤–éƒ¨å‡½æ•°çš„å‡½æ•°å‚æ•°ï¼ˆè€Œä¸æ˜¯è¿”å›å‚æ•°ï¼‰è¢«å¼ºåˆ¶ä¸º<code>calldata</code>ï¼Œè¡Œä¸ºè¡¨ç°ä¸<code>memory</code>å¾ˆç›¸ä¼¼ã€‚</p>
<p>æ•°æ®ä½ç½®æ˜¯é‡è¦çš„ï¼Œå› ä¸ºä»–ä»¬æ”¹å˜äº†èµ‹å€¼è¡Œä¸º:<code>memory</code>å’Œ<code>storage</code>ä¹‹é—´çš„èµ‹å€¼ã€çŠ¶æ€å˜é‡ä¹‹é—´çš„èµ‹å€¼æ€»æ˜¯ä¼šäº§ç”Ÿç‹¬ç«‹æ‹·è´ã€‚å‘å±€éƒ¨<code>storage</code> å˜é‡èµ‹å€¼ï¼Œå°½ç®¡åªæ˜¯èµ‹äºˆä¸€ä¸ªå¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨æ€»æ˜¯æŒ‡å‘ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå³ä½¿åè€…ä¼šæ”¹å˜ã€‚<code>memory</code>å’Œ<code>memory</code>ä¹‹é—´çš„èµ‹å€¼ä¸ä¼šäº§ç”Ÿæ‹·è´ã€‚</p>
<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs gml">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    uint[] <span class="hljs-variable language_">x</span>; <span class="hljs-comment">// the data location of x is storage</span><br><br>    <span class="hljs-comment">// the data location of memoryArray is memory</span><br>    <span class="hljs-keyword">function</span> f(uint[] memoryArray) public &#123;<br>        <span class="hljs-variable language_">x</span> = memoryArray; <span class="hljs-comment">// works, copies the whole array to storage</span><br>        <span class="hljs-keyword">var</span> <span class="hljs-variable language_">y</span> = <span class="hljs-variable language_">x</span>; <span class="hljs-comment">// works, assigns a pointer, data location of y is storage</span><br>        <span class="hljs-variable language_">y</span>[<span class="hljs-number">7</span>]; <span class="hljs-comment">// fine, returns the 8th element</span><br>        <span class="hljs-comment">// å±€éƒ¨ storage å˜é‡ä¿®æ”¹äº†çŠ¶æ€ storage å˜é‡ã€‚</span><br>        <span class="hljs-variable language_">y</span>.length = <span class="hljs-number">2</span>; <span class="hljs-comment">// fine, modifies x through y</span><br>        <span class="hljs-comment">// æ¸…é™¤æ•°ç»„çš„æ–¹æ³•</span><br>        <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">x</span>; <span class="hljs-comment">// fine, clears the array, also modifies y</span><br>        <span class="hljs-comment">// å¯ä»¥æŠŠå®å‚èµ‹ç»™çŠ¶æ€å˜é‡ï¼ŒæŠŠå±€éƒ¨å˜é‡æŒ‡å‘çŠ¶æ€å˜é‡ï¼Œå´ä¸èƒ½è·³è¿‡ç¬¬ä¸€æ­¥ã€‚çŠ¶æ€å˜é‡éƒ½æ˜¯â€œé™æ€åˆ†é…â€çš„ã€‚</span><br>        <span class="hljs-comment">// The following does not work; it would need to create a new temporary /</span><br>        <span class="hljs-comment">// unnamed array in storage, but storage is &quot;statically&quot; allocated:</span><br>        <span class="hljs-comment">// y = memoryArray;</span><br>        <span class="hljs-comment">// This does not work either, since it would &quot;reset&quot; the pointer, but there</span><br>        <span class="hljs-comment">// is no sensible location it could point to.</span><br>        <span class="hljs-comment">// delete y;</span><br>        g(<span class="hljs-variable language_">x</span>); <span class="hljs-comment">// calls g, handing over a reference to x</span><br>        h(<span class="hljs-variable language_">x</span>); <span class="hljs-comment">// calls h and creates an independent, temporary copy in memory</span><br>    &#125;<br><br>    <span class="hljs-keyword">function</span> g(uint[] storage storageArray) internal &#123;&#125;<br>    <span class="hljs-keyword">function</span> h(uint[] memoryArray) public &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åœ¨å®éªŒä¹‹ä¸­ï¼Œæ„é€ å‡½æ•°ç”Ÿæˆçš„æ€»æ˜¯<code>memory</code>ç±»å‹çš„å˜é‡ï¼Œæ‹·è´åˆ° storage å˜é‡å°±å¯ä»¥è®©å®ƒè¢«æŒä¹…åŒ–äº†ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p>å¼ºåˆ¶æ•°æ®ä½ç½®ï¼š<br>
å¤–éƒ¨å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯<code>calldata</code><br>
çŠ¶æ€å˜é‡å¿…é¡»æ˜¯<code>storage</code><br>
ç¼ºçœæ•°æ®ä½ç½®ï¼š<br>
å‡½æ•°å‚æ•°é»˜è®¤æ˜¯<code>memory</code><br>
æ‰€æœ‰å±€éƒ¨å˜é‡é»˜è®¤æ˜¯<code>storage</code></p>
<h5 id="æ•°ç»„">æ•°ç»„</h5>
<p>æ•°ç»„å¯ä»¥æœ‰ç¼–è¯‘æ—¶çš„å›ºå®šé•¿åº¦ï¼Œä¹Ÿå¯ä»¥æ˜¯åŠ¨æ€çš„ã€‚<code>storage</code>æ•°ç»„çš„å…ƒç´ ç±»å‹å¯ä»¥æ˜¯ä»»æ„çš„ï¼ˆå³å¯ä»¥æ˜¯æ•°ç»„çš„æ•°ç»„ã€mapping çš„æ•°ç»„å’Œç»“æ„ä½“çš„æ•°ç»„ï¼‰ã€‚<code>memory</code>æ•°ç»„åˆ™ä¸èƒ½æœ‰<code>mapping</code>å…ƒç´ ï¼Œå¦‚æœå®ƒæ˜¯ä¸ªå…¬å…±å¯è§å‡½æ•°ï¼ˆå¤–éƒ¨å‡½æ•°ï¼Ÿï¼‰ï¼Œå®ƒçš„å…ƒç´ å¿…é¡»æ˜¯ä¸ª ABI ç±»å‹ã€‚</p>
<p>å®šé•¿æ•°ç»„å†™ä½œï¼Œ<code>T[k]</code>ï¼Œå˜é•¿æ•°ç»„å†™ä½œ<code>T[]</code>ï¼ˆä¹Ÿå°±æ˜¯è¯´å¤§éƒ¨åˆ†çš„æ™ºèƒ½åˆçº¦çš„å‡½æ•°å‚æ•°éƒ½æ˜¯<code>memory</code>åŠ¨æ€æ•°ç»„ï¼‰ã€‚</p>
<p>5ä¸ª<code>unint</code>åŠ¨æ€æ•°ç»„çš„å†™æ³•ä¸å…¶ä»–è¯­è¨€æ­£å¥½åè¿‡æ¥ï¼Œ<code>uint[][15]</code>ã€‚è®¿é—®ç¬¬ä¸‰ä¸ªåŠ¨æ€æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œåˆåè€Œå’Œå…¶å®ƒè¯­è¨€ä¸€æ ·ï¼Œ<code>x[2][16]</code>ã€‚</p>
<h5 id="åˆ›å»ºå†…å­˜æ•°ç»„">åˆ›å»ºå†…å­˜æ•°ç»„</h5>
<p><strong>å¯ä»¥ç”¨ new æ¥åˆ›å»ºå†…å­˜æ•°ç»„</strong>ã€‚<code>memory</code>æ•°ç»„ä¸å¯ä»¥é€šè¿‡<code>.length</code> æ¥ä¿®æ”¹æ•°ç»„å°ºå¯¸ï¼Œä½†<code>storage</code>æ•°ç»„å¯ä»¥ã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f(<span class="hljs-built_in">uint</span> len) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        <span class="hljs-built_in">uint</span>[] memory a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">uint</span>[](<span class="hljs-number">7</span>);<br>        bytes memory b = <span class="hljs-keyword">new</span> bytes(len);<br>        <span class="hljs-comment">// Here we have a.length == 7 and b.length == len</span><br>        a[<span class="hljs-number">6</span>] = <span class="hljs-number">8</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="æ•°ç»„å­—é¢é‡-å†…è”æ•°ç»„">æ•°ç»„å­—é¢é‡/å†…è”æ•°ç»„</h5>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f() <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        g([<span class="hljs-built_in">uint</span>(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);<br>    &#125;<br>    <span class="hljs-comment">// è¿™ä¹Ÿæ˜¯ä¸ªå®šé•¿æ•°ç»„çš„ä¾‹å­</span><br>    <span class="hljs-built_in">function</span> g(<span class="hljs-built_in">uint</span>[<span class="hljs-number">3</span>] _data) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="æˆå‘˜">æˆå‘˜</h5>
<p>lengthï¼šåªæœ‰ storage çš„åŠ¨æ€æ•°ç»„æ‰èƒ½åŠ¨æ€ä¿®æ”¹è‡ªå·±çš„å°ºå¯¸ã€‚<br>
pushï¼šåœ¨æ•°ç»„å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼Œè¿”å›æ–°çš„é•¿åº¦ã€‚</p>
<p>æ•°ç»„çš„ä¸€ä¸ªç»¼åˆä¾‹å­ï¼š</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract ArrayContract &#123;<br>    <span class="hljs-built_in">uint</span>[<span class="hljs-number">2</span>**<span class="hljs-number">20</span>] m_aLotOfIntegers;<br>    <span class="hljs-comment">// Note that the following is not a pair of dynamic arrays but a</span><br>    <span class="hljs-comment">// dynamic array of pairs (i.e. of fixed size arrays of length two).</span><br>    <span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>][] m_pairsOfFlags;<br>    <span class="hljs-comment">// newPairs is stored in memory - the default for function arguments</span><br><br>    <span class="hljs-built_in">function</span> setAllFlagPairs(<span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>][] newPairs) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// assignment to a storage array replaces the complete array</span><br>        m_pairsOfFlags = newPairs;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> setFlagPair(<span class="hljs-built_in">uint</span> index, <span class="hljs-built_in">bool</span> flagA, <span class="hljs-built_in">bool</span> flagB) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// access to a non-existing index will throw an exception</span><br>        m_pairsOfFlags[index][<span class="hljs-number">0</span>] = flagA;<br>        m_pairsOfFlags[index][<span class="hljs-number">17</span>] = flagB;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> changeFlagArraySize(<span class="hljs-built_in">uint</span> newSize) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// if the new size is smaller, removed array elements will be cleared</span><br>        m_pairsOfFlags.length = newSize;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> clear() <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// these clear the arrays completely</span><br>        <span class="hljs-keyword">delete</span> m_pairsOfFlags;<br>        <span class="hljs-keyword">delete</span> m_aLotOfIntegers;<br>        <span class="hljs-comment">// identical effect here</span><br>        m_pairsOfFlags.length = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    bytes m_byteData;<br><br>    <span class="hljs-built_in">function</span> byteArrays(bytes data) <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-comment">// byte arrays (&quot;bytes&quot;) are different as they are stored without padding,</span><br>        <span class="hljs-comment">// but can be treated identical to &quot;uint8[]&quot;</span><br>        m_byteData = data;<br>        m_byteData.length += <span class="hljs-number">7</span>;<br>        m_byteData[<span class="hljs-number">3</span>] = <span class="hljs-keyword">byte</span>(<span class="hljs-number">8</span>);<br>        <span class="hljs-keyword">delete</span> m_byteData[<span class="hljs-number">2</span>];<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> addFlag(<span class="hljs-built_in">bool</span>[<span class="hljs-number">2</span>] flag) <span class="hljs-keyword">public</span> returns (<span class="hljs-built_in">uint</span>) &#123;<br>        <span class="hljs-keyword">return</span> m_pairsOfFlags.push(flag);<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> createMemoryArray(<span class="hljs-built_in">uint</span> size) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> returns (bytes) &#123;<br>        <span class="hljs-comment">// Dynamic memory arrays are created using `new`:</span><br>        <span class="hljs-built_in">uint</span>[<span class="hljs-number">2</span>][] memory arrayOfPairs = <span class="hljs-keyword">new</span> <span class="hljs-built_in">uint</span>[<span class="hljs-number">2</span>][](size);<br>        <span class="hljs-comment">// Create a dynamic byte array:</span><br>        bytes memory b = <span class="hljs-keyword">new</span> bytes(<span class="hljs-number">200</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">uint</span> i = <span class="hljs-number">0</span>; i &lt; b.length; i++)<br>            b[i] = <span class="hljs-keyword">byte</span>(i);<br>        <span class="hljs-keyword">return</span> b;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="ç»“æ„ä½“ç±»å‹">ç»“æ„ä½“ç±»å‹</h5>
<p>ç»“æ„ä½“æä¾›äº†å®šä¹‰æ–°ç±»å‹çš„èƒ½åŠ›ã€‚<br>
ä¼—ç­¹åˆçº¦çš„ä¾‹å­ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract CrowdFunding &#123;<br>    // Defines a <span class="hljs-built_in">new</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">with</span> two fields.<br>    struct Funder &#123;<br>        address addr;<br>        uint amount;<br>    &#125;<br><br>    struct Campaign &#123;<br>        address beneficiary;<br>        uint fundingGoal;<br>        uint numFunders;<br>        uint amount;<br>        <span class="hljs-keyword">mapping</span> (uint =&gt; Funder) funders;<br>    &#125;<br><br>    uint numCampaigns;<br>    <span class="hljs-keyword">mapping</span> (uint =&gt; Campaign) campaigns;<br><br>    <span class="hljs-keyword">function</span> newCampaign(address beneficiary, uint goal) <span class="hljs-built_in">public</span> <span class="hljs-keyword">returns</span> (uint campaignID) &#123;<br>        campaignID = numCampaigns++; // campaignID <span class="hljs-keyword">is</span> <span class="hljs-keyword">return</span> variable<br>        // Creates <span class="hljs-built_in">new</span> struct <span class="hljs-keyword">and</span> saves <span class="hljs-keyword">in</span> <span class="hljs-keyword">storage</span>. We leave <span class="hljs-keyword">out</span> the <span class="hljs-keyword">mapping</span> <span class="hljs-keyword">type</span>.<br>        // è¿™é‡Œæ„é€ å‡½æ•°ç”Ÿæˆçš„æ•°æ®ç±»å‹æ˜¯ memoryï¼Œè€Œ campaigns[campaignID]çš„æ•°æ®ä½ç½®æ˜¯ <span class="hljs-keyword">storage</span>ï¼Œåªæœ‰è¿™ç§æ–¹å¼å¯ä»¥éšå¼è‡ªåŠ¨è½¬åŒ–è¿™ä¸¤ç§ data <span class="hljs-keyword">location</span>ã€‚<br>        campaigns[campaignID] = Campaign(beneficiary, goal, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> contribute(uint campaignID) <span class="hljs-built_in">public</span> payable &#123;<br>        Campaign <span class="hljs-keyword">storage</span> c = campaigns[campaignID];<br>        // Creates a <span class="hljs-built_in">new</span> <span class="hljs-keyword">temporary</span> memory struct, initialised <span class="hljs-keyword">with</span> the given <span class="hljs-keyword">values</span><br>        // <span class="hljs-keyword">and</span> copies it <span class="hljs-keyword">over</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">storage</span>.<br>        // Note that you can <span class="hljs-keyword">also</span> use Funder(msg.sender, msg.<span class="hljs-keyword">value</span>) <span class="hljs-keyword">to</span> initialise.<br>        c.funders[c.numFunders++] = Funder(&#123;addr: msg.sender, amount: msg.<span class="hljs-keyword">value</span>&#125;);<br>        c.amount += msg.<span class="hljs-keyword">value</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> checkGoalReached(uint campaignID) <span class="hljs-built_in">public</span> <span class="hljs-keyword">returns</span> (<span class="hljs-type">bool</span> reached) &#123;<br>        Campaign <span class="hljs-keyword">storage</span> c = campaigns[campaignID];<br>        <span class="hljs-keyword">if</span> (c.amount &lt; c.fundingGoal)<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        uint amount = c.amount;<br>        c.amount = <span class="hljs-number">0</span>;<br>        c.beneficiary.transfer(amount);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>struct æœ¬èº«å¯ä»¥å­˜å‚¨æ•°ç»„å’Œæ˜ å°„ï¼Œä¹Ÿå¯ä»¥è¢«è¿™ä¸¤è€…å­˜å‚¨ã€‚å®ƒä¸èƒ½å­˜å‚¨å®ƒè‡ªèº«ç±»å‹çš„å˜é‡ï¼Œstruct çš„å°ºå¯¸å¿…é¡»æ˜¯æœ‰é™çš„ã€‚</p>
<h4 id="æ˜ å°„">æ˜ å°„</h4>
<p><code>mapping(_KeyType =&gt; _ValueType)</code>é‡Œçš„keyç±»å‹ä¸èƒ½æ˜¯æ˜ å°„ï¼ŒåŠ¨æ€é•¿åº¦æ•°ç»„ã€åˆçº¦ã€æšä¸¾å’Œç»“æ„ä½“ã€‚value å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚</p>
<p>æ˜ å°„å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸ªè¢«è™šæ‹Ÿåˆå§‹åŒ–çš„ hash è¡¨ï¼Œæ‰€æœ‰å¯èƒ½çš„é”®éƒ½å­˜åœ¨è€Œä¸”å€¼è¢«åˆå§‹åŒ–ä¸º0å€¼ã€‚å®é™…ä¸Š key æ•°æ®å¹¶ä¸å­˜åœ¨æ˜ å°„é‡Œé¢ï¼Œåªæœ‰å®ƒçš„<code>keccak256</code>æ•£åˆ—å€¼è¢«å­˜åœ¨é‡Œé¢ï¼Œç”¨æ¥æŸ¥å€¼ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract MappingExample &#123;<br>    mapping(address =&gt; <span class="hljs-built_in">uint</span>) <span class="hljs-keyword">public</span> balances;<br><br>    <span class="hljs-function">function <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> newBalance</span>) <span class="hljs-keyword">public</span></span> &#123;<br>        balances[msg.sender] = newBalance;<br>    &#125;<br>&#125;<br><br>contract MappingUser &#123;<br>    <span class="hljs-function">function <span class="hljs-title">f</span>() <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span> &#123;<br>        MappingExample m = <span class="hljs-keyword">new</span> MappingExample();<br>        m.update(<span class="hljs-number">100</span>);<br>        <span class="hljs-keyword">return</span> m.balances(<span class="hljs-keyword">this</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>mapping æœ¬èº«æ˜¯ä¸å¯è¿­ä»£çš„ï¼Œä½†å¯ä»¥çœ‹<a target="_blank" rel="noopener" href="https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol">iterable mapping</a>ï¼Œçœ‹çœ‹æ€ä¹ˆåœ¨å®ƒä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªå¯è¿­ä»£çš„ç»“æ„ã€‚</p>
<h4 id="ç‰µæ¶‰åˆ°å·¦å€¼çš„æ“ä½œç¬¦">ç‰µæ¶‰åˆ°å·¦å€¼çš„æ“ä½œç¬¦</h4>
<h5 id="delete">delete</h5>
<p><code>delete</code>ä¸€ä¸ªå˜é‡ï¼Œå·®ä¸å¤šå¯ä»¥è¯´æ˜¯æŠŠä¸€ä¸ªé›¶å€¼èµ‹ç»™å®ƒã€‚é™¤äº†ä¸èƒ½ delete ä¸€ä¸ªæ˜ å°„ä»¥å¤–ï¼Œæ‰€æœ‰ç±»å‹çš„å˜é‡éƒ½å¯ä»¥è¢« deleteã€‚delete åŠ¨æ€æ•°ç»„ä¼šå¾—åˆ°ä¸€ä¸ªé•¿åº¦ä¸º0çš„æ–°åŠ¨æ€æ•°ç»„ï¼Œdelete ä¸€ä¸ªé™æ€æ•°ç»„ä¼šå¾—åˆ°ä¸€ä¸ªé•¿åº¦ç­‰äºåŸé•¿åº¦ï¼Œæ‰€æœ‰å…ƒç´ éƒ½ç­‰äºè¯¥å…ƒç´ ç±»å‹é›¶å€¼çš„æ•°ç»„ï¼Œdelete ä¸€ä¸ªç»“æ„ä½“å˜é‡ï¼Œæ‰€æœ‰çš„æˆå‘˜é™¤äº†æ˜ å°„éƒ½ä¼šå˜æˆ0å€¼ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract DeleteExample &#123;<br>    uint data;<br>    uint[] dataArray;<br><br>    <span class="hljs-keyword">function</span> f() <span class="hljs-built_in">public</span> &#123;<br>        // æ³¨æ„ï¼è¿™é‡Œ x æ‹·è´äº† dataï¼Œè€Œä¸æ˜¯æŠŠä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº† dataã€‚<br>        uint x = data;<br>        <span class="hljs-keyword">delete</span> x; // sets x <span class="hljs-keyword">to</span> <span class="hljs-number">0</span>, does <span class="hljs-keyword">not</span> affect data<br>        <span class="hljs-keyword">delete</span> data; // sets data <span class="hljs-keyword">to</span> <span class="hljs-number">0</span>, does <span class="hljs-keyword">not</span> affect x which still holds a <span class="hljs-keyword">copy</span><br>        uint[] <span class="hljs-keyword">storage</span> y = dataArray;<br>        <span class="hljs-keyword">delete</span> dataArray; // this sets dataArray.length <span class="hljs-keyword">to</span> zero, but <span class="hljs-keyword">as</span> uint[] <span class="hljs-keyword">is</span> a complex <span class="hljs-keyword">object</span>, <span class="hljs-keyword">also</span><br>        // y <span class="hljs-keyword">is</span> affected which <span class="hljs-keyword">is</span> an <span class="hljs-keyword">alias</span> <span class="hljs-keyword">to</span> the <span class="hljs-keyword">storage</span> <span class="hljs-keyword">object</span><br>        // <span class="hljs-keyword">On</span> the other hand: &quot;delete y&quot; <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">valid</span>, <span class="hljs-keyword">as</span> assignments <span class="hljs-keyword">to</span> <span class="hljs-keyword">local</span> variables<br>        // referencing <span class="hljs-keyword">storage</span> objects can <span class="hljs-keyword">only</span> be made <span class="hljs-keyword">from</span> existing <span class="hljs-keyword">storage</span> objects.<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢">åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢</h4>
<p>æ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½å¯ä»¥è½¬å˜ä¸º<code>uint160</code>ï¼Œä¹Ÿå°±å¯ä»¥è½¬å˜ä¸ºåœ°å€ã€‚</p>
<p>æ˜¾å¼è½¬æ¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">uint x <span class="hljs-operator">=</span> uint(y)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<h4 id="ç±»å‹æ¨å¯¼">ç±»å‹æ¨å¯¼</h4>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">uint24 x <span class="hljs-operator">=</span> <span class="hljs-number">0</span>x123<span class="hljs-comment">;</span><br>var y <span class="hljs-operator">=</span> x<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>
<p>var ä¸èƒ½ç”¨åœ¨å‡½æ•°å½¢å‚å’Œè¿”å›å€¼ä¸Šã€‚<br>
var åªåœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼æ—¶è¢«æ¨å¯¼å‡ºæ¥ï¼Œæ‰€ä»¥ä»¥ä¸‹å¾ªç¯æ— æ³•ç»ˆæ­¢ï¼š</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">for (var i <span class="hljs-operator">=</span> <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 2000; i++) &#123; ... &#125;</span><br></code></pre></td></tr></table></figure>
<p>å› ä¸ºç¬¬ä¸€æ¬¡èµ‹å€¼ï¼Œä½¿å¾— i è¢«æ¨å¯¼ä¸º<code>uint8</code>ç±»å‹äº†ã€‚</p>
<h3 id="å•ä½å’Œå…¨å±€å¯ç”¨å˜é‡">å•ä½å’Œå…¨å±€å¯ç”¨å˜é‡</h3>
<h4 id="ä»¥å¤ªå¸çš„å•ä½">ä»¥å¤ªå¸çš„å•ä½</h4>
<p>å››çº§å•ä½<code>wei</code>ï¼Œ<code>finney</code>ï¼Œ<code>szabo</code> æˆ–è€… <code>ether</code>ã€‚<code>2 ether == 2000 finney</code>ã€‚</p>
<h4 id="æ—¶é—´å•ä½">æ—¶é—´å•ä½</h4>
<p><code>seconds</code>ï¼Œ<code>minutes</code>ï¼Œ<code>hours</code>ï¼Œ<code>day</code>ï¼Œ<code>weeks</code>å’Œ<code>years</code>ã€‚<br>
å°å¿ƒé—°ç§’ï¼ˆ leap secondsï¼‰é—®é¢˜ã€‚</p>
<p>å·§å¦™ä½¿ç”¨å•ä½æ¥å¯¹æ¯”å½“å‰æ—¶é—´çš„ä¾‹å­ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function">function <span class="hljs-title">f</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> start, <span class="hljs-built_in">uint</span> daysAfter</span>) <span class="hljs-keyword">public</span></span> &#123;<br>    <span class="hljs-keyword">if</span> (now &gt;= start + daysAfter * <span class="hljs-number">1</span> days) &#123;<br>      <span class="hljs-comment">// ...</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="ç‰¹æ®Šçš„å˜é‡å’Œå‡½æ•°">ç‰¹æ®Šçš„å˜é‡å’Œå‡½æ•°</h4>
<p>åœ¨å…¨å±€ç©ºé—´é‡Œæ—©å·²å­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„å˜é‡å’Œå‡½æ•°ï¼Œç”¨ä»¥æä¾›åŒºå—é“¾çš„ä¿¡æ¯ï¼š</p>
<h5 id="åŒºå—å’Œäº‹åŠ¡å±æ€§">åŒºå—å’Œäº‹åŠ¡å±æ€§</h5>
<ul>
<li>block.blockhash(uint blockNumber) returns (bytes32)ï¼šä¸€ä¸ªç»™å®šåŒºå—çš„æ•£åˆ—å€¼ - åªå¯¹å½“å‰æœ€è¿‘çš„256ä¸ªåŒºå—å¥æ•ˆã€‚</li>
<li>block.coinbase (address)ï¼šå½“å‰åŒºå—æŒ–æ˜è€…çš„åœ°å€ã€‚</li>
<li>block.difficulty (uint)ï¼šå½“å‰åŒºå—çš„éš¾åº¦ã€‚</li>
<li>block.gaslimit (uint)ï¼šå½“å‰åŒºå—çš„ gaslimitã€‚</li>
<li>block.number (uint)ï¼šå½“å‰åŒºå—å·</li>
<li>block.timestamp (uint)ï¼šå½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä» unix epoch å¼€å§‹çš„ç§’æ•°å½¢å¼ã€‚</li>
<li>msg.data (bytes)ï¼šå®Œæ•´çš„è°ƒç”¨æ•°æ®ã€‚</li>
<li>msg.gas (uint)ï¼šå‰©ä½™ gasã€‚</li>
<li>msg.sender (address)ï¼šå½“å‰è°ƒç”¨çš„æ¶ˆæ¯å‘é€è€…ã€‚</li>
<li>msg.sig (bytes4)ï¼šcalldata çš„æœ€åˆå››ä¸ªå­—èŠ‚ï¼ˆå‡½æ•°æ ‡è¯†ç¬¦ï¼‰ã€‚</li>
<li>msg.value (uint)ï¼šæ¶ˆæ¯é™„å¸¦çš„ä»·å€¼æ•°ã€‚</li>
<li>now (uint)ï¼šæ—¶é—´æˆ³çš„åˆ«åã€‚</li>
<li>tx.gasprice (uint)ï¼šäº‹åŠ¡çš„ gaspriceã€‚</li>
<li>tx.origin (address)ï¼šäº‹åŠ¡çš„å‘é€è€… (å®Œæ•´è°ƒç”¨é“¾)ã€‚</li>
</ul>
<p>msg çš„æ‰€æœ‰æˆå‘˜ï¼Œå¯èƒ½åœ¨æ¯ä¸ªå¤–éƒ¨è°ƒç”¨ä¸­éƒ½å‘ç”Ÿå˜åŒ–ã€‚</p>
<h5 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h5>
<p><code>assert(bool condition)</code>ï¼šå¦‚æœæ¡ä»¶ä¸ä¸ºçœŸæŠ›å‡ºå¼‚å¸¸ã€‚<br>
<code>require(bool condition)</code>ï¼šæŠ›å‡ºå¼‚å¸¸å¦‚æœæ¡ä»¶ä¸ä¸ºçœŸï¼Œç”¨æ¥åšè¾“å…¥æ£€æŸ¥ï¼ˆé€šå¸¸é…åˆ modifier ä½¿ç”¨ï¼‰ã€‚<br>
<code>revert()</code>ï¼šé€€å‡ºæ‰§è¡Œï¼Œå¹¶ä¸”åè½¬çŠ¶æ€å˜åŒ–ã€‚</p>
<h5 id="æ•°å­¦å’Œå¯†ç å­¦å‡½æ•°">æ•°å­¦å’Œå¯†ç å­¦å‡½æ•°</h5>
<ul>
<li>addmod(uint x, uint y, uint k) returns (uint):<br>
compute (x + y) % k where the addition is performed with arbitrary precision and does not wrap around at 2**256. Assert that k != 0 starting from version 0.5.0.</li>
<li>mulmod(uint x, uint y, uint k) returns (uint):<br>
compute (x * y) % k where the multiplication is performed with arbitrary precision and does not wrap around at 2**256. Assert that k != 0 starting from version 0.5.0.</li>
<li>keccak256(â€¦) returns (bytes32):<br>
compute the Ethereum-SHA-3 (Keccak-256) hash of the (tightly packed) arguments</li>
<li>sha256(â€¦) returns (bytes32):<br>
compute the SHA-256 hash of the (tightly packed) arguments</li>
<li>sha3(â€¦) returns (bytes32):<br>
alias to keccak256</li>
<li>ripemd160(â€¦) returns (bytes20):<br>
compute RIPEMD-160 hash of the (tightly packed) arguments</li>
<li>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address):<br>
recover the address associated with the public key from elliptic curve signature or return zero on error (example usage)</li>
</ul>
<p>å› ä¸ºâ€œç´§å¯†æ‰“åŒ…â€ï¼Œä»¥ä¸‹å†…å®¹æ˜¯ç›¸ç­‰çš„ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">keccak256</span><span class="hljs-params">(<span class="hljs-string">&quot;ab&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">keccak256</span><span class="hljs-params">(<span class="hljs-string">&quot;abc&quot;</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">keccak256</span><span class="hljs-params">(<span class="hljs-number">0</span>x616263)</span></span><br><span class="hljs-function"><span class="hljs-title">keccak256</span><span class="hljs-params">(<span class="hljs-number">6382179</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">keccak256</span><span class="hljs-params">(<span class="hljs-number">97</span>, <span class="hljs-number">98</span>, <span class="hljs-number">99</span>)</span></span><br></code></pre></td></tr></table></figure>
<h3 id="è¡¨è¾¾å¼å’Œæ§åˆ¶ç»“æ„">è¡¨è¾¾å¼å’Œæ§åˆ¶ç»“æ„</h3>
<h4 id="è¾“å…¥å‚æ•°å’Œè¾“å‡ºå‚æ•°">è¾“å…¥å‚æ•°å’Œè¾“å‡ºå‚æ•°</h4>
<h5 id="è¾“å…¥å‚æ•°">è¾“å…¥å‚æ•°</h5>
<p>å£°æ˜è¾“å…¥å‚æ•°å’Œå£°æ˜å˜é‡ä¸€æ ·ã€‚</p>
<h5 id="è¾“å‡ºå‚æ•°">è¾“å‡ºå‚æ•°</h5>
<p>è¾“å‡ºå‚æ•°çš„å®šä¹‰ï¼Œå¾ˆåƒ Golangï¼š</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract Simple &#123;<br>    <span class="hljs-built_in">function</span> arithmetics(<span class="hljs-built_in">uint</span> _a, <span class="hljs-built_in">uint</span> _b)<br>        <span class="hljs-keyword">public</span><br>        <span class="hljs-keyword">pure</span><br>        returns (<span class="hljs-built_in">uint</span> o_sum, <span class="hljs-built_in">uint</span> o_product)<br>    &#123;<br>        o_sum = _a + _b;<br>        o_product = _a * _b;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="æ§åˆ¶ç»“æ„">æ§åˆ¶ç»“æ„</h4>
<p>é™¤äº† switch å’Œ gotoï¼ŒJavaScript ä¸­æ‰€æœ‰çš„æ§åˆ¶ç»“æ„ Solidity éƒ½æ”¯æŒã€‚</p>
<h5 id="å¤šè¿”å›å€¼">å¤šè¿”å›å€¼</h5>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°å£°æ˜çš„åœ°æ–¹æœ‰å¤šè¿”å›å€¼äº†ï¼Œå¯ä»¥åƒ Golang ä¸€æ ·å†™å¤šè¿”å›å€¼-<code>return (v0, v1, ..., vn)</code>ã€‚</p>
<h4 id="function-calls">Function Calls</h4>
<h5 id="å†…éƒ¨è°ƒç”¨">å†…éƒ¨è°ƒç”¨</h5>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">16</span>;<br><br>contract C &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">g</span>(uint a) public pure returns (uint ret) &#123; <span class="hljs-keyword">return</span> <span class="hljs-type">f()</span>; &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">f</span>() internal pure returns (uint ret) &#123; <span class="hljs-keyword">return</span> <span class="hljs-type">g(7)</span> + f(); &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†…éƒ¨è°ƒç”¨ä¼šè¢« EVM ç¿»è¯‘æˆå­—èŠ‚ç ï¼Œç›´æ¥ jump è¿‡å»ã€‚å› ä¸ºè¿™æ—¶å€™è¿˜æ˜¯åœ¨å†…å­˜å†…è°ƒç”¨ï¼Œå†…å­˜å†…çŠ¶æ€æ²¡æœ‰è¢«æ¸…ç†æ‰ï¼Œæ‰€ä»¥æ˜¯å¾ˆé«˜æ•ˆã€‚</p>
<h5 id="å¤–éƒ¨å‡½æ•°è°ƒç”¨">å¤–éƒ¨å‡½æ•°è°ƒç”¨</h5>
<p>åƒ<code>c.g(2);</code>è¿™ç±»è°ƒç”¨ï¼Œæœ¬èº«æ˜¯åœ¨ä¸€ä¸ª contract å®ä¾‹ä¸Šçš„è°ƒç”¨ï¼Œæœ¬èº«å¿…ç„¶è¦æ±‚ message call çš„ï¼Œå°±ä¸èƒ½ jump äº†ã€‚</p>
<p>è°ƒç”¨å…¶ä»–åˆçº¦çš„ payable æ–¹æ³•çš„ä¾‹å­ã€‚</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">0</span>;<br><br>contract InfoFeed &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">info</span>() public payable returns (uint ret) &#123; <span class="hljs-keyword">return</span> <span class="hljs-type">42</span>; &#125;<br>&#125;<br><br>contract Consumer &#123;<br>    InfoFeed feed;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">setFeed</span>(address addr) public &#123; feed = InfoFeed(addr); &#125;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">callFeed</span>() public &#123; feed.info.value(10).gas(800)(); &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åªæœ‰è¢« payable ä¿®é¥°çš„æ–¹æ³•ï¼Œæ‰å¯ä»¥è¢« value option æ–¹æ³•è°ƒç”¨ã€‚<code>InfoFeed(addr)</code>å¹¶ä¸æ˜¯è°ƒç”¨ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼ˆçœ‹æ¥æ„é€ æ–¹æ³•åªæœ‰åœ¨åˆçº¦åˆå§‹åŒ–çš„æ—¶å€™æ‰ä¼šè¢«è°ƒç”¨ï¼‰ï¼Œè€Œæ˜¯å‘è¿™ä¸ªåœ°å€å£°ç§°èƒ½ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Ÿ</p>
<p>ä¸ä»»ä½•å…¶ä»–åˆçº¦äº¤äº’éƒ½æœ‰æ½œåœ¨å±é™©ï¼Œç‰¹åˆ«æ˜¯åœ¨è¯¥åˆçº¦çš„æºç äº‹å…ˆæœªçŸ¥çš„æƒ…å†µä¸‹ã€‚å½“å‰çš„åˆçº¦æŠŠæ§åˆ¶æƒæ‹±æ‰‹äº¤ç»™è¢«è°ƒç”¨åˆçº¦ï¼Œå®ƒå°±å¯ä»¥åšä»»ä½•äº‹ã€‚ä¸ºäº†è®©è‡ªå·±çš„æˆnot vulnerable to exploitï¼Œåº”è¯¥è®©è‡ªå·±çš„å¤–éƒ¨å‡½æ•°è°ƒç”¨æœ‰é˜²å¾¡æ€§ï¼Œå°½é‡è®©å¤–éƒ¨å‡½æ•°è°ƒç”¨å‘ç”Ÿåœ¨<strong>çŠ¶æ€æ”¹å˜ä¹‹å</strong>ã€‚</p>
<h5 id="å‘½åè°ƒç”¨å’ŒåŒ¿åå‡½æ•°å‚æ•°">å‘½åè°ƒç”¨å’ŒåŒ¿åå‡½æ•°å‚æ•°</h5>
<p>ä¸€ä¸ªç®€å•çš„å­—é¢é‡è°ƒç”¨çš„ä¾‹å­ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-function">function <span class="hljs-title">f</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> key, <span class="hljs-built_in">uint</span> <span class="hljs-keyword">value</span></span>) <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">g</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-comment">// named arguments</span><br>        f(&#123;<span class="hljs-keyword">value</span>: <span class="hljs-number">2</span>, key: <span class="hljs-number">3</span>&#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="çœç•¥å‡½æ•°å‚æ•°å">çœç•¥å‡½æ•°å‚æ•°å</h5>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract C &#123;<br>    <span class="hljs-comment">// è¿™é‡Œæœ‰ä¸ªè¢«çœç•¥äº†çš„ uint å‚æ•°ï¼Œä¸èƒ½è®¿é—®åˆ°ã€‚</span><br>    <span class="hljs-comment">// omitted name for parameter</span><br>    <span class="hljs-built_in">function</span> func(<span class="hljs-built_in">uint</span> k, <span class="hljs-built_in">uint</span>) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> returns(<span class="hljs-built_in">uint</span>) &#123;<br>        <span class="hljs-keyword">return</span> k;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="ç”¨newåˆ›å»ºæ–°åˆçº¦">ç”¨<code>new</code>åˆ›å»ºæ–°åˆçº¦</h4>
<p>å¯ä»¥ç”¨<code>new</code>æ¥åˆ›å»ºåˆçº¦ã€‚è¦è¢«åˆ›å»ºçš„åˆçº¦çš„å®Œæ•´ä»£ç ï¼Œè¦äº‹å…ˆè¢«çŸ¥é“ï¼Œæ‰€ä»¥ï¼Œä¹Ÿå°±ä¸å¯èƒ½æœ‰é€’å½’çš„åˆ›å»ºä¾èµ–äº†ï¼š</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract D &#123;<br>    <span class="hljs-built_in">uint</span> x;<br>    <span class="hljs-built_in">function</span> D(<span class="hljs-built_in">uint</span> a) <span class="hljs-keyword">public</span> payable &#123;<br>        x = a;<br>    &#125;<br>&#125;<br><br>contract C &#123;<br>    <span class="hljs-comment">// åˆ›å»º C çš„æ—¶å€™ä¸€å¹¶åˆ›å»º D</span><br>    D d = <span class="hljs-keyword">new</span> D(<span class="hljs-number">4</span>); <span class="hljs-comment">// will be executed as part of C&#x27;s constructor</span><br><br>    <span class="hljs-built_in">function</span> createD(<span class="hljs-built_in">uint</span> arg) <span class="hljs-keyword">public</span> &#123;<br>        D newD = <span class="hljs-keyword">new</span> D(arg);<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> createAndEndowD(<span class="hljs-built_in">uint</span> arg, <span class="hljs-built_in">uint</span> amount) <span class="hljs-keyword">public</span> payable &#123;<br>        <span class="hljs-comment">// Send ether along with the creation</span><br>        D newD = (<span class="hljs-keyword">new</span> D).value(amount)(arg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="è¡¨è¾¾å¼æ±‚å€¼çš„é¡ºåº">è¡¨è¾¾å¼æ±‚å€¼çš„é¡ºåº</h4>
<p>é™¤äº†å¸ƒå°”è¡¨è¾¾å¼ä»¥å¤–ï¼Œæ‰€æœ‰è¡¨è¾¾å¼çš„æ±‚å€¼é¡ºåºéƒ½å¯èƒ½æ˜¯æœªå®šçš„ã€‚åœ¨è¡¨è¾¾å¼æ ‘ä¸­ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹ä¸€å®šä¼šåœ¨å®ƒä¹‹å‰æ‰§è¡Œï¼ˆåç¼€éå†ï¼‰ï¼Œå…¶ä»–çš„å…¨éƒ¨éƒ½æ²¡æœ‰ä¿è¯ã€‚</p>
<h4 id="èµ‹å€¼">èµ‹å€¼</h4>
<h5 id="è§£æ„èµ‹å€¼å’Œå¤šè¿”å›å€¼">è§£æ„èµ‹å€¼å’Œå¤šè¿”å›å€¼</h5>
<p>Solidity å†…éƒ¨æ”¯æŒå…ƒç»„ç±»å‹ï¼Œå³ä¸€ä¸ªå…ƒç´ å¯èƒ½æ˜¯ä¸åŒç±»å‹ï¼Œä½†é•¿åº¦åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šä¸ºå¸¸æ•°çš„æ•°ç»„åˆ—è¡¨ã€‚å…ƒç»„æ‰æ˜¯å¤šè¿”å›å€¼çš„æœ¬è´¨ï¼ˆå…¶å®åœ¨å…¶ä»–è¯­è¨€é‡Œè¿˜å…è®¸å¯¹è±¡ç»“æ„çš„è§£æ„è¿”å›ï¼‰ã€‚</p>
<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gml">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract C &#123;<br>    uint[] data;<br><br>    <span class="hljs-keyword">function</span> f() public pure returns (uint, <span class="hljs-built_in">bool</span>, uint) &#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-number">7</span>, <span class="hljs-symbol">true</span>, <span class="hljs-number">2</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> g() public &#123;<br>        <span class="hljs-comment">// Declares and assigns the variables. Specifying the type explicitly is not possible.</span><br>        <span class="hljs-keyword">var</span> (<span class="hljs-variable language_">x</span>, b, <span class="hljs-variable language_">y</span>) = f();<br>        <span class="hljs-comment">// Assigns to a pre-existing variable.</span><br>        (<span class="hljs-variable language_">x</span>, <span class="hljs-variable language_">y</span>) = (<span class="hljs-number">2</span>, <span class="hljs-number">7</span>);<br>        <span class="hljs-comment">// Common trick to swap values -- does not work for non-value storage types.</span><br>        (<span class="hljs-variable language_">x</span>, <span class="hljs-variable language_">y</span>) = (<span class="hljs-variable language_">y</span>, <span class="hljs-variable language_">x</span>);<br>        <span class="hljs-comment">// Components can be left out (also for variable declarations).</span><br>        <span class="hljs-comment">// If the tuple ends in an empty component,</span><br>        <span class="hljs-comment">// the rest of the values are discarded.</span><br>        (data.length,) = f(); <span class="hljs-comment">// Sets the length to 7</span><br>        <span class="hljs-comment">// The same can be done on the left side.</span><br>        <span class="hljs-comment">// If the tuple begins in an empty component, the beginning values are discarded.</span><br>        (,data[<span class="hljs-number">3</span>]) = f(); <span class="hljs-comment">// Sets data[3] to 2</span><br>        <span class="hljs-comment">// Components can only be left out at the left-hand-side of assignments, with</span><br>        <span class="hljs-comment">// one exception:</span><br>        (<span class="hljs-variable language_">x</span>,) = (<span class="hljs-number">1</span>,);<br>        <span class="hljs-comment">// (1,) is the only way to specify a 1-component tuple, because (1) is</span><br>        <span class="hljs-comment">// equivalent to 1.</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="æ•°ç»„å’Œç»“æ„ä½“çš„å¤æ‚ç‚¹">æ•°ç»„å’Œç»“æ„ä½“çš„å¤æ‚ç‚¹</h5>
<p>æ•°ç»„å’Œç»“æ„ä½“ç­‰éå€¼ç±»å‹èµ‹å€¼è¯­ä¹‰ç¨æ˜¾å¤æ‚ã€‚</p>
<p>èµ‹å€¼ç»™ä¸€ä¸ªçŠ¶æ€å˜é‡æ€»æ˜¯ä¼šäº§ç”Ÿä¸€ä¸ªç‹¬ç«‹æ‹·è´ã€‚</p>
<p>ä»çŠ¶æ€å˜é‡èµ‹æ•°ç»„å’Œç»“æ„ä½“ç»™å±€éƒ¨å˜é‡æ˜¯ä¼ å¼•ç”¨ï¼Œå†èµ‹å€¼è¿˜æ˜¯ä¼ å¼•ç”¨ã€‚</p>
<h4 id="ä½œç”¨åŸŸå’Œå£°æ˜">ä½œç”¨åŸŸå’Œå£°æ˜</h4>
<p>ä¸€ä¸ªå˜é‡ï¼ˆåŒ…æ‹¬åœ¨å‡½æ•°å†…ï¼‰è¢«å£°æ˜çš„æ—¶å€™å°±ä¼šæ‹¥æœ‰å­—èŠ‚é›¶å€¼ã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> foo() <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> returns (<span class="hljs-built_in">uint</span>) &#123;<br>        <span class="hljs-comment">// baz is implicitly initialized as 0</span><br>        <span class="hljs-built_in">uint</span> bar = <span class="hljs-number">5</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) &#123;<br>            bar += baz;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">uint</span> baz = <span class="hljs-number">10</span>;<span class="hljs-comment">// never executes</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> bar;<span class="hljs-comment">// returns 5</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å‡½æ•°å†…çš„å˜é‡é‡Œè¿˜æ˜¯æ²¡æœ‰å—çº§ä½œç”¨åŸŸçš„ã€‚</p>
<h5 id="ä»-0-5-0-å¼€å§‹å°±æœ‰ä½œç”¨åŸŸäº†">ä» 0.5.0 å¼€å§‹å°±æœ‰ä½œç”¨åŸŸäº†</h5>
<p>å—ä½œç”¨åŸŸæœ‰å—ç”Ÿå‘½å‘¨æœŸã€‚<br>
for ç›¸å…³å˜é‡åªæœ‰ for å—çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><span class="hljs-keyword">pragma</span> experimental <span class="hljs-string">&quot;v0.5.0&quot;</span>;<br>contract C &#123;<br>    <span class="hljs-built_in">function</span> minimalScoping() <span class="hljs-keyword">pure</span> <span class="hljs-keyword">public</span> &#123;<br>        &#123;<br>            <span class="hljs-built_in">uint</span> same2 = <span class="hljs-number">0</span>;<br>        &#125;<br><br>        &#123;<br>            <span class="hljs-built_in">uint</span> same2 = <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><span class="hljs-keyword">pragma</span> experimental <span class="hljs-string">&quot;v0.5.0&quot;</span>;<br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f() <span class="hljs-keyword">pure</span> <span class="hljs-keyword">public</span> returns (<span class="hljs-built_in">uint</span>) &#123;<br>        <span class="hljs-built_in">uint</span> x = <span class="hljs-number">1</span>;<br>        &#123;<br>            x = <span class="hljs-number">2</span>; <span class="hljs-comment">// this will assign to the outer variable</span><br>            <span class="hljs-built_in">uint</span> x;<br>        &#125;<br>        <span class="hljs-keyword">return</span> x; <span class="hljs-comment">// x has value 2</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="é”™è¯¯å¤„ç†ï¼šæ–­è¨€-éœ€æ±‚-åè½¬å’Œå¼‚å¸¸">é”™è¯¯å¤„ç†ï¼šæ–­è¨€ã€éœ€æ±‚ã€åè½¬å’Œå¼‚å¸¸</h4>
<p>æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šåè½¬å½“å‰çš„è°ƒç”¨åŠå…¶å­è°ƒç”¨çš„çŠ¶æ€å˜åŒ–ã€‚</p>
<p>åœ¨æœªæ¥<code>throw</code>ä¼šè¢«æ·˜æ±°æ‰ï¼Œåº”è¯¥ä½¿ç”¨<code>revert</code>ã€‚</p>
<p>æœ‰äº›è°ƒç”¨æ–¹æ³•æ˜¯é è¿”å›å€¼æ¥ç¡®è®¤å¼‚å¸¸çš„ï¼Œæ³¨æ„æ£€æŸ¥è¿”å›å€¼ã€‚</p>
<p>ç›®å‰ä¸æ”¯æŒ catch è¯­å¥ã€‚</p>
<h3 id="åˆçº¦">åˆçº¦</h3>
<p>Solidity é‡Œçš„åˆçº¦ï¼Œç±»ä¼¼é¢å‘å¯¹è±¡è¯­è¨€é‡Œé¢çš„ç±»ã€‚ä»–ä»¬åŒ…å«æŒä¹…åŒ–çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ã€‚</p>
<p>è·¨åˆçº¦è°ƒç”¨ä¸èƒ½å¼•ç”¨è€ä¸Šä¸‹æ–‡çš„çŠ¶æ€å˜é‡ï¼Œä½†ä¾ç„¶è¦å°å¿ƒå¤–éƒ¨å‡½æ•°è°ƒç”¨é—®é¢˜ã€‚</p>
<h4 id="åˆ›å»ºåˆçº¦">åˆ›å»ºåˆçº¦</h4>
<p>å¯ä»¥ç”¨å¤–éƒ¨äº‹åŠ¡æˆ–è€…åœ¨åˆçº¦å†…éƒ¨åˆ›å»ºåˆçº¦ã€‚</p>
<p>å¯ä»¥ç”¨<a target="_blank" rel="noopener" href="https://github.com/ethereum/web3.js">web3.js</a>çš„ API åˆ›å»ºåˆçº¦ï¼Œå…·ä½“å‚è§<a target="_blank" rel="noopener" href="https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#new-contract">web3.eth.Contract</a>ã€‚</p>
<p>åªå…è®¸ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä¸å…è®¸æ„é€ å‡½æ•°é‡è½½ã€‚ä¹Ÿå¯ä»¥æ²¡æœ‰æ„é€ å‡½æ•°ã€‚</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract OwnedToken &#123;<br>    // TokenCreator <span class="hljs-keyword">is</span> a contract <span class="hljs-keyword">type</span> that <span class="hljs-keyword">is</span> defined below.<br>    // It <span class="hljs-keyword">is</span> fine <span class="hljs-keyword">to</span> reference it <span class="hljs-keyword">as</span> long <span class="hljs-keyword">as</span> it <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> used<br>    // <span class="hljs-keyword">to</span> <span class="hljs-keyword">create</span> a <span class="hljs-built_in">new</span> contract.<br>    TokenCreator creator;<br>    address <span class="hljs-keyword">owner</span>;<br>    bytes32 <span class="hljs-type">name</span>;<br><br>    // This <span class="hljs-keyword">is</span> the constructor which registers the<br>    // creator <span class="hljs-keyword">and</span> the assigned <span class="hljs-type">name</span>.<br>    <span class="hljs-keyword">function</span> OwnedToken(bytes32 _name) <span class="hljs-built_in">public</span> &#123;<br>        // <span class="hljs-type">internal</span> å˜é‡ä¸éœ€è¦ this è®¿é—®ï¼Œåæ­£è¿™æ—¶å€™åˆçº¦è¿˜ä¸å­˜åœ¨å‘¢<br>        // State variables are accessed via their <span class="hljs-type">name</span><br>        // <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> via e.g. this.<span class="hljs-keyword">owner</span>. This <span class="hljs-keyword">also</span> applies<br>        // <span class="hljs-keyword">to</span> <span class="hljs-keyword">functions</span> <span class="hljs-keyword">and</span> especially <span class="hljs-keyword">in</span> the constructors,<br>        // you can <span class="hljs-keyword">only</span> <span class="hljs-keyword">call</span> them <span class="hljs-keyword">like</span> that (&quot;internally&quot;),<br>        // because the contract itself does <span class="hljs-keyword">not</span> exist yet.<br>        owner = msg.sender;<br>        // We <span class="hljs-keyword">do</span> an explicit <span class="hljs-keyword">type</span> <span class="hljs-keyword">conversion</span> <span class="hljs-keyword">from</span> `address`<br>        // <span class="hljs-keyword">to</span> `TokenCreator` <span class="hljs-keyword">and</span> assume that the <span class="hljs-keyword">type</span> <span class="hljs-keyword">of</span><br>        // the calling contract <span class="hljs-keyword">is</span> TokenCreator, there <span class="hljs-keyword">is</span><br>        // <span class="hljs-keyword">no</span> <span class="hljs-type">real</span> way <span class="hljs-keyword">to</span> <span class="hljs-keyword">check</span> that.<br>        creator = TokenCreator(msg.sender);<br>        <span class="hljs-type">name</span> = _name;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> changeName(bytes32 newName) <span class="hljs-built_in">public</span> &#123;<br>        // <span class="hljs-keyword">Only</span> the creator can <span class="hljs-keyword">alter</span> the <span class="hljs-type">name</span> <span class="hljs-comment">--</span><br>        // the comparison <span class="hljs-keyword">is</span> possible since contracts<br>        // are implicitly convertible <span class="hljs-keyword">to</span> addresses.<br>        <span class="hljs-keyword">if</span> (msg.sender == address(creator))<br>            <span class="hljs-type">name</span> = newName;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> transfer(address newOwner) <span class="hljs-built_in">public</span> &#123;<br>        // <span class="hljs-keyword">Only</span> the <span class="hljs-keyword">current</span> <span class="hljs-keyword">owner</span> can transfer the token.<br>        <span class="hljs-keyword">if</span> (msg.sender != <span class="hljs-keyword">owner</span>) <span class="hljs-keyword">return</span>;<br>        // We <span class="hljs-keyword">also</span> want <span class="hljs-keyword">to</span> ask the creator <span class="hljs-keyword">if</span> the transfer<br>        // <span class="hljs-keyword">is</span> fine. Note that this calls a <span class="hljs-keyword">function</span> <span class="hljs-keyword">of</span> the<br>        // contract defined below. <span class="hljs-keyword">If</span> the <span class="hljs-keyword">call</span> fails (e.g.<br>        // due <span class="hljs-keyword">to</span> <span class="hljs-keyword">out</span>-<span class="hljs-keyword">of</span>-gas), the execution here stops<br>        // immediately.<br>        <span class="hljs-keyword">if</span> (creator.isTokenTransferOK(<span class="hljs-keyword">owner</span>, newOwner))<br>            owner = newOwner;<br>    &#125;<br>&#125;<br><br>contract TokenCreator &#123;<br>    <span class="hljs-keyword">function</span> createToken(bytes32 <span class="hljs-type">name</span>)<br>       <span class="hljs-built_in">public</span><br>       <span class="hljs-keyword">returns</span> (OwnedToken tokenAddress)<br>    &#123;<br>        // <span class="hljs-keyword">Create</span> a <span class="hljs-built_in">new</span> Token contract <span class="hljs-keyword">and</span> <span class="hljs-keyword">return</span> its address.<br>        // <span class="hljs-keyword">From</span> the JavaScript side, the <span class="hljs-keyword">return</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">is</span> simply<br>        // `address`, <span class="hljs-keyword">as</span> this <span class="hljs-keyword">is</span> the closest <span class="hljs-keyword">type</span> available <span class="hljs-keyword">in</span><br>        // the ABI.<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> OwnedToken(<span class="hljs-type">name</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> changeName(OwnedToken tokenAddress, bytes32 <span class="hljs-type">name</span>)  <span class="hljs-built_in">public</span> &#123;<br>        // Again, the <span class="hljs-keyword">external</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">of</span> `tokenAddress` <span class="hljs-keyword">is</span><br>        // simply `address`.<br>        tokenAddress.changeName(<span class="hljs-type">name</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> isTokenTransferOK(address currentOwner, address newOwner)<br>        <span class="hljs-built_in">public</span><br>        <span class="hljs-keyword">view</span><br>        <span class="hljs-keyword">returns</span> (<span class="hljs-type">bool</span> ok)<br>    &#123;<br>        // è¿™æ®µå¯ä»¥è¯´æ˜¯èƒ¡è¯Œçš„<br>        // <span class="hljs-keyword">Check</span> <span class="hljs-keyword">some</span> arbitrary condition.<br>        address tokenAddress = msg.sender;<br>        <span class="hljs-keyword">return</span> (keccak256(newOwner) &amp; <span class="hljs-number">0xff</span>) == (bytes20(tokenAddress) &amp; <span class="hljs-number">0xff</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="å¯è§æ€§å’Œ-getter">å¯è§æ€§å’Œ Getter</h4>
<p>å†…éƒ¨è°ƒç”¨åªäº§ç”Ÿ JUMPï¼Œè€Œå¤–éƒ¨è°ƒç”¨äº§ç”Ÿ EVM callã€‚</p>
<p>æœ‰å››ç§å¯è§æ€§ï¼š<code>external</code>ï¼Œ<code>public</code>ï¼Œ<code>internal</code>æˆ–è€… <code>private</code>ã€‚è¿™å››ä¸ªå¯è§æ€§ï¼Œæ°å¥½æ˜¯ä¸¤ç»„åä¹‰è¯ã€‚</p>
<p>çŠ¶æ€å˜é‡é»˜è®¤å¯è§æ€§æ˜¯<code>internal</code>è€Œä¸å¯èƒ½æ˜¯<code>external</code>ã€‚</p>
<p><strong>å‡½æ•°é»˜è®¤å¯è§æ€§æ˜¯ publicï¼</strong></p>
<p>externalï¼šå¤–éƒ¨å‡½æ•°æ˜¯åˆçº¦æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚æ„å‘³ç€ä»–ä»¬åº”è¯¥è¢«ä»å¤–éƒ¨è°ƒç”¨ï¼Œå¿…ç„¶äº§ç”Ÿ EVM callã€‚ä¸€ä¸ª<code>external</code>çš„<code>f</code>æ˜¯ä¸èƒ½<code>f()</code>çš„ï¼Œåªèƒ½<code>this.f()</code>ã€‚</p>
<p>publicï¼šå…¬å…±å‡½æ•°ä¹Ÿæ˜¯åˆçº¦æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥å¤–éƒ¨è°ƒç”¨ä¹Ÿå¯ä»¥å†…éƒ¨è°ƒç”¨ã€‚æœ€ç®€å•è€Œå®Œç¾çš„æ¥å£è®¾è®¡ã€‚å…¬å…±å˜é‡ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ª getter å‡½æ•°ã€‚</p>
<p>internalï¼šå†…éƒ¨å‡½æ•°å’Œå˜é‡åªèƒ½åˆçº¦å†…éƒ¨è®¿é—®ï¼Œä¸ç”¨ thisã€‚ç±»ä¼¼ privateã€‚</p>
<p>privateï¼šå†…éƒ¨å‡½æ•°å’Œå˜é‡ä¸èƒ½è¢«ç»§æ‰¿ï¼Œåªèƒ½å†…éƒ¨è®¿é—®ã€‚</p>
<p>æ³¨æ„ï¼Œåˆçº¦çš„æ‰€æœ‰å†…å®¹åœ¨åŒºå—é“¾ä¸Šéƒ½æ˜¯å…¬å¼€å¯è§çš„ï¼Œè¿™äº›ä¿®é¥°ç¬¦åªèƒ½é˜»æ­¢ä¸å½“ä¿®æ”¹ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">// This will not compile</span><br>pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">private</span> data;<br><br>    <span class="hljs-function">function <span class="hljs-title">f</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> a</span>) <span class="hljs-keyword">private</span> <span class="hljs-title">returns</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> b</span>)</span> &#123; <span class="hljs-keyword">return</span> a + <span class="hljs-number">1</span>; &#125;<br>    <span class="hljs-function">function <span class="hljs-title">setData</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> a</span>) <span class="hljs-keyword">public</span></span> &#123; data = a; &#125;<br>    <span class="hljs-function">function <span class="hljs-title">getData</span>() <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span> &#123; <span class="hljs-keyword">return</span> data; &#125;<br>    <span class="hljs-function">function <span class="hljs-title">compute</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> a, <span class="hljs-built_in">uint</span> b</span>) <span class="hljs-keyword">internal</span> <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span> &#123; <span class="hljs-keyword">return</span> a+b; &#125;<br>&#125;<br><br>contract D &#123;<br>    <span class="hljs-function">function <span class="hljs-title">readData</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        C c = <span class="hljs-keyword">new</span> C();<br>        <span class="hljs-built_in">uint</span> local = c.f(<span class="hljs-number">7</span>); <span class="hljs-comment">// error: member `f` is not visible</span><br>        c.setData(<span class="hljs-number">3</span>);<br>        local = c.getData();<br>        local = c.compute(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// error: member `compute` is not visible</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// é€šè¿‡ç»§æ‰¿ï¼Œå®ç°äº†ä»£ç å¤ç”¨</span><br>contract E <span class="hljs-keyword">is</span> C &#123;<br>    <span class="hljs-function">function <span class="hljs-title">g</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        C c = <span class="hljs-keyword">new</span> C();<br>        <span class="hljs-built_in">uint</span> val = compute(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// access to internal member (from derived to parent contract)</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="getter">Getter</h5>
<p>getter æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¸€ä¸ªè°ƒç”¨çš„ä¾‹å­ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">public</span> data = <span class="hljs-number">42</span>;<br>&#125;<br><br>contract Caller &#123;<br>    C c = <span class="hljs-keyword">new</span> C();<br>    <span class="hljs-function">function <span class="hljs-title">f</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-comment">// æ¢è¨€ä¹‹ï¼Œç”¨å‡½æ•°æ¥è®¿é—®å…¬å…±å˜é‡ï¼Œä¸è¦ç”¨ç‚¹æ“ä½œç¬¦ã€‚</span><br>        <span class="hljs-built_in">uint</span> local = c.data();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å†…å¤–è®¿é—®ä¸å†…éƒ¨è®¿é—®ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract C &#123;<br>    uint <span class="hljs-keyword">public</span> <span class="hljs-keyword">data</span>;<br>    function x() <span class="hljs-keyword">public</span> &#123;<br>        <span class="hljs-keyword">data</span> = <span class="hljs-number">3</span>; <span class="hljs-comment">// internal access</span><br>        uint <span class="hljs-keyword">val</span> = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>(); <span class="hljs-comment">// external access</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼š</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs zephir">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract Complex &#123;<br>    struct Data &#123;<br>        <span class="hljs-keyword">uint</span> a;<br>        bytes3 b;<br>        mapping (<span class="hljs-keyword">uint</span> =&gt; <span class="hljs-keyword">uint</span>) map;<br>    &#125;<br>    mapping (<span class="hljs-keyword">uint</span> =&gt; mapping(<span class="hljs-keyword">bool</span> =&gt; Data[])) <span class="hljs-keyword">public</span> data;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>ç”Ÿæˆçš„å‡½æ•°çš„å½¢å¼å¾ˆè´¹è§£ï¼š</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs zephir"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">data</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> arg1, <span class="hljs-keyword">bool</span> arg2, <span class="hljs-keyword">uint</span> arg3)</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span> a, bytes3 b)</span> </span>&#123;<br>    a = data[arg1][arg2][arg3].a;<br>    b = data[arg1][arg2][arg3].b;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="å‡½æ•°ä¿®é¥°ç¬¦">å‡½æ•°ä¿®é¥°ç¬¦</h4>
<p>å‡½æ•°ä¿®é¥°ç¬¦æ˜¯ç”¨æ¥æ”¹å˜å‡½æ•°è¡Œä¸ºçš„ï¼Œæ¯”å¦‚æ£€éªŒæ¡ä»¶ã€‚å‡½æ•°ä¿®é¥°ç¬¦å¯ä»¥è¢«é›†æˆä¹Ÿå¯ä»¥è¢«è¦†ç›–ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract owned &#123;<br>    <span class="hljs-function">function <span class="hljs-title">owned</span>() <span class="hljs-keyword">public</span></span> &#123; owner = msg.sender; &#125;<br>    address owner;<br><br>    <span class="hljs-comment">// This contract only defines a modifier but does not use</span><br>    <span class="hljs-comment">// it: it will be used in derived contracts.</span><br>    <span class="hljs-comment">// The function body is inserted where the special symbol</span><br>    <span class="hljs-comment">// `_;` in the definition of a modifier appears.</span><br>    <span class="hljs-comment">// This means that if the owner calls this function, the</span><br>    <span class="hljs-comment">// function is executed and otherwise, an exception is</span><br>    <span class="hljs-comment">// thrown.</span><br>    modifier onlyOwner &#123;<br>        require(msg.sender == owner);<br>        _;<br>    &#125;<br>&#125;<br><br>contract mortal <span class="hljs-keyword">is</span> owned &#123;<br>    <span class="hljs-comment">// This contract inherits the `onlyOwner` modifier from</span><br>    <span class="hljs-comment">// `owned` and applies it to the `close` function, which</span><br>    <span class="hljs-comment">// causes that calls to `close` only have an effect if</span><br>    <span class="hljs-comment">// they are made by the stored owner.</span><br>    <span class="hljs-function">function <span class="hljs-title">close</span>() <span class="hljs-keyword">public</span> onlyOwner</span> &#123;<br>        selfdestruct(owner);<br>    &#125;<br>&#125;<br><br>contract priced &#123;<br>    <span class="hljs-comment">// Modifiers can receive arguments:</span><br>    <span class="hljs-function">modifier <span class="hljs-title">costs</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> price</span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.<span class="hljs-keyword">value</span> &gt;= price) &#123;<br>            _;<br>        &#125;<br>    &#125;<br>&#125;<br><br>contract Register <span class="hljs-keyword">is</span> priced, owned &#123;<br>    mapping (address =&gt; <span class="hljs-built_in">bool</span>) registeredAddresses;<br>    <span class="hljs-built_in">uint</span> price;<br><br>    <span class="hljs-function">function <span class="hljs-title">Register</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> initialPrice</span>) <span class="hljs-keyword">public</span></span> &#123; price = initialPrice; &#125;<br>    <br>    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰è¿™ä¸ªå…³é”®å­—ï¼Œåˆçº¦ä¼šè‡ªåŠ¨æ‹’ç»è¢«å‘é€è¿‡æ¥çš„ä»¥å¤ªå¸</span><br>    <span class="hljs-comment">// It is important to also provide the</span><br>    <span class="hljs-comment">// `payable` keyword here, otherwise the function will</span><br>    <span class="hljs-comment">// automatically reject all Ether sent to it.</span><br>    <span class="hljs-function">function <span class="hljs-title">register</span>() <span class="hljs-keyword">public</span> payable <span class="hljs-title">costs</span>(<span class="hljs-params">price</span>)</span> &#123;<br>        registeredAddresses[msg.sender] = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">changePrice</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> _price</span>) <span class="hljs-keyword">public</span> onlyOwner</span> &#123;<br>        price = _price;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// å·§å¦™åœ°åŠ é”ï¼Œç±»ä¼¼ synchronizedã€‚</span><br>contract Mutex &#123;<br>    <span class="hljs-built_in">bool</span> locked;<br>    <span class="hljs-function">modifier <span class="hljs-title">noReentrancy</span>()</span> &#123;<br>        require(!locked);<br>        locked = <span class="hljs-literal">true</span>;<br>        <span class="hljs-comment">// è®©æ­¥ä¿®é¥°ç¬¦ï¼Œç±»ä¼¼ Ruby ä¸­çš„ yieldã€‚</span><br>        _;<br>        locked = <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> This function is protected by a mutex, which means that</span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> reentrant calls from within `msg.sender.call` cannot call `f` again.</span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> The `return 7` statement assigns 7 to the return value but still</span><br>    <span class="hljs-comment"><span class="hljs-doctag">///</span> executes the statement `locked = false` in the modifier.</span><br>    <span class="hljs-function">function <span class="hljs-title">f</span>() <span class="hljs-keyword">public</span> noReentrancy <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span></span>)</span> &#123;<br>        require(msg.sender.call());<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">7</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="çŠ¶æ€å¸¸é‡">çŠ¶æ€å¸¸é‡</h4>
<p>çŠ¶æ€å˜é‡å¯ä»¥è¢«å£°æ˜ä¸º<code>constant</code>ã€‚å®ƒä»¬å¿…é¡»è¢«ç¼–è¯‘æ—¶å·²çŸ¥å¸¸é‡å€¼çš„è¡¨è¾¾å¼èµ‹å€¼ï¼Œè¡¨è¾¾å¼ä¸èƒ½æ¥è§¦ storage (e.g. <code>now</code>ï¼Œ<code>this.balance</code> æˆ–è€… <code>block.number</code>)ï¼Œä¸èƒ½ç”±æ‰§è¡Œæ•°æ®å†³å®šï¼ˆ<code>msg.value</code>æˆ–è€…<code>gasleft()</code>ï¼‰ï¼Œæˆ–è€…å¤–éƒ¨åˆçº¦è°ƒç”¨ã€‚å…è®¸ä½¿ç”¨å†…éƒ¨è®¡ç®—å‡½æ•°<code>keccak256</code> ï¼Œ<code>sha256</code>ï¼Œ<code>ripemd160</code>ï¼Œ<code>ecrecover</code>ï¼Œ<code>addmod</code>å’Œ<code>mulmod</code>ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">pragma</span> solidity<span class="hljs-regexp"> ^0.4.0</span>;<br><br><span class="hljs-attribute">contract</span> C &#123;<br>    <span class="hljs-attribute">uint</span> constant x = <span class="hljs-number">32</span>**<span class="hljs-number">22</span> + <span class="hljs-number">8</span>;<br>    <span class="hljs-attribute">string</span> constant text = <span class="hljs-string">&quot;abc&quot;</span>;<br>    <span class="hljs-attribute">bytes32</span> constant myHash = keccak256(<span class="hljs-string">&quot;abc&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="å‡½æ•°">å‡½æ•°</h4>
<h5 id="view">view</h5>
<p>ä¸ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°å¯ä»¥è¢«å£°æ˜ä¸º<code>view</code>ã€‚</p>
<p>ä»¥ä¸‹æƒ…å†µä¸èƒ½ç”¨<code>view</code>ï¼š</p>
<ol>
<li>å†™çŠ¶æ€å˜é‡</li>
<li>å‘å°„äº‹ä»¶</li>
<li>åˆ›å»ºå…¶ä»–åˆçº¦</li>
<li>ä½¿ç”¨è‡ªæ¯</li>
<li>ç”¨è°ƒç”¨å‘é€ä»¥å¤ªå¸ï¼ˆä¹Ÿå°±æ˜¯è¯´ call ä¹Ÿä¸å®‰å…¨ï¼‰</li>
<li>è°ƒç”¨å…¶ä»–é<code>view</code>æˆ–è€…<code>pure</code>æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨ä½çº§è°ƒç”¨æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨æŸäº›ç‰¹å®šå†…è”æ±‡ç¼–æ“ä½œç ã€‚</li>
</ol>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract C &#123;<br>    <span class="hljs-built_in">function</span> f(<span class="hljs-built_in">uint</span> a, <span class="hljs-built_in">uint</span> b) <span class="hljs-keyword">public</span> view returns (<span class="hljs-built_in">uint</span>) &#123;<br>        <span class="hljs-keyword">return</span> a * (b + <span class="hljs-number">42</span>) + now;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>getter éƒ½æ˜¯<code>view</code>ã€‚</p>
<p>view æ˜¯å°½é‡åšåˆ°æœ€å¤§é™åº¦çš„ç¼–ç¨‹å®‰å…¨ï¼Œæœ‰æ—¶å€™åˆä¸èƒ½ä¿è¯ã€‚æ‰€ä»¥æ˜¯ä¸ªæœªå®Œæˆå“ã€‚</p>
<h5 id="pure-å‡½æ•°">pure å‡½æ•°</h5>
<p>ä¸è¯»å’Œå†™ state çš„å‡½æ•°å« pure å‡½æ•°ã€‚view æ˜¯ä¸å†™ï¼Œpure æ›´å½»åº•ã€‚pure å¯èƒ½äº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹é‡Œçš„çº¯å‡½æ•°ã€‚</p>
<p>pure å‡½æ•°é¦–å…ˆå¿…é¡»æ»¡è¶³ view å‡½æ•°çš„è¦æ±‚ï¼Œç„¶åä¸èƒ½æœ‰ä»¥ä¸‹è¡Œä¸ºï¼š</p>
<ol>
<li>è¯»çŠ¶æ€å˜é‡</li>
<li>è®¿é—®ä»»ä½• balanceã€‚</li>
<li>è®¿é—® blockï¼Œtx å’Œ msg çš„ä»»ä½•æˆå‘˜ã€‚</li>
<li>è°ƒç”¨é<code>pure</code>çš„å…¶ä»–å‡½æ•°ã€‚</li>
<li>ä½¿ç”¨æŸäº›ç‰¹å®šå†…è”æ±‡ç¼–æ“ä½œç ã€‚</li>
</ol>
<p>pure ä¹Ÿæ˜¯æœªå®Œæˆå“ï¼Œç¼–è¯‘å™¨ä¸èƒ½ä¿è¯å‡½æ•°çš„ä¸è¯»ä¸å†™ã€‚</p>
<h5 id="é™çº§å‡½æ•°">é™çº§å‡½æ•°</h5>
<p>ä¸€ä¸ªåˆçº¦åªèƒ½ç”±ä¸€ä¸ªæ— åå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸èƒ½æœ‰å‚æ•°åˆ—è¡¨ï¼Œä¹Ÿä¸èƒ½æœ‰è¿”å›å€¼ã€‚åˆçº¦åœ¨è¢«è°ƒç”¨ï¼Œä½†æ²¡æœ‰åˆé€‚çš„å‡½æ•°åŒ¹é…å¾—ä¸Šï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•è°ƒç”¨æ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±è¢«æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°åœ¨åˆçº¦æ¥æ”¶åˆ°çº¯ä»¥å¤ªå¸ï¼ˆæ²¡æœ‰æ•°æ®ï¼‰çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚ä¸ºäº†æ¥æ”¶ä»¥å¤ªå¸ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»è¢«å£°æ˜ä¸º payableã€‚æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œæ™®é€šè½¬è´¦äº‹åŠ¡æ— æ³•å¾€è¿™ä¸ªåˆçº¦é‡Œè½¬è´¦ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°æœ€å°‘éœ€è¦ 2300ä¸ª gasï¼ˆæ°å¥½æ˜¯æ™®é€šè½¬è´¦çš„ååˆ†ä¹‹ä¸€ï¼‰ã€‚</p>
<p>å³ä½¿è¿™ä¸ªå‡½æ•°æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨<code>msg.data</code>æ¥è·å–è°ƒç”¨è½½è·ã€‚æ¢è¨€ä¹‹ï¼Œè°ƒç”¨è¿™ç§å‡½æ•°ï¼Œåº”è¯¥å‘é€ä¸€äº›æ²¡æœ‰å…¶ä»–å‡½æ•°å¯ä»¥åŒ¹é…å¾—ä¸Šçš„å®å‚ã€‚</p>
<p>æ—©ç‰ˆæœ¬çš„ Solidity é‡Œé¢é™çº§å‡½æ•°éƒ½è°ƒç”¨å¤±è´¥çš„è¯ï¼Œæ˜¯ä¸é€€å¸çš„ï¼Œç°åœ¨çš„ç‰ˆæœ¬é€€å¸äº†ã€‚</p>
<p>å³ä½¿æ²¡æœ‰é™çº§å‡½æ•°ï¼Œè‡ªæ¯å’ŒæŒ–çŸ¿çš„ç›®æ ‡ä¾ç„¶å¯ä»¥è®¾ç½®ä¸ºè¿™ä¸ªåˆçº¦è´¦æˆ·ã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract Test &#123;<br>    <span class="hljs-comment">// This function is called for all messages sent to</span><br>    <span class="hljs-comment">// this contract (there is no other function).</span><br>    <span class="hljs-comment">// Sending Ether to this contract will cause an exception,</span><br>    <span class="hljs-comment">// because the fallback function does not have the `payable`</span><br>    <span class="hljs-comment">// modifier.</span><br>    <span class="hljs-built_in">function</span>() <span class="hljs-keyword">public</span> &#123; x = <span class="hljs-number">1</span>; &#125;<br>    <span class="hljs-built_in">uint</span> x;<br>&#125;<br><br><br><span class="hljs-comment">// This contract keeps all Ether sent to it with no way</span><br><span class="hljs-comment">// to get it back.</span><br>contract Sink &#123;<br>    <span class="hljs-built_in">function</span>() <span class="hljs-keyword">public</span> payable &#123; &#125;<br>&#125;<br><br>contract Caller &#123;<br>    <span class="hljs-built_in">function</span> callTest(Test test) <span class="hljs-keyword">public</span> &#123;<br>        test.call(<span class="hljs-number">0</span>xabcdef01); <span class="hljs-comment">// hash does not exist</span><br>        <span class="hljs-comment">// results in test.x becoming == 1.</span><br><br>        <span class="hljs-comment">// The following will not compile, but even</span><br>        <span class="hljs-comment">// if someone sends ether to that contract,</span><br>        <span class="hljs-comment">// the transaction will fail and reject the</span><br>        <span class="hljs-comment">// Ether.</span><br>        <span class="hljs-comment">//test.send(2 ether);</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="å‡½æ•°é‡è½½">å‡½æ•°é‡è½½</h5>
<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹åŒå…¶ä»–é‡è½½ä¸€æ ·ã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-comment">// This will not compile</span><br><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract A &#123;<br>    <span class="hljs-built_in">function</span> f(B _in) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> returns (B <span class="hljs-keyword">out</span>) &#123;<br>        <span class="hljs-keyword">out</span> = _in;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span> f(address _in) <span class="hljs-keyword">public</span> <span class="hljs-keyword">pure</span> returns (address <span class="hljs-keyword">out</span>) &#123;<br>        <span class="hljs-keyword">out</span> = _in;<br>    &#125;<br>&#125;<br><br>contract B &#123;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥ç¼–è¯‘é”™è¯¯ï¼Œæ˜¯å› ä¸ºç¼–è¯‘åçš„ ABI ç±»å‹éƒ½æ˜¯ addressï¼Œç­‰äºæ²¡æœ‰é‡è½½ã€‚</p>
<h4 id="äº‹ä»¶">äº‹ä»¶</h4>
<p>äº‹ä»¶å…è®¸æ–¹ä¾¿åœ°ä½¿ç”¨ EVM çš„æ—¥å¿—åŸºç¡€è®¾æ–½ã€‚</p>
<p>æ—¥å¿—å¯ä»¥è¢«åœ¨åˆçº¦å†…éƒ¨è¢«ç»§æ‰¿ã€‚æ—¥å¿—ä¸äº‹åŠ¡ã€åˆçº¦å…³è”ï¼Œä¸åŒºå—åŒåœ¨ã€‚</p>
<p>æ—¥å¿—çš„ SPV è¯æ˜æ˜¯å¯ä»¥åšåˆ°çš„ã€‚</p>
<p>æœ€å¤šä¸‰ä¸ªå‚æ•°å¯ä»¥è¢«æ ‡è®°ä¸º<code>indexed</code>æ¥ç´¢å¼•ã€‚å…¶å®ç´¢å¼•çš„æŸ¥æ‰¾ï¼Œå¯èƒ½æ˜¯é€šè¿‡æ•£åˆ—å­˜å‚¨å’ŒæŸ¥æ‰¾çš„æ–¹å¼æ¥å®ç°çš„ã€‚æœ¬è´¨ä¸Šå°±æ˜¯æŠŠè¿™ä¸ªå‚æ•°å­˜æˆ topic ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥è¢«ç±»ä¼¼æµå¤„ç†çš„æœºåˆ¶ç›‘å¬èµ·æ¥ã€‚</p>
<p>äº‹ä»¶çš„æ­£ç»Ÿ watch ç”¨æ³•ï¼š</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs scss">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-selector-class">.0</span>;<br><br>contract ClientReceipt &#123;<br>    event <span class="hljs-built_in">Deposit</span>(<br>        address indexed _from,<br>        bytes32 indexed _id,<br>        uint _value<br>    );<br><br>    function <span class="hljs-built_in">deposit</span>(bytes32 _id) public payable &#123;<br>        <span class="hljs-comment">// Events are emitted using `emit`, followed by</span><br>        <span class="hljs-comment">// the name of the event and the arguments</span><br>        <span class="hljs-comment">// (if any) in parentheses. Any such invocation</span><br>        <span class="hljs-comment">// (even deeply nested) can be detected from</span><br>        <span class="hljs-comment">// the JavaScript API by filtering for `Deposit`.</span><br>        emit <span class="hljs-built_in">Deposit</span>(msg.sender, _id, msg.value);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> abi = <span class="hljs-comment">/* abi as generated by the compiler */</span>;<br><span class="hljs-keyword">var</span> ClientReceipt = web3.eth.contract(abi);<br><span class="hljs-keyword">var</span> clientReceipt = ClientReceipt.at(<span class="hljs-string">&quot;0x1234...ab67&quot;</span> <span class="hljs-comment">/* address */</span>);<br><br><span class="hljs-keyword">var</span> event = clientReceipt.Deposit();<br><br><span class="hljs-comment">// watch for changes</span><br>event.watch(<span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>)&#123;<br>    <span class="hljs-comment">// result will contain various information</span><br>    <span class="hljs-comment">// including the argumets given to the `Deposit`</span><br>    <span class="hljs-comment">// call.</span><br>    <span class="hljs-keyword">if</span> (!error)<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(result);<br>&#125;);<br><br><span class="hljs-comment">// Or pass a callback to start watching immediately</span><br><span class="hljs-keyword">var</span> event = clientReceipt.Deposit(<span class="hljs-keyword">function</span>(<span class="hljs-params">error, result</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!error)<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(result);<br>&#125;);<br></code></pre></td></tr></table></figure>
<h5 id="ä½çº§æ—¥å¿—è®¾æ–½">ä½çº§æ—¥å¿—è®¾æ–½</h5>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">10</span>;<br><br>contract C &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">f</span>() public payable &#123;<br>        bytes32 _id = 0x420042;<br>        log3(<br>            bytes32(msg.value),<br>            bytes32(0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20),<br>            bytes32(msg.sender),<br>            _id<br>        );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>logn ä¸€å…±å– n+1ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ”¾åœ¨ data åŒºï¼Œå…¶ä»–å‚æ•°æ”¾åœ¨ topic åŒºã€‚</p>
<h5 id="å…¶ä»–ç†è§£äº‹ä»¶çš„èµ„æº">å…¶ä»–ç†è§£äº‹ä»¶çš„èµ„æº</h5>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ethereum/wiki/wiki/JavaScript-API#contract-events">Javascript documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/debris/smart-exchange/blob/master/lib/contracts/SmartExchange.sol">Example usage of events</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/debris/smart-exchange/blob/master/lib/exchange_transactions.js">How to access them in js</a></li>
</ul>
<h4 id="ç»§æ‰¿">ç»§æ‰¿</h4>
<p>Solidity æ”¯æŒæŸç§ç¨‹åº¦ä¸Šçš„å¤šç»§æ‰¿ï¼Œå®ƒéœ€è¦æ‹·è´åŒ…æ‹¬å¤šæ€åœ¨å†…çš„ä»£ç ã€‚å½“ä¸€ä¸ªåˆçº¦å¤šç»§æ‰¿çš„æ—¶å€™ï¼Œåœ¨é“¾ä¸Šåªåˆ›å»ºä¸€ä»½åˆçº¦ï¼Œå…¶ä»–</p>
<p>æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯è™šè°ƒç”¨ã€‚</p>
<p>ç»§æ‰¿ç³»ç»Ÿéå¸¸åƒ Python çš„å…ƒç±»ç»§æ‰¿ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>contract owned &#123;<br>    <span class="hljs-function">function <span class="hljs-title">owned</span>()</span> &#123; owner = msg.sender; &#125;<br>    address owner;<br>&#125;<br><br><span class="hljs-comment">// åªæœ‰ private ä¸ä¼šè¢«ç»§æ‰¿ä¸‹æ¥</span><br><span class="hljs-comment">// Use `is` to derive from another contract. Derived</span><br><span class="hljs-comment">// contracts can access all non-private members including</span><br><span class="hljs-comment">// internal functions and state variables. These cannot be</span><br><span class="hljs-comment">// accessed externally via `this`, though.</span><br>contract mortal <span class="hljs-keyword">is</span> owned &#123;<br>    <span class="hljs-function">function <span class="hljs-title">kill</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.sender == owner) selfdestruct(owner);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ²¡æœ‰å‡½æ•°ä½“çš„å‡½æ•°ã€‚å…¶åˆçº¦æ˜¯æŠ½è±¡çš„ã€‚å®Œå…¨æ²¡æœ‰å‡½æ•°ä½“çš„åˆçº¦åªèƒ½å½“æ¥å£ç”¨ã€‚</span><br><span class="hljs-comment">// These abstract contracts are only provided to make the</span><br><span class="hljs-comment">// interface known to the compiler. Note the function</span><br><span class="hljs-comment">// without body. If a contract does not implement all</span><br><span class="hljs-comment">// functions it can only be used as an interface.</span><br>contract Config &#123;<br>    <span class="hljs-function">function <span class="hljs-title">lookup</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> id</span>) <span class="hljs-keyword">public</span> <span class="hljs-title">returns</span> (<span class="hljs-params">address adr</span>)</span>;<br>&#125;<br><br>contract NameReg &#123;<br>    <span class="hljs-function">function <span class="hljs-title">register</span>(<span class="hljs-params">bytes32 name</span>) <span class="hljs-keyword">public</span></span>;<br>    <span class="hljs-function">function <span class="hljs-title">unregister</span>() <span class="hljs-keyword">public</span></span>;<br> &#125;<br><br><span class="hljs-comment">// å¤šç»§æ‰¿ç±»ä¼¼ C++ çš„è™šç»§æ‰¿ï¼Œä¸ä¼šæœ‰å¤šä»½é‡å¤æˆå‘˜ã€‚</span><br><span class="hljs-comment">// Multiple inheritance is possible. Note that `owned` is</span><br><span class="hljs-comment">// also a base class of `mortal`, yet there is only a single</span><br><span class="hljs-comment">// instance of `owned` (as for virtual inheritance in C++).</span><br>contract named <span class="hljs-keyword">is</span> owned, mortal &#123;<br>    <span class="hljs-function">function <span class="hljs-title">named</span>(<span class="hljs-params">bytes32 name</span>)</span> &#123;<br>        Config config = Config(<span class="hljs-number">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span>);<br>        NameReg(config.lookup(<span class="hljs-number">1</span>)).register(name);<br>    &#125;<br><br>    <span class="hljs-comment">// Functions can be overridden by another function with the same name and</span><br>    <span class="hljs-comment">// the same number/types of inputs.  If the overriding function has different</span><br>    <span class="hljs-comment">// types of output parameters, that causes an error.</span><br>    <span class="hljs-comment">// Both local and message-based function calls take these overrides</span><br>    <span class="hljs-comment">// into account.</span><br>    <span class="hljs-function">function <span class="hljs-title">kill</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.sender == owner) &#123;<br>            Config config = Config(<span class="hljs-number">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span>);<br>            NameReg(config.lookup(<span class="hljs-number">1</span>)).unregister();<br>            <span class="hljs-comment">// It is still possible to call a specific</span><br>            <span class="hljs-comment">// overridden function.</span><br>            mortal.kill();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// è¿™æ ·è°ƒç”¨æ˜¾å¼æ„é€ å‡½æ•°å°±è®¨åŒäº†</span><br><span class="hljs-comment">// If a constructor takes an argument, it needs to be</span><br><span class="hljs-comment">// provided in the header (or modifier-invocation-style at</span><br><span class="hljs-comment">// the constructor of the derived contract (see below)).</span><br>contract PriceFeed <span class="hljs-keyword">is</span> owned, mortal, named(<span class="hljs-string">&quot;GoldFeed&quot;</span>) &#123;<br>   <span class="hljs-function">function <span class="hljs-title">updateInfo</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> newInfo</span>) <span class="hljs-keyword">public</span></span> &#123;<br>      <span class="hljs-keyword">if</span> (msg.sender == owner) info = newInfo;<br>   &#125;<br><br>   <span class="hljs-function">function <span class="hljs-title">get</span>() <span class="hljs-keyword">public</span> view <span class="hljs-title">returns</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> r</span>)</span> &#123; <span class="hljs-keyword">return</span> info; &#125;<br><br>   <span class="hljs-built_in">uint</span> info;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä¸€ä¸ªè±å½¢ç»§æ‰¿çš„è®¨åŒé—®é¢˜ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract <span class="hljs-keyword">owned</span> &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-keyword">owned</span>() <span class="hljs-built_in">public</span> &#123; owner = msg.sender; &#125;<br>    address <span class="hljs-keyword">owner</span>;<br>&#125;<br><br>contract mortal <span class="hljs-keyword">is</span> <span class="hljs-keyword">owned</span> &#123;<br>    <span class="hljs-keyword">function</span> kill() <span class="hljs-built_in">public</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.sender == <span class="hljs-keyword">owner</span>) selfdestruct(<span class="hljs-keyword">owner</span>);<br>    &#125;<br>&#125;<br><br>contract Base1 <span class="hljs-keyword">is</span> mortal &#123;<br>    <span class="hljs-keyword">function</span> kill() <span class="hljs-built_in">public</span> &#123; <span class="hljs-comment">/* do cleanup 1 */</span> super.kill(); &#125;<br>&#125;<br><br><br>contract Base2 <span class="hljs-keyword">is</span> mortal &#123;<br>    <span class="hljs-keyword">function</span> kill() <span class="hljs-built_in">public</span> &#123; <span class="hljs-comment">/* do cleanup 2 */</span> super.kill(); &#125;<br>&#125;<br><br>contract Final <span class="hljs-keyword">is</span> Base1, Base2 &#123;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ç»§æ‰¿é¡ºåºå¤§æ¦‚æ˜¯Finalï¼ŒBase2ï¼ŒBase1ï¼Œmortalï¼Œownedã€‚</p>
<p>è°ƒç”¨é¡ºåºå¾ˆå¤æ‚ï¼Œéœ€è¦ç”¨çš„æ—¶å€™è¿˜æ˜¯çœ‹æ•™ç¨‹åŸæ–‡å§ã€‚</p>
<h5 id="æ„é€ å™¨">æ„é€ å™¨</h5>
<p>æ„é€ å™¨å¯ä»¥æ˜¯<code>public</code>ä¹Ÿå¯ä»¥æ˜¯<code>internal</code>ã€‚</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract A &#123;<br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">public</span> a;<br>    <br>    <span class="hljs-comment">// A å› ä¸ºè¿™ä¸ªæ„é€ å™¨å˜æˆäº†æŠ½è±¡ç±»</span><br>    <span class="hljs-function">function <span class="hljs-title">A</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> _a</span>) <span class="hljs-keyword">internal</span></span> &#123;<br>        a = _a;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// æ˜¾å¼å®ä¾‹åŒ–</span><br><span class="hljs-function">contract B <span class="hljs-keyword">is</span> <span class="hljs-title">A</span>(<span class="hljs-params"><span class="hljs-number">1</span></span>)</span> &#123;<br>    <span class="hljs-function">function <span class="hljs-title">B</span>() <span class="hljs-keyword">public</span></span> &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="åŸºç±»æ„é€ å™¨å‚æ•°">åŸºç±»æ„é€ å™¨å‚æ•°</h5>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br>contract Base &#123;<br>    <span class="hljs-built_in">uint</span> x;<br>    <span class="hljs-function">function <span class="hljs-title">Base</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> _x</span>) <span class="hljs-keyword">public</span></span> &#123; x = _x; &#125;<br>&#125;<br><br><span class="hljs-comment">// ç”¨ä¸¤ç§æ–¹æ³•è°ƒç”¨åŸºç±»æ„é€ å™¨</span><br><span class="hljs-function">contract Derived <span class="hljs-keyword">is</span> <span class="hljs-title">Base</span>(<span class="hljs-params"><span class="hljs-number">7</span></span>)</span> &#123;<br>    <span class="hljs-comment">// ç¬¬äºŒç§æ–¹æ³•èµ¢äº†</span><br>    <span class="hljs-function">function <span class="hljs-title">Derived</span>(<span class="hljs-params"><span class="hljs-built_in">uint</span> _y</span>) <span class="hljs-title">Base</span>(<span class="hljs-params">_y * _y</span>) <span class="hljs-keyword">public</span></span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="å¤šé‡ç»§æ‰¿ä¸çº¿æ€§åŒ–">å¤šé‡ç»§æ‰¿ä¸çº¿æ€§åŒ–</h5>
<p>Solidity å­¦ä¹  Python çš„<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/C3_linearization">C3çº¿æ€§åŒ–</a>æ¥è§£å†³<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">è±å½¢é—®é¢˜</a>ã€‚</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs maxima">// This will <span class="hljs-keyword">not</span> <span class="hljs-built_in">compile</span><br><br>pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-built_in">contract</span> X &#123;&#125;<br><span class="hljs-built_in">contract</span> A <span class="hljs-built_in">is</span> X &#123;&#125;<br><span class="hljs-built_in">contract</span> C <span class="hljs-built_in">is</span> A, X &#123;&#125;<br></code></pre></td></tr></table></figure>
<h5 id="æŠ½è±¡åˆçº¦">æŠ½è±¡åˆçº¦</h5>
<p>ä¸¤ç§æƒ…å†µä¸‹ä¼šäº§ç”ŸæŠ½è±¡åˆçº¦ï¼š</p>
<ul>
<li>æœ‰å‡½æ•°æ²¡æœ‰å‡½æ•°ä½“</li>
<li>æ„é€ å‡½æ•°æ˜¯<code>internal</code>çš„ã€‚</li>
</ul>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">0</span>;<br><br>contract Feline &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">utterance</span>() public returns (bytes32);<br>&#125;<br><br>contract Cat <span class="hljs-keyword">is</span> Feline &#123;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title">utterance</span>() public returns (bytes32) &#123; <span class="hljs-keyword">return</span> <span class="hljs-type">&quot;miaow&quot;</span>; &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¯¹æ¯”</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-comment">// æ— å‡½æ•°ä½“å‡½æ•°</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span><span class="hljs-params">(address)</span> <span class="hljs-title function_">external</span> <span class="hljs-title function_">returns</span> <span class="hljs-params">(address)</span>;<br><span class="hljs-comment">// å‡½æ•°å˜é‡</span><br><span class="hljs-keyword">function</span><span class="hljs-params">(address)</span> <span class="hljs-title function_">external</span> <span class="hljs-title function_">returns</span> <span class="hljs-params">(address)</span> <span class="hljs-title function_">foo</span>;<br></code></pre></td></tr></table></figure>
<h4 id="æ¥å£">æ¥å£</h4>
<p>æ¥å£å°±æ˜¯å®Œå…¨æ²¡æœ‰ä»»ä½•å‡½æ•°ä½“çš„åˆçº¦ã€‚å’Œ cpp é‡ŒæŠ½è±¡ç±»åˆ°æ¥å£çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>è€Œä¸”è¿˜æœ‰ä»¥ä¸‹å¾ˆç†Ÿæ‚‰çš„é™åˆ¶ï¼š</p>
<ul>
<li>ä¸èƒ½ç»§æ‰¿å…¶ä»–åˆçº¦å’Œæ¥å£</li>
<li>ä¸èƒ½å®šä¹‰æ„é€ å™¨</li>
<li>ä¸èƒ½å®šä¹‰å˜é‡</li>
<li>ä¸èƒ½å®šä¹‰ç»“æ„ä½“</li>
<li>ä¸èƒ½å®šä¹‰æšä¸¾</li>
</ul>
<p>æ¥å£å°±æ˜¯ ABI çš„ç­‰ä»·å½¢å¼ï¼Œä¸¤è€…ä¹‹é—´åº”è¯¥å¯ä»¥æ— æŸäº’è½¬ã€‚</p>
<p>æ¥å£æœ‰è‡ªå·±çš„å…³é”®å­—ã€‚</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br><span class="hljs-keyword">interface</span> Token &#123;<br>    <span class="hljs-built_in">function</span> transfer(address recipient, <span class="hljs-built_in">uint</span> amount) <span class="hljs-keyword">public</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ¥å£å’Œç»§æ‰¿å…¶ä»–åˆçº¦ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯éƒ½æ˜¯ is å…³é”®å­—ï¼Œæ²¡æœ‰å…¶ä»–ç”¨æ³•ã€‚</p>
<h4 id="åº“">åº“</h4>
<p>åº“ç±»ä¼¼äºåˆçº¦ã€‚ä»–ä»¬çš„ç›®çš„æ˜¯åªåœ¨ç‰¹å®šçš„åœ°å€ä¸Šéƒ¨ç½²ä¸€æ¬¡ï¼Œç„¶åé€šè¿‡<code>DELEGATECALL</code>è°ƒç”¨ã€‚è¿™æ„å‘³ç€ï¼Œåº“å‡½æ•°ä¼šåœ¨å½“å‰åˆçº¦çš„ä¸Šä¸‹æ–‡é‡Œè¢«è°ƒç”¨ï¼Œåè€Œä¸åƒå¤–éƒ¨è°ƒç”¨(ç›´æ¥è°ƒç”¨å…¶ä»–åˆçº¦åœ°å€çš„å®ä¾‹æ–¹æ³•ä¸€æ ·)ï¼Œäº§ç”Ÿ EVM callã€‚å‡½æ•°é‡Œçš„ this éƒ½ä¼šç»‘å®šåˆ°å½“å‰åˆçº¦ï¼Œç±»ä¼¼ bindã€‚</p>
<p>å½“ç„¶ï¼Œä»£ç†è°ƒç”¨æ˜¯åº•å±‚å®ç°çš„ï¼Œåœ¨ä½¿ç”¨ä¸Šæ˜¯çœ‹ä¸å‡ºæ¥çš„ã€‚åº“çš„<code>internal</code>å‡½æ•°ï¼Œå¯¹äºè°ƒç”¨å®ƒçš„åˆçº¦ä¹Ÿæ˜¯å¯è§çš„ï¼Œè¿™äº›ä»£ç å°±å¥½åƒæ˜¯ä¸€ä¸ªè¢« mixin è¿›åˆçº¦é‡Œçš„åŸºç±»åˆçº¦ä¸€æ ·ã€‚è°ƒç”¨å†…éƒ¨å‡½æ•°ç”¨çš„æ˜¯<code>JUMP</code>è€Œä¸æ˜¯<code>DELEGATECALL</code>ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œåº“æ˜¯ä¸€ä¸ª util å¼çš„ç”¨æ³•ã€‚æ¢è¨€ä¹‹ï¼Œåº“é‡Œå¿…é¡»éƒ½æ˜¯æ˜¯<code>view</code>æˆ–è€…<code>pure</code>å‡½æ•°ã€‚</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs zephir">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>library Set &#123;<br>  <span class="hljs-comment">// We define a new struct datatype that will be used to</span><br>  <span class="hljs-comment">// hold its data in the calling contract.</span><br>  struct Data &#123; mapping(<span class="hljs-keyword">uint</span> =&gt; <span class="hljs-keyword">bool</span>) flags; &#125;<br><br>  <span class="hljs-comment">// Note that the first parameter is of type &quot;storage</span><br>  <span class="hljs-comment">// reference&quot; and thus only its storage address and not</span><br>  <span class="hljs-comment">// its contents is passed as part of the call.  This is a</span><br>  <span class="hljs-comment">// special feature of library functions.  It is idiomatic</span><br>  <span class="hljs-comment">// to call the first parameter `self`, if the function can</span><br>  <span class="hljs-comment">// be seen as a method of that object.</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span><span class="hljs-params">(Data storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> value)</span></span><br><span class="hljs-function">      <span class="hljs-title">public</span></span><br><span class="hljs-function">      <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span></span><br><span class="hljs-function">  </span>&#123;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.flags[value])<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; <span class="hljs-comment">// already there</span><br>      <span class="hljs-keyword">self</span>.flags[value] = <span class="hljs-keyword">true</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">remove</span><span class="hljs-params">(Data storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> value)</span></span><br><span class="hljs-function">      <span class="hljs-title">public</span></span><br><span class="hljs-function">      <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span></span><br><span class="hljs-function">  </span>&#123;<br>      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">self</span>.flags[value])<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; <span class="hljs-comment">// not there</span><br>      <span class="hljs-keyword">self</span>.flags[value] = <span class="hljs-keyword">false</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;<br><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contains</span><span class="hljs-params">(Data storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> value)</span></span><br><span class="hljs-function">      <span class="hljs-title">public</span></span><br><span class="hljs-function">      <span class="hljs-title">view</span></span><br><span class="hljs-function">      <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">bool</span>)</span></span><br><span class="hljs-function">  </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.flags[value];<br>  &#125;<br>&#125;<br><br>contract C &#123;<br>    Set.Data knownValues;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> value)</span> <span class="hljs-title">public</span> </span>&#123;<br>        <span class="hljs-comment">// The library functions can be called without a</span><br>        <span class="hljs-comment">// specific instance of the library, since the</span><br>        <span class="hljs-comment">// &quot;instance&quot; will be the current contract.</span><br>        <span class="hljs-keyword">require</span>(Set.insert(knownValues, value));<br>    &#125;<br>    <span class="hljs-comment">// In this contract, we can also directly access knownValues.flags, if we want.</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>åº“ä¹Ÿæœ‰é™åˆ¶ï¼š</p>
<ul>
<li>ä¸èƒ½æœ‰çŠ¶æ€å˜é‡</li>
<li>ä¸èƒ½ç»§æ‰¿å…¶ä»–ä¹Ÿä¸èƒ½è¢«ç»§æ‰¿</li>
<li>ä¸èƒ½æ¥æ”¶ä»¥å¤ªå¸</li>
</ul>
<h4 id="using-for">Using For</h4>
<p><code>using A for B;</code> è¡¨æ˜ï¼ŒæŠŠä¸€ä¸ªåº“çš„å‡½æ•°æ·»åŠ åˆ°ä¸€ä¸ªæŒ‡å®šç±»å‹ä¸Šã€‚è¿™å¯¼è‡´äº†è¿™äº›åº“å‡½æ•°å¤šäº†ä¸€ä¸ªï¼ˆéšå¼çš„ï¼‰æ¶ˆæ¯æ¥å—è€…å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™ç±»ä¼¼ Python é‡Œçš„ selfã€‚</p>
<p><code>using A for *;</code>è¡¨æ˜ A çš„åº“å‡½æ•°è¢«é™„ç€ç»™ä»»æ„ç±»å‹ã€‚è¿™å¯èƒ½ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåº“ä¸èƒ½æœ‰è‡ªå·±çš„ state çš„åŸå› å§ã€‚</p>
<p>æ²¡æœ‰ç”¨åˆ° self çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>library <span class="hljs-type">BigInt</span> &#123;<br><br>    // è¿™ä¸ªç»“æ„ä½“æœ¬æ¥æ˜¯æ²¡æœ‰æˆå‘˜å‡½æ•°çš„ã€‚<br>    struct <span class="hljs-type">bigint</span> &#123;<br>        uint[] limbs;<br>    &#125;<br><br>    // å…¨éƒ¨éƒ½æ˜¯ pure å‡½æ•°<br>    <span class="hljs-keyword">function</span> fromUint(uint x) <span class="hljs-type">internal</span> pure <span class="hljs-keyword">returns</span> (<span class="hljs-type">bigint</span> r) &#123;<br>        r.limbs = <span class="hljs-built_in">new</span> uint[](<span class="hljs-number">1</span>);<br>        r.limbs[<span class="hljs-number">0</span>] = x;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-keyword">add</span>(<span class="hljs-type">bigint</span> _a, <span class="hljs-type">bigint</span> _b) <span class="hljs-type">internal</span> pure <span class="hljs-keyword">returns</span> (<span class="hljs-type">bigint</span> r) &#123;<br>        r.limbs = <span class="hljs-built_in">new</span> uint[](max(_a.limbs.length, _b.limbs.length));<br>        uint carry = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (uint i = <span class="hljs-number">0</span>; i &lt; r.limbs.length; ++i) &#123;<br>            uint a = limb(_a, i);<br>            uint b = limb(_b, i);<br>            r.limbs[i] = a + b + carry;<br>            <span class="hljs-keyword">if</span> (a + b &lt; a || (a + b == uint(<span class="hljs-number">-1</span>) &amp;&amp; carry &gt; <span class="hljs-number">0</span>))<br>                carry = <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">else</span><br>                carry = <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (carry &gt; <span class="hljs-number">0</span>) &#123;<br>            // too bad, we have <span class="hljs-keyword">to</span> <span class="hljs-keyword">add</span> a limb<br>            uint[] memory newLimbs = <span class="hljs-built_in">new</span> uint[](r.limbs.length + <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; r.limbs.length; ++i)<br>                newLimbs[i] = r.limbs[i];<br>            newLimbs[i] = carry;<br>            r.limbs = newLimbs;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> limb(<span class="hljs-type">bigint</span> _a, uint _limb) <span class="hljs-type">internal</span> pure <span class="hljs-keyword">returns</span> (uint) &#123;<br>        <span class="hljs-keyword">return</span> _limb &lt; _a.limbs.length ? _a.limbs[_limb] : <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> max(uint a, uint b) private pure <span class="hljs-keyword">returns</span> (uint) &#123;<br>        <span class="hljs-keyword">return</span> a &gt; b ? a : b;<br>    &#125;<br>&#125;<br><br>contract C &#123;<br>    <span class="hljs-keyword">using</span> <span class="hljs-type">BigInt</span> <span class="hljs-keyword">for</span> <span class="hljs-type">BigInt</span>.bigint;<br><br>    <span class="hljs-keyword">function</span> f() <span class="hljs-built_in">public</span> pure &#123;<br>        // è¿™é‡Œçš„ä¸‰ä¸ªå˜é‡ç±»å‹éƒ½æ˜¯ <span class="hljs-type">BigInt</span>.bigintï¼Œä½†å¢åŠ äº†åº“å‡½æ•°<br>        var x = <span class="hljs-type">BigInt</span>.fromUint(<span class="hljs-number">7</span>);<br>        var y = <span class="hljs-type">BigInt</span>.fromUint(uint(<span class="hljs-number">-1</span>));<br>        var z = x.<span class="hljs-keyword">add</span>(y);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>self å¯ä»¥ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥æœ‰ï¼Œå¦ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>// This <span class="hljs-keyword">is</span> the same code <span class="hljs-keyword">as</span> <span class="hljs-keyword">before</span>, just <span class="hljs-keyword">without</span> comments<br>library <span class="hljs-keyword">Set</span> &#123;<br>  struct Data &#123; <span class="hljs-keyword">mapping</span>(uint =&gt; <span class="hljs-type">bool</span>) flags; &#125;<br><br>  <span class="hljs-keyword">function</span> <span class="hljs-keyword">insert</span>(Data <span class="hljs-keyword">storage</span> self, uint <span class="hljs-keyword">value</span>)<br>      <span class="hljs-built_in">public</span><br>      <span class="hljs-keyword">returns</span> (<span class="hljs-type">bool</span>)<br>  &#123;<br>      <span class="hljs-keyword">if</span> (self.flags[<span class="hljs-keyword">value</span>])<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; // already there<br>      self.flags[<span class="hljs-keyword">value</span>] = <span class="hljs-keyword">true</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> remove(Data <span class="hljs-keyword">storage</span> self, uint <span class="hljs-keyword">value</span>)<br>      <span class="hljs-built_in">public</span><br>      <span class="hljs-keyword">returns</span> (<span class="hljs-type">bool</span>)<br>  &#123;<br>      <span class="hljs-keyword">if</span> (!self.flags[<span class="hljs-keyword">value</span>])<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>; // <span class="hljs-keyword">not</span> there<br>      self.flags[<span class="hljs-keyword">value</span>] = <span class="hljs-keyword">false</span>;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">function</span> contains(Data <span class="hljs-keyword">storage</span> self, uint <span class="hljs-keyword">value</span>)<br>      <span class="hljs-built_in">public</span><br>      <span class="hljs-keyword">view</span><br>      <span class="hljs-keyword">returns</span> (<span class="hljs-type">bool</span>)<br>  &#123;<br>      <span class="hljs-keyword">return</span> self.flags[<span class="hljs-keyword">value</span>];<br>  &#125;<br>&#125;<br><br>contract C &#123;<br>    <span class="hljs-keyword">using</span> <span class="hljs-keyword">Set</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">Set</span>.Data; // this <span class="hljs-keyword">is</span> the crucial change<br>    // ç”¨åå­—ç©ºé—´æ¥è®¿é—®å†…éƒ¨ç±»å‹<br>    <span class="hljs-keyword">Set</span>.Data knownValues;<br><br>    <span class="hljs-keyword">function</span> register(uint <span class="hljs-keyword">value</span>) <span class="hljs-built_in">public</span> &#123;<br>        // Here, <span class="hljs-keyword">all</span> variables <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-keyword">Set</span>.Data have<br>        // corresponding member <span class="hljs-keyword">functions</span>.<br>        // The <span class="hljs-keyword">following</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">call</span> <span class="hljs-keyword">is</span> identical <span class="hljs-keyword">to</span><br>        // `<span class="hljs-keyword">Set</span>.<span class="hljs-keyword">insert</span>(knownValues, <span class="hljs-keyword">value</span>)`<br>        // ä»ç¬¬äºŒä¸ªå‚æ•°ä¼ èµ·<br>        require(knownValues.<span class="hljs-keyword">insert</span>(<span class="hljs-keyword">value</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¯¹åŸºç¡€ç±»å‹çš„çŒ´å­è¡¥ä¸ï¼š</p>
<figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs zephir">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.16</span>;<br><br>library Search &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">indexOf</span><span class="hljs-params">(<span class="hljs-keyword">uint</span>[] storage <span class="hljs-keyword">self</span>, <span class="hljs-keyword">uint</span> value)</span></span><br><span class="hljs-function">        <span class="hljs-title">public</span></span><br><span class="hljs-function">        <span class="hljs-title">view</span></span><br><span class="hljs-function">        <span class="hljs-title">returns</span> <span class="hljs-params">(<span class="hljs-keyword">uint</span>)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">uint</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">self</span>.length; i++)<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>[i] == value) <span class="hljs-keyword">return</span> i;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">uint</span>(<span class="hljs-number">-1</span>);<br>    &#125;<br>&#125;<br><br>contract C &#123;<br>    using Search <span class="hljs-keyword">for</span> <span class="hljs-keyword">uint</span>[];<br>    <span class="hljs-keyword">uint</span>[] data;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> value)</span> <span class="hljs-title">public</span> </span>&#123;<br>        data.push(value);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">replace</span><span class="hljs-params">(<span class="hljs-keyword">uint</span> _old, <span class="hljs-keyword">uint</span> _new)</span> <span class="hljs-title">public</span> </span>&#123;<br>        <span class="hljs-comment">// This performs the library function call</span><br>        <span class="hljs-keyword">uint</span> index = data.indexOf(_old);<br>        <span class="hljs-keyword">if</span> (index == <span class="hljs-keyword">uint</span>(<span class="hljs-number">-1</span>))<br>            data.push(_new);<br>        <span class="hljs-keyword">else</span><br>            data[index] = _new;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="solidity-æ±‡ç¼–">Solidity æ±‡ç¼–</h3>
<p>Solidity æ”¯æŒæ‰‹å†™æ±‡ç¼–æ¨¡å¼ã€‚</p>
<h3 id="æ‚é¡¹">æ‚é¡¹</h3>
<h4 id="æœ‰ç”¨çš„å°æŠ€å·§">æœ‰ç”¨çš„å°æŠ€å·§</h4>
<ul>
<li>ä½¿ç”¨<code>delete</code>åˆ é™¤æ‰€æœ‰çš„æ•°ç»„å…ƒç´ ã€‚</li>
<li>è°ƒç”¨å†…éƒ¨ send çš„æ–¹æ³•æ˜¯<code>address(contractVariable).send(amount)</code>ã€‚</li>
<li>ç”¨å­—é¢é‡çš„æ–¹æ³•åˆå§‹åŒ–ç»“æ„ä½“ï¼ˆè€Œä¸æ˜¯åˆçº¦ï¼‰ï¼š<code>x = MyStruct({a: 1, b: 2});</code>ã€‚</li>
</ul>
<h2 id="å®‰å…¨é—®é¢˜">å®‰å…¨é—®é¢˜</h2>
<h3 id="å¯é‡å…¥">å¯é‡å…¥</h3>
<p>æ‰€æœ‰çš„ send æœ¬è´¨ä¸Šéƒ½å¯ä»¥åŒ…å«ä»£ç æ‰§è¡Œï¼ˆå› ä¸ºé™çº§å‡½æ•°çš„å­˜åœ¨ï¼‰ï¼Œæ‰€æœ‰ä»¥ä¸‹ä¸¤ä¸ªåˆçº¦éƒ½æ˜¯æœ‰æ¼æ´çš„ï¼š</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arcade">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-comment">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span><br>contract Fund &#123;<br>    <span class="hljs-comment">/// Mapping of ether shares of the contract.</span><br>    mapping(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> uint) shares;<br>    <span class="hljs-comment">/// Withdraw your share.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">public</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.sender.send(shares[msg.sender]))<br>            shares[msg.sender] = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arcade">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.0</span>;<br><br><span class="hljs-comment">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span><br>contract Fund &#123;<br>    <span class="hljs-comment">/// Mapping of ether shares of the contract.</span><br>    mapping(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> uint) shares;<br>    <span class="hljs-comment">/// Withdraw your share.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">public</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.sender.call.value(shares[msg.sender])())<br>            shares[msg.sender] = <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>è¢«è°ƒç”¨æ–¹å¦‚æœåœ¨è‡ªå·±çš„é™çº§å‡½æ•°é‡Œé¢å†è°ƒç”¨è¿™ä¸ªåˆçº¦çš„æå–å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ— é™æå–é’±ï¼Œç›´åˆ° out-of-gas å¼‚å¸¸å‘ç”Ÿä¸ºæ­¢ã€‚</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs arcade">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract Fund &#123;<br>    <span class="hljs-comment">/// Mapping of ether shares of the contract.</span><br>    mapping(<span class="hljs-function"><span class="hljs-params">address</span> =&gt;</span> uint) shares;<br>    <span class="hljs-comment">/// Withdraw your share.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params"></span>) <span class="hljs-title function_">public</span> &#123;<br>        <span class="hljs-keyword">var</span> share = shares[msg.sender];<br>        shares[msg.sender] = <span class="hljs-number">0</span>;<br>        msg.sender.transfer(share);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åªæœ‰è¿™ä¸ªå…ˆæ‰£æ¬¾çš„é’±åŒ…æ‰èƒ½é˜²åˆ«äººåå‘é€’å½’è°ƒç”¨è‡ªå·±ã€‚</p>
<h3 id="è½¬ä»¥å¤ªå¸ç›¸å…³é—®é¢˜">è½¬ä»¥å¤ªå¸ç›¸å…³é—®é¢˜</h3>
<p>ä¸€ä¸ªåœ°å€å’Œè´¦æˆ·æ²¡æœ‰åŠæ³•æŠ—æ‹’åˆ«äººå‘å®ƒè½¬è´¦ï¼Œé™¤éè½¬è´¦å¤±è´¥ã€‚ä¸ç”¨æ¶ˆæ¯è°ƒç”¨ä¹Ÿå¯ä»¥ç§»åŠ¨ä»¥å¤ªå¸çš„æ–¹æ³•æœ‰ä¸¤ä¸ªï¼šæŒ–çŸ¿å’Œè‡ªæ¯ã€‚</p>
<p><code>addr.call.value(x)()</code>ç­‰ä»·äº<code>addr.transfer(x)</code>ï¼Œä½†å®ƒæŠŠå‰©ä½™çš„ gas å…¨éƒ½æä¾›ç»™æ¥å—è€…ï¼Œè®©å®ƒæ‰§è¡Œæ›´è´µçš„æ“ä½œäº†ã€‚</p>
<p>ä¸€å®šè¦è®°å¾—æ£€æŸ¥<code>send</code>çš„è¿”å›å€¼ã€‚</p>
<h3 id="tx-origin">tx.origin</h3>
<p>ä¸€ä¸ªç±»ä¼¼ CSRF çš„ç›¸å…³é—®é¢˜ï¼š</p>
<p>ä¸€ä¸ªæ£€æŸ¥ tx.origin çš„é’±åŒ…</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">11</span>;<br><br>// THIS CONTRACT CONTAINS A BUG - <span class="hljs-keyword">DO</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">USE</span><br>contract TxUserWallet &#123;<br>    address owner;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title">TxUserWallet</span>() public &#123;<br>        owner = msg.sender;<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title">transferTo</span>(address dest, uint amount) public &#123;<br>        require(tx.origin == owner);<br>        dest.transfer(amount);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p>ä¸€ä¸ªæ”»å‡»è€…çš„é’±åŒ…</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs d"><span class="hljs-keyword">pragma</span> solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br><span class="hljs-keyword">interface</span> TxUserWallet &#123;<br>    <span class="hljs-built_in">function</span> transferTo(address dest, <span class="hljs-built_in">uint</span> amount) <span class="hljs-keyword">public</span>;<br>&#125;<br><br>contract TxAttackWallet &#123;<br>    address owner;<br><br>    <span class="hljs-built_in">function</span> TxAttackWallet() <span class="hljs-keyword">public</span> &#123;<br>        owner = msg.sender;<br>    &#125;<br><br>    <span class="hljs-built_in">function</span>() <span class="hljs-keyword">public</span> &#123;<br>        TxUserWallet(msg.sender).transferTo(owner, msg.sender.balance);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>åªè¦è¢«æ”»å‡»è€…å¾€æ”»å‡»è€…é’±åŒ…è½¬è´¦ï¼Œæ”»å‡»è€…é’±åŒ…å°±ä¼šå‘ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¹¶å€Ÿç”¨ tx.origin æ¥ç›—å–è¢«æ”»å‡»è€…çš„å…¨éƒ¨ä½™é¢ã€‚æ¯ä¸ªåœ°å€çš„å…¨éƒ¨ä½™é¢éƒ½æ˜¯å…¬å¼€å¯æŸ¥çš„ã€‚</p>
<h2 id="é€šç”¨æ¨¡å¼">é€šç”¨æ¨¡å¼</h2>
<h3 id="ä»åˆçº¦ä¸­å–é’±">ä»åˆçº¦ä¸­å–é’±</h3>
<p>æ¯”è°æ›´æœ‰é’±çš„åˆçº¦ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract WithdrawalContract &#123;<br>    address <span class="hljs-keyword">public</span> richest;<br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">public</span> mostSent;<br><br>    mapping (address =&gt; <span class="hljs-built_in">uint</span>) pendingWithdrawals;<br><br>    <span class="hljs-function">function <span class="hljs-title">WithdrawalContract</span>() <span class="hljs-keyword">public</span> payable</span> &#123;<br>        richest = msg.sender;<br>        mostSent = msg.<span class="hljs-keyword">value</span>;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">becomeRichest</span>() <span class="hljs-keyword">public</span> payable <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">bool</span></span>)</span> &#123;<br>        <span class="hljs-keyword">if</span> (msg.<span class="hljs-keyword">value</span> &gt; mostSent) &#123;<br>            pendingWithdrawals[richest] += msg.<span class="hljs-keyword">value</span>;<br>            richest = msg.sender;<br>            mostSent = msg.<span class="hljs-keyword">value</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">withdraw</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-built_in">uint</span> amount = pendingWithdrawals[msg.sender];<br>        <span class="hljs-comment">// Remember to zero the pending refund before</span><br>        <span class="hljs-comment">// sending to prevent re-entrancy attacks</span><br>        pendingWithdrawals[msg.sender] = <span class="hljs-number">0</span>;<br>        msg.sender.transfer(amount);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="ç”¨-modifier-æ¥è®¾å®šå¯è®¿é—®æ€§çš„é—®é¢˜">ç”¨ modifier æ¥è®¾å®šå¯è®¿é—®æ€§çš„é—®é¢˜</h3>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs typescript">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract <span class="hljs-title class_">AccessRestriction</span> &#123;<br>    <span class="hljs-comment">// These will be assigned at the construction</span><br>    <span class="hljs-comment">// phase, where `msg.sender` is the account</span><br>    <span class="hljs-comment">// creating this contract.</span><br>    address <span class="hljs-keyword">public</span> owner = msg.<span class="hljs-property">sender</span>;<br>    uint <span class="hljs-keyword">public</span> creationTime = now;<br><br>    <span class="hljs-comment">// Modifiers can be used to change</span><br>    <span class="hljs-comment">// the body of a function.</span><br>    <span class="hljs-comment">// If this modifier is used, it will</span><br>    <span class="hljs-comment">// prepend a check that only passes</span><br>    <span class="hljs-comment">// if the function is called from</span><br>    <span class="hljs-comment">// a certain address.</span><br>    modifier <span class="hljs-title function_">onlyBy</span>(<span class="hljs-params">address _account</span>)<br>    &#123;<br>        <span class="hljs-built_in">require</span>(msg.<span class="hljs-property">sender</span> == _account);<br>        <span class="hljs-comment">// Do not forget the &quot;_;&quot;! It will</span><br>        <span class="hljs-comment">// be replaced by the actual function</span><br>        <span class="hljs-comment">// body when the modifier is used.</span><br>        _;<br>    &#125;<br><br>    <span class="hljs-comment">/// Make `_newOwner` the new owner of this</span><br>    <span class="hljs-comment">/// contract.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">changeOwner</span>(<span class="hljs-params">address _newOwner</span>)<br>        <span class="hljs-keyword">public</span><br>        <span class="hljs-title function_">onlyBy</span>(<span class="hljs-params">owner</span>)<br>    &#123;<br>        owner = _newOwner;<br>    &#125;<br><br>    modifier <span class="hljs-title function_">onlyAfter</span>(<span class="hljs-params">uint _time</span>) &#123;<br>        <span class="hljs-built_in">require</span>(now &gt;= _time);<br>        _;<br>    &#125;<br><br>    <span class="hljs-comment">/// Erase ownership information.</span><br>    <span class="hljs-comment">/// May only be called 6 weeks after</span><br>    <span class="hljs-comment">/// the contract has been created.</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">disown</span>(<span class="hljs-params"></span>)<br>        <span class="hljs-keyword">public</span><br>        <span class="hljs-title function_">onlyBy</span>(owner)<br>        <span class="hljs-title function_">onlyAfter</span>(<span class="hljs-params">creationTime + <span class="hljs-number">6</span> weeks</span>)<br>    &#123;<br>        <span class="hljs-keyword">delete</span> owner;<br>    &#125;<br><br>    <span class="hljs-comment">// This modifier requires a certain</span><br>    <span class="hljs-comment">// fee being associated with a function call.</span><br>    <span class="hljs-comment">// If the caller sent too much, he or she is</span><br>    <span class="hljs-comment">// refunded, but only after the function body.</span><br>    <span class="hljs-comment">// This was dangerous before Solidity version 0.4.0,</span><br>    <span class="hljs-comment">// where it was possible to skip the part after `_;`.</span><br>    modifier <span class="hljs-title function_">costs</span>(<span class="hljs-params">uint _amount</span>) &#123;<br>        <span class="hljs-built_in">require</span>(msg.<span class="hljs-property">value</span> &gt;= _amount);<br>        _;<br>        <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">value</span> &gt; _amount)<br>            msg.<span class="hljs-property">sender</span>.<span class="hljs-title function_">send</span>(msg.<span class="hljs-property">value</span> - _amount);<br>    &#125;<br><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">forceOwnerChange</span>(<span class="hljs-params">address _newOwner</span>)<br>        <span class="hljs-keyword">public</span><br>        <span class="hljs-title function_">costs</span>(<span class="hljs-params"><span class="hljs-number">200</span> ether</span>)<br>    &#123;<br>        owner = _newOwner;<br>        <span class="hljs-comment">// just some example condition</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">uint</span>(owner) &amp; <span class="hljs-number">0</span> == <span class="hljs-number">1</span>)<br>            <span class="hljs-comment">// This did not refund for Solidity</span><br>            <span class="hljs-comment">// before version 0.4.0.</span><br>            <span class="hljs-keyword">return</span>;<br>        <span class="hljs-comment">// refund overpaid fees</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="çŠ¶æ€æœº">çŠ¶æ€æœº</h3>
<p>è¿™ä¸ªä¾‹å­æœ‰ä¸¤ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼š</p>
<ul>
<li>modifier å¯ä»¥å åŠ </li>
<li>å¯ä»¥ç”±æ—¶é—´è‡ªåŠ¨é©±åŠ¨çŠ¶æ€æœºæ‰§è¡Œ</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs csharp">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.11</span>;<br><br>contract StateMachine &#123;<br>    <span class="hljs-built_in">enum</span> Stages &#123;<br>        AcceptingBlindedBids,<br>        RevealBids,<br>        AnotherStage,<br>        AreWeDoneYet,<br>        Finished<br>    &#125;<br><br>    <span class="hljs-comment">// This is the current stage.</span><br>    Stages <span class="hljs-keyword">public</span> stage = Stages.AcceptingBlindedBids;<br><br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">public</span> creationTime = now;<br><br>    <span class="hljs-function">modifier <span class="hljs-title">atStage</span>(<span class="hljs-params">Stages _stage</span>)</span> &#123;<br>        require(stage == _stage);<br>        _;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">nextStage</span>() <span class="hljs-keyword">internal</span></span> &#123;<br>        stage = Stages(<span class="hljs-built_in">uint</span>(stage) + <span class="hljs-number">1</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">// å¿…é¡»æ”¾åœ¨æœ€å¼€å§‹</span><br>    <span class="hljs-comment">// Perform timed transitions. Be sure to mention</span><br>    <span class="hljs-comment">// this modifier first, otherwise the guards</span><br>    <span class="hljs-comment">// will not take the new stage into account.</span><br>    <span class="hljs-function">modifier <span class="hljs-title">timedTransitions</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> (stage == Stages.AcceptingBlindedBids &amp;&amp;<br>                    now &gt;= creationTime + <span class="hljs-number">10</span> days)<br>            nextStage();<br>        <span class="hljs-keyword">if</span> (stage == Stages.RevealBids &amp;&amp;<br>                now &gt;= creationTime + <span class="hljs-number">12</span> days)<br>            nextStage();<br>        <span class="hljs-comment">// The other stages transition by transaction</span><br>        _;<br>    &#125;<br><br>    <span class="hljs-comment">// Order of the modifiers matters here!</span><br>    <span class="hljs-function">function <span class="hljs-title">bid</span>()</span><br><span class="hljs-function">        <span class="hljs-keyword">public</span></span><br><span class="hljs-function">        payable</span><br><span class="hljs-function">        timedTransitions</span><br><span class="hljs-function">        <span class="hljs-title">atStage</span>(<span class="hljs-params">Stages.AcceptingBlindedBids</span>)</span><br>    &#123;<br>        <span class="hljs-comment">// We will not implement that here</span><br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">reveal</span>()</span><br><span class="hljs-function">        <span class="hljs-keyword">public</span></span><br><span class="hljs-function">        timedTransitions</span><br><span class="hljs-function">        <span class="hljs-title">atStage</span>(<span class="hljs-params">Stages.RevealBids</span>)</span><br>    &#123;<br>    &#125;<br><br>    <span class="hljs-comment">// This modifier goes to the next stage</span><br>    <span class="hljs-comment">// after the function is done.</span><br>    <span class="hljs-function">modifier <span class="hljs-title">transitionNext</span>()</span><br>    &#123;<br>        _;<br>        nextStage();<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">g</span>()</span><br><span class="hljs-function">        <span class="hljs-keyword">public</span></span><br><span class="hljs-function">        timedTransitions</span><br><span class="hljs-function">        <span class="hljs-title">atStage</span>(<span class="hljs-params">Stages.AnotherStage</span>)</span><br><span class="hljs-function">        transitionNext</span><br>    &#123;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">h</span>()</span><br><span class="hljs-function">        <span class="hljs-keyword">public</span></span><br><span class="hljs-function">        timedTransitions</span><br><span class="hljs-function">        <span class="hljs-title">atStage</span>(<span class="hljs-params">Stages.AreWeDoneYet</span>)</span><br><span class="hljs-function">        transitionNext</span><br>    &#123;<br>    &#125;<br><br>    <span class="hljs-function">function <span class="hljs-title">i</span>()</span><br><span class="hljs-function">        <span class="hljs-keyword">public</span></span><br><span class="hljs-function">        timedTransitions</span><br><span class="hljs-function">        <span class="hljs-title">atStage</span>(<span class="hljs-params">Stages.Finished</span>)</span><br>    &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://magicliang.github.io">magicliang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://magicliang.github.io/2018/03/08/%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0-Solidity/">https://magicliang.github.io/2018/03/08/%E9%87%8D%E6%96%B0%E5%AD%A6%E4%B9%A0-Solidity/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">åŒºå—é“¾</a><a class="post-meta__tags" href="/tags/Ethereum/">Ethereum</a></div><div class="post-share"><div class="social-share" data-image="/img/wall-paper-11.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2017/10/31/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9B%B8%E5%85%B3%E7%A0%94%E7%A9%B6%E8%B5%84%E6%96%99/" title="ä»¥å¤ªåŠç›¸å…³ç ”ç©¶èµ„æ–™"><img class="cover" src="/img/wall-paper-83.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-31</div><div class="info-item-2">ä»¥å¤ªåŠç›¸å…³ç ”ç©¶èµ„æ–™</div></div><div class="info-2"><div class="info-item-1"> ã€Šä»¥å¤ªåŠçš„ gas è´¹ç‡ä¸€è§ˆè¡¨ã€‹ ã€Šä»¥å¤ªåŠå­¦ä¹ ç¬”è®°ï¼šç§æœ‰é“¾æ­å»ºæ“ä½œæŒ‡å—ã€‹ ã€Šä»¥å¤ªåŠä¸­çš„è´¦æˆ·ã€äº¤æ˜“ã€Gaså’ŒåŒºå—Gas Limitã€‹ StackOverflow ä¸Šçš„é—®ç­”ï¼šä»¥å¤ªåŠä¸»é“¾åˆ°åº•éœ€è¦å¤šå¤§ç©ºé—´ï¼Ÿ StackOverflow ä¸Šçš„é—®ç­”ï¼šæ€æ ·æä¾›æ— é™æ¬¡æ•°çš„æ™ºèƒ½åˆçº¦æ“ä½œï¼Ÿ ã€ŠåŒºå—é“¾æŠ€æœ¯-æ™ºèƒ½åˆçº¦-ä»¥å¤ªåŠ ï¼ˆè¯‘æ–‡ï¼‰ã€‹ ã€Šä»¥å¤ªåŠå®˜æ–¹æ–‡æ¡£ã€‹ ã€Šä»¥å¤ªåŠç§æœ‰é“¾æ­å»ºæŒ‡å—ã€‹ ã€Šä»¥å¤ªåŠå…³äºæ­å»ºç§æœ‰ç½‘ç»œçš„ wikiã€‹ ã€Šé¢„å……å€¼ä»¥å¤ªåŠèµ„é‡‘çš„æ–¹æ³•ã€‹ã€‚æ³¨æ„çœ‹ carchrae çš„å›å¤ï¼Œè¿™é‡Œé¢ä¹Ÿæä¾›äº†æ‹·è´ç§é’¥å¤ç”¨ç§é’¥çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘åœ¨å¤šèŠ‚ç‚¹çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ ã€Šä¸€æœ¬ä¸å‚æ•°æœ‰å…³çš„ä»‹ç»æ€æ ·æ­å»ºç§é“¾çš„ gitbookã€‹ã€‚ StackOverflow ä¸Šçš„é—®ç­”ï¼šä»¥å¤ªåŠçš„ç½‘ç»œéš¾åº¦æ˜¯å¦å¯ä»¥é™æ€é”æ­»ï¼Ÿæ³¨æ„çœ‹å®ƒè¿˜æœ‰ä¸ªç›¸å…³çš„å­é—®é¢˜ã€‚å¦‚æœç½‘ç»œç®—åŠ›çš„ç¨³å®šçš„è¯ï¼Œåº”è¯¥ä¸ä¼šå‡ºç°éš¾åº¦å¢é•¿æ‰å¯¹ã€‚ å€¼å¾—å¤§è¯»ç‰¹è¯»çš„ geth çš„æ–‡æ¡£ã€‚ç‰¹åˆ«æ˜¯æŒ–çŸ¿ã€è´¦æˆ·ç®¡ç†çš„éƒ¨åˆ†ã€‚ geth çš„å‘½ä»¤è¡Œé€‰é¡¹ã€‚æ³¨æ„ï¼Œæœ‰äº›é€‰é¡¹åœ¨å½“å‰ç‰ˆæœ¬ä¸­å·²ç»æ¶ˆå¤±äº†ï¼Œå¦‚ï¼ˆgpominã€gpomaxï¼‰ã€‚ StackOverflow ä¸Šçš„é—®ç­”ï¼šå¦‚ä½•é™ä½æµ‹è¯•ç½‘ç»œä¸­çš„éš¾åº¦ã€‚æ„Ÿè§‰æ²¡å¤šå¤§ç”¨ã€‚ æœç´¢ä»¥...</div></div></div></a><a class="pagination-related" href="/2018/01/24/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%9A%84%E7%A1%AC%E5%88%86%E5%8F%89/" title="ä»¥å¤ªåŠçš„ç¡¬åˆ†å‰"><img class="cover" src="/img/wall-paper-76.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-01-24</div><div class="info-item-2">ä»¥å¤ªåŠçš„ç¡¬åˆ†å‰</div></div><div class="info-2"><div class="info-item-1">â€ƒâ€ƒæœ‰å››æ¬¡è®¡åˆ’å†…çš„è½¯ä»¶å‡çº§ï¼Œæ¯æ¬¡éƒ½æ˜¯ç¡¬åˆ†å‰ï¼šFrontierï¼ŒHomesteadï¼ŒMetropolisï¼ŒSerenityã€‚ â€ƒâ€ƒæœ‰ä¸€æ¬¡æ„æ–™ä¹‹å¤–çš„åˆ†å‰ï¼ˆDAO äº‹ä»¶ï¼‰ï¼Œåˆ¶é€ å‡º ETH å’Œä»¥å¤ªç»å…¸ä¸¤ç§è´§å¸ã€‚ â€ƒâ€ƒæ¯æ¬¡åˆ†å‰éƒ½ä¼šé€ æˆçŸ¿å·¥çš„è¿ç§»ã€‚æ—§é“¾ä¼šå› ä¸ºæµå¤±ç®—åŠ›è€Œä¸§å¤±å®‰å…¨æ€§ã€‚ â€ƒâ€ƒå¤§éƒ½ä¼šåˆ†å‰æœ¬æ¥æ‰“ç®—å¼•çˆ†éš¾åº¦ç‚¸å¼¹ï¼Œè¿«ä½¿çŸ¿å·¥ä»¬ä» PoW å…±è¯†ç®—æ³•ç§»åŠ¨åˆ° PoA å…±è¯†ç®—æ³•ï¼Œè®©ä»¥å¤ªåŠè¿›å…¥å†°æ²³æ—¶ä»£ã€‚ä½†è¿™ä¸ªéš¾åº¦ç‚¸å¼¹çš„å¼•çˆ†è¢«å»¶åäº†ã€‚ â€ƒâ€ƒå¤§éƒ½ä¼šåŒæ ·å¼•å…¥äº†ä¸€ä¸ª PoS çš„æ—©æœŸå®æ–½ï¼ŒCasperå…±å­˜ ç®—æ³•å…è®¸æ¯ä¸€ç™¾ä¸ªåŒºå—é‡Œä¼šæœ‰ä¸€ä¸ª PoS åŒºå—ã€‚å…³äº PoS ç®—æ³•ï¼ŒVitalik çš„è§£é‡Šæ˜¯ï¼š  æƒ³è±¡ç°åœ¨æœ‰ 100 ä¸ªäººå›´ç€åœ†æ¡Œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªäººæ‹¿ç€å¾ˆå¤šå¼ çº¸ï¼Œæ¯å¼ çº¸è®°å½•ç€å¾ˆå¤šç¬”å†å²äº¤æ˜“ä¿¡æ¯ã€‚ç¬¬ä¸€ä¸ªäººæ‹¿èµ·ç¬”ç­¾å®Œåé€’ç»™ç¬¬äºŒä¸ªäººï¼Œç¬¬äºŒä¸ªäººä¹Ÿåšå‡ºäº†ç›¸åŒçš„é€‰æ‹©ï¼Œå¦‚æœå¤§å¤šæ•°äººåšå‡ºäº†ç›¸åŒçš„é€‰æ‹©ï¼Œå³éƒ½ç­¾ç½²äº†åŒä¸€å¼ çº¸é‚£ä¹ˆæ¯ä¸€ä¸ªå‚ä¸è€…ä¼šè·å¾—1ç¾å…ƒï¼Œå½“ä½ åšå‡ºå’Œç»å¤§å¤šæ•°äººä¸åŒçš„é€‰æ‹©æ—¶ï¼Œé‚£ä¹ˆä½ çš„æˆ¿å­å°±ä¼šç€ç«ï¼  â€ƒâ€ƒå¦‚æœçœŸçš„ä¸èƒ½é˜»æ­¢çŸ¿å·¥åœç•™åœ¨ PoW ä¸Šç»§ç»­æŒ–çŸ¿ï¼Œé‚£å°†ä¼šåˆ›å»ºä¸‰ç§ä»¥å¤ªåŠå¸ï¼šETCã€ETH-PoWã€ETH-PoSï¼Œè¿™å¯¹ä»¥å¤ªåŠ...</div></div></div></a><a class="pagination-related" href="/2018/02/03/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E9%80%82%E5%90%88%E6%8B%BF%E6%9D%A5%E5%81%9A%E8%81%94%E7%9B%9F%E9%93%BE%EF%BC%9F/" title="ä»¥å¤ªåŠä¸ºä»€ä¹ˆä¸é€‚åˆæ‹¿æ¥åšè”ç›Ÿé“¾ï¼Ÿ"><img class="cover" src="/img/wall-paper-162.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-02-03</div><div class="info-item-2">ä»¥å¤ªåŠä¸ºä»€ä¹ˆä¸é€‚åˆæ‹¿æ¥åšè”ç›Ÿé“¾ï¼Ÿ</div></div><div class="info-2"><div class="info-item-1">è”ç›Ÿé“¾å¿…ç„¶è¦æ±‚å¤šä¸ªè´¦æˆ·ç³»ç»Ÿå­˜åœ¨ï¼Œè”ç›Ÿä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»ç‹¬ç«‹ä¿å­˜è‡ªå·±çš„ç§é’¥ï¼Œåˆ™åœ¨å½“å‰çš„ gas ç³»ç»Ÿé™åˆ¶ä¸‹ï¼Œæ¯ä¸ªè´¦æˆ·å¿…é¡»æœ‰è‡ªå·±çš„etherå­˜æ¬¾ã€‚ æ˜¯ä¸æ˜¯å…è®¸å¤šå¤´å‡ºå—ï¼Ÿå¦‚æœå…è®¸å¤šå¤´å‡ºå—ï¼Œåˆ™å„ä¸ªè´¦æˆ·å¯ä»¥é¢„å…ˆprefundæˆ–è€…åœ¨ç½‘ç»œå¯åŠ¨çš„æ—¶å€™å……é’±ï¼Œä¸å¿…è€ƒè™‘è´§å¸æµé€šæ€§é—®é¢˜ã€‚ä½†å¤šå¤´å‡ºå—çš„ç¼ºç‚¹æ˜¯ï¼Œä¸å¯æŠµæŒ¡åˆ†å‰ã€‚è€Œä¸”ï¼Œå®é™…ä¸Šææœ‰å¯èƒ½è¿˜æ˜¯å­˜åœ¨è´§å¸æµé€šæ€§é—®é¢˜ã€‚ ä¸å…è®¸å¤šå¤´å‡ºå—ï¼Œåˆ™å¿…é¡»ç”±æˆ‘ä»¬è‡ªå·±çš„ä¸­å¿ƒè´¦æˆ·æ¥å‡ºå—ï¼Œæˆ‘ä»¬è‡ªå·±æ¥å‡ºå—çš„è¯ï¼Œå…¶ä»–è´¦æˆ·å‘èµ·åˆçº¦è¯·æ±‚éœ€è¦çš„è´§å¸éœ€è¦å®šæœŸä»æˆ‘ä»¬çš„ä¸­å¿ƒè´¦æˆ·æå–å‡ºæ¥ã€‚ å¦‚æœå¯ä»¥ç”¨å¼ºä¸€è‡´æ€§çš„åè®®æ¥é¢„å…ˆæŒä¹…åŒ–æ‰€æœ‰çš„å†™æ¶ˆæ¯ï¼Œä¹Ÿè®¸å¯ä»¥é ç›‘æ§æŠŠé”™è¯¯æ¢å¤è¿‡æ¥ï¼Œå½“ç„¶è¿™ä¹Ÿå¯¹ä¸šåŠ¡äº§ç”Ÿäº†å¼ºä¾èµ–ï¼Œä¸šåŠ¡çš„å†™æ“ä½œå¿…é¡»æ˜¯å¯ä»¥é€šè¿‡ç±»ä¼¼åå¹‚ç­‰çš„æ–¹å¼æ¢å¤è¿‡æ¥çš„ã€‚è¿™å°±æ˜¯æŠŠRaftåˆ†å¸ƒå¼å¼ºä¸€è‡´æ€§åè®®å½“åšä¸€ä¸ªåˆ†å¸ƒå¼çš„WALæ¥ç”¨äº†ã€‚ES ä¸é€‚åˆæ‹¿æ¥å½“è¿™ä¸ª WALï¼Œå› ä¸ºå®ƒä¸æ˜¯å¼ºå®æ—¶å†™çš„ã€‚ </div></div></div></a><a class="pagination-related" href="/2018/01/31/%E5%AD%A6%E4%B9%A0%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%9F%BA%E7%A1%80%E8%B5%84%E6%96%99/" title="å­¦ä¹ åŒºå—é“¾çš„åŸºç¡€èµ„æ–™"><img class="cover" src="/img/wall-paper-43.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-01-31</div><div class="info-item-2">å­¦ä¹ åŒºå—é“¾çš„åŸºç¡€èµ„æ–™</div></div><div class="info-2"><div class="info-item-1">ã€ŠçŒ¥çå‘è‚²æˆåŒºå—é“¾å¼€å‘è€…ã€‹ æ™®æ—æ–¯é¡¿çš„ã€ŠBitcoin and Cryptocurrency Technologiesã€‹è¯¾ç¨‹ ã€Šç²¾é€šæ¯”ç‰¹å¸ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹ </div></div></div></a><a class="pagination-related" href="/2018/02/03/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8E%E9%9A%8F%E6%9C%BA%E6%95%B0%E9%97%AE%E9%A2%98/" title="ä»¥å¤ªåŠä¸éšæœºæ•°é—®é¢˜"><img class="cover" src="/img/wall-paper-118.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-02-03</div><div class="info-item-2">ä»¥å¤ªåŠä¸éšæœºæ•°é—®é¢˜</div></div><div class="info-2"><div class="info-item-1">å€¼å¾—æ³¨æ„çš„å‡ ç¯‡æ–‡ç« ï¼š è¿™ä¸ª reddit ä¸Šçš„å¸–å­é‡Œæåˆ°äº† RANDAO å…¶å®æ˜¯ä¸å¤Ÿå®‰å…¨çš„ï¼Œä½†ä¸‹é¢ RANDAO çš„ä½œè€…åˆå‡ºæ¥è¯´è¿™ä¸ªä¸œè¥¿è¢«å®ƒæ”¹è¿›è¿‡äº†ã€‚ è¿™ä¸ªè¯é¢˜ä¸‹é¢è¿˜æœ‰äººå¼•äº† Vitalik çš„ä¸€ç¯‡åšå®¢ã€‚ randaoçš„å®ç°ã€‚åŸºæœ¬ä¸Šå°±æ˜¯ç”¨ä¸€ä¸ªdao çš„æ–¹å¼ï¼ˆDecentralized autonomous organizationï¼‰æ¥è¿è¡Œä¸€ä¸ªåŒ¿åå…ˆçŸ¥ç»„ç»‡ã€‚è¿™ä¸ªè®¾è®¡æ€è·¯å’Œ Vitalik è°ˆåˆ°çš„ç”¨å…ˆçŸ¥è€Œä¸æ˜¯å…¨ä¸Šé“¾çš„ç‰ˆæœ¬æ¥è¿è¡Œæ™ºèƒ½åˆçº¦çš„å¯¹æ¯”åŸºæœ¬ä¸€è‡´ã€‚ vdice è‡ªå·±çš„åšå®¢é‡Œä¹Ÿæåˆ°äº†ç”¨æœªæ¥çš„å—hashæ¥ç”Ÿæˆéšæœºæ•°æ˜¯ä¸å®‰å…¨çš„ï¼Œä»–ä»¬ç›´æ¥ä½¿ç”¨äº†oraclizeã€‚æ”¹å¤©è¦åˆ†æä¸‹å®ƒä»¬æ‰€è°“çš„â€œ200è¡Œçš„å®‰å…¨çš„codebaseâ€ã€‚ </div></div></div></a><a class="pagination-related" href="/2018/03/12/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1%E5%92%8C%E6%B6%88%E6%81%AF%E8%B0%83%E7%94%A8/" title="ä»¥å¤ªåŠä¸­çš„äº‹åŠ¡å’Œæ¶ˆæ¯è°ƒç”¨"><img class="cover" src="/img/wall-paper-2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-03-12</div><div class="info-item-2">ä»¥å¤ªåŠä¸­çš„äº‹åŠ¡å’Œæ¶ˆæ¯è°ƒç”¨</div></div><div class="info-2"><div class="info-item-1">ç»¼åˆWhat is the difference between a â€œcallâ€ , â€œmessage callâ€ and a â€œmessageâ€ä¸‹çš„å›å¤ï¼Œå¾—å‡ºæ­¤æ–‡ã€‚ Call æ˜¯ä¸€ä¸ªåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸‹å«ä¹‰å¾ˆæ··ä¹±çš„è¯æ±‡ã€‚ Message æ˜¯å¸¦æœ‰æ•°æ®è½½è·æˆ–ä»·å€¼ï¼Œåœ¨åˆçº¦åˆ°åˆçº¦ä¹‹é—´ä¼ é€’çš„ä¸œè¥¿ï¼ˆåˆçº¦å¯èƒ½æœ‰ç‹¬ç«‹è´¦æˆ·ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼ï¼‰ã€‚Message åˆ°è¾¾ç›®æ ‡è´¦æˆ·åï¼Œå¦‚æœç›®æ ‡è´¦æˆ·å«æœ‰ä»£ç ï¼Œåˆ™ç›®æ ‡è´¦æˆ·ä¼šäº§ç”ŸçŠ¶æ€è¿ç§»ï¼Œè¿™æ—¶å€™ Message å°±äº§ç”Ÿäº† Message Callã€‚Message ä¸ä¼šå› ä¸ºæŒ–çŸ¿å»¶è¿Ÿï¼Œä»–ä»¬æœ¬èº«å°±æ˜¯ transaction æ‰§è¡Œçš„ä¸€éƒ¨åˆ†ã€‚ Transaction ä¸€å®šæ˜¯ç”±å¤–éƒ¨è´¦æˆ·ç­¾ç½²çš„ï¼Œè´¦æˆ·åˆ°è´¦æˆ·ä¹‹é—´å‘é€çš„ Message ï¼Œè¦ä¹ˆå®ƒäº§ç”Ÿäº†ä¸€ä¸ªåˆçº¦ï¼Œè¦ä¹ˆå®ƒæ˜¯ä¸€ä¸ª Message Callï¼Œè€Œä¸”å®ƒå¯ä»¥æ¿€å‘åˆçº¦ä¹‹é—´è¶Šæ¥è¶Šå¤šçš„ Message Callã€‚ å†å¼•ç”¨ Solidity å®˜æ–¹æ–‡æ¡£åŸæ–‡ï¼š  A transaction is a message that is sent from one account to another account (which might be t...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%85%A5%E9%97%A8-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">æ™ºèƒ½åˆçº¦å…¥é—¨&#x2F;ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%9F%BA%E6%9C%AC%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">1.1.</span> <span class="toc-text">ç¬¬ä¸€ä¸ªåŸºæœ¬çš„ä¾‹å­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E8%B4%A7%E5%B8%81%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">1.2.</span> <span class="toc-text">å­è´§å¸çš„ä¾‹å­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80"><span class="toc-number">1.3.</span> <span class="toc-text">åŒºå—é“¾åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">äº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97"><span class="toc-number">1.3.2.</span> <span class="toc-text">åŒºå—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%9D%8A%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.4.</span> <span class="toc-text">ä»¥å¤ªåŠè™šæ‹Ÿæœº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-number">1.4.1.</span> <span class="toc-text">æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7"><span class="toc-number">1.4.2.</span> <span class="toc-text">è´¦æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.4.3.</span> <span class="toc-text">äº‹åŠ¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gas"><span class="toc-number">1.4.4.</span> <span class="toc-text">Gas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#storage-memory-%E5%92%8C-stack"><span class="toc-number">1.4.5.</span> <span class="toc-text">Storageï¼Œ Memory å’Œ Stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="toc-number">1.4.6.</span> <span class="toc-text">æŒ‡ä»¤é›†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E8%B0%83%E7%94%A8"><span class="toc-number">1.4.7.</span> <span class="toc-text">æ¶ˆæ¯è°ƒç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delegatecall-%E5%A7%94%E6%89%98%E8%B0%83%E7%94%A8-callcode-%E8%B0%83%E7%94%A8%E4%BB%A3%E7%A0%81-%E5%92%8C-libraries-%E5%BA%93"><span class="toc-number">1.4.8.</span> <span class="toc-text">Delegatecallï¼ˆå§”æ‰˜è°ƒç”¨ï¼‰&#x2F;Callcodeï¼ˆè°ƒç”¨ä»£ç ï¼‰ å’Œ Libraries(åº“)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.9.</span> <span class="toc-text">æ—¥å¿—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA"><span class="toc-number">1.4.10.</span> <span class="toc-text">åˆ›å»º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E6%AF%81"><span class="toc-number">1.4.11.</span> <span class="toc-text">è‡ªæ¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#solidity%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">Solidityä¸¾ä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E4%B8%BE"><span class="toc-number">2.1.</span> <span class="toc-text">é€‰ä¸¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B2%E6%8B%8D%E5%8D%96"><span class="toc-number">2.2.</span> <span class="toc-text">ç›²æ‹å–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%8B%8D%E5%8D%96"><span class="toc-number">2.2.1.</span> <span class="toc-text">ç®€å•æ‹å–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B2%E6%8B%8D%E5%8D%96"><span class="toc-number">2.2.2.</span> <span class="toc-text">ç›²æ‹å–</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%B4%AD%E4%B9%B0"><span class="toc-number">2.3.</span> <span class="toc-text">å®‰å…¨çš„è¿œç¨‹è´­ä¹°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5solidity"><span class="toc-number">3.</span> <span class="toc-text">æ·±å…¥Solidity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#solidity-%E6%BA%90%E6%96%87%E4%BB%B6%E7%9A%84%E8%BD%AE%E5%BB%93"><span class="toc-number">3.1.</span> <span class="toc-text">Solidity æºæ–‡ä»¶çš„è½®å»“</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC-pragma"><span class="toc-number">3.1.1.</span> <span class="toc-text">ç‰ˆæœ¬ pragma</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E5%85%B6%E4%BB%96%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">å¼•å…¥å…¶ä»–æºæ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E5%92%8C%E8%AF%AD%E4%B9%89"><span class="toc-number">3.2.1.</span> <span class="toc-text">è¯­æ³•å’Œè¯­ä¹‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84"><span class="toc-number">3.2.2.</span> <span class="toc-text">è·¯å¾„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%98%A0%E5%B0%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.3.</span> <span class="toc-text">é‡æ˜ å°„é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A%E9%97%AE%E9%A2%98"><span class="toc-number">3.2.4.</span> <span class="toc-text">æ³¨é‡Šé—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E7%BA%A6%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.</span> <span class="toc-text">åˆçº¦çš„ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F"><span class="toc-number">3.3.1.</span> <span class="toc-text">çŠ¶æ€å˜é‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.2.</span> <span class="toc-text">å‡½æ•°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.3.3.</span> <span class="toc-text">å‡½æ•°ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">3.3.4.</span> <span class="toc-text">äº‹ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#struct-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.5.</span> <span class="toc-text">Struct ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.6.</span> <span class="toc-text">æšä¸¾ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%BC%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.1.</span> <span class="toc-text">å€¼ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.1.1.</span> <span class="toc-text">å¸ƒå°”ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B4%E5%9E%8B"><span class="toc-number">3.4.1.2.</span> <span class="toc-text">æ•´å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E7%82%B9%E6%95%B0"><span class="toc-number">3.4.1.3.</span> <span class="toc-text">å®šç‚¹æ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.1.4.</span> <span class="toc-text">åœ°å€ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9A%E9%95%BF%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84"><span class="toc-number">3.4.1.5.</span> <span class="toc-text">å®šé•¿å­—èŠ‚æ•°ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%95%BF%E5%BA%A6%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84"><span class="toc-number">3.4.1.6.</span> <span class="toc-text">åŠ¨æ€é•¿åº¦å­—èŠ‚æ•°ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">3.4.1.7.</span> <span class="toc-text">åœ°å€å­—é¢é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%89%E7%90%86%E6%95%B0%E5%92%8C%E6%95%B4%E6%95%B0%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">3.4.1.8.</span> <span class="toc-text">æœ‰ç†æ•°å’Œæ•´æ•°å­—é¢é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">3.4.1.9.</span> <span class="toc-text">å­—ç¬¦ä¸²å­—é¢é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E5%AD%97%E9%9D%A2%E9%87%8F"><span class="toc-number">3.4.1.10.</span> <span class="toc-text">åå…­è¿›åˆ¶å­—é¢é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE"><span class="toc-number">3.4.1.11.</span> <span class="toc-text">æšä¸¾</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.1.12.</span> <span class="toc-text">å‡½æ•°ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.2.</span> <span class="toc-text">å¼•ç”¨ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%BD%8D%E7%BD%AE"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">æ•°æ®ä½ç½®</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E7%BB%84"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">æ•°ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%86%85%E5%AD%98%E6%95%B0%E7%BB%84"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">åˆ›å»ºå†…å­˜æ•°ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%AD%97%E9%9D%A2%E9%87%8F-%E5%86%85%E8%81%94%E6%95%B0%E7%BB%84"><span class="toc-number">3.4.2.4.</span> <span class="toc-text">æ•°ç»„å­—é¢é‡&#x2F;å†…è”æ•°ç»„</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%90%E5%91%98"><span class="toc-number">3.4.2.5.</span> <span class="toc-text">æˆå‘˜</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.2.6.</span> <span class="toc-text">ç»“æ„ä½“ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84"><span class="toc-number">3.4.3.</span> <span class="toc-text">æ˜ å°„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B5%E6%B6%89%E5%88%B0%E5%B7%A6%E5%80%BC%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">3.4.4.</span> <span class="toc-text">ç‰µæ¶‰åˆ°å·¦å€¼çš„æ“ä½œç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#delete"><span class="toc-number">3.4.4.1.</span> <span class="toc-text">delete</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.4.5.</span> <span class="toc-text">åŸºæœ¬æ•°æ®ç±»å‹ä¹‹é—´çš„è½¬æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%8E%A8%E5%AF%BC"><span class="toc-number">3.4.6.</span> <span class="toc-text">ç±»å‹æ¨å¯¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BD%8D%E5%92%8C%E5%85%A8%E5%B1%80%E5%8F%AF%E7%94%A8%E5%8F%98%E9%87%8F"><span class="toc-number">3.5.</span> <span class="toc-text">å•ä½å’Œå…¨å±€å¯ç”¨å˜é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E5%B8%81%E7%9A%84%E5%8D%95%E4%BD%8D"><span class="toc-number">3.5.1.</span> <span class="toc-text">ä»¥å¤ªå¸çš„å•ä½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%8D%95%E4%BD%8D"><span class="toc-number">3.5.2.</span> <span class="toc-text">æ—¶é—´å•ä½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E5%8F%98%E9%87%8F%E5%92%8C%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.3.</span> <span class="toc-text">ç‰¹æ®Šçš„å˜é‡å’Œå‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BA%E5%9D%97%E5%92%8C%E4%BA%8B%E5%8A%A1%E5%B1%9E%E6%80%A7"><span class="toc-number">3.5.3.1.</span> <span class="toc-text">åŒºå—å’Œäº‹åŠ¡å±æ€§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">3.5.3.2.</span> <span class="toc-text">é”™è¯¯å¤„ç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E5%92%8C%E5%AF%86%E7%A0%81%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="toc-number">3.5.3.3.</span> <span class="toc-text">æ•°å­¦å’Œå¯†ç å­¦å‡½æ•°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="toc-number">3.6.</span> <span class="toc-text">è¡¨è¾¾å¼å’Œæ§åˆ¶ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0%E5%92%8C%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0"><span class="toc-number">3.6.1.</span> <span class="toc-text">è¾“å…¥å‚æ•°å’Œè¾“å‡ºå‚æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0"><span class="toc-number">3.6.1.1.</span> <span class="toc-text">è¾“å…¥å‚æ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%8F%82%E6%95%B0"><span class="toc-number">3.6.1.2.</span> <span class="toc-text">è¾“å‡ºå‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84"><span class="toc-number">3.6.2.</span> <span class="toc-text">æ§åˆ¶ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">3.6.2.1.</span> <span class="toc-text">å¤šè¿”å›å€¼</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#function-calls"><span class="toc-number">3.6.3.</span> <span class="toc-text">Function Calls</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%B0%83%E7%94%A8"><span class="toc-number">3.6.3.1.</span> <span class="toc-text">å†…éƒ¨è°ƒç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">3.6.3.2.</span> <span class="toc-text">å¤–éƒ¨å‡½æ•°è°ƒç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E8%B0%83%E7%94%A8%E5%92%8C%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="toc-number">3.6.3.3.</span> <span class="toc-text">å‘½åè°ƒç”¨å’ŒåŒ¿åå‡½æ•°å‚æ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9C%81%E7%95%A5%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%90%8D"><span class="toc-number">3.6.3.4.</span> <span class="toc-text">çœç•¥å‡½æ•°å‚æ•°å</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8new%E5%88%9B%E5%BB%BA%E6%96%B0%E5%90%88%E7%BA%A6"><span class="toc-number">3.6.4.</span> <span class="toc-text">ç”¨newåˆ›å»ºæ–°åˆçº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-number">3.6.5.</span> <span class="toc-text">è¡¨è¾¾å¼æ±‚å€¼çš„é¡ºåº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC"><span class="toc-number">3.6.6.</span> <span class="toc-text">èµ‹å€¼</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC%E5%92%8C%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">3.6.6.1.</span> <span class="toc-text">è§£æ„èµ‹å€¼å’Œå¤šè¿”å›å€¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93%E7%9A%84%E5%A4%8D%E6%9D%82%E7%82%B9"><span class="toc-number">3.6.6.2.</span> <span class="toc-text">æ•°ç»„å’Œç»“æ„ä½“çš„å¤æ‚ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E5%A3%B0%E6%98%8E"><span class="toc-number">3.6.7.</span> <span class="toc-text">ä½œç”¨åŸŸå’Œå£°æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E-0-5-0-%E5%BC%80%E5%A7%8B%E5%B0%B1%E6%9C%89%E4%BD%9C%E7%94%A8%E5%9F%9F%E4%BA%86"><span class="toc-number">3.6.7.1.</span> <span class="toc-text">ä» 0.5.0 å¼€å§‹å°±æœ‰ä½œç”¨åŸŸäº†</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%9A%E6%96%AD%E8%A8%80-%E9%9C%80%E6%B1%82-%E5%8F%8D%E8%BD%AC%E5%92%8C%E5%BC%82%E5%B8%B8"><span class="toc-number">3.6.8.</span> <span class="toc-text">é”™è¯¯å¤„ç†ï¼šæ–­è¨€ã€éœ€æ±‚ã€åè½¬å’Œå¼‚å¸¸</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E7%BA%A6"><span class="toc-number">3.7.</span> <span class="toc-text">åˆçº¦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%90%88%E7%BA%A6"><span class="toc-number">3.7.1.</span> <span class="toc-text">åˆ›å»ºåˆçº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E8%A7%81%E6%80%A7%E5%92%8C-getter"><span class="toc-number">3.7.2.</span> <span class="toc-text">å¯è§æ€§å’Œ Getter</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#getter"><span class="toc-number">3.7.2.1.</span> <span class="toc-text">Getter</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.7.3.</span> <span class="toc-text">å‡½æ•°ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E5%B8%B8%E9%87%8F"><span class="toc-number">3.7.4.</span> <span class="toc-text">çŠ¶æ€å¸¸é‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.5.</span> <span class="toc-text">å‡½æ•°</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#view"><span class="toc-number">3.7.5.1.</span> <span class="toc-text">view</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pure-%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.5.2.</span> <span class="toc-text">pure å‡½æ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%99%8D%E7%BA%A7%E5%87%BD%E6%95%B0"><span class="toc-number">3.7.5.3.</span> <span class="toc-text">é™çº§å‡½æ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD"><span class="toc-number">3.7.5.4.</span> <span class="toc-text">å‡½æ•°é‡è½½</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">3.7.6.</span> <span class="toc-text">äº‹ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%8E%E7%BA%A7%E6%97%A5%E5%BF%97%E8%AE%BE%E6%96%BD"><span class="toc-number">3.7.6.1.</span> <span class="toc-text">ä½çº§æ—¥å¿—è®¾æ–½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%90%86%E8%A7%A3%E4%BA%8B%E4%BB%B6%E7%9A%84%E8%B5%84%E6%BA%90"><span class="toc-number">3.7.6.2.</span> <span class="toc-text">å…¶ä»–ç†è§£äº‹ä»¶çš„èµ„æº</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">3.7.7.</span> <span class="toc-text">ç»§æ‰¿</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">3.7.7.1.</span> <span class="toc-text">æ„é€ å™¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E7%B1%BB%E6%9E%84%E9%80%A0%E5%99%A8%E5%8F%82%E6%95%B0"><span class="toc-number">3.7.7.2.</span> <span class="toc-text">åŸºç±»æ„é€ å™¨å‚æ•°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF%E4%B8%8E%E7%BA%BF%E6%80%A7%E5%8C%96"><span class="toc-number">3.7.7.3.</span> <span class="toc-text">å¤šé‡ç»§æ‰¿ä¸çº¿æ€§åŒ–</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%90%88%E7%BA%A6"><span class="toc-number">3.7.7.4.</span> <span class="toc-text">æŠ½è±¡åˆçº¦</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.7.8.</span> <span class="toc-text">æ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%93"><span class="toc-number">3.7.9.</span> <span class="toc-text">åº“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#using-for"><span class="toc-number">3.7.10.</span> <span class="toc-text">Using For</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solidity-%E6%B1%87%E7%BC%96"><span class="toc-number">3.8.</span> <span class="toc-text">Solidity æ±‡ç¼–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%82%E9%A1%B9"><span class="toc-number">3.9.</span> <span class="toc-text">æ‚é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E7%94%A8%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="toc-number">3.9.1.</span> <span class="toc-text">æœ‰ç”¨çš„å°æŠ€å·§</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">å®‰å…¨é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%87%8D%E5%85%A5"><span class="toc-number">4.1.</span> <span class="toc-text">å¯é‡å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E4%BB%A5%E5%A4%AA%E5%B8%81%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98"><span class="toc-number">4.2.</span> <span class="toc-text">è½¬ä»¥å¤ªå¸ç›¸å…³é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tx-origin"><span class="toc-number">4.3.</span> <span class="toc-text">tx.origin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">é€šç”¨æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%90%88%E7%BA%A6%E4%B8%AD%E5%8F%96%E9%92%B1"><span class="toc-number">5.1.</span> <span class="toc-text">ä»åˆçº¦ä¸­å–é’±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8-modifier-%E6%9D%A5%E8%AE%BE%E5%AE%9A%E5%8F%AF%E8%AE%BF%E9%97%AE%E6%80%A7%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.2.</span> <span class="toc-text">ç”¨ modifier æ¥è®¾å®šå¯è®¿é—®æ€§çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">5.3.</span> <span class="toc-text">çŠ¶æ€æœº</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">ç°¡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>