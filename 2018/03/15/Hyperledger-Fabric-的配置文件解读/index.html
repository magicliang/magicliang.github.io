<!DOCTYPE html>

<html lang="zh-Hans">
    <head>
    <meta charset="utf-8">
    <!--
        hexo-theme-suka © SukkaW
        GitHub: https://github.com/SukkaW/hexo-theme-suka
    -->

    <!-- ### Resource Hint ### -->

    <!-- ## DNS Prefetch ## -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

<!-- busuanzi -->

    <link rel="dns-prefetch" href="//busuanzi.ibruce.info">


<!-- comment -->







<!-- analytics -->







    <!-- ## Preload ## -->
    
    <!-- Busuanzi -->
    
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" as="script">







    <!-- ### Meta & Title & Info ### -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, maximum-scale=5, viewport-fit=cover">
    <meta name="renderer" content="webkit">

    <!-- Title -->
    <title>Hyperledger Fabric 的配置文件解读 | 守株阁</title>

    <!-- Favicons -->
    <link rel="icon" type="image&#x2F;ico" href="/img/suka-favicon.ico">

    <!-- ### Import File ### -->
    <link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>
    body {
        background-color: #f8f9fa;
    }

    a, a:visited {
        color: #0070ff;
    }

    a:active, a:focus, a:hover {
        color: #0070ff;
        opacity: .75;
    }

    #post-content a,
    #post-content a:hover,
    #post-content a:focus,
    #post-content a:visited {
        color: #005eb9;
        opacity: 1;
    }

    

    .post-entry .card-body a {
        color: #0070ff;
    }

    .avatar {
        background: #444;
    }

    .navbar-link,
    .navbar-link:visited,
    .timeline .timeline-item .timeline-icon.icon-lg {
        color: #0070ff;
    }

    .navbar-link:hover {
        color: #0070ff;
        opacity: .8;
    }

    #search-input .btn,
    #disqus_click_btn,
    #disqus-switch-to-direct,
    #disqus-loadmore-button {
        background: #727e96;
        border-color: #727e96;
        color: #fff;
    }

    #post-toc a.post-toc-link,
    #post-toc a.post-toc-link:visited,
    .share-menu.menu .menu-item>a {
        color: #727e96;
    }

    .share-menu.menu .menu-item>a:hover,
    .share-menu.menu .menu-item>a:focus,
    .share-menu.menu .menu-item>a:visited {
        color: #50596c;
        background: #f8f9fa;
        opacity: .85;
    }
</style><link rel="stylesheet" href="/css/style.min.css">








    <!-- Prettify Theme -->
    
    <link rel="preload" href="/css/highlight/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/css/highlight/github.min.css"></noscript>





<script>
/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",function(){e.poly(),t.clearInterval(a)}):t.attachEvent&&t.attachEvent("onload",function(){e.poly(),t.clearInterval(a)})}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this);
</script>

    <!-- ### Site Verification ### -->
    


    <link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="守株阁"><meta name="msapplication-starturl" content="http://magicliang.github.io"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="守株阁"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- ### The Open Graph & Twitter Card Protocol ### -->
    <meta property="og:title" content="Hyperledger Fabric 的配置文件解读 | 守株阁"><meta property="og:site_name" content="守株阁"><meta property="og:type" content="article"><meta property="og:url" content="http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/"><meta property="og:locale" content="zh-Hans"><meta name="description" content="Crypto Generatorx.509 相关的文件主要包含两个东西：证书和 signing keys。 cryptogen 使用的配置文件是crypto-config.yaml。 x.509 的根证书是ca-cert。它把 peers 和 orderers 绑定到一个 Org 里面。在这个网络里，每个组织都有签发自己的证书的能力，可以用这个 ca 来签发其他证书给节点和 client。 签发交 - magicliang - 守株阁"><meta name="keywords" content="区块链, Hyperledger Fabric"><meta property="article:published_time" content="2018-03-15T06:38:14.000Z"><meta property="article:modified_time" content="2019-09-09T13:35:42.000Z"><meta property="og:updated_time" content="2019-09-09T13:35:42.000Z"><meta property="article:author" content="magicliang"><meta property="article:tag" content="区块链, Hyperledger Fabric"><meta name="twitter:card" content="summary">

    

    <!-- ### Canonical link ### -->
    <link rel="canonical" href="http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/">

    <meta name="generator" content="Hexo 6.0.0">

    <!-- ### Analytics ### -->
    







    <!-- ### Structured Data ### -->
    



<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "url": "http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/",
    "@type": "BlogPosting",
    "logo": "http://magicliang.github.io/img/suka-favicon.ico",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/"
    },
    "headline": "Hyperledger Fabric 的配置文件解读 | 守株阁",
    
    "image": {
        "@type": "ImageObject",
        "url": "http://magicliang.github.io/img/suka-favicon.ico"
    },
    
    "datePublished": "2018-03-15T06:38:14.000Z",
    "dateModified": "2019-09-09T13:35:42.000Z",
    "author": {
        "@type": "Person",
        "name": "magicliang",
        "image": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/default_avatar.png"
        },
        "description": "Hi, nice to meet you."
    },
    "publisher": {
        "@type": "Organization",
        "name": "守株阁",
        "logo": {
            "@type": "ImageObject",
            "url": "http://magicliang.github.io/img/suka-favicon.ico"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "http://magicliang.github.io/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "区块链, Hyperledger Fabric",
    "description": "Crypto Generatorx.509 相关的文件主要包含两个东西：证书和 signing keys。 cryptogen 使用的配置文件是crypto-config.yaml。 x.509 的根证书是ca-cert。它把 peers 和 orderers 绑定到一个 Org 里面。在这个网络里，每个组织都有签发自己的证书的能力，可以用这个 ca 来签发其他证书给节点和 client。 签发交 - magicliang - 守株阁"
}
</script>



    <!-- ### Custom Head ### -->
    
</head>

    <body>
            

            <!-- ### Main content ### -->
            <!-- ## Header ##-->
<header>
    <h1 class="header-title text-center"><a href="/">守株阁</a></h1>

    <p class="text-center header-slogan">
        
            
                Hi, nice to meet you.
            
        
    </p>

    <nav class="navbar-section text-center">
    
        <a href="/" class="navbar-link">Home</a>
    
    
        <a href="/archives/" class="navbar-link">Archives</a>
    
    
        <a href="/search" class="navbar-link">Search</a>
    
    
    
        <div class="dropdown dropdown-right">
    <a class="navbar-link dropdown-toggle" tabindex="0">Share</a>
    <ul class="menu share-menu">

        <!-- Share Weibo -->
        
        <li class="menu-item">
            <a href="http://service.weibo.com/share/share.php?appkey=&title=守株阁&url=http://magicliang.github.io&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
        </li>
        

        <!-- Share Twitter -->
        
        <li class="menu-item">
            <a href="https://twitter.com/intent/tweet?text=守株阁&url=http://magicliang.github.io&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
        </li>
        

        <!-- Share Facebook -->
        
        <li class="menu-item">
            <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
        </li>
        

        <!-- Share Google+ -->
        
        <li class="menu-item">
            <a href="https://plus.google.com/share?url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
        </li>
        

        <!-- Share LinkedIn -->
        
        <li class="menu-item">
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io&title=Hyperledger Fabric 的配置文件解读" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
        </li>
        

        <!-- Share QQ -->
        
        <li class="menu-item">
            <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=Hyperledger Fabric 的配置文件解读&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
        </li>
        

        <!-- Share Telegram -->
        
        <li class="menu-item">
            <a href="https://t.me/share/url?url=http://magicliang.github.io&text=Hyperledger Fabric 的配置文件解读" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
        </li>
        

        <!-- QRCode -->
        
        <li class="menu-item">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMQAAADECAAAAADlzdG3AAADNUlEQVR42u3a227CUAxEUf7/p9unShUiM9shTi/avNBClGQhndjH9uPjH7weIkSIECFiHfEIr6/vv7+/+vv5+OfPvn/+fI72+dF9iRCxiXi5aMJFjk76Cn103NGx9L5EiNhGpAWdTtgw6WaPromPESHiBxBHC+8ZmBZvAx39LULEb0SkC5DFTh8c5HsRIu5EpEQrbYTSRdqPMbn+W1msCBFDxKRQcOf7WrVDhIiAwMVbsPlpSWIrNKQN2CVVcREiYH+CBLEWqFpCRzZY9LwiRGwi0iKkF01F6PSDkM1YfGiIELGAoJsbskEiwY4U4fCDRoSIBUQNKAXVGjNkYdNmZ8xiRYi4CEGaHaT4e7ZZQhLOw4eGCBFLiEmSlxrxpHE/AY0HGUWIuACRbqgNXbWARx8Yk8KDCBHbiDZoSAthtDnSNj80eIoQcTeCAkgSl4oDqZBcB8JEiFhC0GYjbbpMigq0cI07RSJEvImYJGBtUaZARhvuk+K0CBFbiGnQIQFymkymH/EwcRQhYglBLkaGdqdQ2mwcT56JEPEGIi3qFsRawGyFg1QcSGgRIjYRNLi0BJAUlmnRjTQsRYjYRqSFmQYL24ZnkhDSorUIEZsI0hypA4WD42kBohUjRIjYRrTmBm2ikHc6IFaLzSJE3IQgG//0Pwl4ZINVN2AiRCwiSPODFhImwe7MpkqEiDsQ9CQt0KUFTAdU6KIXIWIDQQJdutFpQXoSOOtAmAgRS4i0WafNE/KQSAknCZIiRNyBaIlWSgzPbPJpE54koCJEbCAmF6gnPXEeEjBRAihCxIWIVrgiyd9kwLEFUzK4IkLEXQjaYJkMsqQkkAyioGAnQsSFiGlTkTQUSYBrgy7jnZ0IERcgSEGZFLmmzRVaKEODjCJEXIggCSBpPrZmIropkDyezmJFiIAIcpE2XHjmnRYq8HCvCBEXIujmiBSRSTOeFtHaZkmEiE0EGa5qYNJwp0NgaZMlQsRvQNAh9cmQCxlciYUMESJ+AEEgrZmSgl9a8ONqhwgRFyJSAGuDV62hThuU7XyooCxCxAUIWgimizM13Fsjpg0Pn652iBABEX/5JUKECBEi1l6fXnHgrqvxploAAAAASUVORK5CYII=" alr="QRCode">
        </li>
        

    </ul>
</div>
    
    
</nav>
</header>

            
    <!-- ## Post ## -->
    <div class="post-container">
    <div id="post-card" class="card">
        
        <div class="card-item-container">
            <div class="card-inner-cell">
                <!-- # Post Header Info # -->
                <div class="card-header">
                    
    <h1 class="card-title h3 mb-2">Hyperledger Fabric 的配置文件解读</h1>




<div class="post-header-info">
    <p class="post-header-info-left text-gray">
        <img class="author-thumb lazyload" data-src="/img/default_avatar.png" src="/img/suka-lazyload.gif" alt="magicliang's Avatar">
        <span>2018-03-15</span>
        
        
            <!-- Busuanzi Post Views -->
<span id="busuanzi_container_page_pv" hidden>
    <span class="suka-devide-dot"></span>
    <span></span>
    <span id="busuanzi_value_page_pv"></span>
    <span>Views</span>
</span>
        
        
    </p>
    <div class="post-header-info-right">
        
            <div class="dropdown dropdown-right">
<a class="dropdown-toggle" tabindex="0">Share the post</a>
<ul class="menu share-menu">
    <!-- Share Weibo -->
    
    <li class="menu-item">
        <a href="http://service.weibo.com/share/share.php?appkey=&title=Hyperledger Fabric 的配置文件解读&url=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/&pic=http://magicliang.github.io/img/suka-favicon.ico&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">Share to Weibo</a>
    </li>
    

    <!-- Share Twitter -->
    
    <li class="menu-item">
        <a href="https://twitter.com/intent/tweet?text=Hyperledger Fabric 的配置文件解读&url=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/&via=magicliang" target="_blank" rel="external noopener noreferrer nofollow">Share to Twitter</a>
    </li>
    

    <!-- Share Facebook -->
    
    <li class="menu-item">
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/" target="_blank" rel="external noopener noreferrer nofollow">Share to Facebook</a>
    </li>
    

    <!-- Share Google+ -->
    
    <li class="menu-item">
        <a href="https://plus.google.com/share?url=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/" target="_blank" rel="external noopener noreferrer nofollow">Share to Google+</a>
    </li>
    

    <!-- Share LinkedIn -->
    
    <li class="menu-item">
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/&title=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to LinkedIn</a>
    </li>
    

    <!-- Share QQ -->
    
    <li class="menu-item">
        <a href="http://connect.qq.com/widget/shareqq/index.html?site=守株阁&title=守株阁&summary=关于技术以及人生&pics=http://magicliang.github.io/img/suka-favicon.ico&url=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/" target="_blank" rel="external noopener noreferrer nofollow"> Share to QQ</a>
    </li>
    

    <!-- Share Telegram -->
    
    <li class="menu-item">
        <a href="https://t.me/share/url?url=http://magicliang.github.io/2018/03/15/Hyperledger-Fabric-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/&text=守株阁" target="_blank" rel="external noopener noreferrer nofollow">Share to Telegram</a>
    </li>
    

    <!-- QRCode -->
    
    <li class="menu-item">
        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMQAAADECAAAAADlzdG3AAADNUlEQVR42u3a227CUAxEUf7/p9unShUiM9shTi/avNBClGQhndjH9uPjH7weIkSIECFiHfEIr6/vv7+/+vv5+OfPvn/+fI72+dF9iRCxiXi5aMJFjk76Cn103NGx9L5EiNhGpAWdTtgw6WaPromPESHiBxBHC+8ZmBZvAx39LULEb0SkC5DFTh8c5HsRIu5EpEQrbYTSRdqPMbn+W1msCBFDxKRQcOf7WrVDhIiAwMVbsPlpSWIrNKQN2CVVcREiYH+CBLEWqFpCRzZY9LwiRGwi0iKkF01F6PSDkM1YfGiIELGAoJsbskEiwY4U4fCDRoSIBUQNKAXVGjNkYdNmZ8xiRYi4CEGaHaT4e7ZZQhLOw4eGCBFLiEmSlxrxpHE/AY0HGUWIuACRbqgNXbWARx8Yk8KDCBHbiDZoSAthtDnSNj80eIoQcTeCAkgSl4oDqZBcB8JEiFhC0GYjbbpMigq0cI07RSJEvImYJGBtUaZARhvuk+K0CBFbiGnQIQFymkymH/EwcRQhYglBLkaGdqdQ2mwcT56JEPEGIi3qFsRawGyFg1QcSGgRIjYRNLi0BJAUlmnRjTQsRYjYRqSFmQYL24ZnkhDSorUIEZsI0hypA4WD42kBohUjRIjYRrTmBm2ikHc6IFaLzSJE3IQgG//0Pwl4ZINVN2AiRCwiSPODFhImwe7MpkqEiDsQ9CQt0KUFTAdU6KIXIWIDQQJdutFpQXoSOOtAmAgRS4i0WafNE/KQSAknCZIiRNyBaIlWSgzPbPJpE54koCJEbCAmF6gnPXEeEjBRAihCxIWIVrgiyd9kwLEFUzK4IkLEXQjaYJkMsqQkkAyioGAnQsSFiGlTkTQUSYBrgy7jnZ0IERcgSEGZFLmmzRVaKEODjCJEXIggCSBpPrZmIropkDyezmJFiIAIcpE2XHjmnRYq8HCvCBEXIujmiBSRSTOeFtHaZkmEiE0EGa5qYNJwp0NgaZMlQsRvQNAh9cmQCxlciYUMESJ+AEEgrZmSgl9a8ONqhwgRFyJSAGuDV62hThuU7XyooCxCxAUIWgimizM13Fsjpg0Pn652iBABEX/5JUKECBEi1l6fXnHgrqvxploAAAAASUVORK5CYII=" alt="QRCode">
    </li>
    

</ul>
</div>
        
    </div>
</div>
                </div>
                <div class="card-body">
                    
                        
                        
                            <div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Crypto-Generator"><span class="post-toc-number">1.</span> <span class="post-toc-text">Crypto Generator</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#configtxgen-%E7%9B%B8%E5%85%B3"><span class="post-toc-number">2.</span> <span class="post-toc-text">configtxgen 相关</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#docker-compose-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="post-toc-number">3.</span> <span class="post-toc-text">docker-compose 的配置文件分析</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%B8%B8%E8%A7%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%89%8D%E7%BC%80"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">常见环境变量前缀</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#peer-base-yaml"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">peer-base.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#docker-compose-base-yaml"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">docker-compose-base.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#docker-compose-cli-yaml"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">docker-compose-cli.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#docker-compose-e2e-template-yaml"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">docker-compose-e2e-template.yaml</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#byfn-sh"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">byfn.sh</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#script-script-sh"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">script&#x2F;script.sh</span></a></li></ol></li></ol></div>
                        
                    
                    <article id="post-content">
                        <h2 id="Crypto-Generator"><a href="#Crypto-Generator" class="headerlink" title="Crypto Generator"></a>Crypto Generator</h2><p>x.509 相关的文件主要包含两个东西：证书和 signing keys。</p>
<p>cryptogen 使用的配置文件是<code>crypto-config.yaml</code>。</p>
<p>x.509 的根证书是<code>ca-cert</code>。它把 peers 和 orderers 绑定到一个 Org 里面。在这个网络里，每个组织都有签发自己的证书的能力，可以用这个 ca 来签发其他证书给节点和 client。</p>
<p>签发交易用的是私钥（keystore），验证交易用的是公钥（signcerts）。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright IBM Corp. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 注意这个文件里一点指定 MSP 的 ID 的地方都没有。</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># &quot;OrdererOrgs&quot; - Definition of organizations managing orderer nodes</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">OrdererOrgs:</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># Orderer</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># 这里的 Name 是 MemberShip 的 ID，大致就是一个法律实体作为会员。</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">Orderer</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">ORDERER_DOMAIN</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># &quot;Specs&quot; - See PeerOrgs below for complete description</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="attr">Specs:</span></span><br><span class="line">      <span class="comment"># orderer docker 容器的名字 </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">Hostname:</span> <span class="string">orderer</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># &quot;PeerOrgs&quot; - Definition of organizations managing peer nodes</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="attr">PeerOrgs:</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># Org1</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">Org1</span></span><br><span class="line">      <span class="comment"># 组织1的完整 domain</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">ORG1_DOMAIN</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># &quot;Specs&quot;</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># Uncomment this section to enable the explicit definition of hosts in your</span></span><br><span class="line">    <span class="comment"># configuration.  Most users will want to use Template, below</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># Specs is an array of Spec entries.  Each Spec entry consists of two fields:</span></span><br><span class="line">    <span class="comment">#   - Hostname:   (Required) The desired hostname, sans the domain.</span></span><br><span class="line">    <span class="comment">#   - CommonName: (Optional) Specifies the template or explicit override for</span></span><br><span class="line">    <span class="comment">#                 the CN.  By default, this is the template:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#                              &quot;&#123;&#123;.Hostname&#125;&#125;.&#123;&#123;.Domain&#125;&#125;&quot;</span></span><br><span class="line">    <span class="comment">#                 这个 CommonName 搞不好是拼出来的完整容器名，比如peer0.org1.com 之类的。</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#                 which obtains its values from the Spec.Hostname and</span></span><br><span class="line">    <span class="comment">#                 Org.Domain, respectively.</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># Specs:</span></span><br><span class="line">    <span class="comment">#   - Hostname: foo # implicitly &quot;foo.ORG1_DOMAIN&quot;</span></span><br><span class="line">    <span class="comment">#     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above</span></span><br><span class="line">    <span class="comment">#   - Hostname: bar</span></span><br><span class="line">    <span class="comment">#   - Hostname: baz</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># &quot;Template&quot;</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># Allows for the definition of 1 or more hosts that are created sequentially</span></span><br><span class="line">    <span class="comment"># from a template. By default, this looks like &quot;peer%d&quot; from 0 to Count-1.</span></span><br><span class="line">    <span class="comment"># You may override the number of nodes (Count), the starting index (Start)</span></span><br><span class="line">    <span class="comment"># or the template used to construct the name (Hostname).</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># <span class="doctag">Note:</span> Template and Specs are not mutually exclusive.  You may define both</span></span><br><span class="line">    <span class="comment"># sections and the aggregate nodes will be created for you.  Take care with</span></span><br><span class="line">    <span class="comment"># name collisions</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># 这里的容器名就不是用 Hostname 指定出来的，而是用 spec 推导出来的了。具体还是看文档，这里就是规定这个组织里有多少个 peer，peer 用什么名字。现在这个名字就是 peer0，peer1 的形式。当然都可以改。</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br><span class="line">      <span class="comment"># Start: 5</span></span><br><span class="line">      <span class="comment"># Hostname: &#123;&#123;.Prefix&#125;&#125;&#123;&#123;.Index&#125;&#125; # default</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># &quot;Users&quot;</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># Count: The number of user accounts _in addition_ to Admin</span></span><br><span class="line">    <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">    <span class="comment"># 这个users 本身就是指的非 admin 的 user 要创建出多少套 identity 证书来。</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">  <span class="comment"># Org2: See &quot;Org1&quot; for full specification</span></span><br><span class="line">  <span class="comment"># ---------------------------------------------------------------------------</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">Org2</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">ORG2_DOMAIN</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">Org3</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">ORG3_DOMAIN</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>跑完这个工具生成的材料都在<code>crypto-config</code>这个文件夹下，它总会归属于 ordererOrganzations 和 peerOrganizations。这两个文件夹下的子文件夹就是由拓扑决定的几个域文件夹。每个域下必有 ca、msp、peers/orderers、tlsca 和 users 五个文件夹。每个user，peer和orderer还必然有自己的MSP。</p>
<h2 id="configtxgen-相关"><a href="#configtxgen-相关" class="headerlink" title="configtxgen 相关"></a>configtxgen 相关</h2><p><code>configtxgen</code>需要使用的配置文件是<code>configtx.yaml</code>，解说文件大致如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright IBM Corp. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Profile</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - Different configuration profiles may be encoded here to be specified</span></span><br><span class="line"><span class="comment">#   as parameters to the configtxgen tool</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Profiles:</span></span><br><span class="line">    <span class="comment"># 这个 profile 是用来定义 consortium 的。远在产生频道以前，就定义 orderer 和组织之间的关系。</span></span><br><span class="line">    <span class="attr">TwoOrgsOrdererGenesis:</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="comment"># 按照 YAML 的语法，&lt;&lt;: * 是对 anchor 的引用</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*OrdererOrg</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="comment"># 这个名称似乎是默认的样例联盟，在没有联盟的时候会被拿出来用</span></span><br><span class="line">            <span class="attr">SampleConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*Org1</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*Org2</span></span><br><span class="line">    <span class="comment"># 这两个 profile 则是产生频道用的。换言之，一套 orderer 和多个组织，可以产生多个 consortium。</span></span><br><span class="line">    <span class="attr">TwoOrgsChannel:</span></span><br><span class="line">        <span class="attr">Consortium:</span> <span class="string">SampleConsortium</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*Org1</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*Org2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 因为增加了 profile，所以要去改使用 profile 的地方。</span></span><br><span class="line">    <span class="attr">ThreeOrgsOrdererGenesis:</span></span><br><span class="line">        <span class="attr">Orderer:</span></span><br><span class="line">            <span class="comment"># 按照 YAML 的语法，这是对 anchor 的引用</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*OrdererDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*OrdererOrg</span></span><br><span class="line">        <span class="attr">Consortiums:</span></span><br><span class="line">            <span class="comment"># 这里换了一个联盟来跑这个 network。</span></span><br><span class="line">            <span class="attr">BusinessConsortium:</span></span><br><span class="line">                <span class="attr">Organizations:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*Org1</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*Org2</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="meta">*Org3</span></span><br><span class="line">    <span class="attr">ThreeOrgsChannel:</span></span><br><span class="line">        <span class="attr">Consortium:</span> <span class="string">BusinessConsortium</span></span><br><span class="line">        <span class="attr">Application:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">            <span class="attr">Organizations:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*Org1</span></span><br><span class="line">                <span class="bullet">-</span> <span class="meta">*Org2</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">*Org3</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Section: Organizations</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - This section defines the different organizational identities which will</span></span><br><span class="line"><span class="comment">#   be referenced later in the configuration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SampleOrg defines an MSP using the sampleconfig.  It should never be used</span></span><br><span class="line">    <span class="comment"># in production but may be used as a template for other definitions</span></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">&amp;OrdererOrg</span></span><br><span class="line">        <span class="comment"># DefaultOrg defines the organization which is used in the sampleconfig</span></span><br><span class="line">        <span class="comment"># of the fabric.git development environment</span></span><br><span class="line">        <span class="attr">Name:</span> <span class="string">OrdererOrg</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ID to load the MSP definition as</span></span><br><span class="line">        <span class="attr">ID:</span> <span class="string">OrdererMSP</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># MSPDir is the filesystem path which contains the MSP configuration</span></span><br><span class="line">        <span class="attr">MSPDir:</span> <span class="string">crypto-config/ordererOrganizations/ORDERER_DOMAIN/msp</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">&amp;Org1</span></span><br><span class="line">        <span class="comment"># DefaultOrg defines the organization which is used in the sampleconfig</span></span><br><span class="line">        <span class="comment"># of the fabric.git development environment</span></span><br><span class="line">        <span class="attr">Name:</span> <span class="string">Org1MSP</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ID to load the MSP definition as</span></span><br><span class="line">        <span class="attr">ID:</span> <span class="string">Org1MSP</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">MSPDir:</span> <span class="string">crypto-config/peerOrganizations/ORG1_DOMAIN/msp</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">AnchorPeers:</span></span><br><span class="line">            <span class="comment"># AnchorPeers defines the location of peers which can be used</span></span><br><span class="line">            <span class="comment"># for cross org gossip communication.  Note, this value is only</span></span><br><span class="line">            <span class="comment"># encoded in the genesis block in the Application section context</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="string">peer0.ORG1_DOMAIN</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">&amp;Org2</span></span><br><span class="line">        <span class="comment"># DefaultOrg defines the organization which is used in the sampleconfig</span></span><br><span class="line">        <span class="comment"># of the fabric.git development environment</span></span><br><span class="line">        <span class="attr">Name:</span> <span class="string">Org2MSP</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ID to load the MSP definition as</span></span><br><span class="line">        <span class="attr">ID:</span> <span class="string">Org2MSP</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">MSPDir:</span> <span class="string">crypto-config/peerOrganizations/ORG2_DOMAIN/msp</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">AnchorPeers:</span></span><br><span class="line">            <span class="comment"># AnchorPeers defines the location of peers which can be used</span></span><br><span class="line">            <span class="comment"># for cross org gossip communication.  Note, this value is only</span></span><br><span class="line">            <span class="comment"># encoded in the genesis block in the Application section context</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="string">peer0.ORG2_DOMAIN</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">&amp;Org3</span></span><br><span class="line">        <span class="comment"># 这个组织 name取什么名字，完全无碍于MSP ID。但会影响 configtxgen 的 -asOrg 参数，进而影响 anchor 节点 configtx 的生成。</span></span><br><span class="line">        <span class="attr">Name:</span> <span class="string">Org3MSP</span></span><br><span class="line">        <span class="comment"># 这里这个 MSP ID 完全可以不按照惯例来，也完全不影响整个网络的启动，也完全不受 crypto-config.yaml 的配置文件影响。</span></span><br><span class="line">        <span class="attr">ID:</span> <span class="string">Org3-MSP</span></span><br><span class="line">        <span class="attr">MSPDir:</span> <span class="string">crypto-config/peerOrganizations/ORG3_DOMAIN/msp</span></span><br><span class="line">        <span class="comment"># 锚节点可以是数组 </span></span><br><span class="line">        <span class="attr">AnchorPeers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">Host:</span> <span class="string">peer0.ORG3_DOMAIN</span></span><br><span class="line">              <span class="attr">Port:</span> <span class="number">7051</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: Orderer</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - This section defines the values to encode into a config transaction or</span></span><br><span class="line"><span class="comment">#   genesis block for orderer related parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment"># 这里就是 anchor 了。</span></span><br><span class="line"><span class="attr">Orderer:</span> <span class="meta">&amp;OrdererDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Orderer Type: The orderer implementation to start</span></span><br><span class="line">    <span class="comment"># Available types are &quot;solo&quot; and &quot;kafka&quot;</span></span><br><span class="line">    <span class="attr">OrdererType:</span> <span class="string">solo</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">orderer.ORDERER_DOMAIN:7050</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Batch Timeout: The amount of time to wait before creating a batch</span></span><br><span class="line">    <span class="attr">BatchTimeout:</span> <span class="string">2s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Batch Size: Controls the number of messages batched into a block</span></span><br><span class="line">    <span class="attr">BatchSize:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Max Message Count: The maximum number of messages to permit in a batch</span></span><br><span class="line">        <span class="attr">MaxMessageCount:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Absolute Max Bytes: The absolute maximum number of bytes allowed for</span></span><br><span class="line">        <span class="comment"># the serialized messages in a batch.</span></span><br><span class="line">        <span class="attr">AbsoluteMaxBytes:</span> <span class="number">99</span> <span class="string">MB</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Preferred Max Bytes: The preferred maximum number of bytes allowed for</span></span><br><span class="line">        <span class="comment"># the serialized messages in a batch. A message larger than the preferred</span></span><br><span class="line">        <span class="comment"># max bytes will result in a batch larger than preferred max bytes.</span></span><br><span class="line">        <span class="attr">PreferredMaxBytes:</span> <span class="number">512</span> <span class="string">KB</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Kafka:</span></span><br><span class="line">        <span class="comment"># Brokers: A list of Kafka brokers to which the orderer connects</span></span><br><span class="line">        <span class="comment"># <span class="doctag">NOTE:</span> Use IP:port notation</span></span><br><span class="line">        <span class="attr">Brokers:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:9092</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations is the list of orgs which are defined as participants on</span></span><br><span class="line">    <span class="comment"># the orderer side of the network</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: Application</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - This section defines the values to encode into a config transaction or</span></span><br><span class="line"><span class="comment">#   genesis block for application related parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations is the list of orgs which are defined as participants on</span></span><br><span class="line">    <span class="comment"># the application side of the network</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br></pre></td></tr></table></figure>

<h2 id="docker-compose-的配置文件分析"><a href="#docker-compose-的配置文件分析" class="headerlink" title="docker-compose 的配置文件分析"></a>docker-compose 的配置文件分析</h2><p>服务的定义依赖关系大概是 peer-base.yaml -&gt; docker-compose-base.yaml -&gt; docker-compose-cli.yaml。</p>
<h3 id="常见环境变量前缀"><a href="#常见环境变量前缀" class="headerlink" title="常见环境变量前缀"></a>常见环境变量前缀</h3><p>Orderer 相关的环境变量开头是<code>ORDERER_GENERAL_</code>。</p>
<p>Peer 相关的环境变量开头是<code>CORE_PEER_</code>。</p>
<p>其他环境变量开头是<code>CORE_</code>。</p>
<h3 id="peer-base-yaml"><a href="#peer-base-yaml" class="headerlink" title="peer-base.yaml"></a>peer-base.yaml</h3><p>启动 chaincode 容器都是在本<strong>网桥</strong>网络里启动的。</p>
<p>它的工作目录是<code>/opt/gopath/src/github.com/hyperledger/fabric/peer</code>。二进制的可执行文件应该都在 gopath 下。</p>
<p>它的工作路径里有二进制的 peer 文件，所以可以直接<code>peer node start</code>启动。</p>
<p>它的所谓的 vm enpoint 看起来就是容器服务治理的思路，用 port 来做 endpoint 的端点<code>CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</code>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个文件夹是纯净的，与 example 组织无关。</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">peer-base:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:$IMAGE_TAG</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># 用默认的网桥网络来启动链码容器。</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=$&#123;COMPOSE_PROJECT_NAME&#125;_byfn</span></span><br><span class="line">      <span class="comment">#- CORE_LOGGING_LEVEL=ERROR</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_LOGGING_LEVEL=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_USELEADERELECTION=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_ORGLEADER=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span></span><br></pre></td></tr></table></figure>

<h3 id="docker-compose-base-yaml"><a href="#docker-compose-base-yaml" class="headerlink" title="docker-compose-base.yaml"></a>docker-compose-base.yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># orderer 的配置</span></span><br><span class="line">  <span class="attr">orderer.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">orderer.example.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-orderer:$IMAGE_TAG</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOGLEVEL=debug</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_GENESISMETHOD=file</span></span><br><span class="line">      <span class="comment"># 这个给 orderer 准备的创世区块，看下面的 volumes 的映射</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span></span><br><span class="line">      <span class="comment"># enabled TLS</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_ENABLED=true</span></span><br><span class="line">      <span class="comment"># 服务器的 key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span></span><br><span class="line">      <span class="comment"># 服务器的证书</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span></span><br><span class="line">      <span class="comment"># ca 的证书</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric</span></span><br><span class="line">    <span class="comment"># 启动命令，不像 peer，不再需要加参数了。</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">orderer</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="comment"># 对创世区块的映射  </span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span></span><br><span class="line">    <span class="comment"># 对 msp 文件夹的映射</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/msp:/var/hyperledger/orderer/msp</span></span><br><span class="line">    <span class="comment"># 对 tls 文件夹的映射</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">../crypto-config/ordererOrganizations/example.com/orderers/orderer.example.com/tls/:/var/hyperledger/orderer/tls</span></span><br><span class="line">    <span class="comment"># 注意，这一步需要的命名卷，实际上就是要在 docker-compose-cli 里被顶层 volume 实例化</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">orderer.example.com:/var/hyperledger/production/orderer</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7050</span><span class="string">:7050</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.org1.example.com:</span></span><br><span class="line">    <span class="comment"># 经典的继承语法</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span> <span class="string">peer-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer-base</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.org1.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="comment"># 外部的流言地址，和本机的 peer 地址一样</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=Org1MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">        <span class="comment"># peer 容器必备：MSP 与 TLS 文件夹</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">peer0.org1.example.com:/var/hyperledger/production</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7051</span><span class="string">:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">7053</span><span class="string">:7053</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer1.org1.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer1.org1.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span> <span class="string">peer-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer-base</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer1.org1.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=Org1MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">peer1.org1.example.com:/var/hyperledger/production</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8051</span><span class="string">:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8053</span><span class="string">:7053</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.org2.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span> <span class="string">peer-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer-base</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.org2.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.org2.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=Org2MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">peer0.org2.example.com:/var/hyperledger/production</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9051</span><span class="string">:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9053</span><span class="string">:7053</span></span><br><span class="line">  <span class="comment"># 所有节点的变化：</span></span><br><span class="line">  <span class="comment"># 1 修改 service name。</span></span><br><span class="line">  <span class="comment"># 2 修改 container_name</span></span><br><span class="line">  <span class="comment"># 3 修改本 peer 地址</span></span><br><span class="line">  <span class="comment"># 4 修改 gossip 相关，实际上还是本机地址</span></span><br><span class="line">  <span class="attr">peer1.org2.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer1.org2.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span> <span class="string">peer-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer-base</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer1.org2.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer1.org2.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer1.org2.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=Org2MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">../crypto-config/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">peer1.org2.example.com:/var/hyperledger/production</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10051</span><span class="string">:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">10053</span><span class="string">:7053</span></span><br></pre></td></tr></table></figure>

<h3 id="docker-compose-cli-yaml"><a href="#docker-compose-cli-yaml" class="headerlink" title="docker-compose-cli.yaml"></a>docker-compose-cli.yaml</h3><p>在cli 容器内的的Gopath 就是普通的 /opt/gopath。</p>
<p>在容器内有四个已经写好的目录，要映射到本地目录上才能用，映射关系大致是：</p>
<p>./../chaincode/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go<br>./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/：脚本的位置，这里应该可以放一些让容器外的控制命令操纵整个 fabric 的脚本。<br>./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts：当然这就是 channel 的器物所在地了。 本身的相关文件的放置地。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright IBM Corp. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前 compose 语法已经升级到了 version 3了。</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方文档的释义，大义是顶级的 volume 元素是为了在不同的 service 之间共享 volume 而准备的。</span></span><br><span class="line"><span class="comment"># You can mount a host path as part of a definition for a single service, and there is no need to define it in the top level volumes key.</span></span><br><span class="line"><span class="comment"># But, if you want to reuse a volume across multiple services, then define a named volume in the top-level volumes key. Use named volumes with services, swarms, and stack files.</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="comment"># 这个语法相当于声明了若干个命名卷。不同的容器之间把相同的卷挂载到自己本地的路径里，就相当于打通了两个容器的数据共享。</span></span><br><span class="line">  <span class="comment"># 注意，命名卷的开头并不是路径形式的，所以不要求当前的 host 有这个名字的绝对路径或者相对路径。</span></span><br><span class="line">  <span class="attr">orderer.ORDERER_DOMAIN:</span></span><br><span class="line">  <span class="attr">peer0.org1.example.com:</span></span><br><span class="line">  <span class="attr">peer1.org1.example.com:</span></span><br><span class="line">  <span class="attr">peer0.org2.example.com:</span></span><br><span class="line">  <span class="attr">peer1.org2.example.com:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个顶级网络名称，供服务之间引用</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">byfn:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">orderer.ORDERER_DOMAIN:</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>   <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">orderer.ORDERER_DOMAIN</span></span><br><span class="line">    <span class="comment"># 在这里虽然可以覆盖 container name，但有必要么？</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">orderer.ORDERER_DOMAIN</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="comment"># 这是要加入的网络名称</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.org1.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer1.org1.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer1.org1.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer1.org1.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.org2.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer1.org2.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer1.org2.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer1.org2.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cli:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">cli</span></span><br><span class="line">    <span class="comment"># 这里不继承任何配置文件，而是直接使用镜像初始化容器</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-tools:$IMAGE_TAG</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GOPATH=/opt/gopath</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_LOGGING_LEVEL=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=cli</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=Org1MSP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="comment"># 容器运行的时候，就会在内部的 console 里启动这段命令。类似我们经常 docker run 使用的 /bin/bash 一样。</span></span><br><span class="line">    <span class="comment"># 在这里我们传导了两个关键的环境变量进去，一个频道名，一个延迟。这也是目前唯二的还能在 cli 容器启动时改变的东西了。</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/bash</span> <span class="string">-c</span> <span class="string">&#x27;./scripts/script.sh $&#123;CHANNEL_NAME&#125; $&#123;DELAY&#125;; sleep $TIMEOUT&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment"># host 上路径: 容器内路径</span></span><br><span class="line">        <span class="comment"># 映射本机的运行时配置文件到容器内。</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">        <span class="comment"># ：这就是链码的主要位置了，看来这个目录也是镜像里就写死的，要写自定义的链码也只能从这里安装进去。</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./../chaincode/:/opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./scripts:/opt/gopath/src/github.com/hyperledger/fabric/peer/scripts/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="comment"># 等这些 service 启动完了，再启动自己这个 service。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">orderer.ORDERER_DOMAIN</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer1.org1.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer1.org2.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br></pre></td></tr></table></figure>
<h3 id="docker-compose-e2e-template-yaml"><a href="#docker-compose-e2e-template-yaml" class="headerlink" title="docker-compose-e2e-template.yaml"></a>docker-compose-e2e-template.yaml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright IBM Corp. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这个文件会被 byfn.sh 的 replacePrivateKey() 函数生成实际的 docker-compose-e2e.yaml。</span></span><br><span class="line"><span class="comment"># 然后被 sed 命令另作他用。</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">orderer.example.com:</span></span><br><span class="line">  <span class="attr">peer0.org1.example.com:</span></span><br><span class="line">  <span class="attr">peer1.org1.example.com:</span></span><br><span class="line">  <span class="attr">peer0.org2.example.com:</span></span><br><span class="line">  <span class="attr">peer1.org2.example.com:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">byfn:</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">ca0:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-ca:$IMAGE_TAG</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-org1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA1_PRIVATE_KEY</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7054:7054&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA1_PRIVATE_KEY -b admin:adminpw -d&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./crypto-config/peerOrganizations/org1.example.com/ca/:/etc/hyperledger/fabric-ca-server-config</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ca_peerOrg1</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ca1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-ca:$IMAGE_TAG</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_CA_NAME=ca-org2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/CA2_PRIVATE_KEY</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8054:7054&quot;</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">sh</span> <span class="string">-c</span> <span class="string">&#x27;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/CA2_PRIVATE_KEY -b admin:adminpw -d&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./crypto-config/peerOrganizations/org2.example.com/ca/:/etc/hyperledger/fabric-ca-server-config</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ca_peerOrg2</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">orderer.example.com:</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>   <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">orderer.example.com</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">orderer.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.org1.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer0.org1.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer1.org1.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer1.org1.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer1.org1.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.org2.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer0.org2.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer1.org2.example.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer1.org2.example.com</span></span><br><span class="line">    <span class="attr">extends:</span></span><br><span class="line">      <span class="attr">file:</span>  <span class="string">base/docker-compose-base.yaml</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">peer1.org2.example.com</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">byfn</span></span><br></pre></td></tr></table></figure>

<h3 id="byfn-sh"><a href="#byfn-sh" class="headerlink" title="byfn.sh"></a>byfn.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Copyright IBM Corp All Rights Reserved</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script will orchestrate a sample end-to-end execution of the Hyperledger</span></span><br><span class="line"><span class="comment"># Fabric network.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The end-to-end verification provisions a sample Fabric network consisting of</span></span><br><span class="line"><span class="comment"># two organizations, each maintaining two peers, and a “solo” ordering service.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This verification makes use of two fundamental tools, which are necessary to</span></span><br><span class="line"><span class="comment"># create a functioning transactional network with digital signature validation</span></span><br><span class="line"><span class="comment"># and access control:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * cryptogen - generates the x509 certificates used to identify and</span></span><br><span class="line"><span class="comment">#   authenticate the various components in the network.</span></span><br><span class="line"><span class="comment"># * configtxgen - generates the requisite configuration artifacts for orderer</span></span><br><span class="line"><span class="comment">#   bootstrap and channel creation.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Each tool consumes a configuration yaml file, within which we specify the topology</span></span><br><span class="line"><span class="comment"># of our network (cryptogen) and the location of our certificates for various</span></span><br><span class="line"><span class="comment"># configuration operations (configtxgen).  Once the tools have been successfully run,</span></span><br><span class="line"><span class="comment"># we are able to launch our network.  More detail on the tools and the structure of</span></span><br><span class="line"><span class="comment"># the network will be provided later in this document.  For now, let&#x27;s get going...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># prepending $PWD/../bin to PATH to ensure we are picking up the correct binaries</span></span><br><span class="line"><span class="comment"># this may be commented out to resolve installed version of tools if desired</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;PWD&#125;</span>/../bin:<span class="variable">$&#123;PWD&#125;</span>:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># 这个环境变量很重要，这里的 export 保证这个变量是在 environment 里。可以被子进程（另一个 shell 脚本继承）。</span></span><br><span class="line"><span class="comment"># 并不是所有的父进程里的 variable 都会被子进程看到的。</span></span><br><span class="line"><span class="built_in">export</span> FABRIC_CFG_PATH=<span class="variable">$&#123;PWD&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print the usage message</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">printHelp</span></span> () &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Usage: &quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m up|down|restart|generate [-c &lt;channel name&gt;] [-t &lt;timeout&gt;] [-d &lt;delay&gt;] [-f &lt;docker-compose-file&gt;] [-s &lt;dbtype&gt;] [-i &lt;imagetag&gt;]&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -h|--help (print this message)&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -m &lt;mode&gt; - one of &#x27;up&#x27;, &#x27;down&#x27;, &#x27;restart&#x27; or &#x27;generate&#x27;&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;      - &#x27;up&#x27; - bring up the network with docker-compose up&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;      - &#x27;down&#x27; - clear the network with docker-compose down&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;      - &#x27;restart&#x27; - restart the network&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;      - &#x27;generate&#x27; - generate required certificates and genesis block&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -c &lt;channel name&gt; - channel name to use (defaults to \&quot;mychannel\&quot;)&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -t &lt;timeout&gt; - CLI timeout duration in microseconds (defaults to 10000)&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -d &lt;delay&gt; - delay duration in seconds (defaults to 3)&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -f &lt;docker-compose-file&gt; - specify which docker-compose file use (defaults to docker-compose-cli.yaml)&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -s &lt;dbtype&gt; - the database backend to use: goleveldb (default) or couchdb&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;    -i &lt;imagetag&gt; - pass the image tag to launch the network using the tag: 1.0.1, 1.0.2, 1.0.3, 1.0.4 (defaults to latest)&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Typically, one would first generate the required certificates and &quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;genesis block, then bring up the network. e.g.:&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m generate -c mychannel&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m up -c mychannel -s couchdb&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m up -c mychannel -s couchdb -i 1.0.6&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m down -c mychannel&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Taking all defaults:&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m generate&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m up&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;  byfn.sh -m down&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ask user for confirmation to proceed</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">askProceed</span></span> () &#123;</span><br><span class="line">  <span class="built_in">read</span> -p <span class="string">&quot;Continue (y/n)? &quot;</span> ans</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$ans</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    y|Y )</span><br><span class="line">      <span class="comment"># 只有这个地方会正常走下去</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;proceeding ...&quot;</span></span><br><span class="line">    <span class="comment"># 这个双分号是 case 的休止符</span></span><br><span class="line">    ;;</span><br><span class="line">    n|N )</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;exiting...&quot;</span></span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line">    * )</span><br><span class="line">      <span class="comment"># 这里会递归</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;invalid response&quot;</span></span><br><span class="line">      askProceed</span><br><span class="line">    ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Obtain CONTAINER_IDS and remove them</span></span><br><span class="line"><span class="comment"># TODO Might want to make this optional - could clear other containers</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">clearContainers</span></span> () &#123;</span><br><span class="line">  <span class="comment"># -a 表示输出全部容器，-q 表示只输出容器 id，这样就可以迭代使用了</span></span><br><span class="line">  <span class="comment"># 结果大概是这样</span></span><br><span class="line">  <span class="comment"># 8a25b455f05e</span></span><br><span class="line">  <span class="comment"># d2d84545a902</span></span><br><span class="line">  <span class="comment"># c67d337e5bd9</span></span><br><span class="line">  <span class="comment"># e5cbd8457caf</span></span><br><span class="line">  <span class="comment"># 9ee6a1cb33c1</span></span><br><span class="line">  <span class="comment"># a0df580d4633</span></span><br><span class="line">  <span class="comment"># cb6b441b083f</span></span><br><span class="line">  <span class="comment"># 0c87d55710c8</span></span><br><span class="line">  <span class="comment"># c24f3eb2e0e0</span></span><br><span class="line">  CONTAINER_IDS=$(docker ps -aq)</span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$CONTAINER_IDS</span>&quot;</span> -o <span class="string">&quot;<span class="variable">$CONTAINER_IDS</span>&quot;</span> == <span class="string">&quot; &quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;---- No containers available for deletion ----&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># 直接拿这个列表来 rm，而不用再 xargs 了。</span></span><br><span class="line">    docker rm -f <span class="variable">$CONTAINER_IDS</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Delete any images that were generated as a part of this setup</span></span><br><span class="line"><span class="comment"># specifically the following images are often left behind:</span></span><br><span class="line"><span class="comment"># TODO list generated image naming patterns</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">removeUnwantedImages</span></span>() &#123;</span><br><span class="line">  <span class="comment"># 用 awk 来截取多段输出的好例子。</span></span><br><span class="line">  <span class="comment"># 注意在这里我们可以看到不要乱改 peer 的名字，不然不能在这里搞到所有的 image_id。</span></span><br><span class="line">  <span class="comment"># $()的形式可以把命令求和为一个匿名变量。</span></span><br><span class="line">  DOCKER_IMAGE_IDS=$(docker images | grep <span class="string">&quot;dev\|none\|test-vp\|peer[0-9]-&quot;</span> | awk <span class="string">&#x27;&#123;print $3&#125;&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$DOCKER_IMAGE_IDS</span>&quot;</span> -o <span class="string">&quot;<span class="variable">$DOCKER_IMAGE_IDS</span>&quot;</span> == <span class="string">&quot; &quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;---- No images available for deletion ----&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    docker rmi -f <span class="variable">$DOCKER_IMAGE_IDS</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate the needed certificates, the genesis block and start the network.</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">networkUp</span></span> () &#123;</span><br><span class="line">  <span class="comment"># generate artifacts if they don&#x27;t exist</span></span><br><span class="line">  <span class="comment"># 确认一个目录是否存在的命令</span></span><br><span class="line">  <span class="keyword">if</span> [ ! -d <span class="string">&quot;crypto-config&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 第一步，生成证书。其实不只是生成证书，还生成证书相关的东西。</span></span><br><span class="line">    generateCerts</span><br><span class="line">    replacePrivateKey</span><br><span class="line">    generateChannelArtifacts</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;IF_COUCHDB&#125;</span>&quot;</span> == <span class="string">&quot;couchdb&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      IMAGE_TAG=<span class="variable">$IMAGETAG</span> CHANNEL_NAME=<span class="variable">$CHANNEL_NAME</span> TIMEOUT=<span class="variable">$CLI_TIMEOUT</span> DELAY=<span class="variable">$CLI_DELAY</span> docker-compose -f <span class="variable">$COMPOSE_FILE</span> -f <span class="variable">$COMPOSE_FILE_COUCH</span> up -d 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">      <span class="comment"># 这一行让 Docker-Compose 来按照配置文件装配容器配置，生成由容器组成的项目网络</span></span><br><span class="line">      <span class="comment"># cli 容器起来以后，会自己去创建频道、一个一个地把容器加入网络中。一个一个地初始化链码，一个一个地测试链码。</span></span><br><span class="line">      IMAGE_TAG=<span class="variable">$IMAGETAG</span> CHANNEL_NAME=<span class="variable">$CHANNEL_NAME</span> TIMEOUT=<span class="variable">$CLI_TIMEOUT</span> DELAY=<span class="variable">$CLI_DELAY</span> docker-compose -f <span class="variable">$COMPOSE_FILE</span> up -d 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ERROR !!!! Unable to start network&quot;</span></span><br><span class="line">    <span class="comment"># 这个命令就是去读一个容器启动的 command 在 console 里的输出。</span></span><br><span class="line">    docker logs -f cli</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  docker logs -f cli</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tear down running network</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">networkDown</span></span> () &#123;</span><br><span class="line">  docker-compose -f <span class="variable">$COMPOSE_FILE</span> down --volumes</span><br><span class="line">  docker-compose -f <span class="variable">$COMPOSE_FILE</span> -f <span class="variable">$COMPOSE_FILE_COUCH</span> down --volumes</span><br><span class="line">  <span class="comment"># Don&#x27;t remove the generated artifacts -- note, the ledgers are always removed</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$MODE</span>&quot;</span> != <span class="string">&quot;restart&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># Bring the containers down deleting their volumes</span></span><br><span class="line">    <span class="comment">#Cleanup the chaincode containers</span></span><br><span class="line">    clearContainers</span><br><span class="line">    <span class="comment">#Cleanup images</span></span><br><span class="line">    removeUnwantedImages</span><br><span class="line">    <span class="comment"># remove orderer block and other channel configuration transactions and certs</span></span><br><span class="line">    rm -rf channel-artifacts/*.block channel-artifacts/*.tx crypto-config</span><br><span class="line">    <span class="comment"># remove the docker-compose yaml file that was customized to the example</span></span><br><span class="line">    rm -f docker-compose-e2e.yaml</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 但这个文件有什么用呢？docker-compose-e2e-template.yaml </span></span><br><span class="line"><span class="comment"># Using docker-compose-e2e-template.yaml, replace constants with private key file names</span></span><br><span class="line"><span class="comment"># generated by the cryptogen tool and output a docker-compose.yaml specific to this</span></span><br><span class="line"><span class="comment"># configuration</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">replacePrivateKey</span></span> () &#123;</span><br><span class="line">  <span class="comment"># sed on MacOSX does not support -i flag with a null extension. We will use</span></span><br><span class="line">  <span class="comment"># &#x27;t&#x27; for our back-up&#x27;s extension and depete it at the end of the function</span></span><br><span class="line">  ARCH=`uname -s | grep Darwin`</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ARCH</span>&quot;</span> == <span class="string">&quot;Darwin&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    OPTS=<span class="string">&quot;-it&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    OPTS=<span class="string">&quot;-i&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Copy the template to the file that will be modified to add the private key</span></span><br><span class="line">  cp docker-compose-e2e-template.yaml docker-compose-e2e.yaml</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The next steps will replace the template&#x27;s contents with the</span></span><br><span class="line">  <span class="comment"># actual values of the private key file names for the two CAs.</span></span><br><span class="line">  <span class="comment"># 把当前的父文件夹记住</span></span><br><span class="line">  CURRENT_DIR=<span class="variable">$PWD</span></span><br><span class="line">  <span class="built_in">cd</span> crypto-config/peerOrganizations/org1.example.com/ca/</span><br><span class="line">  PRIV_KEY=$(ls *_sk)</span><br><span class="line">  <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$CURRENT_DIR</span>&quot;</span></span><br><span class="line">  sed <span class="variable">$OPTS</span> <span class="string">&quot;s/CA1_PRIVATE_KEY/<span class="variable">$&#123;PRIV_KEY&#125;</span>/g&quot;</span> docker-compose-e2e.yaml</span><br><span class="line">  <span class="built_in">cd</span> crypto-config/peerOrganizations/org2.example.com/ca/</span><br><span class="line">  PRIV_KEY=$(ls *_sk)</span><br><span class="line">  <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$CURRENT_DIR</span>&quot;</span></span><br><span class="line">  sed <span class="variable">$OPTS</span> <span class="string">&quot;s/CA2_PRIVATE_KEY/<span class="variable">$&#123;PRIV_KEY&#125;</span>/g&quot;</span> docker-compose-e2e.yaml</span><br><span class="line">  <span class="comment"># If MacOSX, remove the temporary backup of the docker-compose file</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ARCH</span>&quot;</span> == <span class="string">&quot;Darwin&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    rm docker-compose-e2e.yamlt</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># X.509只是 PKI 密码学架构的一个实现。</span></span><br><span class="line"><span class="comment"># ca-cert 是根证书。</span></span><br><span class="line"><span class="comment"># 为什么 count 必须放在这个文件里面。</span></span><br><span class="line"><span class="comment"># 这个函数不止生成证书，还有 keystore。</span></span><br><span class="line"><span class="comment"># 私钥签署，公钥验证！而不是公钥签署，私钥验证！</span></span><br><span class="line"><span class="comment"># We will use the cryptogen tool to generate the cryptographic material (x509 certs)</span></span><br><span class="line"><span class="comment"># for our various network entities.  The certificates are based on a standard PKI</span></span><br><span class="line"><span class="comment"># implementation where validation is achieved by reaching a common trust anchor.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Cryptogen consumes a file - ``crypto-config.yaml`` - that contains the network</span></span><br><span class="line"><span class="comment"># topology and allows us to generate a library of certificates for both the</span></span><br><span class="line"><span class="comment"># Organizations and the components that belong to those Organizations.  Each</span></span><br><span class="line"><span class="comment"># Organization is provisioned a unique root certificate (``ca-cert``), that binds</span></span><br><span class="line"><span class="comment"># specific components (peers and orderers) to that Org.  Transactions and communications</span></span><br><span class="line"><span class="comment"># within Fabric are signed by an entity&#x27;s private key (``keystore``), and then verified</span></span><br><span class="line"><span class="comment"># by means of a public key (``signcerts``).  You will notice a &quot;count&quot; variable within</span></span><br><span class="line"><span class="comment"># this file.  We use this to specify the number of peers per Organization; in our</span></span><br><span class="line"><span class="comment"># case it&#x27;s two peers per Org.  The rest of this template is extremely</span></span><br><span class="line"><span class="comment"># self-explanatory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># After we run the tool, the certs will be parked in a folder titled ``crypto-config``.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generates Org certs using cryptogen tool</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">generateCerts</span></span> ()&#123;</span><br><span class="line">  <span class="built_in">which</span> cryptogen</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;cryptogen tool not found. exiting&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;##########################################################&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;##### Generate certificates using cryptogen tool #########&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;##########################################################&quot;</span></span><br><span class="line">  <span class="keyword">if</span> [ -d <span class="string">&quot;crypto-config&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    rm -Rf crypto-config</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  cryptogen generate --config=./crypto-config.yaml</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Failed to generate certificates...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一个新的 org 都要有一个 anchor 节点。这也就意味着不仅配置文件里要有相关的配置，也意味着初始化步骤里</span></span><br><span class="line"><span class="comment"># 要有相关的配置命令。</span></span><br><span class="line"><span class="comment"># 把三件事做起来：</span></span><br><span class="line"><span class="comment"># 1 生成创世区块。 2 生成频道配置 3 配置锚节点。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The `configtxgen tool is used to create four artifacts: orderer **bootstrap</span></span><br><span class="line"><span class="comment"># block**, fabric **channel configuration transaction**, and two **anchor</span></span><br><span class="line"><span class="comment"># peer transactions** - one for each Peer Org.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The orderer block is the genesis block for the ordering service, and the</span></span><br><span class="line"><span class="comment"># channel transaction file is broadcast to the orderer at channel creation</span></span><br><span class="line"><span class="comment"># time.  The anchor peer transactions, as the name might suggest, specify each</span></span><br><span class="line"><span class="comment"># Org&#x27;s anchor peer on this channel.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Configtxgen consumes a file - ``configtx.yaml`` - that contains the definitions</span></span><br><span class="line"><span class="comment"># for the sample network. There are three members - one Orderer Org (``OrdererOrg``)</span></span><br><span class="line"><span class="comment"># and two Peer Orgs (``Org1`` &amp; ``Org2``) each managing and maintaining two peer nodes.</span></span><br><span class="line"><span class="comment"># This file also specifies a consortium - ``SampleConsortium`` - consisting of our</span></span><br><span class="line"><span class="comment"># two Peer Orgs.  Pay specific attention to the &quot;Profiles&quot; section at the top of</span></span><br><span class="line"><span class="comment"># this file.  You will notice that we have two unique headers. One for the orderer genesis</span></span><br><span class="line"><span class="comment"># block - ``TwoOrgsOrdererGenesis`` - and one for our channel - ``TwoOrgsChannel``.</span></span><br><span class="line"><span class="comment"># These headers are important, as we will pass them in as arguments when we create</span></span><br><span class="line"><span class="comment"># our artifacts.  This file also contains two additional specifications that are worth</span></span><br><span class="line"><span class="comment"># noting.  Firstly, we specify the anchor peers for each Peer Org</span></span><br><span class="line"><span class="comment"># (``peer0.org1.example.com`` &amp; ``peer0.org2.example.com``).  Secondly, we point to</span></span><br><span class="line"><span class="comment"># the location of the MSP directory for each member, in turn allowing us to store the</span></span><br><span class="line"><span class="comment"># root certificates for each Org in the orderer genesis block.  This is a critical</span></span><br><span class="line"><span class="comment"># concept. Now any network entity communicating with the ordering service can have</span></span><br><span class="line"><span class="comment"># its digital signature verified.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This function will generate the crypto material and our four configuration</span></span><br><span class="line"><span class="comment"># artifacts, and subsequently output these files into the ``channel-artifacts``</span></span><br><span class="line"><span class="comment"># folder.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># If you receive the following warning, it can be safely ignored:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># [bccsp] GetDefault -&gt; WARN 001 Before using BCCSP, please call InitFactories(). Falling back to bootBCCSP.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can ignore the logs regarding intermediate certs, we are not using them in</span></span><br><span class="line"><span class="comment"># this crypto implementation.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate orderer genesis block, channel configuration transaction and</span></span><br><span class="line"><span class="comment"># anchor peer update transactions</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">generateChannelArtifacts</span></span>() &#123;</span><br><span class="line">  <span class="comment"># 检测一个命令是不是存在</span></span><br><span class="line">  <span class="built_in">which</span> configtxgen</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;configtxgen tool not found. exiting&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;##########################################################&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#########  Generating Orderer Genesis block ##############&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;##########################################################&quot;</span></span><br><span class="line">  <span class="comment"># Note: For some unknown reason (at least for now) the block file can&#x27;t be</span></span><br><span class="line">  <span class="comment"># named orderer.genesis.block or the orderer will fail to launch!</span></span><br><span class="line">  <span class="comment"># 1 生成创世区块</span></span><br><span class="line">  configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Failed to generate orderer genesis block...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#################################################################&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;### Generating channel configuration transaction &#x27;channel.tx&#x27; ###&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#################################################################&quot;</span></span><br><span class="line">  <span class="comment"># 2 生成频道配置，实际上就是 channel 事务。</span></span><br><span class="line">  configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID <span class="variable">$CHANNEL_NAME</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Failed to generate channel configuration transaction...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#################################################################&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#######    Generating anchor peer update for Org1MSP   ##########&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#################################################################&quot;</span></span><br><span class="line">  <span class="comment"># configtxgen -help 可以看到它的各种 options。其中 outputAnchorPeersUpdate 只能在创建缺省频道（实际上自定义频道也可以），和最初建 anchor 时才可以使用。</span></span><br><span class="line">  <span class="comment"># 这个 channel 名和 asOrg 参数共同决定 Org1MSPanchors.tx 的内容。</span></span><br><span class="line">  configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID <span class="variable">$CHANNEL_NAME</span> -asOrg Org1MSP</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Failed to generate anchor peer update for Org1MSP...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#################################################################&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#######    Generating anchor peer update for Org2MSP   ##########&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;#################################################################&quot;</span></span><br><span class="line">  configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate \</span><br><span class="line">  ./channel-artifacts/Org2MSPanchors.tx -channelID <span class="variable">$CHANNEL_NAME</span> -asOrg Org2MSP</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Failed to generate anchor peer update for Org2MSP...&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义完函数以后，这里才是程序的起点</span></span><br><span class="line"><span class="comment"># Obtain the OS and Architecture string that will be used to select the correct</span></span><br><span class="line"><span class="comment"># native binaries for your platform</span></span><br><span class="line">OS_ARCH=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(uname -s|tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27;|sed &#x27;s/mingw64_nt.*/windows/&#x27;)</span>-<span class="subst">$(uname -m | sed &#x27;s/x86_64/amd64/g&#x27;)</span>&quot;</span> | awk <span class="string">&#x27;&#123;print tolower($0)&#125;&#x27;</span>)</span><br><span class="line"><span class="comment"># timeout duration - the duration the CLI should wait for a response from</span></span><br><span class="line"><span class="comment"># another container before giving up</span></span><br><span class="line">CLI_TIMEOUT=10</span><br><span class="line"><span class="comment">#default for delay</span></span><br><span class="line">CLI_DELAY=3</span><br><span class="line"><span class="comment"># channel name defaults to &quot;mychannel&quot;</span></span><br><span class="line">CHANNEL_NAME=<span class="string">&quot;mychannel&quot;</span></span><br><span class="line"><span class="comment"># use this as the default docker-compose yaml definition</span></span><br><span class="line">COMPOSE_FILE=docker-compose-cli.yaml</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">COMPOSE_FILE_COUCH=docker-compose-couch.yaml</span><br><span class="line"><span class="comment"># default image tag</span></span><br><span class="line">IMAGETAG=<span class="string">&quot;latest&quot;</span></span><br><span class="line"><span class="comment"># Parse commandline args</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">&quot;h?m:c:t:d:f:s:i:&quot;</span> opt; <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">&quot;<span class="variable">$opt</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    h|\?)</span><br><span class="line">      printHelp</span><br><span class="line">      <span class="built_in">exit</span> 0</span><br><span class="line">    ;;</span><br><span class="line">    m)  MODE=<span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">    c)  CHANNEL_NAME=<span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">    t)  CLI_TIMEOUT=<span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">    d)  CLI_DELAY=<span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">    f)  COMPOSE_FILE=<span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">    s)  IF_COUCHDB=<span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">    i)  IMAGETAG=`uname -m`<span class="string">&quot;-&quot;</span><span class="variable">$OPTARG</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Determine whether starting, stopping, restarting or generating for announce</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$MODE</span>&quot;</span> == <span class="string">&quot;up&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  EXPMODE=<span class="string">&quot;Starting&quot;</span></span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$MODE</span>&quot;</span> == <span class="string">&quot;down&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  EXPMODE=<span class="string">&quot;Stopping&quot;</span></span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$MODE</span>&quot;</span> == <span class="string">&quot;restart&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  EXPMODE=<span class="string">&quot;Restarting&quot;</span></span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$MODE</span>&quot;</span> == <span class="string">&quot;generate&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  EXPMODE=<span class="string">&quot;Generating certs and genesis block for&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  printHelp</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Announce what was requested</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;IF_COUCHDB&#125;</span>&quot;</span> == <span class="string">&quot;couchdb&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;EXPMODE&#125;</span> with channel &#x27;<span class="variable">$&#123;CHANNEL_NAME&#125;</span>&#x27; and CLI timeout of &#x27;<span class="variable">$&#123;CLI_TIMEOUT&#125;</span>&#x27; using database &#x27;<span class="variable">$&#123;IF_COUCHDB&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;EXPMODE&#125;</span> with channel &#x27;<span class="variable">$&#123;CHANNEL_NAME&#125;</span>&#x27; and CLI timeout of &#x27;<span class="variable">$&#123;CLI_TIMEOUT&#125;</span>&#x27;&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="comment"># ask for confirmation to proceed</span></span><br><span class="line">askProceed</span><br><span class="line"></span><br><span class="line"><span class="comment">#Create the network using docker compose</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;up&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  networkUp</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;down&quot;</span> ]; <span class="keyword">then</span> <span class="comment">## Clear the network</span></span><br><span class="line">  networkDown</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;generate&quot;</span> ]; <span class="keyword">then</span> <span class="comment">## Generate Artifacts</span></span><br><span class="line">  generateCerts</span><br><span class="line">  replacePrivateKey</span><br><span class="line">  generateChannelArtifacts</span><br><span class="line">  <span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$&#123;MODE&#125;</span>&quot;</span> == <span class="string">&quot;restart&quot;</span> ]; <span class="keyword">then</span> <span class="comment">## Restart the network</span></span><br><span class="line">  networkDown</span><br><span class="line">  networkUp</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  printHelp</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="script-script-sh"><a href="#script-script-sh" class="headerlink" title="script/script.sh"></a>script/script.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; ____    _____      _      ____    _____ &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/ ___|  |_   _|    / \    |  _ \  |_   _|&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;\___ \    | |     / _ \   | |_) |   | |  &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; ___) |   | |    / ___ \  |  _ &lt;    | |  &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|____/    |_|   /_/   \_\ |_| \_\   |_|  &quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Build your first network (BYFN) end-to-end test&quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">CHANNEL_NAME=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">DELAY=<span class="string">&quot;<span class="variable">$2</span>&quot;</span></span><br><span class="line">: <span class="variable">$&#123;CHANNEL_NAME:=&quot;mychannel&quot;&#125;</span></span><br><span class="line">: <span class="variable">$&#123;TIMEOUT:=&quot;60&quot;&#125;</span></span><br><span class="line">COUNTER=1</span><br><span class="line">MAX_RETRY=5</span><br><span class="line"><span class="comment"># 是不是使用 TLS，其实只与 orderer 和 channel 有关。</span></span><br><span class="line">ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/ORDERER_DOMAIN/orderers/orderer.ORDERER_DOMAIN/msp/tlscacerts/tlsca.ORDERER_DOMAIN-cert.pem</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Channel name : &quot;</span><span class="variable">$CHANNEL_NAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># verify the result of the end-to-end test</span></span><br><span class="line"><span class="function"><span class="title">verifyResult</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$1</span> -ne 0 ] ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;!!!!!!!!!!!!!!! &quot;</span><span class="variable">$2</span><span class="string">&quot; !!!!!!!!!!!!!!!!&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;========= ERROR !!! FAILED to execute End-2-End Scenario ===========&quot;</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">setGlobals</span></span> () &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 -o <span class="variable">$1</span> -eq 1 ] ; <span class="keyword">then</span></span><br><span class="line">    CORE_PEER_LOCALMSPID=<span class="string">&quot;Org1MSP&quot;</span></span><br><span class="line">    CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">    <span class="comment"># 传进来不同的命令，更改的核心环境变量指标是容器的 endpoint 地址。也就是CORE_PEER_ADDRESS。相同组织的 enpoint 使用的是相同的 MSP 密码学目录。</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">      CORE_PEER_ADDRESS=peer0.org1.example.com:7051</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      CORE_PEER_ADDRESS=peer1.org1.example.com:7051</span><br><span class="line">      <span class="comment"># 此处有重复，疑为错误。但 github 上原版的代码就是这样写的。</span></span><br><span class="line">      CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    CORE_PEER_LOCALMSPID=<span class="string">&quot;Org2MSP&quot;</span></span><br><span class="line">    CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$1</span> -eq 2 ]; <span class="keyword">then</span></span><br><span class="line">      CORE_PEER_ADDRESS=peer0.org2.example.com:7051</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      CORE_PEER_ADDRESS=peer1.org2.example.com:7051</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">  env |grep CORE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建频道是第一步</span></span><br><span class="line"><span class="function"><span class="title">createChannel</span></span>() &#123;</span><br><span class="line">  <span class="comment"># 把 cli 内的全局变量设置为0系列</span></span><br><span class="line">  setGlobals 0</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> -o <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> = <span class="string">&quot;false&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="comment"># 1 -o 是 orderer string，实际上就是从cli 容器出发，可以读到的容器地址，这里还要考虑容器网络连通性问题。-c 是频道名。channel.tx是不可读文件。</span></span><br><span class="line">      <span class="comment"># 换言之，如果我们有足够多的创世区块，和 channel.tx。我们可以在一个 cli 容器里面生成多个频道。</span></span><br><span class="line">      <span class="comment"># 2 实际上我们从这一步开始，就知道了 orderer 才是最先 join 进这个 channel 里的一个节点。</span></span><br><span class="line">      <span class="comment"># 3 几乎所有的频道、peer、orderer 节点相关的操作，都要依靠这个 peer channel 命令开头的系列命令。</span></span><br><span class="line">      <span class="comment"># 4 channel id 就是 channel name。</span></span><br><span class="line">    peer channel create -o orderer.ORDERER_DOMAIN:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ./channel-artifacts/channel.tx &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># 注意，如果需要打开 tls，那么这个--cafile选项特别特别重要。</span></span><br><span class="line">    peer channel create -o orderer.ORDERER_DOMAIN:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ./channel-artifacts/channel.tx --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  res=$?</span><br><span class="line">  cat log.txt</span><br><span class="line">  verifyResult <span class="variable">$res</span> <span class="string">&quot;Channel creation failed&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Channel \&quot;<span class="variable">$CHANNEL_NAME</span>\&quot; is created successfully ===================== &quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">updateAnchorPeers</span></span>() &#123;</span><br><span class="line">  PEER=<span class="variable">$1</span></span><br><span class="line">  setGlobals <span class="variable">$PEER</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> -o <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> = <span class="string">&quot;false&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      <span class="comment"># 生成的 anchor artifact 到这里才有用。这样才算真的把锚节点注册上去了。</span></span><br><span class="line">    peer channel update -o orderer.ORDERER_DOMAIN:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ./channel-artifacts/<span class="variable">$&#123;CORE_PEER_LOCALMSPID&#125;</span>anchors.tx &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    peer channel update -o orderer.ORDERER_DOMAIN:7050 -c <span class="variable">$CHANNEL_NAME</span> -f ./channel-artifacts/<span class="variable">$&#123;CORE_PEER_LOCALMSPID&#125;</span>anchors.tx --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  res=$?</span><br><span class="line">  cat log.txt</span><br><span class="line">  verifyResult <span class="variable">$res</span> <span class="string">&quot;Anchor peer update failed&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Anchor peers for org \&quot;<span class="variable">$CORE_PEER_LOCALMSPID</span>\&quot; on \&quot;<span class="variable">$CHANNEL_NAME</span>\&quot; is updated successfully ===================== &quot;</span></span><br><span class="line">  sleep <span class="variable">$DELAY</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Sometimes Join takes time hence RETRY atleast for 5 times</span></span><br><span class="line"><span class="function"><span class="title">joinWithRetry</span></span> () &#123;</span><br><span class="line">  <span class="comment"># peer channel join 实际上是消耗四个环境变量作为把 peer 加入 channel 的依据，所以外部传进来的环境变量到此几乎可说是无用的。</span></span><br><span class="line">  <span class="comment"># CORE_PEER_MSPCONFIGPATH</span></span><br><span class="line">  <span class="comment"># CORE_PEER_ADDRESS</span></span><br><span class="line">  <span class="comment"># CORE_PEER_LOCALMSPID</span></span><br><span class="line">  <span class="comment"># CORE_PEER_TLS_ROOTCERT_FILE</span></span><br><span class="line">  peer channel join -b <span class="variable">$CHANNEL_NAME</span>.block  &gt;&amp;log.txt</span><br><span class="line">  res=$?</span><br><span class="line">  cat log.txt</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$res</span> -ne 0 -a <span class="variable">$COUNTER</span> -lt <span class="variable">$MAX_RETRY</span> ]; <span class="keyword">then</span></span><br><span class="line">    COUNTER=` expr <span class="variable">$COUNTER</span> + 1`</span><br><span class="line">    <span class="comment"># 这的 peer 是顺序 peer，和实际的容器名是不一样的。</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;PEER<span class="variable">$1</span> failed to join the channel, Retry after 2 seconds&quot;</span></span><br><span class="line">    <span class="comment"># bash sleep 的妙用</span></span><br><span class="line">    sleep <span class="variable">$DELAY</span></span><br><span class="line">    <span class="comment"># 递归重试</span></span><br><span class="line">    joinWithRetry <span class="variable">$1</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    COUNTER=1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  verifyResult <span class="variable">$res</span> <span class="string">&quot;After <span class="variable">$MAX_RETRY</span> attempts, PEER<span class="variable">$ch</span> has failed to Join the Channel&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">joinChannel</span></span> () &#123;</span><br><span class="line">  <span class="keyword">for</span> ch <span class="keyword">in</span> 0 1 2 3; <span class="keyword">do</span></span><br><span class="line">    setGlobals <span class="variable">$ch</span></span><br><span class="line">    joinWithRetry <span class="variable">$ch</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;===================== PEER<span class="variable">$ch</span> joined on the channel \&quot;<span class="variable">$CHANNEL_NAME</span>\&quot; ===================== &quot;</span></span><br><span class="line">    sleep <span class="variable">$DELAY</span></span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">installChaincode</span></span> () &#123;</span><br><span class="line">  PEER=<span class="variable">$1</span></span><br><span class="line">  setGlobals <span class="variable">$PEER</span></span><br><span class="line">  <span class="comment"># 这里这个 p 就是在cli 容器内可以看到的 chaincode 的 go 文件路径了。n 则是链码的合约名字。</span></span><br><span class="line">  <span class="comment"># 这个链码为什么不需要经过编译，真是奇也怪哉。</span></span><br><span class="line">  peer chaincode install -n mycc -v 1.0 -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example02 &gt;&amp;log.txt</span><br><span class="line">  res=$?</span><br><span class="line">  cat log.txt</span><br><span class="line">        verifyResult <span class="variable">$res</span> <span class="string">&quot;Chaincode installation on remote peer PEER<span class="variable">$PEER</span> has Failed&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Chaincode is installed on remote peer PEER<span class="variable">$PEER</span> ===================== &quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">instantiateChaincode</span></span> () &#123;</span><br><span class="line">  PEER=<span class="variable">$1</span></span><br><span class="line">  setGlobals <span class="variable">$PEER</span></span><br><span class="line">  <span class="comment"># 用硬编码的方式好过用接口的方式来读写 orderer endpoint 的位置。</span></span><br><span class="line">  <span class="comment"># while &#x27;peer chaincode&#x27; command can get the orderer endpoint from the peer (if join was successful),</span></span><br><span class="line">  <span class="comment"># lets supply it directly as we know it using the &quot;-o&quot; option</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> -o <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> = <span class="string">&quot;false&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># 在链码初始化的时候，制定背书策略。</span></span><br><span class="line">    <span class="comment"># 供反射调用</span></span><br><span class="line">    peer chaincode instantiate -o orderer.ORDERER_DOMAIN:7050 -C <span class="variable">$CHANNEL_NAME</span> -n mycc -v 1.0 -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]&#125;&#x27;</span> -P <span class="string">&quot;OR (&#x27;Org1MSP.member&#x27;,&#x27;Org2MSP.member&#x27;)&quot;</span> &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    peer chaincode instantiate -o orderer.ORDERER_DOMAIN:7050 --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> -C <span class="variable">$CHANNEL_NAME</span> -n mycc -v 1.0 -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]&#125;&#x27;</span> -P <span class="string">&quot;OR (&#x27;Org1MSP.member&#x27;,&#x27;Org2MSP.member&#x27;)&quot;</span> &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  res=$?</span><br><span class="line">  cat log.txt</span><br><span class="line">  verifyResult <span class="variable">$res</span> <span class="string">&quot;Chaincode instantiation on PEER<span class="variable">$PEER</span> on channel &#x27;<span class="variable">$CHANNEL_NAME</span>&#x27; failed&quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Chaincode Instantiation on PEER<span class="variable">$PEER</span> on channel &#x27;<span class="variable">$CHANNEL_NAME</span>&#x27; is successful ===================== &quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">chaincodeQuery</span></span> () &#123;</span><br><span class="line">  PEER=<span class="variable">$1</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Querying on PEER<span class="variable">$PEER</span> on channel &#x27;<span class="variable">$CHANNEL_NAME</span>&#x27;... ===================== &quot;</span></span><br><span class="line">  setGlobals <span class="variable">$PEER</span></span><br><span class="line">  <span class="built_in">local</span> rc=1</span><br><span class="line">  <span class="built_in">local</span> starttime=$(date +%s)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># continue to poll</span></span><br><span class="line">  <span class="comment"># we either get a successful response, or reach TIMEOUT</span></span><br><span class="line">  <span class="keyword">while</span> <span class="built_in">test</span> <span class="string">&quot;<span class="subst">$(($(date +%s)</span>-starttime))&quot;</span> -lt <span class="string">&quot;<span class="variable">$TIMEOUT</span>&quot;</span> -a <span class="variable">$rc</span> -ne 0</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">     sleep <span class="variable">$DELAY</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;Attempting to Query PEER<span class="variable">$PEER</span> ...<span class="subst">$(($(date +%s)</span>-starttime)) secs&quot;</span></span><br><span class="line">     peer chaincode query -C <span class="variable">$CHANNEL_NAME</span> -n mycc -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]&#125;&#x27;</span> &gt;&amp;log.txt</span><br><span class="line">     <span class="built_in">test</span> $? -eq 0 &amp;&amp; VALUE=$(cat log.txt | awk <span class="string">&#x27;/Query Result/ &#123;print $NF&#125;&#x27;</span>)</span><br><span class="line">     <span class="built_in">test</span> <span class="string">&quot;<span class="variable">$VALUE</span>&quot;</span> = <span class="string">&quot;<span class="variable">$2</span>&quot;</span> &amp;&amp; <span class="built_in">let</span> rc=0</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  cat log.txt</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$rc</span> -eq 0 ; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Query on PEER<span class="variable">$PEER</span> on channel &#x27;<span class="variable">$CHANNEL_NAME</span>&#x27; is successful ===================== &quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;!!!!!!!!!!!!!!! Query result on PEER<span class="variable">$PEER</span> is INVALID !!!!!!!!!!!!!!!!&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;================== ERROR !!! FAILED to execute End-2-End Scenario ==================&quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">chaincodeInvoke</span></span> () &#123;</span><br><span class="line">  PEER=<span class="variable">$1</span></span><br><span class="line">  setGlobals <span class="variable">$PEER</span></span><br><span class="line">  <span class="comment"># while &#x27;peer chaincode&#x27; command can get the orderer endpoint from the peer (if join was successful),</span></span><br><span class="line">  <span class="comment"># lets supply it directly as we know it using the &quot;-o&quot; option</span></span><br><span class="line">  <span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> -o <span class="string">&quot;<span class="variable">$CORE_PEER_TLS_ENABLED</span>&quot;</span> = <span class="string">&quot;false&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># -c 是调用的消息的构造函数的参数。后台基本上是用反射什么的来执行调用的。</span></span><br><span class="line">    peer chaincode invoke -o orderer.ORDERER_DOMAIN:7050 -C <span class="variable">$CHANNEL_NAME</span> -n mycc -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&#x27;</span> &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    peer chaincode invoke -o orderer.ORDERER_DOMAIN:7050  --tls <span class="variable">$CORE_PEER_TLS_ENABLED</span> --cafile <span class="variable">$ORDERER_CA</span> -C <span class="variable">$CHANNEL_NAME</span> -n mycc -c <span class="string">&#x27;&#123;&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]&#125;&#x27;</span> &gt;&amp;log.txt</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  res=$?</span><br><span class="line">  cat log.txt</span><br><span class="line">  verifyResult <span class="variable">$res</span> <span class="string">&quot;Invoke execution on PEER<span class="variable">$PEER</span> failed &quot;</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;===================== Invoke transaction on PEER<span class="variable">$PEER</span> on channel &#x27;<span class="variable">$CHANNEL_NAME</span>&#x27; is successful ===================== &quot;</span></span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Create channel</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Creating channel...&quot;</span></span><br><span class="line">createChannel</span><br><span class="line"></span><br><span class="line"><span class="comment">## Join all the peers to the channel</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Having all peers join the channel...&quot;</span></span><br><span class="line">joinChannel</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set the anchor peers for each org in the channel</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Updating anchor peers for org1...&quot;</span></span><br><span class="line"><span class="comment"># 这两个函数调用，要仔细更改当前的核心环境变量为两个组织预先生成好的 anchor 节点的 endpoint。</span></span><br><span class="line">updateAnchorPeers 0</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Updating anchor peers for org2...&quot;</span></span><br><span class="line">updateAnchorPeers 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只在 peer0 和 peer2上安装合约</span></span><br><span class="line"><span class="comment">## Install chaincode on Peer0/Org1 and Peer2/Org2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Installing chaincode on org1/peer0...&quot;</span></span><br><span class="line">installChaincode 0</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Install chaincode on org2/peer2...&quot;</span></span><br><span class="line">installChaincode 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只在 peer2上初始化合约</span></span><br><span class="line"><span class="comment">#Instantiate chaincode on Peer2/Org2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Instantiating chaincode on org2/peer2...&quot;</span></span><br><span class="line">instantiateChaincode 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只在 peer0 上查询合约</span></span><br><span class="line"><span class="comment">#Query on chaincode on Peer0/Org1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Querying chaincode on org1/peer0...&quot;</span></span><br><span class="line">chaincodeQuery 0 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只在 peer0 上调用合约</span></span><br><span class="line"><span class="comment">#Invoke on chaincode on Peer0/Org1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Sending invoke transaction on org1/peer0...&quot;</span></span><br><span class="line">chaincodeInvoke 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 peer3 上追加安装合约 </span></span><br><span class="line"><span class="comment">## Install chaincode on Peer3/Org2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Installing chaincode on org2/peer3...&quot;</span></span><br><span class="line">installChaincode 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 peer3 上追加查询合约。可见追加进来的合约调用结果可以被明确查询到。</span></span><br><span class="line"><span class="comment">#Query on chaincode on Peer3/Org2, check if the result is 90</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Querying chaincode on org2/peer3...&quot;</span></span><br><span class="line">chaincodeQuery 3 90</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;========= All GOOD, BYFN execution completed =========== &quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot; _____   _   _   ____   &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;| ____| | \ | | |  _ \  &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|  _|   |  \| | | | | | &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;| |___  | |\  | | |_| | &quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;|_____| |_| \_| |____/  &quot;</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
                    </article>
                    


    <blockquote id="date-expire-notification" class="post-expired-notify">This article was last updated on <span id="date-expire-num"></span> days ago, and the information described in the article may have changed.</blockquote>
    <script>
    (function() {
        var dateUpdate = Date.parse("2019-09-09");
        var nowDate = new Date();
        var a = nowDate.getTime();
        var b = a - dateUpdate;
        var daysUpdateExpire = Math.floor(b/(24*3600*1000));
        if (daysUpdateExpire >= 120) {
            document.getElementById('date-expire-num').innerHTML = daysUpdateExpire;
        } else {
            document.getElementById('date-expire-notification').style.display = 'none';
        }
    })();
    </script>


<p class="post-footer-info mb-0 pt-0">Published at&nbsp;<time datetime="2018-03-15T06:38:14.000Z" itemprop="datePublished">2018-03-15</time>

    , Updated at&nbsp;<time datetime="2019-09-09T13:35:42.000Z" itemprop="dateModified">2019-09-09</time>

</p>
<p class="post-footer-info mb-0 pt-2">



<span class="post-tags-list mt-2">

<a class="post-tags-list-item" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag">#&nbsp;区块链</a>

<a class="post-tags-list-item" href="/tags/Hyperledger-Fabric/" rel="tag">#&nbsp;Hyperledger Fabric</a>

</span>


</p>

                </div>
                <div class="post-nav px-2 bg-gray">
<ul class="pagination">
    <!-- Prev Nav -->
    
        <li class="page-item page-prev">
            <a href="/2018/03/15/Hyperledger-Fabric-MSP-%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/" rel="prev">
                <div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">Hyperledger Fabric MSP 相关问题</div>
            </a>
        </li>
    

    <!-- Next Nav -->
    
        <li class="page-item page-next">
            <a href="/2018/03/13/X-509%E8%AF%81%E4%B9%A6%E9%97%AE%E9%A2%98/" rel="next">
                <div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div>
                <div class="page-item-subtitle">X.509证书问题</div>
            </a>
        </li>
    
</ul>
</div>

                
                    <!-- # Comment # -->
                    
                
            </div>
        </div>
    </div>
</div>

            <!-- ### Footer ### -->
            <footer class="text-center">
    <!-- footer copyright -->
    
        <p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span>
            <a class="footer-copyright-a" href="http://magicliang.github.io">守株阁</a>
        </p>

    <!-- footer custom text -->
    <p class="footer-text mb-0">
    
    </p>
    <!-- footer develop info -->
    <p class="footer-develop mb-0">
        
    <!-- Busuanzi User Views -->
    <span id="busuanzi_container_site_uv" hidden>
        <span></span>
        <span id="busuanzi_value_site_uv"></span>
        <span>Viewers</span>
        
            <span>|</span>
        
    </span>




        
        Powered by&nbsp;<!--
         --><a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<!--
         --><a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a>
    </p>
</footer>


        <!-- ### Import File ### -->
        <!-- ### Footer JS Import ### -->

<script>

    
window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 50
};
document.getElementById('copyright-year').textContent = new Date().getFullYear();
console.log('\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n', 'color: #fff; background: #444; padding:5px 0;', 'background: #bbb; padding:5px 0;');

</script>

<script src="/lib/vanilla-lazyload/lazyload.min.js" async></script>
    <script src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.js" async></script>


<!-- Offset -->




<!-- Comment -->


<!-- ### Custom Footer ### -->

    </body>

</html>