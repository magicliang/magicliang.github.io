<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ä¸å¸¸è§çš„ Java é›†åˆç±»çš„ç”¨æ³• | å®ˆæ ªé˜</title><meta name="author" content="magicliang"><meta name="copyright" content="magicliang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ ArrayListã€HashMapã€HashSet ç­‰å¸¸è§é›†åˆç±»ã€‚ä½† Java é›†åˆæ¡†æ¶ä¸­è¿˜éšè—ç€è®¸å¤šä¸å¸¸è§ä½†åŠŸèƒ½å¼ºå¤§çš„é›†åˆç±»ï¼Œå®ƒä»¬åœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½æä¾›æ›´ä¼˜é›…ã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚ æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¿™äº›ä¸å¸¸è§é›†åˆç±»çš„ç”¨æ³•ã€åº•å±‚åŸç†å’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ æ„å»ºæ›´å®Œæ•´çš„é›†åˆä½¿ç”¨æ€ç»´æ¨¡å¼ã€‚ Sorted é›†åˆ Sorted é›†åˆåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç»´æŠ¤å…ƒç´ çš„æ’åºçŠ¶æ€ã€‚ä¸»è¦å®ç°ç±»æ˜¯">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸å¸¸è§çš„ Java é›†åˆç±»çš„ç”¨æ³•">
<meta property="og:url" content="https://magicliang.github.io/2018/01/04/%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84-Java-%E9%9B%86%E5%90%88%E7%B1%BB%E7%9A%84%E7%94%A8%E6%B3%95/index.html">
<meta property="og:site_name" content="å®ˆæ ªé˜">
<meta property="og:description" content="åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ ArrayListã€HashMapã€HashSet ç­‰å¸¸è§é›†åˆç±»ã€‚ä½† Java é›†åˆæ¡†æ¶ä¸­è¿˜éšè—ç€è®¸å¤šä¸å¸¸è§ä½†åŠŸèƒ½å¼ºå¤§çš„é›†åˆç±»ï¼Œå®ƒä»¬åœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½æä¾›æ›´ä¼˜é›…ã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚ æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¿™äº›ä¸å¸¸è§é›†åˆç±»çš„ç”¨æ³•ã€åº•å±‚åŸç†å’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ æ„å»ºæ›´å®Œæ•´çš„é›†åˆä½¿ç”¨æ€ç»´æ¨¡å¼ã€‚ Sorted é›†åˆ Sorted é›†åˆåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç»´æŠ¤å…ƒç´ çš„æ’åºçŠ¶æ€ã€‚ä¸»è¦å®ç°ç±»æ˜¯">
<meta property="og:locale">
<meta property="og:image" content="https://magicliang.github.io/img/wall-paper-179.jpeg">
<meta property="article:published_time" content="2018-01-04T14:20:35.000Z">
<meta property="article:modified_time" content="2026-02-07T08:48:04.956Z">
<meta property="article:author" content="magicliang">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://magicliang.github.io/img/wall-paper-179.jpeg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ä¸å¸¸è§çš„ Java é›†åˆç±»çš„ç”¨æ³•",
  "url": "https://magicliang.github.io/2018/01/04/%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84-Java-%E9%9B%86%E5%90%88%E7%B1%BB%E7%9A%84%E7%94%A8%E6%B3%95/",
  "image": "https://magicliang.github.io/img/wall-paper-179.jpeg",
  "datePublished": "2018-01-04T14:20:35.000Z",
  "dateModified": "2026-02-07T08:48:04.956Z",
  "author": [
    {
      "@type": "Person",
      "name": "magicliang",
      "url": "https://magicliang.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://magicliang.github.io/2018/01/04/%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84-Java-%E9%9B%86%E5%90%88%E7%B1%BB%E7%9A%84%E7%94%A8%E6%B3%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: magicliang","link":"Link: ","source":"Source: å®ˆæ ªé˜","info":"Copyright belongs to the author. For commercial use, please contact the author for authorization. For non-commercial use, please indicate the source."}},
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ä¸å¸¸è§çš„ Java é›†åˆç±»çš„ç”¨æ³•',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="å®ˆæ ªé˜" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/wall-paper-179.jpeg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å®ˆæ ªé˜</span></a><a class="nav-page-title" href="/"><span class="site-name">ä¸å¸¸è§çš„ Java é›†åˆç±»çš„ç”¨æ³•</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">ä¸å¸¸è§çš„ Java é›†åˆç±»çš„ç”¨æ³•</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-01-04T14:20:35.000Z" title="Created 2018-01-04 22:20:35">2018-01-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-07T08:48:04.956Z" title="Updated 2026-02-07 16:48:04">2026-02-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">4.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>21mins</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ ArrayListã€HashMapã€HashSet ç­‰å¸¸è§é›†åˆç±»ã€‚ä½† Java é›†åˆæ¡†æ¶ä¸­è¿˜éšè—ç€è®¸å¤šä¸å¸¸è§ä½†åŠŸèƒ½å¼ºå¤§çš„é›†åˆç±»ï¼Œå®ƒä»¬åœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½æä¾›æ›´ä¼˜é›…ã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»è¿™äº›ä¸å¸¸è§é›†åˆç±»çš„ç”¨æ³•ã€åº•å±‚åŸç†å’Œå®é™…åº”ç”¨åœºæ™¯ï¼Œå¸®åŠ©ä½ æ„å»ºæ›´å®Œæ•´çš„é›†åˆä½¿ç”¨æ€ç»´æ¨¡å¼ã€‚</p>
<h2 id="sorted-é›†åˆ">Sorted é›†åˆ</h2>
<p>Sorted é›†åˆåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç»´æŠ¤å…ƒç´ çš„æ’åºçŠ¶æ€ã€‚ä¸»è¦å®ç°ç±»æ˜¯ TreeSet å’Œ TreeMapï¼Œå®ƒä»¬åˆ†åˆ«å®ç°äº† SortedSet å’Œ SortedMap æ¥å£ã€‚</p>
<h3 id="æ ¸å¿ƒç‰¹æ€§">æ ¸å¿ƒç‰¹æ€§</h3>
<ul>
<li><strong>è‡ªåŠ¨æ’åº</strong>ï¼šå…ƒç´ æŒ‰ç…§è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰ Comparator æ’åº</li>
<li><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šæä¾›é«˜æ•ˆçš„å­é›†/å­æ˜ å°„è·å–æ–¹æ³•</li>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šåŸºæœ¬æ“ä½œï¼ˆæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ï¼‰ä¸º O(log n)</li>
</ul>
<h3 id="å…³é”®æ–¹æ³•">å…³é”®æ–¹æ³•</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">SortedSet&lt;String&gt; sortedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>&lt;&gt;();<br><br><span class="hljs-comment">// æ·»åŠ å…ƒç´ </span><br>sortedSet.add(<span class="hljs-string">&quot;Apple&quot;</span>);<br>sortedSet.add(<span class="hljs-string">&quot;Banana&quot;</span>);<br>sortedSet.add(<span class="hljs-string">&quot;Cherry&quot;</span>);<br>sortedSet.add(<span class="hljs-string">&quot;Date&quot;</span>);<br><br><span class="hljs-comment">// è·å–é¦–å°¾å…ƒç´ </span><br><span class="hljs-type">String</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> sortedSet.first();   <span class="hljs-comment">// &quot;Apple&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> sortedSet.last();     <span class="hljs-comment">// &quot;Date&quot;</span><br><br><span class="hljs-comment">// è·å–å­é›†ï¼ˆå‰åŒ…åä¸åŒ…ï¼‰</span><br>SortedSet&lt;String&gt; headSet = sortedSet.headSet(<span class="hljs-string">&quot;Cherry&quot;</span>);  <span class="hljs-comment">// [Apple, Banana]</span><br>SortedSet&lt;String&gt; tailSet = sortedSet.tailSet(<span class="hljs-string">&quot;Banana&quot;</span>);  <span class="hljs-comment">// [Banana, Cherry, Date]</span><br>SortedSet&lt;String&gt; subSet = sortedSet.subSet(<span class="hljs-string">&quot;Banana&quot;</span>, <span class="hljs-string">&quot;Date&quot;</span>); <span class="hljs-comment">// [Banana, Cherry]</span><br></code></pre></td></tr></table></figure>
<h3 id="è‡ªç„¶æ’åº-vs-comparator">è‡ªç„¶æ’åº vs Comparator</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è‡ªç„¶æ’åºï¼ˆå…ƒç´ å®ç° Comparableï¼‰</span><br>SortedSet&lt;Integer&gt; naturalOrder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>&lt;&gt;();<br>naturalOrder.add(<span class="hljs-number">3</span>);<br>naturalOrder.add(<span class="hljs-number">1</span>);<br>naturalOrder.add(<span class="hljs-number">2</span>);<br>System.out.println(naturalOrder); <span class="hljs-comment">// [1, 2, 3]</span><br><br><span class="hljs-comment">// è‡ªå®šä¹‰æ’åºï¼ˆé™åºï¼‰</span><br>SortedSet&lt;Integer&gt; customOrder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>&lt;&gt;(Comparator.reverseOrder());<br>customOrder.add(<span class="hljs-number">3</span>);<br>customOrder.add(<span class="hljs-number">1</span>);<br>customOrder.add(<span class="hljs-number">2</span>);<br>System.out.println(customOrder); <span class="hljs-comment">// [3, 2, 1]</span><br></code></pre></td></tr></table></figure>
<h3 id="treemap-ç¤ºä¾‹">TreeMap ç¤ºä¾‹</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">SortedMap&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>);<br>map.put(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">30</span>);<br>map.put(<span class="hljs-string">&quot;Charlie&quot;</span>, <span class="hljs-number">28</span>);<br><br><span class="hljs-comment">// è·å–é”®çš„èŒƒå›´</span><br>SortedMap&lt;String, Integer&gt; headMap = map.headMap(<span class="hljs-string">&quot;Charlie&quot;</span>);<br>System.out.println(headMap); <span class="hljs-comment">// &#123;Alice=25, Bob=30&#125;</span><br><br><span class="hljs-type">String</span> <span class="hljs-variable">firstKey</span> <span class="hljs-operator">=</span> map.firstKey();   <span class="hljs-comment">// &quot;Alice&quot;</span><br><span class="hljs-type">String</span> <span class="hljs-variable">lastKey</span> <span class="hljs-operator">=</span> map.lastKey();     <span class="hljs-comment">// &quot;Charlie&quot;</span><br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šèŒƒå›´æŸ¥è¯¢ä¼˜åŒ–</strong></p>
<p>å½“éœ€è¦é¢‘ç¹æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚&quot;æŸ¥æ‰¾æ‰€æœ‰å¤§äº X å°äº Y çš„å…ƒç´ &quot;ï¼‰æ—¶ï¼Œä½¿ç”¨ Sorted é›†åˆå¯ä»¥é¿å…å…¨è¡¨æ‰«æï¼Œé€šè¿‡çº¢é»‘æ ‘çš„ç‰¹æ€§å¿«é€Ÿå®šä½è¾¹ç•Œï¼Œæ—¶é—´å¤æ‚åº¦ä» O(n) ä¼˜åŒ–åˆ° O(log n)ã€‚</p>
<hr>
<h2 id="navigable-é›†åˆ">Navigable é›†åˆ</h2>
<p>Navigable é›†åˆç»§æ‰¿è‡ª Sorted é›†åˆï¼Œæä¾›äº†æ›´å¼ºå¤§çš„å¯¼èˆªåŠŸèƒ½ï¼Œèƒ½å¤ŸæŸ¥æ‰¾&quot;æœ€æ¥è¿‘&quot;çš„å…ƒç´ ã€‚TreeSet å’Œ TreeMap åŒæ—¶å®ç°äº† NavigableSet å’Œ NavigableMap æ¥å£ã€‚</p>
<h3 id="æ ¸å¿ƒæ–¹æ³•">æ ¸å¿ƒæ–¹æ³•</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">NavigableSet&lt;Integer&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>&lt;&gt;();<br>set.addAll(Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>));<br><br><span class="hljs-comment">// lower: ä¸¥æ ¼å°äº</span><br><span class="hljs-type">int</span> <span class="hljs-variable">lower</span> <span class="hljs-operator">=</span> set.lower(<span class="hljs-number">5</span>);    <span class="hljs-comment">// 3</span><br><br><span class="hljs-comment">// floor: å°äºç­‰äº</span><br><span class="hljs-type">int</span> <span class="hljs-variable">floor</span> <span class="hljs-operator">=</span> set.floor(<span class="hljs-number">5</span>);    <span class="hljs-comment">// 5</span><br><br><span class="hljs-comment">// ceiling: å¤§äºç­‰äº</span><br><span class="hljs-type">int</span> <span class="hljs-variable">ceiling</span> <span class="hljs-operator">=</span> set.ceiling(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5</span><br><br><span class="hljs-comment">// higher: ä¸¥æ ¼å¤§äº</span><br><span class="hljs-type">int</span> <span class="hljs-variable">higher</span> <span class="hljs-operator">=</span> set.higher(<span class="hljs-number">5</span>);  <span class="hljs-comment">// 7</span><br><br><span class="hljs-comment">// è·å–å¹¶ç§»é™¤é¦–å°¾å…ƒç´ </span><br><span class="hljs-type">int</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> set.pollFirst(); <span class="hljs-comment">// 1</span><br><span class="hljs-type">int</span> <span class="hljs-variable">last</span> <span class="hljs-operator">=</span> set.pollLast();   <span class="hljs-comment">// 9</span><br><br><span class="hljs-comment">// é™åºè§†å›¾</span><br>NavigableSet&lt;Integer&gt; descending = set.descendingSet();<br>System.out.println(descending); <span class="hljs-comment">// [7, 5, 3]</span><br></code></pre></td></tr></table></figure>
<h3 id="navigablemap-ç¤ºä¾‹">NavigableMap ç¤ºä¾‹</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">NavigableMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;Alpha&quot;</span>);<br>map.put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;Beta&quot;</span>);<br>map.put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;Gamma&quot;</span>);<br>map.put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;Delta&quot;</span>);<br><br><span class="hljs-comment">// æŸ¥æ‰¾æœ€æ¥è¿‘çš„é”®</span><br>Map.Entry&lt;String, String&gt; floorEntry = map.floorEntry(<span class="hljs-string">&quot;C1&quot;</span>); <span class="hljs-comment">// C=Gamma</span><br>Map.Entry&lt;String, String&gt; ceilingEntry = map.ceilingEntry(<span class="hljs-string">&quot;C1&quot;</span>); <span class="hljs-comment">// D=Delta</span><br><br><span class="hljs-comment">// é™åºéå†</span><br>NavigableMap&lt;String, String&gt; descendingMap = map.descendingMap();<br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šé‚»è¿‘æŸ¥æ‰¾æ¨¡å¼</strong></p>
<p>åœ¨éœ€è¦æŸ¥æ‰¾&quot;æœ€æ¥è¿‘ç›®æ ‡å€¼&quot;çš„åœºæ™¯ï¼ˆå¦‚ä»·æ ¼åŒºé—´åŒ¹é…ã€æ—¶é—´çª—å£æŸ¥æ‰¾ï¼‰æ—¶ï¼ŒNavigable é›†åˆçš„ lower/floor/ceiling/higher æ–¹æ³•æä¾›äº† O(log n) çš„ç²¾ç¡®æŸ¥æ‰¾èƒ½åŠ›ï¼Œé¿å…äº†æ‰‹åŠ¨éå†å’Œæ¯”è¾ƒã€‚</p>
<hr>
<h2 id="priority-é›†åˆ">Priority é›†åˆ</h2>
<p>PriorityQueue æ˜¯åŸºäºä¼˜å…ˆçº§å †çš„æ— ç•Œä¼˜å…ˆé˜Ÿåˆ—ï¼Œä¸ä¿è¯è¿­ä»£é¡ºåºï¼Œä½†ä¿è¯ poll() æ“ä½œè¿”å›æœ€å°å…ƒç´ ã€‚</p>
<h3 id="åº•å±‚ç»“æ„">åº•å±‚ç»“æ„</h3>
<p>PriorityQueue ä½¿ç”¨<strong>æœ€å°å †</strong>ï¼ˆäºŒå‰å †ï¼‰å®ç°ï¼š</p>
<ul>
<li>æ ¹èŠ‚ç‚¹æ˜¯æœ€å°å…ƒç´ </li>
<li>çˆ¶èŠ‚ç‚¹å°äºç­‰äºå­èŠ‚ç‚¹</li>
<li>ä½¿ç”¨æ•°ç»„å­˜å‚¨ï¼Œç´¢å¼• i çš„å·¦å­èŠ‚ç‚¹ä¸º 2i+1ï¼Œå³å­èŠ‚ç‚¹ä¸º 2i+2</li>
</ul>
<h3 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é»˜è®¤æœ€å°å †</span><br>PriorityQueue&lt;Integer&gt; minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br>minHeap.offer(<span class="hljs-number">5</span>);<br>minHeap.offer(<span class="hljs-number">1</span>);<br>minHeap.offer(<span class="hljs-number">3</span>);<br>minHeap.offer(<span class="hljs-number">2</span>);<br><br>System.out.println(minHeap.poll()); <span class="hljs-comment">// 1 (æœ€å°å…ƒç´ )</span><br>System.out.println(minHeap.poll()); <span class="hljs-comment">// 2</span><br>System.out.println(minHeap.poll()); <span class="hljs-comment">// 3</span><br><br><span class="hljs-comment">// æ³¨æ„ï¼šè¿­ä»£é¡ºåºä¸ä¿è¯æœ‰åº</span><br>System.out.println(minHeap); <span class="hljs-comment">// å¯èƒ½è¾“å‡º [2, 5, 3] ç­‰éæœ‰åºç»“æœ</span><br><br><span class="hljs-comment">// æœ€å¤§å †ï¼ˆä½¿ç”¨è‡ªå®šä¹‰ Comparatorï¼‰</span><br>PriorityQueue&lt;Integer&gt; maxHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;(Comparator.reverseOrder());<br>maxHeap.offer(<span class="hljs-number">5</span>);<br>maxHeap.offer(<span class="hljs-number">1</span>);<br>maxHeap.offer(<span class="hljs-number">3</span>);<br>System.out.println(maxHeap.poll()); <span class="hljs-comment">// 5 (æœ€å¤§å…ƒç´ )</span><br></code></pre></td></tr></table></figure>
<h3 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 id="top-k-é—®é¢˜">Top-K é—®é¢˜</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ‰¾å‡ºå‰ K å¤§çš„å…ƒç´ </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;Integer&gt; <span class="hljs-title function_">topK</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> k)</span> &#123;<br>    PriorityQueue&lt;Integer&gt; minHeap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) &#123;<br>        minHeap.offer(num);<br>        <span class="hljs-keyword">if</span> (minHeap.size() &gt; k) &#123;<br>            minHeap.poll(); <span class="hljs-comment">// ç§»é™¤æœ€å°çš„ï¼Œä¿ç•™ K ä¸ªæœ€å¤§çš„</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(minHeap);<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="ä»»åŠ¡è°ƒåº¦">ä»»åŠ¡è°ƒåº¦</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;Task&gt; &#123;<br>    String name;<br>    <span class="hljs-type">int</span> priority;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Task</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> priority)</span> &#123;<br>        <span class="hljs-built_in">this</span>.name = name;<br>        <span class="hljs-built_in">this</span>.priority = priority;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Task other)</span> &#123;<br>        <span class="hljs-keyword">return</span> Integer.compare(<span class="hljs-built_in">this</span>.priority, other.priority);<br>    &#125;<br>&#125;<br><br>PriorityQueue&lt;Task&gt; taskQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br>taskQueue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(<span class="hljs-string">&quot;Task A&quot;</span>, <span class="hljs-number">3</span>));<br>taskQueue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(<span class="hljs-string">&quot;Task B&quot;</span>, <span class="hljs-number">1</span>));<br>taskQueue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(<span class="hljs-string">&quot;Task C&quot;</span>, <span class="hljs-number">2</span>));<br><br><span class="hljs-keyword">while</span> (!taskQueue.isEmpty()) &#123;<br>    <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> taskQueue.poll();<br>    System.out.println(<span class="hljs-string">&quot;Executing: &quot;</span> + task.name + <span class="hljs-string">&quot; (priority: &quot;</span> + task.priority + <span class="hljs-string">&quot;)&quot;</span>);<br>&#125;<br><span class="hljs-comment">// è¾“å‡ºï¼šTask B (1), Task C (2), Task A (3)</span><br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šåŠ¨æ€æå€¼ç»´æŠ¤</strong></p>
<p>å½“éœ€è¦åŠ¨æ€ç»´æŠ¤é›†åˆä¸­çš„æœ€å°å€¼æˆ–æœ€å¤§å€¼ï¼Œä¸”å…ƒç´ ä¼šé¢‘ç¹æ’å…¥å’Œåˆ é™¤æ—¶ï¼Œä¼˜å…ˆçº§å †æä¾›äº† O(log n) çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œæ¯”æ¯æ¬¡é‡æ–°æ’åºçš„ O(n log n) æ›´é«˜æ•ˆã€‚é€‚ç”¨äºå®æ—¶ Top-Kã€ä»»åŠ¡è°ƒåº¦ã€äº‹ä»¶é©±åŠ¨ç­‰åœºæ™¯ã€‚</p>
<hr>
<h2 id="identity-é›†åˆ">Identity é›†åˆ</h2>
<p>IdentityHashMap æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Map å®ç°ï¼Œå®ƒä½¿ç”¨ <strong>==</strong> è€Œé <strong>equals()</strong> æ¥æ¯”è¾ƒé”®ã€‚è¿™æ„å‘³ç€åªæœ‰ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨å®Œå…¨ç›¸åŒæ—¶ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªé”®ã€‚</p>
<h3 id="ä¸-hashmap-çš„åŒºåˆ«">ä¸ HashMap çš„åŒºåˆ«</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Key</span> &#123;<br>    String value;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Key</span><span class="hljs-params">(String value)</span> &#123;<br>        <span class="hljs-built_in">this</span>.value = value;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object obj)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span> == obj) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-keyword">if</span> (!(obj <span class="hljs-keyword">instanceof</span> Key)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span> value.equals(((Key) obj).value);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> value.hashCode();<br>    &#125;<br>&#125;<br><br><span class="hljs-type">Key</span> <span class="hljs-variable">key1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Key</span>(<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-type">Key</span> <span class="hljs-variable">key2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Key</span>(<span class="hljs-string">&quot;test&quot;</span>);<br><br><span class="hljs-comment">// HashMap ä½¿ç”¨ equals() æ¯”è¾ƒ</span><br>HashMap&lt;Key, String&gt; hashMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>hashMap.put(key1, <span class="hljs-string">&quot;Value1&quot;</span>);<br>hashMap.put(key2, <span class="hljs-string">&quot;Value2&quot;</span>);<br>System.out.println(hashMap.size()); <span class="hljs-comment">// 1 (key1.equals(key2) è¿”å› true)</span><br><br><span class="hljs-comment">// IdentityHashMap ä½¿ç”¨ == æ¯”è¾ƒ</span><br>IdentityHashMap&lt;Key, String&gt; identityMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdentityHashMap</span>&lt;&gt;();<br>identityMap.put(key1, <span class="hljs-string">&quot;Value1&quot;</span>);<br>identityMap.put(key2, <span class="hljs-string">&quot;Value2&quot;</span>);<br>System.out.println(identityMap.size()); <span class="hljs-comment">// 2 (key1 != key2)</span><br></code></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3>
<h4 id="å¯¹è±¡æ‹“æ‰‘ä¿æŒ">å¯¹è±¡æ‹“æ‰‘ä¿æŒ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ·±æ‹·è´æ—¶ä¿æŒå¯¹è±¡å¼•ç”¨å…³ç³»</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepCopy</span> &#123;<br>    <span class="hljs-keyword">private</span> IdentityHashMap&lt;Object, Object&gt; copiedObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdentityHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">deepCopy</span><span class="hljs-params">(T original)</span> &#123;<br>        <span class="hljs-keyword">if</span> (original == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        <br>        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²å¤åˆ¶</span><br>        <span class="hljs-type">T</span> <span class="hljs-variable">copied</span> <span class="hljs-operator">=</span> (T) copiedObjects.get(original);<br>        <span class="hljs-keyword">if</span> (copied != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> copied; <span class="hljs-comment">// è¿”å›åŒä¸€ä¸ªå¼•ç”¨ï¼Œä¿æŒæ‹“æ‰‘ç»“æ„</span><br>        &#125;<br>        <br>        <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡å¹¶è®°å½•</span><br>        <span class="hljs-type">T</span> <span class="hljs-variable">newObject</span> <span class="hljs-operator">=</span> createInstance(original);<br>        copiedObjects.put(original, newObject);<br>        <br>        <span class="hljs-comment">// é€’å½’å¤åˆ¶å­—æ®µ</span><br>        copyFields(original, newObject);<br>        <br>        <span class="hljs-keyword">return</span> newObject;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="åºåˆ—åŒ–ä»£ç†">åºåˆ—åŒ–ä»£ç†</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é¿å…å¾ªç¯å¼•ç”¨å¯¼è‡´çš„æ ˆæº¢å‡º</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Serializer</span> &#123;<br>    <span class="hljs-keyword">private</span> IdentityHashMap&lt;Object, Integer&gt; objectIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdentityHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serialize</span><span class="hljs-params">(Object obj)</span> &#123;<br>        <span class="hljs-keyword">if</span> (objectIds.containsKey(obj)) &#123;<br>            <span class="hljs-comment">// å·²åºåˆ—åŒ–ï¼Œè¾“å‡ºå¼•ç”¨ ID</span><br>            System.out.println(<span class="hljs-string">&quot;ref:&quot;</span> + objectIds.get(obj));<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <br>        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> objectIds.size();<br>        objectIds.put(obj, id);<br>        System.out.println(<span class="hljs-string">&quot;obj:&quot;</span> + id);<br>        <br>        <span class="hljs-comment">// åºåˆ—åŒ–å­—æ®µ</span><br>        serializeFields(obj);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šå¼•ç”¨è¯­ä¹‰æ˜ å°„</strong></p>
<p>å½“éœ€è¦åŒºåˆ†&quot;å€¼ç›¸åŒ&quot;å’Œ&quot;å¼•ç”¨ç›¸åŒ&quot;çš„åœºæ™¯æ—¶ï¼ŒIdentityHashMap æä¾›äº†åŸºäºå¯¹è±¡èº«ä»½è€Œéè¯­ä¹‰ç­‰ä»·çš„æ˜ å°„èƒ½åŠ›ã€‚é€‚ç”¨äºå¯¹è±¡å›¾éå†ã€æ·±æ‹·è´ã€åºåˆ—åŒ–ç­‰éœ€è¦ä¿æŒå¯¹è±¡å¼•ç”¨å…³ç³»çš„åœºæ™¯ã€‚</p>
<hr>
<h2 id="skiplist-é›†åˆ">SkipList é›†åˆ</h2>
<p>è·³è¡¨ï¼ˆSkip Listï¼‰æ˜¯ä¸€ç§æ¦‚ç‡æ•°æ®ç»“æ„ï¼Œé€šè¿‡å¤šå±‚ç´¢å¼•å®ç°å¿«é€ŸæŸ¥æ‰¾ã€‚Java æä¾›äº†åŸºäºè·³è¡¨çš„å¹¶å‘é›†åˆï¼šConcurrentSkipListSet å’Œ ConcurrentSkipListMapã€‚</p>
<h3 id="è·³è¡¨åŸç†">è·³è¡¨åŸç†</h3>
<p>è·³è¡¨é€šè¿‡åœ¨åŸå§‹é“¾è¡¨ä¸Šå»ºç«‹å¤šå±‚ç´¢å¼•ï¼Œå®ç°ç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾çš„æ•ˆæœï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Level</span> <span class="hljs-number">2</span>:  <span class="hljs-number">1</span> -----------------&gt; <span class="hljs-number">9</span><br><span class="hljs-attribute">Level</span> <span class="hljs-number">1</span>:  <span class="hljs-number">1</span> ------&gt; <span class="hljs-number">5</span> ------&gt; <span class="hljs-number">9</span><br><span class="hljs-attribute">Level</span> <span class="hljs-number">0</span>:  <span class="hljs-number">1</span> -&gt; <span class="hljs-number">3</span> -&gt; <span class="hljs-number">5</span> -&gt; <span class="hljs-number">7</span> -&gt; <span class="hljs-number">9</span><br></code></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾ 7 çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>Level 2: 1 &lt; 7, å‰è¿›</li>
<li>Level 1: 5 &lt; 7, å‰è¿›</li>
<li>Level 0: 5 &lt; 7, å‰è¿›ï¼›7 == 7, æ‰¾åˆ°</li>
</ul>
<h3 id="concurrentskiplistset">ConcurrentSkipListSet</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">ConcurrentSkipListSet&lt;Integer&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentSkipListSet</span>&lt;&gt;();<br><br><span class="hljs-comment">// å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨æ“ä½œ</span><br><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> i;<br>    executor.submit(() -&gt; set.add(num));<br>&#125;<br><br>executor.shutdown();<br>executor.awaitTermination(<span class="hljs-number">1</span>, TimeUnit.SECONDS);<br><br>System.out.println(set.size()); <span class="hljs-comment">// 100</span><br>System.out.println(set.first()); <span class="hljs-comment">// 0</span><br>System.out.println(set.last()); <span class="hljs-comment">// 99</span><br></code></pre></td></tr></table></figure>
<h3 id="concurrentskiplistmap">ConcurrentSkipListMap</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">ConcurrentSkipListMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentSkipListMap</span>&lt;&gt;();<br><br>map.put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;Alpha&quot;</span>);<br>map.put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;Beta&quot;</span>);<br>map.put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-string">&quot;Gamma&quot;</span>);<br><br><span class="hljs-comment">// å¹¶å‘å®‰å…¨çš„æ“ä½œ</span><br><span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> map.get(<span class="hljs-string">&quot;B&quot;</span>);<br>Map.Entry&lt;String, String&gt; floorEntry = map.floorEntry(<span class="hljs-string">&quot;B1&quot;</span>);<br></code></pre></td></tr></table></figure>
<h3 id="ä¸-treemap-çš„å¯¹æ¯”">ä¸ TreeMap çš„å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>TreeMap/TreeSet</th>
<th>ConcurrentSkipListMap/ConcurrentSkipListSet</th>
</tr>
</thead>
<tbody>
<tr>
<td>çº¿ç¨‹å®‰å…¨</td>
<td>å¦</td>
<td>æ˜¯</td>
</tr>
<tr>
<td>å¹¶å‘æ€§èƒ½</td>
<td>éœ€è¦å¤–éƒ¨åŒæ­¥</td>
<td>æ— é”å¹¶å‘</td>
</tr>
<tr>
<td>åº•å±‚ç»“æ„</td>
<td>çº¢é»‘æ ‘</td>
<td>è·³è¡¨</td>
</tr>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(log n)</td>
<td>O(log n)</td>
</tr>
</tbody>
</table>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šå¹¶å‘æœ‰åºé›†åˆ</strong></p>
<p>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹éœ€è¦æœ‰åºé›†åˆæ—¶ï¼ŒConcurrentSkipListSet/Map æä¾›äº†æ— é”çš„å¹¶å‘è®¿é—®èƒ½åŠ›ï¼Œé¿å…äº† TreeMap åœ¨å¹¶å‘åœºæ™¯ä¸‹çš„åŒæ­¥å¼€é”€ã€‚é€‚ç”¨äºé«˜å¹¶å‘çš„æ’è¡Œæ¦œã€å®æ—¶ç»Ÿè®¡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰åœºæ™¯ã€‚</p>
<hr>
<h2 id="delayqueue">DelayQueue</h2>
<p>DelayQueue æ˜¯ä¸€ä¸ªæ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œåªæœ‰å½“å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´åˆ°æœŸæ—¶æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–ã€‚å…ƒç´ å¿…é¡»å®ç° Delayed æ¥å£ã€‚</p>
<h3 id="delayed-æ¥å£">Delayed æ¥å£</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Delayed</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&lt;Delayed&gt; &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿”å›å‰©ä½™å»¶è¿Ÿæ—¶é—´ï¼ˆçº³ç§’ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">long</span> <span class="hljs-title function_">getDelay</span><span class="hljs-params">(TimeUnit unit)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DelayedElement</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Delayed</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> delayTime; <span class="hljs-comment">// åˆ°æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br>    <span class="hljs-keyword">private</span> String data;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DelayedElement</span><span class="hljs-params">(<span class="hljs-type">long</span> delay, String data)</span> &#123;<br>        <span class="hljs-built_in">this</span>.delayTime = System.currentTimeMillis() + delay;<br>        <span class="hljs-built_in">this</span>.data = data;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDelay</span><span class="hljs-params">(TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> delayTime - System.currentTimeMillis();<br>        <span class="hljs-keyword">return</span> unit.convert(diff, TimeUnit.MILLISECONDS);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Delayed other)</span> &#123;<br>        <span class="hljs-keyword">return</span> Long.compare(<span class="hljs-built_in">this</span>.delayTime, ((DelayedElement) other).delayTime);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> data;<br>    &#125;<br>&#125;<br><br>DelayQueue&lt;DelayedElement&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayQueue</span>&lt;&gt;();<br>queue.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedElement</span>(<span class="hljs-number">3000</span>, <span class="hljs-string">&quot;Task 1&quot;</span>)); <span class="hljs-comment">// 3ç§’ååˆ°æœŸ</span><br>queue.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedElement</span>(<span class="hljs-number">1000</span>, <span class="hljs-string">&quot;Task 2&quot;</span>)); <span class="hljs-comment">// 1ç§’ååˆ°æœŸ</span><br>queue.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedElement</span>(<span class="hljs-number">2000</span>, <span class="hljs-string">&quot;Task 3&quot;</span>)); <span class="hljs-comment">// 2ç§’ååˆ°æœŸ</span><br><br><span class="hljs-comment">// take() ä¼šé˜»å¡ç›´åˆ°æœ‰å…ƒç´ åˆ°æœŸ</span><br><span class="hljs-keyword">while</span> (!queue.isEmpty()) &#123;<br>    <span class="hljs-type">DelayedElement</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> queue.take();<br>    System.out.println(<span class="hljs-string">&quot;Processed: &quot;</span> + element + <span class="hljs-string">&quot; at &quot;</span> + System.currentTimeMillis());<br>&#125;<br><span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼šTask 2 (1ç§’å), Task 3 (2ç§’å), Task 1 (3ç§’å)</span><br></code></pre></td></tr></table></figure>
<h3 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 id="ç¼“å­˜è¿‡æœŸ">ç¼“å­˜è¿‡æœŸ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Delayed</span> &#123;<br>    <span class="hljs-keyword">private</span> String key;<br>    <span class="hljs-keyword">private</span> Object value;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> expireTime;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheEntry</span><span class="hljs-params">(String key, Object value, <span class="hljs-type">long</span> ttl)</span> &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>        <span class="hljs-built_in">this</span>.value = value;<br>        <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + ttl;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDelay</span><span class="hljs-params">(TimeUnit unit)</span> &#123;<br>        <span class="hljs-keyword">return</span> unit.convert(expireTime - System.currentTimeMillis(), TimeUnit.MILLISECONDS);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Delayed other)</span> &#123;<br>        <span class="hljs-keyword">return</span> Long.compare(<span class="hljs-built_in">this</span>.expireTime, ((CacheEntry) other).expireTime);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExpiringCache</span> &#123;<br>    <span class="hljs-keyword">private</span> DelayQueue&lt;CacheEntry&gt; expireQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayQueue</span>&lt;&gt;();<br>    <span class="hljs-keyword">private</span> Map&lt;String, CacheEntry&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, Object value, <span class="hljs-type">long</span> ttl)</span> &#123;<br>        <span class="hljs-type">CacheEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntry</span>(key, value, ttl);<br>        cache.put(key, entry);<br>        expireQueue.put(entry);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-type">CacheEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> cache.get(key);<br>        <span class="hljs-keyword">return</span> entry != <span class="hljs-literal">null</span> ? entry.value : <span class="hljs-literal">null</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// åå°çº¿ç¨‹æ¸…ç†è¿‡æœŸæ¡ç›®</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startCleanup</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">CacheEntry</span> <span class="hljs-variable">expired</span> <span class="hljs-operator">=</span> expireQueue.take();<br>                    cache.remove(expired.key);<br>                    System.out.println(<span class="hljs-string">&quot;Expired: &quot;</span> + expired.key);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>        &#125;).start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="è®¢å•è¶…æ—¶å–æ¶ˆ">è®¢å•è¶…æ—¶å–æ¶ˆ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Delayed</span> &#123;<br>    <span class="hljs-keyword">private</span> String orderId;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> createTime;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timeout; <span class="hljs-comment">// è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Order</span><span class="hljs-params">(String orderId, <span class="hljs-type">long</span> timeout)</span> &#123;<br>        <span class="hljs-built_in">this</span>.orderId = orderId;<br>        <span class="hljs-built_in">this</span>.createTime = System.currentTimeMillis();<br>        <span class="hljs-built_in">this</span>.timeout = timeout;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getDelay</span><span class="hljs-params">(TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> (createTime + timeout) - System.currentTimeMillis();<br>        <span class="hljs-keyword">return</span> unit.convert(remaining, TimeUnit.MILLISECONDS);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Delayed other)</span> &#123;<br>        <span class="hljs-keyword">return</span> Long.compare(<br>            <span class="hljs-built_in">this</span>.createTime + <span class="hljs-built_in">this</span>.timeout,<br>            ((Order) other).createTime + ((Order) other).timeout<br>        );<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Order cancelled: &quot;</span> + orderId);<br>        <span class="hljs-comment">// å–æ¶ˆè®¢å•é€»è¾‘</span><br>    &#125;<br>&#125;<br><br>DelayQueue&lt;Order&gt; orderQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayQueue</span>&lt;&gt;();<br><br><span class="hljs-comment">// åˆ›å»ºè®¢å•ï¼Œ30åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆ</span><br><span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(<span class="hljs-string">&quot;ORD-001&quot;</span>, <span class="hljs-number">30</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>);<br>orderQueue.put(order);<br><br><span class="hljs-comment">// åå°çº¿ç¨‹å¤„ç†è¶…æ—¶è®¢å•</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Order</span> <span class="hljs-variable">expiredOrder</span> <span class="hljs-operator">=</span> orderQueue.take();<br>            expiredOrder.cancel();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;).start();<br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šæ—¶é—´é©±åŠ¨çš„ä»»åŠ¡è°ƒåº¦</strong></p>
<p>å½“éœ€è¦åœ¨æŒ‡å®šæ—¶é—´ç‚¹æ‰§è¡Œä»»åŠ¡æ—¶ï¼ŒDelayQueue æä¾›äº†åŸºäºä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œé¿å…äº†å®šæ—¶è½®è¯¢çš„æ€§èƒ½å¼€é”€ã€‚é€‚ç”¨äºç¼“å­˜è¿‡æœŸã€è®¢å•è¶…æ—¶ã€å®šæ—¶ä»»åŠ¡ç­‰æ—¶é—´æ•æ„Ÿåœºæ™¯ã€‚</p>
<hr>
<h2 id="enumset-å’Œ-enummap">EnumSet å’Œ EnumMap</h2>
<p>EnumSet å’Œ EnumMap æ˜¯ä¸“ä¸ºæšä¸¾ç±»å‹è®¾è®¡çš„é«˜æ€§èƒ½é›†åˆï¼Œåˆ©ç”¨æšä¸¾çš„ç‰¹æ€§å®ç°äº†æè‡´çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p>
<h3 id="enumset">EnumSet</h3>
<p>EnumSet ä½¿ç”¨ä½å‘é‡ï¼ˆBit Vectorï¼‰å­˜å‚¨ï¼Œç©ºé—´å’Œæ—¶é—´æ•ˆç‡æé«˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Day</span> &#123;<br>    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY<br>&#125;<br><br><span class="hljs-comment">// åˆ›å»º EnumSet</span><br>EnumSet&lt;Day&gt; weekdays = EnumSet.of(Day.MONDAY, Day.TUESDAY, Day.WEDNESDAY, <br>                                   Day.THURSDAY, Day.FRIDAY);<br>EnumSet&lt;Day&gt; weekend = EnumSet.of(Day.SATURDAY, Day.SUNDAY);<br><br><span class="hljs-comment">// èŒƒå›´åˆ›å»º</span><br>EnumSet&lt;Day&gt; allDays = EnumSet.allOf(Day.class);<br>EnumSet&lt;Day&gt; noDays = EnumSet.noneOf(Day.class);<br><br><span class="hljs-comment">// è¡¥é›†æ“ä½œ</span><br>EnumSet&lt;Day&gt; complement = EnumSet.complementOf(weekdays); <span class="hljs-comment">// weekend</span><br><br><span class="hljs-comment">// é›†åˆæ“ä½œ</span><br>EnumSet&lt;Day&gt; workDays = EnumSet.range(Day.MONDAY, Day.FRIDAY);<br>workDays.add(Day.SATURDAY); <span class="hljs-comment">// false (å·²æ»¡)</span><br>workDays.remove(Day.SUNDAY); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>
<h3 id="enummap">EnumMap</h3>
<p>EnumMap ä½¿ç”¨æ•°ç»„å­˜å‚¨ï¼Œé”®å¿…é¡»æ˜¯æšä¸¾ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Operation</span> &#123;<br>    ADD, SUBTRACT, MULTIPLY, DIVIDE<br>&#125;<br><br>EnumMap&lt;Operation, String&gt; descriptions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EnumMap</span>&lt;&gt;(Operation.class);<br>descriptions.put(Operation.ADD, <span class="hljs-string">&quot;åŠ æ³•&quot;</span>);<br>descriptions.put(Operation.SUBTRACT, <span class="hljs-string">&quot;å‡æ³•&quot;</span>);<br>descriptions.put(Operation.MULTIPLY, <span class="hljs-string">&quot;ä¹˜æ³•&quot;</span>);<br>descriptions.put(Operation.DIVIDE, <span class="hljs-string">&quot;é™¤æ³•&quot;</span>);<br><br><span class="hljs-comment">// éå†ï¼ˆä¿è¯æŒ‰æšä¸¾å£°æ˜é¡ºåºï¼‰</span><br><span class="hljs-keyword">for</span> (Map.Entry&lt;Operation, String&gt; entry : descriptions.entrySet()) &#123;<br>    System.out.println(entry.getKey() + <span class="hljs-string">&quot;: &quot;</span> + entry.getValue());<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="æ€§èƒ½ä¼˜åŠ¿">æ€§èƒ½ä¼˜åŠ¿</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// EnumSet vs HashSet</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> &#123; RED, GREEN, BLUE, YELLOW &#125;<br><br><span class="hljs-comment">// EnumSet: ä½¿ç”¨å•ä¸ª long å€¼å­˜å‚¨ï¼ˆ64ä½å¯å­˜å‚¨64ä¸ªæšä¸¾ï¼‰</span><br>EnumSet&lt;Color&gt; enumSet = EnumSet.of(Color.RED, Color.GREEN);<br><span class="hljs-comment">// å†…éƒ¨ç»“æ„ï¼šlong = 0b0011 (ä½å‘é‡)</span><br><br><span class="hljs-comment">// HashSet: ä½¿ç”¨æ•°ç»„+é“¾è¡¨å­˜å‚¨</span><br>HashSet&lt;Color&gt; hashSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>hashSet.add(Color.RED);<br>hashSet.add(Color.GREEN);<br><span class="hljs-comment">// å†…éƒ¨ç»“æ„ï¼šNode[] æ•°ç»„ + é“¾è¡¨èŠ‚ç‚¹</span><br><br><span class="hljs-comment">// æ€§èƒ½æµ‹è¯•</span><br>EnumSet&lt;Color&gt; es = EnumSet.allOf(Color.class);<br>HashSet&lt;Color&gt; hs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(Color.values()));<br><br><span class="hljs-comment">// EnumSet çš„ contains æ“ä½œï¼šä½è¿ç®— O(1)</span><br><span class="hljs-comment">// HashSet çš„ contains æ“ä½œï¼šå“ˆå¸Œè®¡ç®— + é“¾è¡¨éå† O(1) å¹³å‡</span><br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šæšä¸¾ä¸“ç”¨é›†åˆ</strong></p>
<p>å½“é›†åˆå…ƒç´ ç±»å‹æ˜¯æšä¸¾æ—¶ï¼ŒEnumSet/EnumMap æä¾›äº†æ¯”é€šç”¨é›†åˆæ›´å¥½çš„æ€§èƒ½å’Œæ›´ç´§å‡‘çš„å†…å­˜å ç”¨ã€‚é€‚ç”¨äºæ ‡å¿—ä½é›†åˆã€çŠ¶æ€æœºã€é…ç½®ç®¡ç†ç­‰åœºæ™¯ã€‚</p>
<hr>
<h2 id="weakhashmap">WeakHashMap</h2>
<p>WeakHashMap æ˜¯ä¸€ä¸ªä½¿ç”¨å¼±å¼•ç”¨ä½œä¸ºé”®çš„ HashMapã€‚å½“é”®ä¸å†è¢«å¤–éƒ¨å¼•ç”¨æ—¶ï¼Œå®ƒå¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œå¯¹åº”çš„é”®å€¼å¯¹ä¹Ÿä¼šè‡ªåŠ¨ä» Map ä¸­ç§»é™¤ã€‚</p>
<h3 id="å¼±å¼•ç”¨æœºåˆ¶">å¼±å¼•ç”¨æœºåˆ¶</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ™®é€š HashMapï¼šé”®è¢«å¼ºå¼•ç”¨</span><br>HashMap&lt;String, String&gt; strongMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;test&quot;</span>);<br>strongMap.put(key, <span class="hljs-string">&quot;value&quot;</span>);<br>key = <span class="hljs-literal">null</span>; <span class="hljs-comment">// key ä»è¢« Map å¼•ç”¨ï¼Œä¸ä¼šè¢« GC</span><br><br><span class="hljs-comment">// WeakHashMapï¼šé”®è¢«å¼±å¼•ç”¨</span><br>WeakHashMap&lt;String, String&gt; weakMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakHashMap</span>&lt;&gt;();<br>key = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;test&quot;</span>);<br>weakMap.put(key, <span class="hljs-string">&quot;value&quot;</span>);<br>key = <span class="hljs-literal">null</span>; <span class="hljs-comment">// key ä¸å†è¢«å¼ºå¼•ç”¨ï¼ŒGC æ—¶ä¼šè¢«å›æ”¶</span><br><br>System.gc(); <span class="hljs-comment">// è§¦å‘ GC</span><br>System.out.println(weakMap.size()); <span class="hljs-comment">// å¯èƒ½è¾“å‡º 0</span><br></code></pre></td></tr></table></figure>
<h3 id="å®é™…åº”ç”¨åœºæ™¯">å®é™…åº”ç”¨åœºæ™¯</h3>
<h4 id="ç¼“å­˜å®ç°">ç¼“å­˜å®ç°</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WeakCache</span>&lt;K, V&gt; &#123;<br>    <span class="hljs-keyword">private</span> WeakHashMap&lt;K, V&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakHashMap</span>&lt;&gt;();<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;<br>        cache.put(key, value);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> &#123;<br>        <span class="hljs-keyword">return</span> cache.get(key);<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> cache.size();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨åœºæ™¯ï¼šç¼“å­˜å¤§å¯¹è±¡ï¼Œå½“å†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨é‡Šæ”¾</span><br>WeakCache&lt;String, <span class="hljs-type">byte</span>[]&gt; imageCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakCache</span>&lt;&gt;();<br>imageCache.put(<span class="hljs-string">&quot;image1&quot;</span>, loadLargeImage(<span class="hljs-string">&quot;image1.jpg&quot;</span>));<br><span class="hljs-comment">// å½“å†…å­˜ç´§å¼ æ—¶ï¼Œè¿™äº›å¤§å¯¹è±¡ä¼šè¢«è‡ªåŠ¨å›æ”¶</span><br></code></pre></td></tr></table></figure>
<h4 id="å¯¹è±¡å…ƒæ•°æ®å…³è”">å¯¹è±¡å…ƒæ•°æ®å…³è”</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸ºå¯¹è±¡é™„åŠ å…ƒæ•°æ®ï¼Œä¸é˜»æ­¢å¯¹è±¡è¢«å›æ”¶</span><br>WeakHashMap&lt;Object, Map&lt;String, Object&gt;&gt; metadataMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakHashMap</span>&lt;&gt;();<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachMetadata</span><span class="hljs-params">(Object obj, String key, Object value)</span> &#123;<br>    metadataMap.computeIfAbsent(obj, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;()).put(key, value);<br>&#125;<br><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getMetadata</span><span class="hljs-params">(Object obj, String key)</span> &#123;<br>    Map&lt;String, Object&gt; metadata = metadataMap.get(obj);<br>    <span class="hljs-keyword">return</span> metadata != <span class="hljs-literal">null</span> ? metadata.get(key) : <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-comment">// å½“ obj ä¸å†è¢«ä½¿ç”¨æ—¶ï¼Œå…¶å…ƒæ•°æ®ä¹Ÿä¼šè‡ªåŠ¨æ¸…ç†</span><br></code></pre></td></tr></table></figure>
<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡ä½œä¸ºé”®</span><br>WeakHashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakHashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>); <span class="hljs-comment">// &quot;test&quot; æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œä¸ä¼šè¢« GC</span><br>System.gc();<br>System.out.println(map.size()); <span class="hljs-comment">// ä»ç„¶æ˜¯ 1</span><br><br><span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ï¼šä½¿ç”¨æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸ºé”®</span><br>map.put(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">&quot;test&quot;</span>), <span class="hljs-string">&quot;value&quot;</span>);<br>System.gc();<br>System.out.println(map.size()); <span class="hljs-comment">// å¯èƒ½æ˜¯ 0</span><br></code></pre></td></tr></table></figure>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šè‡ªåŠ¨æ¸…ç†ç¼“å­˜</strong></p>
<p>å½“éœ€è¦ç¼“å­˜æ•°æ®ä½†ä¸å¸Œæœ›ç¼“å­˜é˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼ŒWeakHashMap æä¾›äº†è‡ªåŠ¨æ¸…ç†æœºåˆ¶ã€‚é€‚ç”¨äºå¯¹è±¡å…ƒæ•°æ®ã€ä¸´æ—¶ç¼“å­˜ã€ç›‘å¬å™¨æ³¨å†Œç­‰åœºæ™¯ã€‚</p>
<hr>
<h2 id="linkedhashmap-å’Œ-linkedhashset">LinkedHashMap å’Œ LinkedHashSet</h2>
<p>LinkedHashMap å’Œ LinkedHashSet åœ¨ HashMap/HashSet çš„åŸºç¡€ä¸Šå¢åŠ äº†<strong>é¡ºåºä¿æŒ</strong>åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºéå†å…ƒç´ ã€‚</p>
<h3 id="ä¿æŒæ’å…¥é¡ºåº">ä¿æŒæ’å…¥é¡ºåº</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// LinkedHashMap é»˜è®¤æŒ‰æ’å…¥é¡ºåºéå†</span><br>LinkedHashMap&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">1</span>);<br>map.put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">2</span>);<br>map.put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">3</span>);<br><br><span class="hljs-comment">// éå†é¡ºåºï¼šA -&gt; B -&gt; C</span><br><span class="hljs-keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : map.entrySet()) &#123;<br>    System.out.println(entry.getKey() + <span class="hljs-string">&quot;: &quot;</span> + entry.getValue());<br>&#125;<br><br><span class="hljs-comment">// LinkedHashSet åŒç†</span><br>LinkedHashSet&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;&gt;();<br>set.add(<span class="hljs-string">&quot;A&quot;</span>);<br>set.add(<span class="hljs-string">&quot;B&quot;</span>);<br>set.add(<span class="hljs-string">&quot;C&quot;</span>);<br>System.out.println(set); <span class="hljs-comment">// [A, B, C]</span><br></code></pre></td></tr></table></figure>
<h3 id="ä¿æŒè®¿é—®é¡ºåº-lru-ç¼“å­˜">ä¿æŒè®¿é—®é¡ºåºï¼ˆLRU ç¼“å­˜ï¼‰</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// accessOrder=trueï¼šæŒ‰è®¿é—®é¡ºåºéå†</span><br>LinkedHashMap&lt;String, Integer&gt; lruCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;(<span class="hljs-number">16</span>, <span class="hljs-number">0.75f</span>, <span class="hljs-literal">true</span>) &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;String, Integer&gt; eldest)</span> &#123;<br>        <span class="hljs-keyword">return</span> size() &gt; <span class="hljs-number">3</span>; <span class="hljs-comment">// ç¼“å­˜å¤§å°é™åˆ¶ä¸º 3</span><br>    &#125;<br>&#125;;<br><br>lruCache.put(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">1</span>);<br>lruCache.put(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-number">2</span>);<br>lruCache.put(<span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-number">3</span>);<br><br><span class="hljs-comment">// è®¿é—® &quot;A&quot;ï¼Œå°†å…¶ç§»åˆ°æœ«å°¾</span><br>lruCache.get(<span class="hljs-string">&quot;A&quot;</span>);<br><br><span class="hljs-comment">// æ·»åŠ  &quot;D&quot;ï¼Œè§¦å‘ eldest ç§»é™¤ï¼ˆ&quot;B&quot; æ˜¯æœ€ä¹…æœªè®¿é—®çš„ï¼‰</span><br>lruCache.put(<span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-number">4</span>);<br><br><span class="hljs-comment">// å½“å‰é¡ºåºï¼šC -&gt; A -&gt; D</span><br>System.out.println(lruCache.keySet()); <span class="hljs-comment">// [C, A, D]</span><br></code></pre></td></tr></table></figure>
<h3 id="lru-ç¼“å­˜å®ç°">LRU ç¼“å­˜å®ç°</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span>&lt;K, V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;K, V&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxSize;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LRUCache</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> &#123;<br>        <span class="hljs-built_in">super</span>(<span class="hljs-number">16</span>, <span class="hljs-number">0.75f</span>, <span class="hljs-literal">true</span>);<br>        <span class="hljs-built_in">this</span>.maxSize = maxSize;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;K, V&gt; eldest)</span> &#123;<br>        <span class="hljs-keyword">return</span> size() &gt; maxSize;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span><br>LRUCache&lt;String, String&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LRUCache</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>cache.put(<span class="hljs-string">&quot;key1&quot;</span>, <span class="hljs-string">&quot;value1&quot;</span>);<br>cache.put(<span class="hljs-string">&quot;key2&quot;</span>, <span class="hljs-string">&quot;value2&quot;</span>);<br>cache.put(<span class="hljs-string">&quot;key3&quot;</span>, <span class="hljs-string">&quot;value3&quot;</span>);<br><br>cache.get(<span class="hljs-string">&quot;key1&quot;</span>); <span class="hljs-comment">// è®¿é—® key1</span><br>cache.put(<span class="hljs-string">&quot;key4&quot;</span>, <span class="hljs-string">&quot;value4&quot;</span>); <span class="hljs-comment">// æ·»åŠ  key4ï¼Œç§»é™¤ key2ï¼ˆæœ€ä¹…æœªè®¿é—®ï¼‰</span><br><br>System.out.println(cache.keySet()); <span class="hljs-comment">// [key3, key1, key4]</span><br></code></pre></td></tr></table></figure>
<h3 id="æ€§èƒ½å¯¹æ¯”">æ€§èƒ½å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>HashMap</th>
<th>LinkedHashMap</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ’å…¥/åˆ é™¤</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td>æŸ¥æ‰¾</td>
<td>O(1)</td>
<td>O(1)</td>
</tr>
<tr>
<td>éå†é¡ºåº</td>
<td>æ— åº</td>
<td>æ’å…¥é¡ºåº/è®¿é—®é¡ºåº</td>
</tr>
<tr>
<td>å†…å­˜å¼€é”€</td>
<td>è¾ƒå°</td>
<td>è¾ƒå¤§ï¼ˆç»´æŠ¤åŒå‘é“¾è¡¨ï¼‰</td>
</tr>
</tbody>
</table>
<p>ğŸ”‘ <strong>æ¨¡å¼æç‚¼ï¼šæœ‰åºé›†åˆä¸ LRU ç¼“å­˜</strong></p>
<p>å½“éœ€è¦ä¿æŒå…ƒç´ é¡ºåºæˆ–å®ç° LRU ç¼“å­˜æ—¶ï¼ŒLinkedHashMap/LinkedHashSet æä¾›äº†æ¯”æ‰‹åŠ¨ç»´æŠ¤é¡ºåºæ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚é€‚ç”¨äºå†å²è®°å½•ã€æœ€è¿‘è®¿é—®åˆ—è¡¨ã€ç¼“å­˜æ·˜æ±°ç­‰åœºæ™¯ã€‚</p>
<hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº† Java é›†åˆæ¡†æ¶ä¸­ä¸å¸¸è§ä½†åŠŸèƒ½å¼ºå¤§çš„é›†åˆç±»ï¼Œå®ƒä»¬åœ¨ç‰¹å®šåœºæ™¯ä¸‹èƒ½æä¾›æ›´ä¼˜é›…ã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼š</p>
<table>
<thead>
<tr>
<th>é›†åˆç±»</th>
<th>æ ¸å¿ƒç‰¹æ€§</th>
<th>å…¸å‹åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>TreeSet/TreeMap</td>
<td>è‡ªåŠ¨æ’åºã€èŒƒå›´æŸ¥è¯¢</td>
<td>èŒƒå›´æŸ¥è¯¢ã€æ’åºå­˜å‚¨</td>
</tr>
<tr>
<td>NavigableSet/Map</td>
<td>é‚»è¿‘æŸ¥æ‰¾</td>
<td>ä»·æ ¼åŒ¹é…ã€æ—¶é—´çª—å£</td>
</tr>
<tr>
<td>PriorityQueue</td>
<td>ä¼˜å…ˆçº§å †</td>
<td>Top-Kã€ä»»åŠ¡è°ƒåº¦</td>
</tr>
<tr>
<td>IdentityHashMap</td>
<td>å¼•ç”¨è¯­ä¹‰</td>
<td>æ·±æ‹·è´ã€åºåˆ—åŒ–</td>
</tr>
<tr>
<td>ConcurrentSkipListSet/Map</td>
<td>å¹¶å‘æœ‰åºé›†åˆ</td>
<td>é«˜å¹¶å‘æ’è¡Œæ¦œ</td>
</tr>
<tr>
<td>DelayQueue</td>
<td>å»¶è¿Ÿé˜Ÿåˆ—</td>
<td>ç¼“å­˜è¿‡æœŸã€è®¢å•è¶…æ—¶</td>
</tr>
<tr>
<td>EnumSet/EnumMap</td>
<td>æšä¸¾ä¸“ç”¨</td>
<td>æ ‡å¿—ä½ã€çŠ¶æ€æœº</td>
</tr>
<tr>
<td>WeakHashMap</td>
<td>å¼±å¼•ç”¨</td>
<td>è‡ªåŠ¨æ¸…ç†ç¼“å­˜</td>
</tr>
<tr>
<td>LinkedHashMap/HashSet</td>
<td>é¡ºåºä¿æŒ</td>
<td>LRU ç¼“å­˜ã€å†å²è®°å½•</td>
</tr>
</tbody>
</table>
<p>æŒæ¡è¿™äº›ä¸å¸¸è§çš„é›†åˆç±»ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ åœ¨ç‰¹å®šåœºæ™¯ä¸‹é€‰æ‹©æœ€åˆé€‚çš„æ•°æ®ç»“æ„ï¼Œç¼–å†™å‡ºæ›´é«˜æ•ˆã€æ›´ä¼˜é›…çš„ä»£ç ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://magicliang.github.io">magicliang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://magicliang.github.io/2018/01/04/%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84-Java-%E9%9B%86%E5%90%88%E7%B1%BB%E7%9A%84%E7%94%A8%E6%B3%95/">https://magicliang.github.io/2018/01/04/%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%9A%84-Java-%E9%9B%86%E5%90%88%E7%B1%BB%E7%9A%84%E7%94%A8%E6%B3%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post-share"><div class="social-share" data-image="/img/wall-paper-179.jpeg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2017/10/23/%E6%98%82%E8%B4%B5%E7%9A%84%E5%BC%82%E5%B8%B8/" title="æ˜‚è´µçš„å¼‚å¸¸"><img class="cover" src="/img/wall-paper-96.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-23</div><div class="info-item-2">æ˜‚è´µçš„å¼‚å¸¸</div></div><div class="info-2"><div class="info-item-1">æŠ›å‡ºé—®é¢˜ Joshua Bloch åœ¨ã€ŠEffective Javaã€‹çš„ Item 57 é‡Œæ˜ç¡®åœ°æåˆ°è¿‡ï¼Œä¸è¦è¯•å›¾ç”¨ Exception çš„è·³è½¬æ¥ä»£æ›¿æ­£å¸¸çš„ç¨‹åºæ§åˆ¶æµã€‚ä»–åˆ—ä¸¾äº†å¾ˆå¤šåŸå› ï¼Œä½†ç‰¹åˆ«æåˆ°äº†æŠ›å‡ºå¼‚å¸¸ä¼šä½¿å¾—æ•´ä¸ªç¨‹åºè¿è¡Œå˜æ…¢ã€‚æŠ›å‡ºå¼‚å¸¸è¿œæ¯”æ™®é€šçš„ returnã€break ç­‰æ“ä½œå¯¹æ§åˆ¶æµã€æ•°æ®æµçš„æ€§èƒ½å½±å“è¦å¤§ï¼Œå®ƒå°±åªé€‚åˆæ‹¿æ¥ä½œå¼‚å¸¸åˆ†æ”¯çš„æ§åˆ¶è¯­å¥ï¼Œè€Œä¸èƒ½æ‹¿æ¥ç¼–å†™æ­£å¸¸çš„é€»è¾‘ã€‚  Throwing exception is expensive.  è¿™å¥è¯åœ¨ Java çš„ç¨‹åºå‘˜ä¸–ç•Œé‡Œé¢å·²ç»æˆä¸ºè€ç”Ÿå¸¸è°ˆï¼Œå´å¾ˆå°‘æœ‰äººè°ˆåŠåˆ°åº•æŠ›å‡ºå¼‚å¸¸æ¯”æ­£å¸¸çš„ç¨‹åºè·³è½¬è¿”å›æ…¢åœ¨å“ªé‡Œï¼Œæœ‰å¤šæ…¢ã€‚&quot;ä¸è¦æ»¥ç”¨å¼‚å¸¸&quot;å¥½åƒä¸€ä¸ªçŒ´å­å®šå¾‹ï¼Œäººä»¬çŸ¥é“ä¸èƒ½è¿™ä¹ˆåšï¼Œå´ä¸æ˜ç™½ä¸ºä»€ä¹ˆä¸èƒ½è¿™ä¹ˆåšã€‚ æ­¤å‰è¯»äº†ä¸€ä½åŒäº‹å†™çš„å¥½æ–‡ã€ŠJavaè™šæ‹Ÿæœºæ˜¯å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ã€‹ï¼Œæ·±å…¥åœ°åˆ†æäº† JVM å¯¹å¼‚å¸¸è·³è½¬çš„å¤„ç†è¿‡ç¨‹ï¼šJVM ä¼šé€šè¿‡å¼‚å¸¸è¡¨çš„æœºåˆ¶ï¼Œä¼˜åŒ–å¼‚å¸¸æŠ›å‡ºå’Œæ­£å¸¸è¿”å›ä¹‹é—´çš„æ€§èƒ½å·®å¼‚ã€‚ä»…ä»ç¨‹åºè®¡æ•°å™¨çš„ç§»åŠ¨ä¸Šæ¥è®²ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹æ ˆå¸§çš„å¼¹æ ˆå¹¶ä¸æ¯”ç›´æ¥è¿”å›æ›´æ˜‚è´µã€‚å†™åœ¨å‰å¤´çš„ç»“è®ºæ˜¯ï¼š&quot;try-catch è¯­å¥å—å‡ ä¹ä¸ä¼šå½±å“ç¨‹åºè¿è¡Œæ€§èƒ½ï¼...</div></div></div></a><a class="pagination-related" href="/2017/11/30/Java%E4%B8%AD%E7%9A%84%E5%B9%BD%E7%81%B5%E7%B1%BB%E5%9E%8B/" title="Javaä¸­çš„å¹½çµç±»å‹"><img class="cover" src="/img/wall-paper-113.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2017-11-30</div><div class="info-item-2">Javaä¸­çš„å¹½çµç±»å‹</div></div><div class="info-2"><div class="info-item-1">ä»€ä¹ˆæ˜¯å¹½çµç±»å‹ å…ˆä¸Šç»“è®ºï¼šå¹½çµç±»å‹ï¼ˆPhantom Typeï¼‰é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¹½çµèˆ¬çš„ç±»å‹ï¼Œè¿™ç§ç±»å‹å¾€å¾€åœ¨è¿è¡Œæ—¶å¯ä»¥æ¶ˆå¤±ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå®ƒä»¬æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ²¡æœ‰ä»»ä½•å®ä¾‹ï¼ˆJava çš„ Void å°±æ˜¯ä¸€ä¸ªä¸å¯å®ä¾‹åŒ–ç±»å‹çš„ä¾‹å­ï¼Œå¸¸è¢«ç”¨ä½œå¹½çµç±»å‹çš„ç±»å‹å‚æ•°ï¼Œå¦‚ Future&lt;Void&gt;ï¼‰ã€‚å¹½çµç±»å‹æ˜¯ä¸€ç§å¯ä»¥æŠŠæœ‰äº›è¿è¡Œæ—¶æ‰èƒ½æ£€æµ‹åˆ°çš„é”™è¯¯ï¼Œåœ¨ç¼–è¯‘æ—¶æ£€æµ‹å‡ºæ¥çš„æŠ€å·§ã€‚æŒ‰ç…§æœ‰äº›è€å¤–çš„è§‚ç‚¹ï¼Œå°±æ˜¯&quot;Making Wrong Code Look Wrong&quot;ã€‚åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸­ï¼Œå¹½çµç±»å‹çš„å®ç°ï¼Œå¾€å¾€ä¸çŠ¶æ€æ¨¡å¼è¾ƒä¸ºæ¥è¿‘ï¼Œä½†æ¯”çŠ¶æ€æ¨¡å¼æä¾›äº†æ›´å¼ºçš„çº é”™åŠŸèƒ½ã€‚åœ¨ Java 5 ä»¥åçš„ç‰ˆæœ¬é‡Œï¼Œç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨æ³›å‹ã€‚é€šè¿‡æ³›å‹çš„ç±»å‹å‚æ•°ï¼ŒJava ä¸­ä¹Ÿæ‹¥æœ‰äº†å¹½çµç±»å‹çš„èƒ½åŠ›ã€‚ ä¸Šé¢çš„é˜è¿°æ˜¯ä¸æ˜¯å¾ˆéš¾çœ‹æ‡‚ï¼Ÿç›´æ¥è¿›å…¥å…·ä½“çš„ä¾‹å­ã€‚å‡è®¾æœ‰ä¸€ä¸ªé£æœºæ§åˆ¶ç¨‹åºï¼Œæ“ä½œé£æœºèµ·é£æˆ–è€…è½åœ°ã€‚è¿™ä¸ªç¨‹åºæœ‰ä¸€ä¸ªéå¸¸å¼ºçš„ä¸šåŠ¡çº¦æŸï¼Œå°±æ˜¯å¿…é¡»ä¿è¯é£æœºä¸€å¼€å§‹å¿…é¡»å‡ºç°åœ¨åœ°ä¸Šï¼Œåªæœ‰åœ¨åœ°ä¸Šçš„é£æœºå¯ä»¥èµ·é£ï¼Œåªæœ‰èµ·é£çš„é£æœºå¯ä»¥è½åœ°ï¼Œé‚£ä¹ˆåº”è¯¥æ€æ ·è®¾è®¡ç¨‹åºï¼ˆä¸»è¦æ˜¯ç±»å‹å…³ç³»ï¼‰ï¼Œæ¥ä¿è¯è¿™ä¸ªçº¦æŸå¿…ç„¶æˆç«‹å‘¢ï¼Ÿ å®šä¹‰çŠ¶æ€æ¥å£ å…ˆæ¥å®šä¹‰...</div></div></div></a><a class="pagination-related" href="/2018/05/29/JPA-%E7%9A%84-id-%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5/" title="JPA çš„ id ç”Ÿæˆç­–ç•¥"><img class="cover" src="/img/wall-paper-139.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-05-29</div><div class="info-item-2">JPA çš„ id ç”Ÿæˆç­–ç•¥</div></div><div class="info-2"><div class="info-item-1">JPA æœ‰ä¸€ä¸ª@GeneratedValueæ³¨è§£ï¼Œæœ‰ä¸€ä¸ªstrategy attributeï¼Œå¦‚ @GeneratedValue(strategy = GenerationType.IDENTITY)ã€‚ å¸¸è§çš„å¯é€‰ç­–ç•¥ä¸»è¦æœ‰IDENTITYå’ŒSEQUENCEã€‚ GenerationType.IDENTITY è¦æ±‚åº•å±‚æœ‰ä¸€ä¸ª integer æˆ–è€… bigint ç±»å‹çš„è‡ªå¢åˆ—ï¼ˆ auto-incremented column)ã€‚è‡ªå¢åˆ—çš„èµ‹å€¼å¿…é¡»åœ¨æ’å…¥æ“ä½œä¹‹åå‘ç”Ÿï¼Œå› ä¸ºè¿™ä¸ªåŸå› ï¼ŒHibernate æ— æ³•è¿›è¡Œå„ç§ä¼˜åŒ–ï¼ˆç‰¹åˆ«æ˜¯ JDBC çš„ batch å¤„ç†ï¼Œä¸€æ¬¡ flush æ“ä½œä¼šäº§ç”Ÿå¾ˆå¤šæ¡insert è¯­å¥ï¼Œåˆ†åˆ«æ‰§è¡Œï¼‰ã€‚å¦‚æœäº‹åŠ¡å›æ»šï¼Œè‡ªå¢åˆ—çš„å€¼å°±ä¼šè¢«ä¸¢å¼ƒã€‚æ•°æ®åº“åœ¨è¿™ä¸ªè‡ªå¢æ“ä½œä¸Šæœ‰ä¸ªé«˜åº¦ä¼˜åŒ–çš„è½»é‡çº§é”æœºåˆ¶ï¼Œæ€§èƒ½éå¸¸æ£’ã€‚ MySQL æ”¯æŒè¿™ç§ id ç”Ÿæˆç­–ç•¥ï¼Œ ä½¿ç”¨ MySQL åº”è¯¥å°½é‡ä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼Œå³ä½¿å®ƒæ— æ³•ä¼˜åŒ–ã€‚ JPA ç”¨å®ƒç”Ÿæˆ idï¼Œä¼šä¸€æ¡ä¸€æ¡åœ°æ’å…¥æ–°çš„ entityã€‚ GenerationType.SEQUENCE æ•°æ®åº“æœ‰ä¸€ä¸ªæ‰€è°“çš„ sequence å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ selec...</div></div></div></a><a class="pagination-related" href="/2018/06/19/%E5%A6%82%E4%BD%95%E5%81%9A%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%8B%E7%9A%84%E7%AD%94%E6%A1%88/" title="å¦‚ä½•åšæ€§èƒ½æµ‹è¯•çš„é—®é¢˜ä¸‹çš„ç­”æ¡ˆ"><img class="cover" src="/img/wall-paper-82.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-19</div><div class="info-item-2">å¦‚ä½•åšæ€§èƒ½æµ‹è¯•çš„é—®é¢˜ä¸‹çš„ç­”æ¡ˆ</div></div><div class="info-2"><div class="info-item-1">è¯•ç€å›ç­”ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ é¦–å…ˆè¦åˆ’åˆ†ç³»ç»Ÿç±»å‹ï¼šæœ‰çŠ¶æ€è¿˜æ˜¯æ— çŠ¶æ€ï¼Œä¸šåŠ¡ç³»ç»Ÿè¿˜æ˜¯å­˜å‚¨ç³»ç»Ÿã€‚æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œè®¾ç«‹æ€§èƒ½æµ‹è¯•çš„ç›®æ ‡ï¼šæ˜¯è¦æµ‹ QPSï¼Œè¿˜æ˜¯ TPS è¿˜æ˜¯ TPSï¼Œè¿˜æ˜¯ä»»ä½•å…¶ä»–ã€æ€§èƒ½ã€‘-ä»å¹¿ä¹‰æ¥è®²ï¼Œä¸€ä¸ªå­˜å‚¨ç³»ç»Ÿåˆ°åº•èƒ½å¤Ÿä»¥å¤šé«˜çš„å¹³å‡æ—¶å»¶æ¥ç®¡ç†å¤§å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œå¯èƒ½ä¹Ÿæ˜¯æ€§èƒ½çš„ä¸€ç§ã€‚ æœ‰äº†æ€§èƒ½æµ‹è¯•çš„ç›®æ ‡ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‹†è§£ç”¨ä¾‹ã€‚å¦‚æœæŠŠæ€§èƒ½æµ‹è¯•å½’ä¸ºæµ‹è¯•çš„è¯ï¼Œæµ‹è¯•å°±éœ€è¦æµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•ç”¨ä¾‹åªæ˜¯ç”¨ä¾‹çš„å½¢å¼åŒ–è¡¨è¾¾ã€‚æŠŠç”¨æˆ·çš„ä½¿ç”¨åœºæ™¯å‹¾å‹’å‡ºæ¥ï¼ŒæŠŠæ¯ä¸€æ­¥æ‹†è§£æˆçš„æµç¨‹å›¾æˆ–è€…æ—¶åºå›¾â€“æˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªçº¸ä¸Šçš„é›†æˆæµ‹è¯•è®¡åˆ’ï¼Œåªæ˜¯æ²¡æœ‰è·Ÿæ€§èƒ½æŒ‚ä¸Šé’©ã€‚ æ¥ä¸‹æ¥å°±è¿›å…¥çœŸæ­£å†™æµ‹è¯•ç”¨ä¾‹çš„ç¯èŠ‚äº†ã€‚ æˆ‘ä»¬çš„æµ‹è¯•æŠ¥å‘Šå¦‚æœè¦æ¶µç›–è¶³å¤Ÿç«‹ä½“çš„ä¿¡æ¯ï¼Œåˆ™æ—¢è¦äº†è§£æ¯ä¸€ä¸ªç¯èŠ‚/æ¥å£/API çš„æ€§èƒ½æŒ‡æ ‡ï¼Œåˆè¦äº†è§£æ•´ä½“çš„æ€§èƒ½æŒ‡æ ‡ã€‚ è¿™ä¸ªæ—¶å€™æµ‹è¯•å·¥å…·çš„è¦†ç›–é¢å°±å¾ˆé‡è¦äº†ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©åé»‘ç›’çš„æµ‹è¯•å·¥å…·ï¼Œapache ab /JMeterï¼Œåˆ™æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹å°±è¦å›´ç»•ç€å¯¹å¤–äº¤äº’çš„ APIå†™ï¼Œä¹Ÿåªèƒ½æµ‹åˆ°å¤–å›´æ¥å£çš„æ€§èƒ½ã€‚è¿™æ ·çš„æµ‹è¯•ç”¨ä¾‹å†™èµ·æ¥æœ€ç®€å•ï¼Œæ— éœ€ä¾µå…¥ä»»ä½•å†…éƒ¨ä»£ç ä¸­ã€‚ å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† JMH ä¸€ç±»çš„å·¥å…·ï¼Œåˆ™å¯ä»¥è‡ªç”±ç¼–å†™å¯¹ä»»ä½•æ–¹æ³•çš„æµ‹è¯•ç”¨ä¾‹ã€‚ä½†éœ€è¦å¯¹ç³»ç»Ÿæœ‰éå¸¸...</div></div></div></a><a class="pagination-related" href="/2018/09/07/%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4/" title="æ—¥æœŸä¸æ—¶é—´"><img class="cover" src="/img/wall-paper-163.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-09-07</div><div class="info-item-2">æ—¥æœŸä¸æ—¶é—´</div></div><div class="info-2"><div class="info-item-1">JSR 310 Java Dateä¸Time API æ–°æ—§ API çš„æ›´è¿­ æ—§çš„ Java API ä¸»è¦åŒ…æ‹¬java.util.Dateå’Œjava.util.Calendar ä¸¤ä¸ªåŒ…çš„å†…å®¹ã€‚è¿™ä¸¤ä¸ªåŒ…çš„æ—¶é—´ç±»å‹æ˜¯å¯å˜çš„ã€‚å¦‚ Date çš„å®ä¾‹å¯ä»¥é€šè¿‡ setYear æ¥äº§ç”Ÿå˜åŒ–ã€‚ JSR 310 ä¸­åŒ…æ‹¬çš„æ—¥æœŸç±»å‹ä¸»è¦æœ‰ï¼š  è®¡ç®—æœºæ—¶é—´ï¼šInstantï¼Œå¯¹åº” java.util.Dateï¼Œå®ƒä»£è¡¨äº†ä¸€ä¸ªç¡®å®šçš„æ—¶é—´ç‚¹ï¼Œå³ç›¸å¯¹äºæ ‡å‡†Javaçºªå…ƒï¼ˆ1970å¹´1æœˆ1æ—¥ï¼‰çš„åç§»é‡ï¼›ä½†ä¸java.util.Dateç±»ä¸åŒçš„æ˜¯å…¶ç²¾ç¡®åˆ°äº†çº³ç§’çº§åˆ«ã€‚ äººç±»æ—¶é—´ï¼šå¯¹åº”äºäººç±»è‡ªèº«çš„è§‚å¿µï¼Œæ¯”å¦‚LocalDateå’ŒLocalTimeã€‚ä»–ä»¬ä»£è¡¨äº†ä¸€èˆ¬çš„æ—¶åŒºæ¦‚å¿µï¼Œè¦ä¹ˆæ˜¯æ—¥æœŸï¼ˆä¸åŒ…å«æ—¶é—´ï¼‰ï¼Œè¦ä¹ˆæ˜¯æ—¶é—´ï¼ˆä¸åŒ…å«æ—¥æœŸï¼‰ï¼Œç±»ä¼¼äºjava.sqlçš„è¡¨ç¤ºæ–¹å¼ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªMonthDayï¼Œå®ƒå¯ä»¥å­˜å‚¨æŸäººçš„ç”Ÿæ—¥ï¼ˆä¸åŒ…å«å¹´ä»½ï¼‰ã€‚æ¯ä¸ªç±»éƒ½åœ¨å†…éƒ¨å­˜å‚¨æ­£ç¡®çš„æ•°æ®è€Œä¸æ˜¯åƒjava.util.Dateé‚£æ ·åˆ©ç”¨åˆå¤œ12ç‚¹æ¥åŒºåˆ†æ—¥æœŸï¼Œåˆ©ç”¨1970-01-01æ¥è¡¨ç¤ºæ—¶é—´ã€‚è¿™äº›ç±»å‹çš„å®ä¾‹æ˜¯ immutable çš„ï¼Œè€Œä¸”åªèƒ½é€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºã€‚  æ—¶åŒº...</div></div></div></a><a class="pagination-related" href="/2018/10/13/%E5%8D%A1%E8%A1%A8%E5%92%8C-RSet/" title="å¡è¡¨å’Œ RSet"><img class="cover" src="/img/wall-paper-146.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2018-10-13</div><div class="info-item-2">å¡è¡¨å’Œ RSet</div></div><div class="info-2"><div class="info-item-1">ä¸Šä¸‹æ–‡ å¡è¡¨å’Œ RSetï¼ˆRemember Setï¼‰ï¼Œæ˜¯ JVM ä¸ºäº†è§£å†³åˆ†ä»£æ”¶é›†æ—¶ï¼Œlive set æ‰«æéœ€è¦ç©¿æ¢­åˆ°ä¸åŒçš„ä»£çš„æ—¶å€™çš„æ•ˆç‡é—®é¢˜ã€‚ ä½¿ç”¨ç¼“å­˜è¡¨æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œæ˜¯åŒ–é¡ºåºæŸ¥æ‰¾ä¸ºéƒ¨åˆ†éšæœºæŸ¥æ‰¾çš„ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ€è·¯ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¼ ç»Ÿçš„è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼Œå½“æˆ‘ä»¬æŠŠå†…å­˜åˆ†æˆé¡µä»¥åï¼Œä¼šæœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œé¡µè¡¨åˆä¼šæœ‰ä¸€ä¸ªå¿«è¡¨ï¼Œä½œä¸ºä¸€ä¸ªä¸­é—´ç¼“å­˜é¡¹ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„é¡µè¡¨é¡¹ï¼ˆtable entryï¼‰ã€‚ JVM åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†çš„æ—¶å€™ï¼Œæœ‰ä¸€é¡¹éå¸¸é‡è¦çš„å·¥ä½œå°±æ˜¯ç¡®å®šè¿™ä¸€æ¬¡åƒåœ¾æ”¶é›†çš„å¯¹è±¡åˆ°åº•æœ‰å¤šå°‘ä¸ªï¼Œå³ç¡®å®š live set çš„èŒƒå›´ã€‚ å¯¹äºæ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨è€Œè¨€ï¼Œè¿™ä¸ªé—®é¢˜åˆæœ‰å…¶ç‰¹æ®Šä¹‹å¤„ã€‚æ ¹æ® JVM çš„å¼±åˆ†ä»£æ”¶é›†å‡è®¾ï¼ˆweak generational hypothesisï¼‰çš„å­˜åœ¨ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£çš„æ‰«æèŒƒå›´å¯èƒ½å¾ˆå¤§ï¼Œä½†æ–°ç”Ÿä»£çš„ live set ä¸åº”è¯¥å¤ªå¤§ã€‚card table/Remember Set çš„è®¾è®¡ç›®çš„ï¼Œå°±æ˜¯å°½é‡å‡å°‘æ— ç”¨çš„åƒåœ¾æ‰«æèŒƒå›´ï¼Œä½¿ç”¨ç±»ä¼¼æ“ä½œç³»ç»Ÿæˆ–è€…æ•°æ®åº“çš„è„é¡µè¡¨çš„å½¢å¼ï¼Œæ¥åšç±»ä¼¼å¿«è¡¨çš„æŸ¥è¯¢ã€‚ å¡è¡¨ï¼ˆcard tableï¼‰  å¡è¡¨æ˜¯ CMS çš„è§£å†³æ–¹æ¡ˆã€‚ å¡è¡¨é€šå¸¸åœ¨ JV...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#sorted-%E9%9B%86%E5%90%88"><span class="toc-number">1.</span> <span class="toc-text">Sorted é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">1.1.</span> <span class="toc-text">æ ¸å¿ƒç‰¹æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.</span> <span class="toc-text">å…³é”®æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E6%8E%92%E5%BA%8F-vs-comparator"><span class="toc-number">1.3.</span> <span class="toc-text">è‡ªç„¶æ’åº vs Comparator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#treemap-%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.</span> <span class="toc-text">TreeMap ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#navigable-%E9%9B%86%E5%90%88"><span class="toc-number">2.</span> <span class="toc-text">Navigable é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">æ ¸å¿ƒæ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#navigablemap-%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.2.</span> <span class="toc-text">NavigableMap ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#priority-%E9%9B%86%E5%90%88"><span class="toc-number">3.</span> <span class="toc-text">Priority é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">åº•å±‚ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">åŸºæœ¬ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.3.</span> <span class="toc-text">å®é™…åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#top-k-%E9%97%AE%E9%A2%98"><span class="toc-number">3.3.1.</span> <span class="toc-text">Top-K é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6"><span class="toc-number">3.3.2.</span> <span class="toc-text">ä»»åŠ¡è°ƒåº¦</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#identity-%E9%9B%86%E5%90%88"><span class="toc-number">4.</span> <span class="toc-text">Identity é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-hashmap-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.1.</span> <span class="toc-text">ä¸ HashMap çš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.2.</span> <span class="toc-text">ä½¿ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%8B%93%E6%89%91%E4%BF%9D%E6%8C%81"><span class="toc-number">4.2.1.</span> <span class="toc-text">å¯¹è±¡æ‹“æ‰‘ä¿æŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%90%86"><span class="toc-number">4.2.2.</span> <span class="toc-text">åºåˆ—åŒ–ä»£ç†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#skiplist-%E9%9B%86%E5%90%88"><span class="toc-number">5.</span> <span class="toc-text">SkipList é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%B3%E8%A1%A8%E5%8E%9F%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">è·³è¡¨åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#concurrentskiplistset"><span class="toc-number">5.2.</span> <span class="toc-text">ConcurrentSkipListSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#concurrentskiplistmap"><span class="toc-number">5.3.</span> <span class="toc-text">ConcurrentSkipListMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E-treemap-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">5.4.</span> <span class="toc-text">ä¸ TreeMap çš„å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delayqueue"><span class="toc-number">6.</span> <span class="toc-text">DelayQueue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#delayed-%E6%8E%A5%E5%8F%A3"><span class="toc-number">6.1.</span> <span class="toc-text">Delayed æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">åŸºæœ¬ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">6.3.</span> <span class="toc-text">å®é™…åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F"><span class="toc-number">6.3.1.</span> <span class="toc-text">ç¼“å­˜è¿‡æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A2%E5%8D%95%E8%B6%85%E6%97%B6%E5%8F%96%E6%B6%88"><span class="toc-number">6.3.2.</span> <span class="toc-text">è®¢å•è¶…æ—¶å–æ¶ˆ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#enumset-%E5%92%8C-enummap"><span class="toc-number">7.</span> <span class="toc-text">EnumSet å’Œ EnumMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#enumset"><span class="toc-number">7.1.</span> <span class="toc-text">EnumSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#enummap"><span class="toc-number">7.2.</span> <span class="toc-text">EnumMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8A%BF"><span class="toc-number">7.3.</span> <span class="toc-text">æ€§èƒ½ä¼˜åŠ¿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#weakhashmap"><span class="toc-number">8.</span> <span class="toc-text">WeakHashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B1%E5%BC%95%E7%94%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">8.1.</span> <span class="toc-text">å¼±å¼•ç”¨æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">8.2.</span> <span class="toc-text">å®é™…åº”ç”¨åœºæ™¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.2.1.</span> <span class="toc-text">ç¼“å­˜å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%85%83%E6%95%B0%E6%8D%AE%E5%85%B3%E8%81%94"><span class="toc-number">8.2.2.</span> <span class="toc-text">å¯¹è±¡å…ƒæ•°æ®å…³è”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">8.3.</span> <span class="toc-text">æ³¨æ„äº‹é¡¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#linkedhashmap-%E5%92%8C-linkedhashset"><span class="toc-number">9.</span> <span class="toc-text">LinkedHashMap å’Œ LinkedHashSet</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81%E6%8F%92%E5%85%A5%E9%A1%BA%E5%BA%8F"><span class="toc-number">9.1.</span> <span class="toc-text">ä¿æŒæ’å…¥é¡ºåº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81%E8%AE%BF%E9%97%AE%E9%A1%BA%E5%BA%8F-lru-%E7%BC%93%E5%AD%98"><span class="toc-number">9.2.</span> <span class="toc-text">ä¿æŒè®¿é—®é¡ºåºï¼ˆLRU ç¼“å­˜ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lru-%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.3.</span> <span class="toc-text">LRU ç¼“å­˜å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="toc-number">9.4.</span> <span class="toc-text">æ€§èƒ½å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">10.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2017 - 2026 By magicliang</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional and Simplified Chinese">ç°¡</button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="/js/tw_cn.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const config = mermaidSrc.dataset.config ? JSON.parse(mermaidSrc.dataset.config) : {}
      if (!config.theme) {
        config.theme = theme
      }
      const mermaidThemeConfig = `%%{init: ${JSON.stringify(config)}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="/"></script></div></body></html>